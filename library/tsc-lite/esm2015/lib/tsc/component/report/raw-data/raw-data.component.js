import { __awaiter } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { DropdownTypeEnum } from '../../../enum/dropdown.enum';
import { ReportErrorEnum } from '../../../enum/error.enum';
import { Parameter } from '../../../model/parameter.model';
import { Alert } from '../../../model/alert.model';
import { AggregateDataRequest } from '../../../model/aggregate-data.model';
// tsc-library
import { CUSTOM_RANGE_CONSTANT_EXCLUSIVE_DATE, DateFormatEnum, DateInputTypeEnum, DateTypeEnum } from '@library/date';
import { ToastrColor } from '@library/toastr-service';
import { ButtonLabelEnum, COMMON_CONSTANT, InvalidForm, MATERIAL_CONSTANT, MaterialFormFieldAppearance, MessageAlertIconEnum, MessageAlertTypeEnum } from '@library/tsc-common';
import * as i0 from "@angular/core";
import * as i1 from "@library/storage-service";
import * as i2 from "@library/toastr-service";
import * as i3 from "@library/tsc-common";
import * as i4 from "../../../service/aggregate-data.service";
import * as i5 from "../../../service/parameter.service";
import * as i6 from "../../../service/report.service";
import * as i7 from "../../../service/alert.service";
import * as i8 from "@library/date";
import * as i9 from "../../dropdown/entity/entity.component";
import * as i10 from "../../dropdown/device/device.component";
import * as i11 from "@angular/material/core";
import * as i12 from "@angular/common";
// /tsc-library/
export class RawDataReportComponent {
    constructor(storageService, toastService, tscCommonService, aggregateDataService, parameterService, reportService, alertService) {
        this.storageService = storageService;
        this.toastService = toastService;
        this.tscCommonService = tscCommonService;
        this.aggregateDataService = aggregateDataService;
        this.parameterService = parameterService;
        this.reportService = reportService;
        this.alertService = alertService;
        this.materialConstant = MATERIAL_CONSTANT;
        this.commonConstant = COMMON_CONSTANT;
        this.customRangeConstant = CUSTOM_RANGE_CONSTANT_EXCLUSIVE_DATE;
        this.materialFormFieldAppearance = MaterialFormFieldAppearance;
        this.buttonLabelEnum = ButtonLabelEnum;
        this.dropdownTypeEnum = DropdownTypeEnum;
        this.dateFormatEnum = DateFormatEnum;
        this.dateInputTypeEnum = DateInputTypeEnum;
        this.dateTypeEnum = DateTypeEnum;
        this.showAlert = false;
        this.showLoader = false;
        this.parameterM = [new Parameter()];
        this.reportAlertObj = new Alert();
    }
    ngOnInit() {
        this.orgID = this.storageService.getStorage('currentOrgID');
        this.timezone = this.storageService.getStorage('timezone');
    }
    dateInpChange() {
        this.startDate = this.customDateInput.startDateFC.value;
        this.endDate = this.customDateInput.endDateFC.value;
    }
    entityInpChange() {
        this.entityID = this.entityInput.entityFC.value;
    }
    deviceInpChange() {
        this.deviceID = this.deviceInput.deviceFC.value;
        if (this.deviceID) {
            this.getParameterByDeviceID(this.deviceID);
        }
    }
    getParameterByDeviceID(deviceID) {
        return __awaiter(this, void 0, void 0, function* () {
            let requestBody = {};
            requestBody['deviceID'] = [deviceID];
            this.parameterM = (yield this.parameterService.getParameterByDeviceID(this.orgID, requestBody));
        });
    }
    viewReport() {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            this.alertService.resetAlertProperties(this.reportAlertObj);
            if (!this.parameterM || this.parameterM.length == 0 || !this.parameterM[0]['id']) {
                yield this.getParameterByDeviceID(this.deviceID);
            }
            if (this.isValidInputField()) {
                this.toastService.openToast(InvalidForm.INVALID_FORM_TITLE, InvalidForm.INVALID_FORM_MESSAGE, ToastrColor.ERROR);
                return;
            }
            if (this.startDate == this.endDate) {
                this.alertService.setAlertProperties(this.reportAlertObj, ReportErrorEnum.INVALID_DATE_LABEL, ReportErrorEnum.INVALID_DATE_MESSAGE, MessageAlertTypeEnum.INFO, MessageAlertIconEnum.INFO_ICON);
                return;
            }
            this.dayDifference = this.getTimeDifference(this.startDate, this.endDate);
            if (this.dayDifference <= 1) {
                try {
                    this.showLoader = true;
                    const requestData = this.createDataRequest();
                    this.reportData = yield this.aggregateDataService.getAggregateData(this.orgID, requestData);
                    if (((_a = this.reportData) === null || _a === void 0 ? void 0 : _a.length) > 0) {
                        this.timestamp = this.reportService.extractTimestamp(this.reportData);
                        this.renderTable = this.reportService.populateTable(this.timestamp, this.reportData, this.dateFormatEnum.DATE_TIME);
                    }
                    else if (((_b = this.reportData) === null || _b === void 0 ? void 0 : _b.length) == 0) {
                        this.alertService.setAlertProperties(this.reportAlertObj, ReportErrorEnum.DATA_NOT_FOUND_LABEL, ReportErrorEnum.DATA_NOT_FOUND_MESSAGE, MessageAlertTypeEnum.WARNING, MessageAlertIconEnum.WARNING_ICON);
                    }
                }
                catch (error) {
                    console.error("Error in viewReport()", error);
                    this.alertService.setAlertProperties(this.reportAlertObj, ReportErrorEnum.INVALID_ERROR_LABEL, ReportErrorEnum.INVALID_ERROR_MESSAGE, MessageAlertTypeEnum.DANGER, MessageAlertIconEnum.DANGER_ICON);
                }
                finally {
                    this.showLoader = false;
                }
            }
            else {
                this.alertService.setAlertProperties(this.reportAlertObj, ReportErrorEnum.TIME_EXCEEDED_LABEL, ReportErrorEnum.TIME_EXCEEDED_MESSAGE, MessageAlertTypeEnum.INFO, MessageAlertIconEnum.INFO_ICON);
            }
        });
    }
    createDataRequest() {
        const requestData = new AggregateDataRequest();
        requestData.startTime = this.startDate;
        requestData.endTime = this.endDate;
        requestData.interval = "raw";
        requestData.entityID = [this.entityID];
        requestData.deviceID = [this.deviceID];
        requestData.params = this.parameterM.map(param => ({
            name: param.paramMetric,
            dsAgg: 'avg',
            agg: 'avg'
        }));
        requestData.nullifyParams();
        return requestData;
    }
    isValidInputField() {
        const controls = [
            this.customDateInput.startDateFC,
            this.entityInput.entityFC,
            this.deviceInput.deviceFC,
        ];
        controls.forEach(control => control.markAsTouched());
        return controls.some(control => control.invalid);
    }
    getTimeDifference(startTime, endTime) {
        const date1 = new Date(startTime).getTime();
        const date2 = new Date(endTime).getTime();
        const diffTime = Math.abs(date2 - date1);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
    }
}
RawDataReportComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: RawDataReportComponent, deps: [{ token: i1.StorageService }, { token: i2.ToastrService }, { token: i3.TSCCommonService }, { token: i4.AggregateDataService }, { token: i5.ParameterService }, { token: i6.ReportService }, { token: i7.AlertService }], target: i0.ɵɵFactoryTarget.Component });
RawDataReportComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: RawDataReportComponent, selector: "lib-raw-data", viewQueries: [{ propertyName: "customDateInput", first: true, predicate: ["customDateInput"], descendants: true }, { propertyName: "entityInput", first: true, predicate: ["entityInput"], descendants: true }, { propertyName: "deviceInput", first: true, predicate: ["deviceInput"], descendants: true }], ngImport: i0, template: "<div class=\"card main-card cardOverwrite h100\">\n    <div class=\"headerContainer\">\n        <div class=\"headerLeftContainer\">\n            <div class=\"pageTitle\">Raw Data Report</div>\n        </div>\n    </div>\n\n    <div class=\"card-body\">\n        <div class=\"row\">\n            <div class=\"col-sm-3\">\n                <lib-date-input #customDateInput (emitFilter)=\"dateInpChange()\" [materialFieldWidthInp]=\"true\"\n                    [materialFormFieldAppearanceInp]=\"materialFormFieldAppearance.FORM_FIELD_APPEARANCE\"\n                    [isMandatoryFieldInp]=\"true\" [dateInputTypeInp]=\"dateInputTypeEnum.CUSTOM_INPUT\"\n                    [dateTypeInp]=\"dateTypeEnum.EXCLUSIVE\" [showDefaultDurationInp]=\"true\" [showCdrRangeLabelInp]=\"true\"\n                    [labelInp]=\"'Select date'\" [timezoneInp]=\"timezone\" [rangeInp]=\"customRangeConstant\" [showTimeInCDRInp]=\"true\"\n                    [showRangeInp]=\"true\" [cdrFormatInp]=\"'YYYY-MM-DD HH:mm:ss'\"></lib-date-input>\n            </div>\n\n            <div class=\"col-sm-3\">\n                <lib-entity #entityInput (emitFilter)=\"entityInpChange()\"></lib-entity>\n            </div>\n\n            <div class=\"col-sm-3\">\n                <lib-device #deviceInput [dropdownTypeInp]=\"dropdownTypeEnum.SINGLE_DROPDOWN\" [entityInp]=\"entityID\"\n                    (emitFilter)=\"deviceInpChange()\"></lib-device>\n            </div>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-sm-12\">\n                <div class=\"float-end\">\n                    <button class=\"btn btn-sm btn-primary\" type=\"button\" (click)=\"viewReport()\" matRipple\n                        [matRippleCentered]=\"materialConstant.MAT_RIPPLE_CENTER\">\n                        {{ buttonLabelEnum.READ_BTN_LABEL }}\n                    </button>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-sm-12\">\n                <lib-message-alert *ngIf=\"reportAlertObj.showAlert\" [labelInp]=\"reportAlertObj.alertLabel\"\n                    [contentInp]=\"reportAlertObj.alertContent\" [messageAlertTypeInp]=\"reportAlertObj.messageAlertType\"\n                    [messageAlertIconInp]=\"reportAlertObj.messageAlertIcon\">\n                </lib-message-alert>\n            </div>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"centerAlign\">\n                <lib-skeleton-loader *ngIf=\"showLoader\" [count]=\"3\" [appearance]=\"'circle'\"\n                    [theme]=\"{ height: '15px', width: '15px', 'background-color': '#e7ebf3' }\"></lib-skeleton-loader>\n            </div>\n        </div>\n\n        <div class=\"row mt-3\" *ngIf=\"reportData && reportData.length > 0\">\n            <div class=\"overflowX customScrollBar\">\n                <table class=\"table\">\n                    <tbody>\n                        <tr class=\"tableHeader\">\n                            <td class=\"fw-bold\"> Sr. No. </td>\n                            <td align=\"center\" class=\"fw-bold\"> Time </td>\n                            <ng-container *ngFor=\"let data of reportData; let i = index\">\n                                <td align=\"center\" class=\"fw-bold\">\n                                    {{ data.paramLabel }} ({{ data.unit }}) ({{ data.dsAgg }})\n                                </td>\n                            </ng-container>\n                        </tr>\n                    </tbody>\n                    <tbody>\n                        <tr *ngFor=\"let row of renderTable\">\n                            <td>{{ row.index }}</td>\n                            <td align=\"center\" class=\"colWidthContainingDateTime\">{{ row.time }}</td>\n                            <td align=\"center\" *ngFor=\"let value of row.data\">{{ value ? value : commonConstant.HYPHEN\n                                }}\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n</div>", components: [{ type: i8.DateInputComponent, selector: "lib-date-input", inputs: ["materialFormFieldAppearanceInp", "materialFieldWidthInp", "dateInputTypeInp", "dateTypeInp", "timezoneInp", "labelInp", "rangeInp", "cdrFormatInp", "isMandatoryFieldInp", "showRangeInp", "showCdrRangeLabelInp", "showDefaultDurationInp", "showTimeInCDRInp"], outputs: ["emitFilter"] }, { type: i9.EntityComponent, selector: "lib-entity", inputs: ["dropdownTypeInp"], outputs: ["emitFilter"] }, { type: i10.DeviceComponent, selector: "lib-device", inputs: ["dropdownTypeInp", "entityInp"], outputs: ["emitFilter"] }, { type: i3.MessageAlertComponent, selector: "lib-message-alert", inputs: ["messageAlertTypeInp", "messageAlertIconInp", "labelInp", "contentInp"] }, { type: i3.SkeletonComponent, selector: "lib-skeleton-loader", inputs: ["count", "appearance", "theme"] }], directives: [{ type: i11.MatRipple, selector: "[mat-ripple], [matRipple]", inputs: ["matRippleRadius", "matRippleDisabled", "matRippleTrigger", "matRippleColor", "matRippleUnbounded", "matRippleCentered", "matRippleAnimation"], exportAs: ["matRipple"] }, { type: i12.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i12.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: RawDataReportComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-raw-data',
                    templateUrl: './raw-data.component.html',
                    styles: []
                }]
        }], ctorParameters: function () { return [{ type: i1.StorageService }, { type: i2.ToastrService }, { type: i3.TSCCommonService }, { type: i4.AggregateDataService }, { type: i5.ParameterService }, { type: i6.ReportService }, { type: i7.AlertService }]; }, propDecorators: { customDateInput: [{
                type: ViewChild,
                args: ['customDateInput']
            }], entityInput: [{
                type: ViewChild,
                args: ['entityInput']
            }], deviceInput: [{
                type: ViewChild,
                args: ['deviceInput']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmF3LWRhdGEuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbGlicmFyeS90c2MtbGl0ZS9zcmMvbGliL3RzYy9jb21wb25lbnQvcmVwb3J0L3Jhdy1kYXRhL3Jhdy1kYXRhLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xpYnJhcnkvdHNjLWxpdGUvc3JjL2xpYi90c2MvY29tcG9uZW50L3JlcG9ydC9yYXctZGF0YS9yYXctZGF0YS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJN0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRTNELE9BQU8sRUFBRSxTQUFTLEVBQWMsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN2RSxPQUFPLEVBQUUsS0FBSyxFQUFVLE1BQU0sNEJBQTRCLENBQUM7QUFDM0QsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFVM0UsY0FBYztBQUNkLE9BQU8sRUFBRSxvQ0FBb0MsRUFBRSxjQUFjLEVBQXNCLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUxSSxPQUFPLEVBQUUsV0FBVyxFQUFpQixNQUFNLHlCQUF5QixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSwyQkFBMkIsRUFBRSxvQkFBb0IsRUFBRSxvQkFBb0IsRUFBb0IsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7QUFDbE0sZ0JBQWdCO0FBU2hCLE1BQU0sT0FBTyxzQkFBc0I7SUFpQy9CLFlBQ1ksY0FBOEIs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QU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM3RCxPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDOztvSEE3SlEsc0JBQXNCO3dHQUF0QixzQkFBc0Isa1dDakNuQyxzaElBa0ZNOzRGRGpETyxzQkFBc0I7a0JBTmxDLFNBQVM7bUJBQUM7b0JBQ1AsUUFBUSxFQUFFLGNBQWM7b0JBQ3hCLFdBQVcsRUFBRSwyQkFBMkI7b0JBQ3hDLE1BQU0sRUFBRSxFQUNQO2lCQUNKO3lSQThCaUMsZUFBZTtzQkFBNUMsU0FBUzt1QkFBQyxpQkFBaUI7Z0JBQ0YsV0FBVztzQkFBcEMsU0FBUzt1QkFBQyxhQUFhO2dCQUNFLFdBQVc7c0JBQXBDLFNBQVM7dUJBQUMsYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0ICogYXMgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5cbmltcG9ydCB7IERyb3Bkb3duVHlwZUVudW0gfSBmcm9tICcuLi8uLi8uLi9lbnVtL2Ryb3Bkb3duLmVudW0nO1xuaW1wb3J0IHsgUmVwb3J0RXJyb3JFbnVtIH0gZnJvbSAnLi4vLi4vLi4vZW51bS9lcnJvci5lbnVtJztcblxuaW1wb3J0IHsgUGFyYW1ldGVyLCBQYXJhbWV0ZXJNIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWwvcGFyYW1ldGVyLm1vZGVsJztcbmltcG9ydCB7IEFsZXJ0LCBBbGVydE0gfSBmcm9tICcuLi8uLi8uLi9tb2RlbC9hbGVydC5tb2RlbCc7XG5pbXBvcnQgeyBBZ2dyZWdhdGVEYXRhUmVxdWVzdCB9IGZyb20gJy4uLy4uLy4uL21vZGVsL2FnZ3JlZ2F0ZS1kYXRhLm1vZGVsJztcblxuaW1wb3J0IHsgRW50aXR5Q29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZHJvcGRvd24vZW50aXR5L2VudGl0eS5jb21wb25lbnQnO1xuaW1wb3J0IHsgRGV2aWNlQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZHJvcGRvd24vZGV2aWNlL2RldmljZS5jb21wb25lbnQnO1xuXG5pbXBvcnQgeyBBZ2dyZWdhdGVEYXRhU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2UvYWdncmVnYXRlLWRhdGEuc2VydmljZSc7XG5pbXBvcnQgeyBQYXJhbWV0ZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZS9wYXJhbWV0ZXIuc2VydmljZSc7XG5pbXBvcnQgeyBSZXBvcnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZS9yZXBvcnQuc2VydmljZSc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlL2FsZXJ0LnNlcnZpY2UnO1xuXG4vLyB0c2MtbGlicmFyeVxuaW1wb3J0IHsgQ1VTVE9NX1JBTkdFX0NPTlNUQU5UX0VYQ0xVU0lWRV9EQVRFLCBEYXRlRm9ybWF0RW51bSwgRGF0ZUlucHV0Q29tcG9uZW50LCBEYXRlSW5wdXRUeXBlRW51bSwgRGF0ZVR5cGVFbnVtIH0gZnJvbSAnQGxpYnJhcnkvZGF0ZSc7XG5pbXBvcnQgeyBTdG9yYWdlU2VydmljZSB9IGZyb20gJ0BsaWJyYXJ5L3N0b3JhZ2Utc2VydmljZSc7XG5pbXBvcnQgeyBUb2FzdHJDb2xvciwgVG9hc3RyU2VydmljZSB9IGZyb20gJ0BsaWJyYXJ5L3RvYXN0ci1zZXJ2aWNlJztcbmltcG9ydCB7IEJ1dHRvbkxhYmVsRW51bSwgQ09NTU9OX0NPTlNUQU5ULCBJbnZhbGlkRm9ybSwgTUFURVJJQUxfQ09OU1RBTlQsIE1hdGVyaWFsRm9ybUZpZWxkQXBwZWFyYW5jZSwgTWVzc2FnZUFsZXJ0SWNvbkVudW0sIE1lc3NhZ2VBbGVydFR5cGVFbnVtLCBUU0NDb21tb25TZXJ2aWNlIH0gZnJvbSAnQGxpYnJhcnkvdHNjLWNvbW1vbic7XG4vLyAvdHNjLWxpYnJhcnkvXG5cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsaWItcmF3LWRhdGEnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9yYXctZGF0YS5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVzOiBbXG4gICAgXVxufSlcbmV4cG9ydCBjbGFzcyBSYXdEYXRhUmVwb3J0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIG1hdGVyaWFsQ29uc3RhbnQgPSBNQVRFUklBTF9DT05TVEFOVDtcbiAgICBjb21tb25Db25zdGFudCA9IENPTU1PTl9DT05TVEFOVDtcbiAgICBjdXN0b21SYW5nZUNvbnN0YW50ID0gQ1VTVE9NX1JBTkdFX0NPTlNUQU5UX0VYQ0xVU0lWRV9EQVRFO1xuXG4gICAgbWF0ZXJpYWxGb3JtRmllbGRBcHBlYXJhbmNlID0gTWF0ZXJpYWxGb3JtRmllbGRBcHBlYXJhbmNlO1xuICAgIGJ1dHRvbkxhYmVsRW51bSA9IEJ1dHRvbkxhYmVsRW51bTtcbiAgICBkcm9wZG93blR5cGVFbnVtID0gRHJvcGRvd25UeXBlRW51bTtcbiAgICBkYXRlRm9ybWF0RW51bSA9IERhdGVGb3JtYXRFbnVtO1xuICAgIGRhdGVJbnB1dFR5cGVFbnVtID0gRGF0ZUlucHV0VHlwZUVudW07XG4gICAgZGF0ZVR5cGVFbnVtID0gRGF0ZVR5cGVFbnVtO1xuXG4gICAgb3JnSUQ6IGFueTtcbiAgICB0aW1lem9uZTogc3RyaW5nO1xuICAgIHN0YXJ0RGF0ZTogc3RyaW5nO1xuICAgIGVuZERhdGU6IHN0cmluZztcbiAgICBlbnRpdHlJRDogYW55O1xuICAgIGRldmljZUlEOiBhbnk7XG4gICAgZGF5RGlmZmVyZW5jZTogYW55O1xuICAgIHRpbWVzdGFtcDogYW55O1xuICAgIHJlbmRlclRhYmxlOiBhbnk7XG4gICAgcmVwb3J0RGF0YTogYW55O1xuICAgIHNob3dBbGVydDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHNob3dMb2FkZXI6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHBhcmFtZXRlck0gPSBbbmV3IFBhcmFtZXRlcigpXTtcbiAgICByZXBvcnRBbGVydE9iajogQWxlcnRNID0gbmV3IEFsZXJ0KCk7XG5cbiAgICBAVmlld0NoaWxkKCdjdXN0b21EYXRlSW5wdXQnKSBjdXN0b21EYXRlSW5wdXQ6IERhdGVJbnB1dENvbXBvbmVudDtcbiAgICBAVmlld0NoaWxkKCdlbnRpdHlJbnB1dCcpIGVudGl0eUlucHV0OiBFbnRpdHlDb21wb25lbnQ7XG4gICAgQFZpZXdDaGlsZCgnZGV2aWNlSW5wdXQnKSBkZXZpY2VJbnB1dDogRGV2aWNlQ29tcG9uZW50O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgc3RvcmFnZVNlcnZpY2U6IFN0b3JhZ2VTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHRvYXN0U2VydmljZTogVG9hc3RyU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB0c2NDb21tb25TZXJ2aWNlOiBUU0NDb21tb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFnZ3JlZ2F0ZURhdGFTZXJ2aWNlOiBBZ2dyZWdhdGVEYXRhU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBwYXJhbWV0ZXJTZXJ2aWNlOiBQYXJhbWV0ZXJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJlcG9ydFNlcnZpY2U6IFJlcG9ydFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgYWxlcnRTZXJ2aWNlOiBBbGVydFNlcnZpY2VcbiAgICApIHsgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMub3JnSUQgPSB0aGlzLnN0b3JhZ2VTZXJ2aWNlLmdldFN0b3JhZ2UoJ2N1cnJlbnRPcmdJRCcpO1xuICAgICAgICB0aGlzLnRpbWV6b25lID0gdGhpcy5zdG9yYWdlU2VydmljZS5nZXRTdG9yYWdlKCd0aW1lem9uZScpO1xuICAgIH1cblxuICAgIGRhdGVJbnBDaGFuZ2UoKSB7XG4gICAgICAgIHRoaXMuc3RhcnREYXRlID0gdGhpcy5jdXN0b21EYXRlSW5wdXQuc3RhcnREYXRlRkMudmFsdWU7XG4gICAgICAgIHRoaXMuZW5kRGF0ZSA9IHRoaXMuY3VzdG9tRGF0ZUlucHV0LmVuZERhdGVGQy52YWx1ZTtcbiAgICB9XG5cbiAgICBlbnRpdHlJbnBDaGFuZ2UoKSB7XG4gICAgICAgIHRoaXMuZW50aXR5SUQgPSB0aGlzLmVudGl0eUlucHV0LmVudGl0eUZDLnZhbHVlO1xuICAgIH1cblxuICAgIGRldmljZUlucENoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5kZXZpY2VJRCA9IHRoaXMuZGV2aWNlSW5wdXQuZGV2aWNlRkMudmFsdWU7XG5cbiAgICAgICAgaWYgKHRoaXMuZGV2aWNlSUQpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0UGFyYW1ldGVyQnlEZXZpY2VJRCh0aGlzLmRldmljZUlEKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldFBhcmFtZXRlckJ5RGV2aWNlSUQoZGV2aWNlSUQpIHtcbiAgICAgICAgbGV0IHJlcXVlc3RCb2R5ID0ge307XG4gICAgICAgIHJlcXVlc3RCb2R5WydkZXZpY2VJRCddID0gW2RldmljZUlEXTtcblxuICAgICAgICB0aGlzLnBhcmFtZXRlck0gPSA8UGFyYW1ldGVyTVtdPmF3YWl0IHRoaXMucGFyYW1ldGVyU2VydmljZS5nZXRQYXJhbWV0ZXJCeURldmljZUlEKHRoaXMub3JnSUQsIHJlcXVlc3RCb2R5KTtcbiAgICB9XG5cbiAgICBhc3luYyB2aWV3UmVwb3J0KCkge1xuXG4gICAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnJlc2V0QWxlcnRQcm9wZXJ0aWVzKHRoaXMucmVwb3J0QWxlcnRPYmopO1xuXG4gICAgICAgIGlmICghdGhpcy5wYXJhbWV0ZXJNIHx8IHRoaXMucGFyYW1ldGVyTS5sZW5ndGggPT0gMCB8fCAhdGhpcy5wYXJhbWV0ZXJNWzBdWydpZCddKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmdldFBhcmFtZXRlckJ5RGV2aWNlSUQodGhpcy5kZXZpY2VJRCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc1ZhbGlkSW5wdXRGaWVsZCgpKSB7XG4gICAgICAgICAgICB0aGlzLnRvYXN0U2VydmljZS5vcGVuVG9hc3QoSW52YWxpZEZvcm0uSU5WQUxJRF9GT1JNX1RJVExFLCBJbnZhbGlkRm9ybS5JTlZBTElEX0ZPUk1fTUVTU0FHRSwgVG9hc3RyQ29sb3IuRVJST1IpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhcnREYXRlID09IHRoaXMuZW5kRGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5hbGVydFNlcnZpY2Uuc2V0QWxlcnRQcm9wZXJ0aWVzKHRoaXMucmVwb3J0QWxlcnRPYmosIFJlcG9ydEVycm9yRW51bS5JTlZBTElEX0RBVEVfTEFCRUwsIFJlcG9ydEVycm9yRW51bS5JTlZBTElEX0RBVEVfTUVTU0FHRSwgTWVzc2FnZUFsZXJ0VHlwZUVudW0uSU5GTywgTWVzc2FnZUFsZXJ0SWNvbkVudW0uSU5GT19JQ09OKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZGF5RGlmZmVyZW5jZSA9IHRoaXMuZ2V0VGltZURpZmZlcmVuY2UodGhpcy5zdGFydERhdGUsIHRoaXMuZW5kRGF0ZSk7XG5cbiAgICAgICAgaWYgKHRoaXMuZGF5RGlmZmVyZW5jZSA8PSAxKSB7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3REYXRhID0gdGhpcy5jcmVhdGVEYXRhUmVxdWVzdCgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvcnREYXRhID0gYXdhaXQgdGhpcy5hZ2dyZWdhdGVEYXRhU2VydmljZS5nZXRBZ2dyZWdhdGVEYXRhKHRoaXMub3JnSUQsIHJlcXVlc3REYXRhKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlcG9ydERhdGE/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aGlzLnJlcG9ydFNlcnZpY2UuZXh0cmFjdFRpbWVzdGFtcCh0aGlzLnJlcG9ydERhdGEpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclRhYmxlID0gdGhpcy5yZXBvcnRTZXJ2aWNlLnBvcHVsYXRlVGFibGUodGhpcy50aW1lc3RhbXAsIHRoaXMucmVwb3J0RGF0YSwgdGhpcy5kYXRlRm9ybWF0RW51bS5EQVRFX1RJTUUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXBvcnREYXRhPy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5zZXRBbGVydFByb3BlcnRpZXModGhpcy5yZXBvcnRBbGVydE9iaiwgUmVwb3J0RXJyb3JFbnVtLkRBVEFfTk9UX0ZPVU5EX0xBQkVMLCBSZXBvcnRFcnJvckVudW0uREFUQV9OT1RfRk9VTkRfTUVTU0FHRSwgTWVzc2FnZUFsZXJ0VHlwZUVudW0uV0FSTklORywgTWVzc2FnZUFsZXJ0SWNvbkVudW0uV0FSTklOR19JQ09OKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIHZpZXdSZXBvcnQoKVwiLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGVydFNlcnZpY2Uuc2V0QWxlcnRQcm9wZXJ0aWVzKHRoaXMucmVwb3J0QWxlcnRPYmosIFJlcG9ydEVycm9yRW51bS5JTlZBTElEX0VSUk9SX0xBQkVMLCBSZXBvcnRFcnJvckVudW0uSU5WQUxJRF9FUlJPUl9NRVNTQUdFLCBNZXNzYWdlQWxlcnRUeXBlRW51bS5EQU5HRVIsIE1lc3NhZ2VBbGVydEljb25FbnVtLkRBTkdFUl9JQ09OKTtcbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnNldEFsZXJ0UHJvcGVydGllcyh0aGlzLnJlcG9ydEFsZXJ0T2JqLCBSZXBvcnRFcnJvckVudW0uVElNRV9FWENFRURFRF9MQUJFTCwgUmVwb3J0RXJyb3JFbnVtLlRJTUVfRVhDRUVERURfTUVTU0FHRSwgTWVzc2FnZUFsZXJ0VHlwZUVudW0uSU5GTywgTWVzc2FnZUFsZXJ0SWNvbkVudW0uSU5GT19JQ09OKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgY3JlYXRlRGF0YVJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3REYXRhID0gbmV3IEFnZ3JlZ2F0ZURhdGFSZXF1ZXN0KCk7XG5cbiAgICAgICAgcmVxdWVzdERhdGEuc3RhcnRUaW1lID0gdGhpcy5zdGFydERhdGU7XG4gICAgICAgIHJlcXVlc3REYXRhLmVuZFRpbWUgPSB0aGlzLmVuZERhdGU7XG4gICAgICAgIHJlcXVlc3REYXRhLmludGVydmFsID0gXCJyYXdcIjtcbiAgICAgICAgcmVxdWVzdERhdGEuZW50aXR5SUQgPSBbdGhpcy5lbnRpdHlJRF07XG4gICAgICAgIHJlcXVlc3REYXRhLmRldmljZUlEID0gW3RoaXMuZGV2aWNlSURdO1xuXG4gICAgICAgIHJlcXVlc3REYXRhLnBhcmFtcyA9IHRoaXMucGFyYW1ldGVyTS5tYXAocGFyYW0gPT4gKHtcbiAgICAgICAgICAgIG5hbWU6IHBhcmFtLnBhcmFtTWV0cmljLFxuICAgICAgICAgICAgZHNBZ2c6ICdhdmcnLFxuICAgICAgICAgICAgYWdnOiAnYXZnJ1xuICAgICAgICB9KSk7XG4gICAgICAgIHJlcXVlc3REYXRhLm51bGxpZnlQYXJhbXMoKTtcblxuICAgICAgICByZXR1cm4gcmVxdWVzdERhdGE7XG4gICAgfVxuXG4gICAgaXNWYWxpZElucHV0RmllbGQoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xzID0gW1xuICAgICAgICAgICAgdGhpcy5jdXN0b21EYXRlSW5wdXQuc3RhcnREYXRlRkMsXG4gICAgICAgICAgICB0aGlzLmVudGl0eUlucHV0LmVudGl0eUZDLFxuICAgICAgICAgICAgdGhpcy5kZXZpY2VJbnB1dC5kZXZpY2VGQyxcbiAgICAgICAgXTtcblxuICAgICAgICBjb250cm9scy5mb3JFYWNoKGNvbnRyb2wgPT4gY29udHJvbC5tYXJrQXNUb3VjaGVkKCkpO1xuICAgICAgICByZXR1cm4gY29udHJvbHMuc29tZShjb250cm9sID0+IGNvbnRyb2wuaW52YWxpZCk7XG4gICAgfVxuXG4gICAgZ2V0VGltZURpZmZlcmVuY2Uoc3RhcnRUaW1lOiBzdHJpbmcsIGVuZFRpbWU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGRhdGUxID0gbmV3IERhdGUoc3RhcnRUaW1lKS5nZXRUaW1lKCk7XG4gICAgICAgIGNvbnN0IGRhdGUyID0gbmV3IERhdGUoZW5kVGltZSkuZ2V0VGltZSgpO1xuICAgICAgICBjb25zdCBkaWZmVGltZSA9IE1hdGguYWJzKGRhdGUyIC0gZGF0ZTEpO1xuICAgICAgICBjb25zdCBkaWZmRGF5cyA9IE1hdGguY2VpbChkaWZmVGltZSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG4gICAgICAgIHJldHVybiBkaWZmRGF5cztcbiAgICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJjYXJkIG1haW4tY2FyZCBjYXJkT3ZlcndyaXRlIGgxMDBcIj5cbiAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyQ29udGFpbmVyXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJMZWZ0Q29udGFpbmVyXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicGFnZVRpdGxlXCI+UmF3IERhdGEgUmVwb3J0PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuXG4gICAgPGRpdiBjbGFzcz1cImNhcmQtYm9keVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTNcIj5cbiAgICAgICAgICAgICAgICA8bGliLWRhdGUtaW5wdXQgI2N1c3RvbURhdGVJbnB1dCAoZW1pdEZpbHRlcik9XCJkYXRlSW5wQ2hhbmdlKClcIiBbbWF0ZXJpYWxGaWVsZFdpZHRoSW5wXT1cInRydWVcIlxuICAgICAgICAgICAgICAgICAgICBbbWF0ZXJpYWxGb3JtRmllbGRBcHBlYXJhbmNlSW5wXT1cIm1hdGVyaWFsRm9ybUZpZWxkQXBwZWFyYW5jZS5GT1JNX0ZJRUxEX0FQUEVBUkFOQ0VcIlxuICAgICAgICAgICAgICAgICAgICBbaXNNYW5kYXRvcnlGaWVsZElucF09XCJ0cnVlXCIgW2RhdGVJbnB1dFR5cGVJbnBdPVwiZGF0ZUlucHV0VHlwZUVudW0uQ1VTVE9NX0lOUFVUXCJcbiAgICAgICAgICAgICAgICAgICAgW2RhdGVUeXBlSW5wXT1cImRhdGVUeXBlRW51bS5FWENMVVNJVkVcIiBbc2hvd0RlZmF1bHREdXJhdGlvbklucF09XCJ0cnVlXCIgW3Nob3dDZHJSYW5nZUxhYmVsSW5wXT1cInRydWVcIlxuICAgICAgICAgICAgICAgICAgICBbbGFiZWxJbnBdPVwiJ1NlbGVjdCBkYXRlJ1wiIFt0aW1lem9uZUlucF09XCJ0aW1lem9uZVwiIFtyYW5nZUlucF09XCJjdXN0b21SYW5nZUNvbnN0YW50XCIgW3Nob3dUaW1lSW5DRFJJbnBdPVwidHJ1ZVwiXG4gICAgICAgICAgICAgICAgICAgIFtzaG93UmFuZ2VJbnBdPVwidHJ1ZVwiIFtjZHJGb3JtYXRJbnBdPVwiJ1lZWVktTU0tREQgSEg6bW06c3MnXCI+PC9saWItZGF0ZS1pbnB1dD5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTNcIj5cbiAgICAgICAgICAgICAgICA8bGliLWVudGl0eSAjZW50aXR5SW5wdXQgKGVtaXRGaWx0ZXIpPVwiZW50aXR5SW5wQ2hhbmdlKClcIj48L2xpYi1lbnRpdHk+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0zXCI+XG4gICAgICAgICAgICAgICAgPGxpYi1kZXZpY2UgI2RldmljZUlucHV0IFtkcm9wZG93blR5cGVJbnBdPVwiZHJvcGRvd25UeXBlRW51bS5TSU5HTEVfRFJPUERPV05cIiBbZW50aXR5SW5wXT1cImVudGl0eUlEXCJcbiAgICAgICAgICAgICAgICAgICAgKGVtaXRGaWx0ZXIpPVwiZGV2aWNlSW5wQ2hhbmdlKClcIj48L2xpYi1kZXZpY2U+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMlwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbG9hdC1lbmRcIj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc20gYnRuLXByaW1hcnlcIiB0eXBlPVwiYnV0dG9uXCIgKGNsaWNrKT1cInZpZXdSZXBvcnQoKVwiIG1hdFJpcHBsZVxuICAgICAgICAgICAgICAgICAgICAgICAgW21hdFJpcHBsZUNlbnRlcmVkXT1cIm1hdGVyaWFsQ29uc3RhbnQuTUFUX1JJUFBMRV9DRU5URVJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHt7IGJ1dHRvbkxhYmVsRW51bS5SRUFEX0JUTl9MQUJFTCB9fVxuICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTEyXCI+XG4gICAgICAgICAgICAgICAgPGxpYi1tZXNzYWdlLWFsZXJ0ICpuZ0lmPVwicmVwb3J0QWxlcnRPYmouc2hvd0FsZXJ0XCIgW2xhYmVsSW5wXT1cInJlcG9ydEFsZXJ0T2JqLmFsZXJ0TGFiZWxcIlxuICAgICAgICAgICAgICAgICAgICBbY29udGVudElucF09XCJyZXBvcnRBbGVydE9iai5hbGVydENvbnRlbnRcIiBbbWVzc2FnZUFsZXJ0VHlwZUlucF09XCJyZXBvcnRBbGVydE9iai5tZXNzYWdlQWxlcnRUeXBlXCJcbiAgICAgICAgICAgICAgICAgICAgW21lc3NhZ2VBbGVydEljb25JbnBdPVwicmVwb3J0QWxlcnRPYmoubWVzc2FnZUFsZXJ0SWNvblwiPlxuICAgICAgICAgICAgICAgIDwvbGliLW1lc3NhZ2UtYWxlcnQ+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNlbnRlckFsaWduXCI+XG4gICAgICAgICAgICAgICAgPGxpYi1za2VsZXRvbi1sb2FkZXIgKm5nSWY9XCJzaG93TG9hZGVyXCIgW2NvdW50XT1cIjNcIiBbYXBwZWFyYW5jZV09XCInY2lyY2xlJ1wiXG4gICAgICAgICAgICAgICAgICAgIFt0aGVtZV09XCJ7IGhlaWdodDogJzE1cHgnLCB3aWR0aDogJzE1cHgnLCAnYmFja2dyb3VuZC1jb2xvcic6ICcjZTdlYmYzJyB9XCI+PC9saWItc2tlbGV0b24tbG9hZGVyPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgbXQtM1wiICpuZ0lmPVwicmVwb3J0RGF0YSAmJiByZXBvcnREYXRhLmxlbmd0aCA+IDBcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJvdmVyZmxvd1ggY3VzdG9tU2Nyb2xsQmFyXCI+XG4gICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGVcIj5cbiAgICAgICAgICAgICAgICAgICAgPHRib2R5PlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPVwidGFibGVIZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJmdy1ib2xkXCI+IFNyLiBOby4gPC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgYWxpZ249XCJjZW50ZXJcIiBjbGFzcz1cImZ3LWJvbGRcIj4gVGltZSA8L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGRhdGEgb2YgcmVwb3J0RGF0YTsgbGV0IGkgPSBpbmRleFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgYWxpZ249XCJjZW50ZXJcIiBjbGFzcz1cImZ3LWJvbGRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGRhdGEucGFyYW1MYWJlbCB9fSAoe3sgZGF0YS51bml0IH19KSAoe3sgZGF0YS5kc0FnZyB9fSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+XG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciAqbmdGb3I9XCJsZXQgcm93IG9mIHJlbmRlclRhYmxlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPnt7IHJvdy5pbmRleCB9fTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGFsaWduPVwiY2VudGVyXCIgY2xhc3M9XCJjb2xXaWR0aENvbnRhaW5pbmdEYXRlVGltZVwiPnt7IHJvdy50aW1lIH19PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgYWxpZ249XCJjZW50ZXJcIiAqbmdGb3I9XCJsZXQgdmFsdWUgb2Ygcm93LmRhdGFcIj57eyB2YWx1ZSA/IHZhbHVlIDogY29tbW9uQ29uc3RhbnQuSFlQSEVOXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+XG4gICAgICAgICAgICAgICAgPC90YWJsZT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PiJdfQ==