import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { OrgRecentData } from '../../../model/recent-data.model';
import { Alert } from '../../../model/alert.model';
import { DashboardErrorEnum } from '../../../enum/error.enum';
import { COMMON_CONSTANT, MessageAlertIconEnum, MessageAlertTypeEnum } from '@library/tsc-common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "@library/storage-service";
import * as i3 from "@library/date";
import * as i4 from "../../../service/trend.service";
import * as i5 from "../../../service/recent-data.service";
import * as i6 from "../../../service/alert.service";
import * as i7 from "@library/tsc-common";
import * as i8 from "@angular/material/card";
import * as i9 from "@angular/common";
import * as i10 from "@angular/material/tooltip";
// /tsc-library/
export class FacilityComponent {
    constructor(router, storageService, dateService, trendService, recentDataService, alertService) {
        this.router = router;
        this.storageService = storageService;
        this.dateService = dateService;
        this.trendService = trendService;
        this.recentDataService = recentDataService;
        this.alertService = alertService;
        this.commonConstant = COMMON_CONSTANT;
        this.showLoader = false;
        this.orgRecentDataM = [new OrgRecentData()];
        this.alertObj = new Alert();
    }
    ngOnInit() {
        this.orgID = this.storageService.getStorage('currentOrgID');
        this.timezone = this.storageService.getStorage('timezone');
        this.getOrgRecentData();
    }
    getOrgRecentData() {
        return __awaiter(this, void 0, void 0, function* () {
            this.alertService.resetAlertProperties(this.alertObj);
            try {
                let requestBody = {
                    'timezone': this.timezone
                };
                this.orgRecentDataM = (yield this.recentDataService.getOrgRecentData(this.orgID, requestBody));
                if (this.orgRecentDataM && this.orgRecentDataM.length == 1) {
                    this.alertService.setAlertProperties(this.alertObj, DashboardErrorEnum.DATA_NOT_FOUND_LABEL, DashboardErrorEnum.DATA_NOT_FOUND_MESSAGE, MessageAlertTypeEnum.WARNING, MessageAlertIconEnum.WARNING_ICON);
                }
            }
            catch (error) {
                console.error(`Error in getOrgRecentData()`, error);
                this.alertService.setAlertProperties(this.alertObj, DashboardErrorEnum.INVALID_ERROR_LABEL, DashboardErrorEnum.INVALID_ERROR_MESSAGE, MessageAlertTypeEnum.DANGER, MessageAlertIconEnum.DANGER_ICON);
            }
            finally {
                this.apiTimer = setTimeout(() => {
                    this.getOrgRecentData();
                }, 300000);
                this.showLoader = false;
            }
        });
    }
    showEntityConsumption(id, name) {
        this.router.navigate(['dashboard/consumption'], { state: { entityID: id, entityName: name } });
    }
    showTrend(paramMetric, deviceID, entityID) {
        let requestBody = {
            paramMetric: paramMetric,
            deviceID: deviceID,
            entityID: entityID
        };
        this.trendService.openDialog(requestBody);
    }
}
FacilityComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: FacilityComponent, deps: [{ token: i1.Router }, { token: i2.StorageService }, { token: i3.DateService }, { token: i4.TrendService }, { token: i5.RecentDataService }, { token: i6.AlertService }], target: i0.ɵɵFactoryTarget.Component });
FacilityComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: FacilityComponent, selector: "app-facility", ngImport: i0, template: "<div class=\"card main-card cardOverwrite h100\">\n    <div class=\"headerContainer\">\n        <div class=\"headerLeftContainer\">\n            <div class=\"pageTitle\">Facility Dashboard</div>\n        </div>\n    </div>\n\n    <div class=\"card-body pt-0\">\n\n        <div class=\"row\">\n            <lib-skeleton-loader *ngIf=\"showLoader\" [count]=\"3\" [appearance]=\"''\"\n                [theme]=\"{ 'border-radius': '16px', height: '40px', 'background-color': 'rgb(230 232 235)' }\"></lib-skeleton-loader>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-sm-12\">\n                <lib-message-alert *ngIf=\"alertObj.showAlert\" [labelInp]=\"alertObj.alertLabel\"\n                    [contentInp]=\"alertObj.alertContent\" [messageAlertTypeInp]=\"alertObj.messageAlertType\"\n                    [messageAlertIconInp]=\"alertObj.messageAlertIcon\">\n                </lib-message-alert>\n            </div>\n        </div>\n\n        <div class=\"row\" *ngIf=\"orgRecentDataM.length > 1\">\n            <div class=\"col-sm-12 mb-3\" *ngFor=\"let recentRes of orgRecentDataM\">\n                <mat-card class=\"cardOverwrite cardBackgroundColor\">\n                    <div class=\"row mb-2\">\n                        <div class=\"col-sm-6\">\n                            <span class=\"entity text-primary\">\n                                <div class=\"d-flex align-items-center\">\n                                    <span class=\"material-symbols-outlined me-2\">domain</span>\n                                    {{ recentRes.entityName }}\n                                </div>\n                            </span>\n                        </div>\n                        <div class=\"col-sm-6 text-end\">\n                            <a class=\"text-primary cursorPointer\" matTooltip=\"Entity consumption\"\n                                matTooltipPosition=\"below\"\n                                (click)=\"showEntityConsumption(recentRes.entityID, recentRes.entityName)\">\n                                <span class=\"material-symbols-outlined fs-4 fw-bold\">monitoring</span>\n                            </a>\n                        </div>\n                    </div>\n\n                    <div class=\"row\">\n                        <div class=\"col-sm-12 ms-3\" *ngFor=\"let deviceRes of recentRes.deviceData\">\n                            <div class=\"d-flex align-items-center\">\n                                <span class=\"material-symbols-outlined text-success me-2\">devices</span>\n                                {{ deviceRes.name }}\n                            </div>\n\n                            <div class=\"row mt-2\">\n                                <div class=\"col-sm-4 mb-3\" *ngFor=\"let paramRes of deviceRes.paramData\">\n                                    <mat-card class=\"cardOverwrite\">\n                                        <ng-container *ngTemplateOutlet=\"parameterData; context: {\n                                                duration: dateService.getRelativeTimeAgoLabel(paramRes?.data?.date),\n                                                value: paramRes?.data?.value,\n                                                unit: paramRes?.unit,\n                                                label: paramRes?.label,\n                                                entityID: recentRes?.entityID,\n                                                deviceID: deviceRes?.id,\n                                                paramName: paramRes?.name\n                                            }\"></ng-container>\n                                    </mat-card>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </mat-card>\n            </div>\n        </div>\n    </div>\n</div>\n\n<ng-template #parameterData let-duration=\"duration\" let-label=\"label\" let-value=\"value\" let-unit=\"unit\"\n    let-entityID=\"entityID\" let-deviceID=\"deviceID\" let-paramName=\"paramName\">\n    <div class=\"row\">\n        <div class=\"col-sm-6 textDurationWithAgoTime\">\n            {{ duration }}\n        </div>\n        <div class=\"col-sm-6 text-end\">\n            <a class=\"text-primary cursorPointer\" matTooltip=\"Trend\" matTooltipPosition=\"below\"\n                (click)=\"showTrend(paramName, deviceID, entityID)\">\n                <span class=\"material-symbols-outlined fs-5 fw-bold\">trending_up</span>\n            </a>\n        </div>\n    </div>\n    <div class=\"row mt-3\">\n        <div class=\"col-sm-12 text-center\">\n            <span class=\"fs-1 fw-bold text-primary\">{{ value ? (value | number: '1.2-2') : commonConstant.HYPHEN\n                }}</span>\n            <span class=\"text-secondary fw-bold\"> {{ value ? unit : '' }} </span>\n        </div>\n    </div>\n    <div class=\"row mt-4 mb-4\">\n        <div class=\"col-sm-12 fs-5 text-center\">\n            {{ label }}\n        </div>\n    </div>\n</ng-template>", styles: [".entity{text-transform:none;font-size:15px;font-weight:600}\n"], components: [{ type: i7.SkeletonComponent, selector: "lib-skeleton-loader", inputs: ["count", "appearance", "theme"] }, { type: i7.MessageAlertComponent, selector: "lib-message-alert", inputs: ["messageAlertTypeInp", "messageAlertIconInp", "labelInp", "contentInp"] }, { type: i8.MatCard, selector: "mat-card", exportAs: ["matCard"] }], directives: [{ type: i9.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i9.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i10.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { type: i9.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }], pipes: { "number": i9.DecimalPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: FacilityComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'app-facility',
                    templateUrl: './facility.component.html',
                    styleUrls: ['./facility.component.scss']
                }]
        }], ctorParameters: function () { return [{ type: i1.Router }, { type: i2.StorageService }, { type: i3.DateService }, { type: i4.TrendService }, { type: i5.RecentDataService }, { type: i6.AlertService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjaWxpdHkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbGlicmFyeS90c2MtbGl0ZS9zcmMvbGliL3RzYy9jb21wb25lbnQvZGFzaGJvYXJkL2ZhY2lsaXR5L2ZhY2lsaXR5LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xpYnJhcnkvdHNjLWxpdGUvc3JjL2xpYi90c2MvY29tcG9uZW50L2Rhc2hib2FyZC9mYWNpbGl0eS9mYWNpbGl0eS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUdsRCxPQUFPLEVBQUUsYUFBYSxFQUFrQixNQUFNLGtDQUFrQyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxLQUFLLEVBQVUsTUFBTSw0QkFBNEIsQ0FBQztBQUUzRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQVM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7Ozs7Ozs7OztBQUNsRyxnQkFBZ0I7QUFRaEIsTUFBTSxPQUFPLGlCQUFpQjtJQVkxQixZQUNZLE1BQWMsRUFDZCxjQUE4QixFQUMvQixXQUF3QixFQUN2QixZQUEwQixFQUMxQixpQkFBb0MsRUFDcEMsWUFBMEI7UUFMMUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUMvQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN2QixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBaEJ0QyxtQkFBYyxHQUFHLGVBQWUsQ0FBQztRQUtqQyxlQUFVLEdBQVks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bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuaW1wb3J0IHsgT3JnUmVjZW50RGF0YSwgT3JnUmVjZW50RGF0YU0gfSBmcm9tICcuLi8uLi8uLi9tb2RlbC9yZWNlbnQtZGF0YS5tb2RlbCc7XG5pbXBvcnQgeyBBbGVydCwgQWxlcnRNIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWwvYWxlcnQubW9kZWwnO1xuXG5pbXBvcnQgeyBEYXNoYm9hcmRFcnJvckVudW0gfSBmcm9tICcuLi8uLi8uLi9lbnVtL2Vycm9yLmVudW0nO1xuXG5pbXBvcnQgeyBSZWNlbnREYXRhU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2UvcmVjZW50LWRhdGEuc2VydmljZSc7XG5pbXBvcnQgeyBUcmVuZFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlL3RyZW5kLnNlcnZpY2UnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZS9hbGVydC5zZXJ2aWNlJztcblxuLy8gdHNjLWxpYnJhcnlcbmltcG9ydCB7IERhdGVTZXJ2aWNlIH0gZnJvbSAnQGxpYnJhcnkvZGF0ZSc7XG5pbXBvcnQgeyBTdG9yYWdlU2VydmljZSB9IGZyb20gJ0BsaWJyYXJ5L3N0b3JhZ2Utc2VydmljZSc7XG5pbXBvcnQgeyBDT01NT05fQ09OU1RBTlQsIE1lc3NhZ2VBbGVydEljb25FbnVtLCBNZXNzYWdlQWxlcnRUeXBlRW51bSB9IGZyb20gJ0BsaWJyYXJ5L3RzYy1jb21tb24nO1xuLy8gL3RzYy1saWJyYXJ5L1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FwcC1mYWNpbGl0eScsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZhY2lsaXR5LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9mYWNpbGl0eS5jb21wb25lbnQuc2NzcyddXG59KVxuXG5leHBvcnQgY2xhc3MgRmFjaWxpdHlDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgY29tbW9uQ29uc3RhbnQgPSBDT01NT05fQ09OU1RBTlQ7XG5cbiAgICBvcmdJRDogYW55O1xuICAgIHRpbWV6b25lOiBhbnk7XG4gICAgYXBpVGltZXI6IGFueTtcbiAgICBzaG93TG9hZGVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBvcmdSZWNlbnREYXRhTSA9IFtuZXcgT3JnUmVjZW50RGF0YSgpXTtcbiAgICBhbGVydE9iajogQWxlcnRNID0gbmV3IEFsZXJ0KCk7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSBzdG9yYWdlU2VydmljZTogU3RvcmFnZVNlcnZpY2UsXG4gICAgICAgIHB1YmxpYyBkYXRlU2VydmljZTogRGF0ZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgdHJlbmRTZXJ2aWNlOiBUcmVuZFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcmVjZW50RGF0YVNlcnZpY2U6IFJlY2VudERhdGFTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlLFxuICAgICkgeyB9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vcmdJRCA9IHRoaXMuc3RvcmFnZVNlcnZpY2UuZ2V0U3RvcmFnZSgnY3VycmVudE9yZ0lEJyk7XG4gICAgICAgIHRoaXMudGltZXpvbmUgPSB0aGlzLnN0b3JhZ2VTZXJ2aWNlLmdldFN0b3JhZ2UoJ3RpbWV6b25lJyk7XG5cbiAgICAgICAgdGhpcy5nZXRPcmdSZWNlbnREYXRhKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0T3JnUmVjZW50RGF0YSgpIHtcblxuICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5yZXNldEFsZXJ0UHJvcGVydGllcyh0aGlzLmFsZXJ0T2JqKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHJlcXVlc3RCb2R5ID0ge1xuICAgICAgICAgICAgICAgICd0aW1lem9uZSc6IHRoaXMudGltZXpvbmVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLm9yZ1JlY2VudERhdGFNID0gPE9yZ1JlY2VudERhdGFNW10+YXdhaXQgdGhpcy5yZWNlbnREYXRhU2VydmljZS5nZXRPcmdSZWNlbnREYXRhKHRoaXMub3JnSUQsIHJlcXVlc3RCb2R5KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3JnUmVjZW50RGF0YU0gJiYgdGhpcy5vcmdSZWNlbnREYXRhTS5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnNldEFsZXJ0UHJvcGVydGllcyh0aGlzLmFsZXJ0T2JqLCBEYXNoYm9hcmRFcnJvckVudW0uREFUQV9OT1RfRk9VTkRfTEFCRUwsIERhc2hib2FyZEVycm9yRW51bS5EQVRBX05PVF9GT1VORF9NRVNTQUdFLCBNZXNzYWdlQWxlcnRUeXBlRW51bS5XQVJOSU5HLCBNZXNzYWdlQWxlcnRJY29uRW51bS5XQVJOSU5HX0lDT04pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG5cbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGluIGdldE9yZ1JlY2VudERhdGEoKWAsIGVycm9yKTtcbiAgICAgICAgICAgIHRoaXMuYWxlcnRTZXJ2aWNlLnNldEFsZXJ0UHJvcGVydGllcyh0aGlzLmFsZXJ0T2JqLCBEYXNoYm9hcmRFcnJvckVudW0uSU5WQUxJRF9FUlJPUl9MQUJFTCwgRGFzaGJvYXJkRXJyb3JFbnVtLklOVkFMSURfRVJST1JfTUVTU0FHRSwgTWVzc2FnZUFsZXJ0VHlwZUVudW0uREFOR0VSLCBNZXNzYWdlQWxlcnRJY29uRW51bS5EQU5HRVJfSUNPTik7XG5cbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuYXBpVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldE9yZ1JlY2VudERhdGEoKTtcbiAgICAgICAgICAgIH0sIDMwMDAwMCk7XG4gICAgICAgICAgICB0aGlzLnNob3dMb2FkZXIgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNob3dFbnRpdHlDb25zdW1wdGlvbihpZCwgbmFtZSkge1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJ2Rhc2hib2FyZC9jb25zdW1wdGlvbiddLCB7IHN0YXRlOiB7IGVudGl0eUlEOiBpZCwgZW50aXR5TmFtZTogbmFtZSB9IH0pO1xuICAgIH1cblxuICAgIHNob3dUcmVuZChwYXJhbU1ldHJpYywgZGV2aWNlSUQsIGVudGl0eUlEKSB7XG4gICAgICAgIGxldCByZXF1ZXN0Qm9keSA9IHtcbiAgICAgICAgICAgIHBhcmFtTWV0cmljOiBwYXJhbU1ldHJpYyxcbiAgICAgICAgICAgIGRldmljZUlEOiBkZXZpY2VJRCxcbiAgICAgICAgICAgIGVudGl0eUlEOiBlbnRpdHlJRFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRyZW5kU2VydmljZS5vcGVuRGlhbG9nKHJlcXVlc3RCb2R5KTtcbiAgICB9XG5cbn0iLCI8ZGl2IGNsYXNzPVwiY2FyZCBtYWluLWNhcmQgY2FyZE92ZXJ3cml0ZSBoMTAwXCI+XG4gICAgPGRpdiBjbGFzcz1cImhlYWRlckNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyTGVmdENvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBhZ2VUaXRsZVwiPkZhY2lsaXR5IERhc2hib2FyZDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJvZHkgcHQtMFwiPlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICAgIDxsaWItc2tlbGV0b24tbG9hZGVyICpuZ0lmPVwic2hvd0xvYWRlclwiIFtjb3VudF09XCIzXCIgW2FwcGVhcmFuY2VdPVwiJydcIlxuICAgICAgICAgICAgICAgIFt0aGVtZV09XCJ7ICdib3JkZXItcmFkaXVzJzogJzE2cHgnLCBoZWlnaHQ6ICc0MHB4JywgJ2JhY2tncm91bmQtY29sb3InOiAncmdiKDIzMCAyMzIgMjM1KScgfVwiPjwvbGliLXNrZWxldG9uLWxvYWRlcj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMlwiPlxuICAgICAgICAgICAgICAgIDxsaWItbWVzc2FnZS1hbGVydCAqbmdJZj1cImFsZXJ0T2JqLnNob3dBbGVydFwiIFtsYWJlbElucF09XCJhbGVydE9iai5hbGVydExhYmVsXCJcbiAgICAgICAgICAgICAgICAgICAgW2NvbnRlbnRJbnBdPVwiYWxlcnRPYmouYWxlcnRDb250ZW50XCIgW21lc3NhZ2VBbGVydFR5cGVJbnBdPVwiYWxlcnRPYmoubWVzc2FnZUFsZXJ0VHlwZVwiXG4gICAgICAgICAgICAgICAgICAgIFttZXNzYWdlQWxlcnRJY29uSW5wXT1cImFsZXJ0T2JqLm1lc3NhZ2VBbGVydEljb25cIj5cbiAgICAgICAgICAgICAgICA8L2xpYi1tZXNzYWdlLWFsZXJ0PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIiAqbmdJZj1cIm9yZ1JlY2VudERhdGFNLmxlbmd0aCA+IDFcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tMTIgbWItM1wiICpuZ0Zvcj1cImxldCByZWNlbnRSZXMgb2Ygb3JnUmVjZW50RGF0YU1cIj5cbiAgICAgICAgICAgICAgICA8bWF0LWNhcmQgY2xhc3M9XCJjYXJkT3ZlcndyaXRlIGNhcmRCYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvdyBtYi0yXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTZcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImVudGl0eSB0ZXh0LXByaW1hcnlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBhbGlnbi1pdGVtcy1jZW50ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCBtZS0yXCI+ZG9tYWluPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3sgcmVjZW50UmVzLmVudGl0eU5hbWUgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTYgdGV4dC1lbmRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz1cInRleHQtcHJpbWFyeSBjdXJzb3JQb2ludGVyXCIgbWF0VG9vbHRpcD1cIkVudGl0eSBjb25zdW1wdGlvblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdFRvb2x0aXBQb3NpdGlvbj1cImJlbG93XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNsaWNrKT1cInNob3dFbnRpdHlDb25zdW1wdGlvbihyZWNlbnRSZXMuZW50aXR5SUQsIHJlY2VudFJlcy5lbnRpdHlOYW1lKVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLXN5bWJvbHMtb3V0bGluZWQgZnMtNCBmdy1ib2xkXCI+bW9uaXRvcmluZzwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMiBtcy0zXCIgKm5nRm9yPVwibGV0IGRldmljZVJlcyBvZiByZWNlbnRSZXMuZGV2aWNlRGF0YVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCB0ZXh0LXN1Y2Nlc3MgbWUtMlwiPmRldmljZXM8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGRldmljZVJlcy5uYW1lIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93IG10LTJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS00IG1iLTNcIiAqbmdGb3I9XCJsZXQgcGFyYW1SZXMgb2YgZGV2aWNlUmVzLnBhcmFtRGF0YVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG1hdC1jYXJkIGNsYXNzPVwiY2FyZE92ZXJ3cml0ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJwYXJhbWV0ZXJEYXRhOyBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogZGF0ZVNlcnZpY2UuZ2V0UmVsYXRpdmVUaW1lQWdvTGFiZWwocGFyYW1SZXM/LmRhdGE/LmRhdGUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhcmFtUmVzPy5kYXRhPy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQ6IHBhcmFtUmVzPy51bml0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHBhcmFtUmVzPy5sYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eUlEOiByZWNlbnRSZXM/LmVudGl0eUlELFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlSUQ6IGRldmljZVJlcz8uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbU5hbWU6IHBhcmFtUmVzPy5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cIj48L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbWF0LWNhcmQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvbWF0LWNhcmQ+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlICNwYXJhbWV0ZXJEYXRhIGxldC1kdXJhdGlvbj1cImR1cmF0aW9uXCIgbGV0LWxhYmVsPVwibGFiZWxcIiBsZXQtdmFsdWU9XCJ2YWx1ZVwiIGxldC11bml0PVwidW5pdFwiXG4gICAgbGV0LWVudGl0eUlEPVwiZW50aXR5SURcIiBsZXQtZGV2aWNlSUQ9XCJkZXZpY2VJRFwiIGxldC1wYXJhbU5hbWU9XCJwYXJhbU5hbWVcIj5cbiAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNiB0ZXh0RHVyYXRpb25XaXRoQWdvVGltZVwiPlxuICAgICAgICAgICAge3sgZHVyYXRpb24gfX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNiB0ZXh0LWVuZFwiPlxuICAgICAgICAgICAgPGEgY2xhc3M9XCJ0ZXh0LXByaW1hcnkgY3Vyc29yUG9pbnRlclwiIG1hdFRvb2x0aXA9XCJUcmVuZFwiIG1hdFRvb2x0aXBQb3NpdGlvbj1cImJlbG93XCJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwic2hvd1RyZW5kKHBhcmFtTmFtZSwgZGV2aWNlSUQsIGVudGl0eUlEKVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCBmcy01IGZ3LWJvbGRcIj50cmVuZGluZ191cDwvc3Bhbj5cbiAgICAgICAgICAgIDwvYT5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInJvdyBtdC0zXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tMTIgdGV4dC1jZW50ZXJcIj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZnMtMSBmdy1ib2xkIHRleHQtcHJpbWFyeVwiPnt7IHZhbHVlID8gKHZhbHVlIHwgbnVtYmVyOiAnMS4yLTInKSA6IGNvbW1vbkNvbnN0YW50LkhZUEhFTlxuICAgICAgICAgICAgICAgIH19PC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0ZXh0LXNlY29uZGFyeSBmdy1ib2xkXCI+IHt7IHZhbHVlID8gdW5pdCA6ICcnIH19IDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInJvdyBtdC00IG1iLTRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMiBmcy01IHRleHQtY2VudGVyXCI+XG4gICAgICAgICAgICB7eyBsYWJlbCB9fVxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+Il19