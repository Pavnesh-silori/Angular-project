import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { OrgRecentData, RecentDataRequestWithoutParam } from '../../../model/recent-data.model';
import { Alert } from '../../../model/alert.model';
import { DashboardErrorEnum } from '../../../enum/error.enum';
import { COMMON_CONSTANT, MessageAlertIconEnum, MessageAlertTypeEnum } from '@library/tsc-common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "@library/storage-service";
import * as i3 from "@library/date";
import * as i4 from "../../../service/trend.service";
import * as i5 from "../../../service/recent-data.service";
import * as i6 from "../../../service/alert.service";
import * as i7 from "@library/tsc-common";
import * as i8 from "@angular/material/card";
import * as i9 from "@angular/common";
import * as i10 from "@angular/material/tooltip";
// /tsc-library/
export class FacilityComponent {
    constructor(router, storageService, dateService, trendService, recentDataService, alertService) {
        this.router = router;
        this.storageService = storageService;
        this.dateService = dateService;
        this.trendService = trendService;
        this.recentDataService = recentDataService;
        this.alertService = alertService;
        this.commonConstant = COMMON_CONSTANT;
        this.showLoader = false;
        this.orgRecentDataM = [new OrgRecentData()];
        this.alertObj = new Alert();
    }
    ngOnInit() {
        this.orgID = this.storageService.getStorage('currentOrgID');
        this.timezone = this.storageService.getStorage('timezone');
        this.getOrgRecentData();
    }
    getOrgRecentData() {
        return __awaiter(this, void 0, void 0, function* () {
            this.alertService.resetAlertProperties(this.alertObj);
            try {
                let requestBody = new RecentDataRequestWithoutParam();
                requestBody.timezone = this.timezone;
                requestBody.backscan = 1;
                this.orgRecentDataM = (yield this.recentDataService.getOrgRecentData(this.orgID, requestBody));
                if (this.orgRecentDataM && this.orgRecentDataM.length == 1) {
                    this.alertService.setAlertProperties(this.alertObj, DashboardErrorEnum.DATA_NOT_FOUND_LABEL, DashboardErrorEnum.DATA_NOT_FOUND_MESSAGE, MessageAlertTypeEnum.WARNING, MessageAlertIconEnum.WARNING_ICON);
                }
            }
            catch (error) {
                console.error(`Error in getOrgRecentData()`, error);
                this.alertService.setAlertProperties(this.alertObj, DashboardErrorEnum.INVALID_ERROR_LABEL, DashboardErrorEnum.INVALID_ERROR_MESSAGE, MessageAlertTypeEnum.DANGER, MessageAlertIconEnum.DANGER_ICON);
            }
            finally {
                this.apiTimer = setTimeout(() => {
                    this.getOrgRecentData();
                }, 300000);
                this.showLoader = false;
            }
        });
    }
    showEntityConsumption(id, name) {
        this.router.navigate(['dashboard/consumption'], { queryParams: { entityID: id } });
    }
    showTrend(paramMetric, deviceID, entityID) {
        let requestBody = {
            paramMetric: paramMetric,
            deviceID: deviceID,
            entityID: entityID
        };
        this.trendService.openDialog(requestBody);
    }
}
FacilityComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: FacilityComponent, deps: [{ token: i1.Router }, { token: i2.StorageService }, { token: i3.DateService }, { token: i4.TrendService }, { token: i5.RecentDataService }, { token: i6.AlertService }], target: i0.ɵɵFactoryTarget.Component });
FacilityComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: FacilityComponent, selector: "app-facility", ngImport: i0, template: "<div class=\"card main-card cardOverwrite h100\">\n    <div class=\"headerContainer\">\n        <div class=\"headerLeftContainer\">\n            <div class=\"pageTitle\">Facility Dashboard</div>\n        </div>\n    </div>\n\n    <div class=\"card-body pt-0\">\n\n        <div class=\"row\">\n            <lib-skeleton-loader *ngIf=\"showLoader\" [count]=\"3\" [appearance]=\"''\"\n                [theme]=\"{ 'border-radius': '16px', height: '40px', 'background-color': 'rgb(230 232 235)' }\"></lib-skeleton-loader>\n        </div>\n\n        <div class=\"row\">\n            <div class=\"col-sm-12\">\n                <lib-message-alert *ngIf=\"alertObj.showAlert\" [labelInp]=\"alertObj.alertLabel\"\n                    [contentInp]=\"alertObj.alertContent\" [messageAlertTypeInp]=\"alertObj.messageAlertType\"\n                    [messageAlertIconInp]=\"alertObj.messageAlertIcon\">\n                </lib-message-alert>\n            </div>\n        </div>\n\n        <div class=\"row\" *ngIf=\"orgRecentDataM.length > 1\">\n            <div class=\"col-sm-12 mb-3\" *ngFor=\"let recentRes of orgRecentDataM\">\n                <mat-card class=\"cardOverwrite cardBackgroundColor\">\n                    <div class=\"row mb-2\">\n                        <div class=\"col-sm-6\">\n                            <span class=\"entity text-primary\">\n                                <div class=\"d-flex align-items-center\">\n                                    <span class=\"material-symbols-outlined me-2\">domain</span>\n                                    <span class=\"me-2\">{{ recentRes.entityName }}</span>\n                                    <span class=\"badge rounded-pill bg-secondary\">\n                                        {{ recentRes.entityType }}\n                                    </span>\n                                </div>\n                            </span>\n                        </div>\n                        <div class=\"col-sm-6 text-end\">\n                            <a class=\"text-primary cursorPointer\" matTooltip=\"Entity consumption\"\n                                matTooltipPosition=\"below\"\n                                (click)=\"showEntityConsumption(recentRes.entityID, recentRes.entityName)\">\n                                <span class=\"material-symbols-outlined fs-4 fw-bold\">monitoring</span>\n                            </a>\n                        </div>\n                    </div>\n\n                    <div class=\"row\">\n                        <div class=\"col-sm-12 ms-3\" *ngFor=\"let deviceRes of recentRes.deviceData\">\n                            <div class=\"d-flex align-items-center\">\n                                <span class=\"material-symbols-outlined me-1\"\n                                    [ngClass]=\"{'text-success': deviceRes.status == 'LIVE', 'text-secondary': deviceRes.status == 'OFFLINE' || deviceRes.status == 'NO_DATA'}\">\n                                    devices\n                                </span>\n                                {{ deviceRes.name }}\n                            </div>\n\n                            <div class=\"row mt-2\">\n                                <div class=\"col-sm-4 mb-3\" *ngFor=\"let paramRes of deviceRes.paramData\">\n                                    <mat-card class=\"cardOverwrite\">\n                                        <ng-container *ngTemplateOutlet=\"parameterData; context: {\n                                                duration: dateService.getRelativeTimeAgoLabel(paramRes?.data?.date, timezone),\n                                                value: paramRes?.data?.value,\n                                                unit: paramRes?.unit,\n                                                label: paramRes?.label,\n                                                entityID: recentRes?.entityID,\n                                                deviceID: deviceRes?.id,\n                                                paramName: paramRes?.name\n                                            }\"></ng-container>\n                                    </mat-card>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </mat-card>\n            </div>\n        </div>\n    </div>\n</div>\n\n<ng-template #parameterData let-duration=\"duration\" let-label=\"label\" let-value=\"value\" let-unit=\"unit\"\n    let-entityID=\"entityID\" let-deviceID=\"deviceID\" let-paramName=\"paramName\">\n    <div class=\"row\">\n        <div class=\"col-sm-6 textDurationWithAgoTime\">\n            {{ duration }}\n        </div>\n        <div class=\"col-sm-6 text-end\">\n            <a class=\"text-primary cursorPointer\" matTooltip=\"Trend\" matTooltipPosition=\"below\"\n                (click)=\"showTrend(paramName, deviceID, entityID)\">\n                <span class=\"material-symbols-outlined fs-5 fw-bold\">trending_up</span>\n            </a>\n        </div>\n    </div>\n    <div class=\"row mt-3\">\n        <div class=\"col-sm-12 text-center\">\n            <span class=\"fs-1 fw-bold text-primary\">{{ value ? value : commonConstant.HYPHEN }}</span>\n            <span class=\"text-secondary fw-bold\"> {{ value ? unit : '' }} </span>\n        </div>\n    </div>\n    <div class=\"row mt-4 mb-4\">\n        <div class=\"col-sm-12 fs-5 text-center\">\n            {{ label }}\n        </div>\n    </div>\n</ng-template>", styles: [".entity{text-transform:none;font-size:15px;font-weight:600}.badge{font-weight:none;font-size:1em;text-transform:none;padding:4px 9px}.bg-secondary{background-color:#b1b2b4!important}\n"], components: [{ type: i7.SkeletonComponent, selector: "lib-skeleton-loader", inputs: ["count", "appearance", "theme"] }, { type: i7.MessageAlertComponent, selector: "lib-message-alert", inputs: ["messageAlertTypeInp", "messageAlertIconInp", "labelInp", "contentInp"] }, { type: i8.MatCard, selector: "mat-card", exportAs: ["matCard"] }], directives: [{ type: i9.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i9.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i10.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { type: i9.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i9.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: FacilityComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'app-facility',
                    templateUrl: './facility.component.html',
                    styleUrls: ['./facility.component.scss']
                }]
        }], ctorParameters: function () { return [{ type: i1.Router }, { type: i2.StorageService }, { type: i3.DateService }, { type: i4.TrendService }, { type: i5.RecentDataService }, { type: i6.AlertService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjaWxpdHkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbGlicmFyeS90c2MtbGl0ZS9zcmMvbGliL3RzYy9jb21wb25lbnQvZGFzaGJvYXJkL2ZhY2lsaXR5L2ZhY2lsaXR5LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xpYnJhcnkvdHNjLWxpdGUvc3JjL2xpYi90c2MvY29tcG9uZW50L2Rhc2hib2FyZC9mYWNpbGl0eS9mYWNpbGl0eS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUdsRCxPQUFPLEVBQUUsYUFBYSxFQUFrQiw2QkFBNkIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ2hILE9BQU8sRUFBRSxLQUFLLEVBQVUsTUFBTSw0QkFBNEIsQ0FBQztBQUUzRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQVM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7Ozs7Ozs7OztBQUNsRyxnQkFBZ0I7QUFRaEIsTUFBTSxPQUFPLGlCQUFpQjtJQVkxQixZQUNZLE1BQWMsRUFDZCxjQUE4QixFQUMvQixXQUF3QixFQUN2QixZQUEwQixFQUMxQixpQkFBb0MsRUFDcEMsWUFBMEI7UUFMMUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUMvQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN2QixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBaEJ0QyxtQkFBYyxHQUFHLGVBQWUsQ0FBQztRQUtq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dXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuXG5pbXBvcnQgeyBPcmdSZWNlbnREYXRhLCBPcmdSZWNlbnREYXRhTSwgUmVjZW50RGF0YVJlcXVlc3RXaXRob3V0UGFyYW0gfSBmcm9tICcuLi8uLi8uLi9tb2RlbC9yZWNlbnQtZGF0YS5tb2RlbCc7XG5pbXBvcnQgeyBBbGVydCwgQWxlcnRNIH0gZnJvbSAnLi4vLi4vLi4vbW9kZWwvYWxlcnQubW9kZWwnO1xuXG5pbXBvcnQgeyBEYXNoYm9hcmRFcnJvckVudW0gfSBmcm9tICcuLi8uLi8uLi9lbnVtL2Vycm9yLmVudW0nO1xuXG5pbXBvcnQgeyBSZWNlbnREYXRhU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2UvcmVjZW50LWRhdGEuc2VydmljZSc7XG5pbXBvcnQgeyBUcmVuZFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlL3RyZW5kLnNlcnZpY2UnO1xuaW1wb3J0IHsgQWxlcnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZS9hbGVydC5zZXJ2aWNlJztcblxuLy8gdHNjLWxpYnJhcnlcbmltcG9ydCB7IERhdGVTZXJ2aWNlIH0gZnJvbSAnQGxpYnJhcnkvZGF0ZSc7XG5pbXBvcnQgeyBTdG9yYWdlU2VydmljZSB9IGZyb20gJ0BsaWJyYXJ5L3N0b3JhZ2Utc2VydmljZSc7XG5pbXBvcnQgeyBDT01NT05fQ09OU1RBTlQsIE1lc3NhZ2VBbGVydEljb25FbnVtLCBNZXNzYWdlQWxlcnRUeXBlRW51bSB9IGZyb20gJ0BsaWJyYXJ5L3RzYy1jb21tb24nO1xuLy8gL3RzYy1saWJyYXJ5L1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FwcC1mYWNpbGl0eScsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZhY2lsaXR5LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9mYWNpbGl0eS5jb21wb25lbnQuc2NzcyddXG59KVxuXG5leHBvcnQgY2xhc3MgRmFjaWxpdHlDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgY29tbW9uQ29uc3RhbnQgPSBDT01NT05fQ09OU1RBTlQ7XG5cbiAgICBvcmdJRDogYW55O1xuICAgIHRpbWV6b25lOiBhbnk7XG4gICAgYXBpVGltZXI6IGFueTtcbiAgICBzaG93TG9hZGVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBvcmdSZWNlbnREYXRhTSA9IFtuZXcgT3JnUmVjZW50RGF0YSgpXTtcbiAgICBhbGVydE9iajogQWxlcnRNID0gbmV3IEFsZXJ0KCk7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSBzdG9yYWdlU2VydmljZTogU3RvcmFnZVNlcnZpY2UsXG4gICAgICAgIHB1YmxpYyBkYXRlU2VydmljZTogRGF0ZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgdHJlbmRTZXJ2aWNlOiBUcmVuZFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcmVjZW50RGF0YVNlcnZpY2U6IFJlY2VudERhdGFTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogQWxlcnRTZXJ2aWNlLFxuICAgICkgeyB9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vcmdJRCA9IHRoaXMuc3RvcmFnZVNlcnZpY2UuZ2V0U3RvcmFnZSgnY3VycmVudE9yZ0lEJyk7XG4gICAgICAgIHRoaXMudGltZXpvbmUgPSB0aGlzLnN0b3JhZ2VTZXJ2aWNlLmdldFN0b3JhZ2UoJ3RpbWV6b25lJyk7XG5cbiAgICAgICAgdGhpcy5nZXRPcmdSZWNlbnREYXRhKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0T3JnUmVjZW50RGF0YSgpIHtcblxuICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5yZXNldEFsZXJ0UHJvcGVydGllcyh0aGlzLmFsZXJ0T2JqKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHJlcXVlc3RCb2R5ID0gbmV3IFJlY2VudERhdGFSZXF1ZXN0V2l0aG91dFBhcmFtKCk7XG5cbiAgICAgICAgICAgIHJlcXVlc3RCb2R5LnRpbWV6b25lID0gdGhpcy50aW1lem9uZTtcbiAgICAgICAgICAgIHJlcXVlc3RCb2R5LmJhY2tzY2FuID0gMTtcblxuICAgICAgICAgICAgdGhpcy5vcmdSZWNlbnREYXRhTSA9IDxPcmdSZWNlbnREYXRhTVtdPmF3YWl0IHRoaXMucmVjZW50RGF0YVNlcnZpY2UuZ2V0T3JnUmVjZW50RGF0YSh0aGlzLm9yZ0lELCByZXF1ZXN0Qm9keSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9yZ1JlY2VudERhdGFNICYmIHRoaXMub3JnUmVjZW50RGF0YU0ubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5zZXRBbGVydFByb3BlcnRpZXModGhpcy5hbGVydE9iaiwgRGFzaGJvYXJkRXJyb3JFbnVtLkRBVEFfTk9UX0ZPVU5EX0xBQkVMLCBEYXNoYm9hcmRFcnJvckVudW0uREFUQV9OT1RfRk9VTkRfTUVTU0FHRSwgTWVzc2FnZUFsZXJ0VHlwZUVudW0uV0FSTklORywgTWVzc2FnZUFsZXJ0SWNvbkVudW0uV0FSTklOR19JQ09OKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBpbiBnZXRPcmdSZWNlbnREYXRhKClgLCBlcnJvcik7XG4gICAgICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5zZXRBbGVydFByb3BlcnRpZXModGhpcy5hbGVydE9iaiwgRGFzaGJvYXJkRXJyb3JFbnVtLklOVkFMSURfRVJST1JfTEFCRUwsIERhc2hib2FyZEVycm9yRW51bS5JTlZBTElEX0VSUk9SX01FU1NBR0UsIE1lc3NhZ2VBbGVydFR5cGVFbnVtLkRBTkdFUiwgTWVzc2FnZUFsZXJ0SWNvbkVudW0uREFOR0VSX0lDT04pO1xuXG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLmFwaVRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRPcmdSZWNlbnREYXRhKCk7XG4gICAgICAgICAgICB9LCAzMDAwMDApO1xuICAgICAgICAgICAgdGhpcy5zaG93TG9hZGVyID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzaG93RW50aXR5Q29uc3VtcHRpb24oaWQsIG5hbWUpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWydkYXNoYm9hcmQvY29uc3VtcHRpb24nXSwgeyBxdWVyeVBhcmFtczogeyBlbnRpdHlJRDogaWQgfSB9KTtcbiAgICB9XG5cbiAgICBzaG93VHJlbmQocGFyYW1NZXRyaWMsIGRldmljZUlELCBlbnRpdHlJRCkge1xuICAgICAgICBsZXQgcmVxdWVzdEJvZHkgPSB7XG4gICAgICAgICAgICBwYXJhbU1ldHJpYzogcGFyYW1NZXRyaWMsXG4gICAgICAgICAgICBkZXZpY2VJRDogZGV2aWNlSUQsXG4gICAgICAgICAgICBlbnRpdHlJRDogZW50aXR5SURcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50cmVuZFNlcnZpY2Uub3BlbkRpYWxvZyhyZXF1ZXN0Qm9keSk7XG4gICAgfVxuXG59IiwiPGRpdiBjbGFzcz1cImNhcmQgbWFpbi1jYXJkIGNhcmRPdmVyd3JpdGUgaDEwMFwiPlxuICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJDb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRlckxlZnRDb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYWdlVGl0bGVcIj5GYWNpbGl0eSBEYXNoYm9hcmQ8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ib2R5IHB0LTBcIj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICA8bGliLXNrZWxldG9uLWxvYWRlciAqbmdJZj1cInNob3dMb2FkZXJcIiBbY291bnRdPVwiM1wiIFthcHBlYXJhbmNlXT1cIicnXCJcbiAgICAgICAgICAgICAgICBbdGhlbWVdPVwieyAnYm9yZGVyLXJhZGl1cyc6ICcxNnB4JywgaGVpZ2h0OiAnNDBweCcsICdiYWNrZ3JvdW5kLWNvbG9yJzogJ3JnYigyMzAgMjMyIDIzNSknIH1cIj48L2xpYi1za2VsZXRvbi1sb2FkZXI+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tMTJcIj5cbiAgICAgICAgICAgICAgICA8bGliLW1lc3NhZ2UtYWxlcnQgKm5nSWY9XCJhbGVydE9iai5zaG93QWxlcnRcIiBbbGFiZWxJbnBdPVwiYWxlcnRPYmouYWxlcnRMYWJlbFwiXG4gICAgICAgICAgICAgICAgICAgIFtjb250ZW50SW5wXT1cImFsZXJ0T2JqLmFsZXJ0Q29udGVudFwiIFttZXNzYWdlQWxlcnRUeXBlSW5wXT1cImFsZXJ0T2JqLm1lc3NhZ2VBbGVydFR5cGVcIlxuICAgICAgICAgICAgICAgICAgICBbbWVzc2FnZUFsZXJ0SWNvbklucF09XCJhbGVydE9iai5tZXNzYWdlQWxlcnRJY29uXCI+XG4gICAgICAgICAgICAgICAgPC9saWItbWVzc2FnZS1hbGVydD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCIgKm5nSWY9XCJvcmdSZWNlbnREYXRhTS5sZW5ndGggPiAxXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTEyIG1iLTNcIiAqbmdGb3I9XCJsZXQgcmVjZW50UmVzIG9mIG9yZ1JlY2VudERhdGFNXCI+XG4gICAgICAgICAgICAgICAgPG1hdC1jYXJkIGNsYXNzPVwiY2FyZE92ZXJ3cml0ZSBjYXJkQmFja2dyb3VuZENvbG9yXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgbWItMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJlbnRpdHkgdGV4dC1wcmltYXJ5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLXN5bWJvbHMtb3V0bGluZWQgbWUtMlwiPmRvbWFpbjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWUtMlwiPnt7IHJlY2VudFJlcy5lbnRpdHlOYW1lIH19PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJiYWRnZSByb3VuZGVkLXBpbGwgYmctc2Vjb25kYXJ5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3sgcmVjZW50UmVzLmVudGl0eVR5cGUgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTYgdGV4dC1lbmRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz1cInRleHQtcHJpbWFyeSBjdXJzb3JQb2ludGVyXCIgbWF0VG9vbHRpcD1cIkVudGl0eSBjb25zdW1wdGlvblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdFRvb2x0aXBQb3NpdGlvbj1cImJlbG93XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNsaWNrKT1cInNob3dFbnRpdHlDb25zdW1wdGlvbihyZWNlbnRSZXMuZW50aXR5SUQsIHJlY2VudFJlcy5lbnRpdHlOYW1lKVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLXN5bWJvbHMtb3V0bGluZWQgZnMtNCBmdy1ib2xkXCI+bW9uaXRvcmluZzwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMiBtcy0zXCIgKm5nRm9yPVwibGV0IGRldmljZVJlcyBvZiByZWNlbnRSZXMuZGV2aWNlRGF0YVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCBtZS0xXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cInsndGV4dC1zdWNjZXNzJzogZGV2aWNlUmVzLnN0YXR1cyA9PSAnTElWRScsICd0ZXh0LXNlY29uZGFyeSc6IGRldmljZVJlcy5zdGF0dXMgPT0gJ09GRkxJTkUnIHx8IGRldmljZVJlcy5zdGF0dXMgPT0gJ05PX0RBVEEnfVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGRldmljZVJlcy5uYW1lIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93IG10LTJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS00IG1iLTNcIiAqbmdGb3I9XCJsZXQgcGFyYW1SZXMgb2YgZGV2aWNlUmVzLnBhcmFtRGF0YVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG1hdC1jYXJkIGNsYXNzPVwiY2FyZE92ZXJ3cml0ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJwYXJhbWV0ZXJEYXRhOyBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogZGF0ZVNlcnZpY2UuZ2V0UmVsYXRpdmVUaW1lQWdvTGFiZWwocGFyYW1SZXM/LmRhdGE/LmRhdGUsIHRpbWV6b25lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwYXJhbVJlcz8uZGF0YT8udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0OiBwYXJhbVJlcz8udW5pdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBwYXJhbVJlcz8ubGFiZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlJRDogcmVjZW50UmVzPy5lbnRpdHlJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZUlEOiBkZXZpY2VSZXM/LmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1OYW1lOiBwYXJhbVJlcz8ubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L21hdC1jYXJkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L21hdC1jYXJkPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG5cbjxuZy10ZW1wbGF0ZSAjcGFyYW1ldGVyRGF0YSBsZXQtZHVyYXRpb249XCJkdXJhdGlvblwiIGxldC1sYWJlbD1cImxhYmVsXCIgbGV0LXZhbHVlPVwidmFsdWVcIiBsZXQtdW5pdD1cInVuaXRcIlxuICAgIGxldC1lbnRpdHlJRD1cImVudGl0eUlEXCIgbGV0LWRldmljZUlEPVwiZGV2aWNlSURcIiBsZXQtcGFyYW1OYW1lPVwicGFyYW1OYW1lXCI+XG4gICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTYgdGV4dER1cmF0aW9uV2l0aEFnb1RpbWVcIj5cbiAgICAgICAgICAgIHt7IGR1cmF0aW9uIH19XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTYgdGV4dC1lbmRcIj5cbiAgICAgICAgICAgIDxhIGNsYXNzPVwidGV4dC1wcmltYXJ5IGN1cnNvclBvaW50ZXJcIiBtYXRUb29sdGlwPVwiVHJlbmRcIiBtYXRUb29sdGlwUG9zaXRpb249XCJiZWxvd1wiXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cInNob3dUcmVuZChwYXJhbU5hbWUsIGRldmljZUlELCBlbnRpdHlJRClcIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLXN5bWJvbHMtb3V0bGluZWQgZnMtNSBmdy1ib2xkXCI+dHJlbmRpbmdfdXA8L3NwYW4+XG4gICAgICAgICAgICA8L2E+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJyb3cgbXQtM1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTEyIHRleHQtY2VudGVyXCI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImZzLTEgZnctYm9sZCB0ZXh0LXByaW1hcnlcIj57eyB2YWx1ZSA/IHZhbHVlIDogY29tbW9uQ29uc3RhbnQuSFlQSEVOIH19PC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0ZXh0LXNlY29uZGFyeSBmdy1ib2xkXCI+IHt7IHZhbHVlID8gdW5pdCA6ICcnIH19IDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInJvdyBtdC00IG1iLTRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMiBmcy01IHRleHQtY2VudGVyXCI+XG4gICAgICAgICAgICB7eyBsYWJlbCB9fVxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+Il19