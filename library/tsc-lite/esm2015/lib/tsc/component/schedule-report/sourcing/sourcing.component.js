import { __awaiter, __rest } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { Validators } from '@angular/forms';
import { isEqual } from 'lodash';
import { ScheduleReportTypeEnum } from '../../../enum/schedule-report.enum';
import { ScheduleReport } from '../../../model/schedule-report.model';
// tsc-library
import { MaterialFormFieldAppearance, InvalidForm, ButtonLabelEnum, FormAction, FormErrorEnum, COMMON_CONSTANT, MATERIAL_CONSTANT, ButtonTooltipEnum } from '@library/tsc-common';
import { ToastrColor } from '@library/toastr-service';
import { ApplicationKeyID } from '@library/application-service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "@angular/forms";
import * as i3 from "../../../controller/schedule-report.controller";
import * as i4 from "../../../service/parameter.service";
import * as i5 from "../../../service/schedule-report.service";
import * as i6 from "@library/storage-service";
import * as i7 from "@library/tsc-common";
import * as i8 from "@library/toastr-service";
import * as i9 from "@angular/material/card";
import * as i10 from "@angular/material/form-field";
import * as i11 from "@angular/material/select";
import * as i12 from "@angular/material/core";
import * as i13 from "../_shared/configuration/configuration.component";
import * as i14 from "@angular/common";
// /tsc-library/
export class ScheduleReportSourcingComponent {
    constructor(activatedRoute, router, formBuilder, scheduleReportController, parameterService, scheduleReportService, 
    // tsc-library
    storageService, tscCommonService, toastrService) {
        this.activatedRoute = activatedRoute;
        this.router = router;
        this.formBuilder = formBuilder;
        this.scheduleReportController = scheduleReportController;
        this.parameterService = parameterService;
        this.scheduleReportService = scheduleReportService;
        this.storageService = storageService;
        this.tscCommonService = tscCommonService;
        this.toastrService = toastrService;
        this.COMMON_CONSTANT = COMMON_CONSTANT;
        this.MATERIAL_CONSTANT = MATERIAL_CONSTANT;
        this.FormAction = FormAction;
        this.FormErrorEnum = FormErrorEnum;
        this.ButtonLabelEnum = ButtonLabelEnum;
        this.ButtonTooltipEnum = ButtonTooltipEnum;
        this.MaterialFormFieldAppearance = MaterialFormFieldAppearance;
        this.allParameterID = [];
        this.totalParameterCount = 0;
        this.isEqual = true;
        this.scheduleReportI = new ScheduleReport();
        this.errorHandling = (formGroup, controlPath, error) => {
            return formGroup.get(controlPath).hasError(error);
        };
    }
    ngOnInit() {
        this.orgID = this.storageService.getStorage('currentOrgID');
        this.applicationKeyID = this.storageService.getStorage('applicationKeyID');
        this.scheduleSourcingReportFGInit();
        this.getConsumptionParameter();
        this.activatedRoute.data.subscribe(data => {
            this.action = data.action;
            this.setPageTitle();
        });
        this.activatedRoute.params.subscribe(params => {
            if (this.action == FormAction.UPDATE) {
                this.scheduleReportID = params.scheduleReportID;
                this.getScheduleReportByID(this.scheduleReportID);
            }
        });
    }
    setPageTitle() {
        const applicationName = this.applicationKeyID == ApplicationKeyID.WATER_KEY_ID ? 'Water' : 'Energy';
        if (this.action == FormAction.CREATE) {
            this.pageTitle = `Schedule ${applicationName} Sourcing Report`;
        }
        else if (this.action == FormAction.UPDATE) {
            this.pageTitle = `Update Scheduled ${applicationName} Sourcing  Report`;
        }
    }
    scheduleSourcingReportFGInit() {
        this.scheduleSourcingReportFG = this.formBuilder.group({
            reportConfig: this.formBuilder.group({
                reportType: [ScheduleReportTypeEnum.SOURCING_REPORT, Validators.required],
                deviceID: [[]],
                entityType: [],
                entityID: [[]],
                sourceConsumer: this.formBuilder.group({
                    type: ['SOURCE'],
                    keyID: []
                }),
                paramMetric: [[], Validators.required],
            }),
            schedulerConfig: this.formBuilder.group({
                name: [, Validators.required],
                dataInterval: [, Validators.required],
                frequency: [, Validators.required],
                userChoice: [, Validators.required],
                userID: [[], Validators.required],
                otherUserEmail: [[]],
                status: [, Validators.required],
                reportFormat: [, Validators.required],
            })
        });
    }
    getConsumptionParameter() {
        return __awaiter(this, void 0, void 0, function* () {
            const consumptionParamM = yield this.parameterService.getConsumptionParameter(this.orgID);
            this.consumptionParamM = consumptionParamM.consumptionParameter;
            this.totalParameterCount = this.consumptionParamM.length;
            this.consumptionParamM.forEach(parameter => this.allParameterID.push(parameter['paramMetric']));
        });
    }
    selectAllParameters() {
        if (!this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').value.includes(-1)) {
            this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').reset([]);
            return;
        }
        this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').setValue([-1, ...this.allParameterID]);
    }
    selectedParameters() {
        const selected = this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').value;
        if (selected.includes(-1)) {
            selected.shift();
            this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').patchValue(selected);
        }
        else if (this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').value.length == this.totalParameterCount) {
            this.allParameterID.splice(0, 0, -1);
            this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').patchValue(this.allParameterID);
        }
        else {
            const filteredSelected = selected.filter(s => s != -1);
            this.scheduleSourcingReportFG.get('paramMetric').patchValue(filteredSelected);
        }
    }
    patchSchedulerConfigInput() {
        this.scheduleSourcingReportFG.get('schedulerConfig').patchValue(this.schedulerConfigInput.scheduleReportFG.value);
    }
    getValidFormData() {
        this.patchSchedulerConfigInput();
        let userID = this.tscCommonService.removeSelectAllID(this.scheduleSourcingReportFG.get('schedulerConfig').get('userID').value);
        this.scheduleSourcingReportFG.get('schedulerConfig').get('userID').patchValue(userID);
        let paramMetrics = this.tscCommonService.removeSelectAllID(this.scheduleSourcingReportFG.get('reportConfig').get('paramMetric').value);
        let paramsArray = paramMetrics.map(paramName => ({
            name: paramName,
            dsAgg: 'sum',
            agg: 'sum'
        }));
        const reportConfigFG = this.scheduleSourcingReportFG.get('reportConfig').value;
        const schedulerConfigFG = this.scheduleSourcingReportFG.get('schedulerConfig').value;
        const { paramMetric } = reportConfigFG, reportConfigWithoutParamMetric = __rest(reportConfigFG, ["paramMetric"]);
        this.modifiedFG = {
            reportConfig: Object.assign(Object.assign({}, reportConfigWithoutParamMetric), { params: paramsArray }),
            schedulerConfig: Object.assign({}, schedulerConfigFG)
        };
    }
    scheduleReportSubmit() {
        this.patchSchedulerConfigInput();
        if (this.schedulerConfigInput.scheduleReportFG.invalid) {
            this.schedulerConfigInput.scheduleReportFG.markAllAsTouched();
        }
        if (this.scheduleSourcingReportFG.invalid) {
            console.log('Invalid form:', this.scheduleSourcingReportFG.value);
            this.toastrService.openToast(InvalidForm.INVALID_FORM_TITLE, InvalidForm.INVALID_FORM_MESSAGE, ToastrColor.ERROR);
            return;
        }
        else {
            this.getValidFormData();
            if (this.action == FormAction.CREATE) {
                this.createScheduleReport();
            }
            else if (this.action == FormAction.UPDATE) {
                this.updateScheduleReport();
            }
        }
    }
    createScheduleReport() {
        this.scheduleReportController.createScheduleReport(this.orgID, this.modifiedFG).subscribe((res) => {
            this.router.navigate([`schedule-report/page`]);
        }, error => {
            console.log('error in createScheduleReport -', error);
        });
    }
    getScheduleReportByID(scheduleReportID) {
        return __awaiter(this, void 0, void 0, function* () {
            this.scheduleReportI = (yield this.scheduleReportService.getScheduleReportByID(this.orgID, scheduleReportID));
            this.patchScheduleReport(this.scheduleReportI);
        });
    }
    patchScheduleReport(scheduleReportI) {
        this.scheduleSourcingReportFG.patchValue({
            reportConfig: scheduleReportI.reportConfig,
            schedulerConfig: scheduleReportI.schedulerConfig
        });
        this.schedulerConfigInput.scheduleReportFG.patchValue(scheduleReportI.schedulerConfig);
        this.initialObject = {
            sourcingReportConfig: this.scheduleSourcingReportFG.value,
            schedulerConfig: this.schedulerConfigInput.scheduleReportFG.value
        };
        this.isValidUpdateForm();
    }
    isValidUpdateForm() {
        this.schedulerConfigInput.scheduleReportFG.valueChanges.subscribe(() => {
            this.checkEquality();
        });
        this.scheduleSourcingReportFG.valueChanges.subscribe(() => {
            this.checkEquality();
        });
    }
    checkEquality() {
        const currentValues = {
            sourcingReportConfig: this.scheduleSourcingReportFG.value,
            schedulerConfig: this.schedulerConfigInput.scheduleReportFG.value
        };
        this.isEqual = isEqual(this.initialObject, currentValues);
    }
    updateScheduleReport() {
        this.scheduleReportController.updateScheduleReport(this.orgID, this.scheduleReportID, this.modifiedFG).subscribe((res) => {
            this.tscCommonService.back();
        }, error => {
            console.log('error in updateScheduleReport -', error);
        });
    }
}
ScheduleReportSourcingComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: ScheduleReportSourcingComponent, deps: [{ token: i1.ActivatedRoute }, { token: i1.Router }, { token: i2.FormBuilder }, { token: i3.ScheduleReportController }, { token: i4.ParameterService }, { token: i5.ScheduleReportService }, { token: i6.StorageService }, { token: i7.TSCCommonService }, { token: i8.ToastrService }], target: i0.ɵɵFactoryTarget.Component });
ScheduleReportSourcingComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: ScheduleReportSourcingComponent, selector: "lib-sourcing", viewQueries: [{ propertyName: "schedulerConfigInput", first: true, predicate: ["schedulerConfigInput"], descendants: true }], ngImport: i0, template: "<div class=\"card main-card cardOverwrite h100\">\n    <div class=\"headerContainer\">\n        <div class=\"headerLeftContainer\">\n            <div class=\"pageTitle\">{{ pageTitle }}</div>\n            <div class=\"pageSubtitle\"></div>\n        </div>\n    </div>\n\n    <div class=\"card-body\">\n        <form [formGroup]=\"scheduleSourcingReportFG\" (ngSubmit)=\"scheduleReportSubmit()\">\n            <div class=\"row\">\n                <div class=\"col-sm-12\">\n                    <mat-card class=\"border cardOverwrite\">\n                        <div class=\"cardTitle\">\n                            Report configuration\n                        </div>\n                        <div class=\"row mt-2\">\n                            <div class=\"col-sm-3\">\n                                <div formGroupName=\"reportConfig\">\n                                    <mat-form-field class=\"matFieldWidth100\" [appearance]=\"MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE\">\n                                        <mat-label>Select consumption parameter</mat-label>\n                                        <mat-select formControlName=\"paramMetric\" multiple required>\n                                            <ng-container\n                                                *ngIf=\"consumptionParamM && consumptionParamM.length > 0 && consumptionParamM[0]['id']; else noConsumptionParamM\">\n                                                <mat-option [value]=\"-1\" (click)=\"selectAllParameters()\">\n                                                    Select all\n                                                </mat-option>\n                                                <mat-option *ngFor=\"let param of consumptionParamM\" [value]=\"param.paramMetric\"\n                                                    (click)=\"selectedParameters()\">\n                                                    {{ param.label }}\n                                                </mat-option>\n                                            </ng-container>\n                                            <ng-template #noConsumptionParamM>\n                                                <mat-option disabled>\n                                                    {{ COMMON_CONSTANT.NO_DATA_FOUND }}\n                                                </mat-option>\n                                            </ng-template>\n                                        </mat-select>\n                                        <mat-error *ngIf=\"errorHandling(scheduleSourcingReportFG, 'reportConfig.paramMetric', 'required')\">\n                                            {{ FormErrorEnum.REQUIRED }}\n                                        </mat-error>\n                                    </mat-form-field>\n                                </div>\n                            </div>\n                        </div>\n                    </mat-card>\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-sm-12\">\n                    <lib-configuration #schedulerConfigInput></lib-configuration>\n                </div>\n            </div>\n            \n            <button class=\"d-none\" type=\"submit\" #formSubmitBtn></button>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-sm-12\">\n                    <div class=\"float-end\">\n                        <button class=\"btn btn-sm btn-secondary me-2\" type=\"button\" (click)=\"tscCommonService.back()\">\n                            {{ ButtonLabelEnum.CANCEL_BTN_LABEL }}\n                        </button>\n\n                        <button class=\"btn btn-sm btn-success\" [ngClass]=\"{\n                                            'btn-success' : action == FormAction.CREATE,\n                                            'btn-primary' : action == FormAction.UPDATE,\n                                            'disabled' : action == FormAction.UPDATE && isEqual\n                                        }\" type=\"submit\">{{ action ==\n                            FormAction.CREATE ? 'Schedule' :\n                            ButtonLabelEnum.UPDATE_BTN_LABEL }}\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </form>\n    </div>\n</div>", components: [{ type: i9.MatCard, selector: "mat-card", exportAs: ["matCard"] }, { type: i10.MatFormField, selector: "mat-form-field", inputs: ["color", "floatLabel", "appearance", "hideRequiredMarker", "hintLabel"], exportAs: ["matFormField"] }, { type: i11.MatSelect, selector: "mat-select", inputs: ["disabled", "disableRipple", "tabIndex"], exportAs: ["matSelect"] }, { type: i12.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { type: i13.ScheduleReportConfigurationComponent, selector: "lib-configuration" }], directives: [{ type: i2.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i2.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i2.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i2.FormGroupName, selector: "[formGroupName]", inputs: ["formGroupName"] }, { type: i10.MatLabel, selector: "mat-label" }, { type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i2.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i2.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { type: i14.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i14.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i10.MatError, selector: "mat-error", inputs: ["id"] }, { type: i14.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: ScheduleReportSourcingComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-sourcing',
                    templateUrl: './sourcing.component.html',
                    styles: []
                }]
        }], ctorParameters: function () { return [{ type: i1.ActivatedRoute }, { type: i1.Router }, { type: i2.FormBuilder }, { type: i3.ScheduleReportController }, { type: i4.ParameterService }, { type: i5.ScheduleReportService }, { type: i6.StorageService }, { type: i7.TSCCommonService }, { type: i8.ToastrService }]; }, propDecorators: { schedulerConfigInput: [{
                type: ViewChild,
                args: ['schedulerConfigInput']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNpbmcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbGlicmFyeS90c2MtbGl0ZS9zcmMvbGliL3RzYy9jb21wb25lbnQvc2NoZWR1bGUtcmVwb3J0L3NvdXJjaW5nL3NvdXJjaW5nLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xpYnJhcnkvdHNjLWxpdGUvc3JjL2xpYi90c2MvY29tcG9uZW50L3NjaGVkdWxlLXJlcG9ydC9zb3VyY2luZy9zb3VyY2luZy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUEwQixVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUdwRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRWpDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBRzVFLE9BQU8sRUFBRSxjQUFjLEVBQW1CLE1BQU0sc0NBQXNDLENBQUM7QUFTdkYsY0FBYztBQUNkLE9BQU8sRUFBYSwyQkFBMkIsRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQW9CLGVBQWUsRUFBRSxpQkFBaUIsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQy9NLE9BQU8sRUFBRSxXQUFXLEVBQWlCLE1BQU0seUJBQXlCLENBQUM7QUFFckUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDaEUsZ0JBQWdCO0FBUWhCLE1BQU0sT0FBTywrQkFBK0I7SUErQnhDLFlBQ1ksY0FBOEIsRUFDOUIsTUFBYyxFQUNkLFdBQXdCLEVBQ3hCLHdCQUFrRCxFQUNsRCxnQkFBa0Ms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b0IsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLO1NBQ3BFLENBQUM7UUFDRixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFRCxvQkFBb0I7UUFDaEIsSUFBSSxDQUFDLHdCQUF3QixDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFjLEVBQUUsRUFBRTtZQUVoSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFakMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxFQUFFO1lBQ1AsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7OzZIQXRQUSwrQkFBK0I7aUhBQS9CLCtCQUErQixrTEMvQjVDLHl3SUE2RU07NEZEOUNPLCtCQUErQjtrQkFOM0MsU0FBUzttQkFBQztvQkFDUCxRQUFRLEVBQUUsY0FBYztvQkFDeEIsV0FBVyxFQUFFLDJCQUEyQjtvQkFDeEMsTUFBTSxFQUFFLEVBQ1A7aUJBQ0o7c1ZBOEJzQyxvQkFBb0I7c0JBQXRELFNBQVM7dUJBQUMsc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuXG5pbXBvcnQgeyBpc0VxdWFsIH0gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IHsgU2NoZWR1bGVSZXBvcnRUeXBlRW51bSB9IGZyb20gJy4uLy4uLy4uL2VudW0vc2NoZWR1bGUtcmVwb3J0LmVudW0nO1xuXG5pbXBvcnQgeyBDb25zdW1wdGlvblBhcmFtZXRlck0gfSBmcm9tICcuLi8uLi8uLi9tb2RlbC9wYXJhbWV0ZXIubW9kZWwnO1xuaW1wb3J0IHsgU2NoZWR1bGVSZXBvcnQsIFNjaGVkdWxlUmVwb3J0SSB9IGZyb20gJy4uLy4uLy4uL21vZGVsL3NjaGVkdWxlLXJlcG9ydC5tb2RlbCc7XG5cbmltcG9ydCB7IFNjaGVkdWxlUmVwb3J0Q29udHJvbGxlciB9IGZyb20gJy4uLy4uLy4uL2NvbnRyb2xsZXIvc2NoZWR1bGUtcmVwb3J0LmNvbnRyb2xsZXInO1xuXG5pbXBvcnQgeyBQYXJhbWV0ZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZS9wYXJhbWV0ZXIuc2VydmljZSc7XG5pbXBvcnQgeyBTY2hlZHVsZVJlcG9ydFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlL3NjaGVkdWxlLXJlcG9ydC5zZXJ2aWNlJztcblxuaW1wb3J0IHsgU2NoZWR1bGVSZXBvcnRDb25maWd1cmF0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi4vX3NoYXJlZC9jb25maWd1cmF0aW9uL2NvbmZpZ3VyYXRpb24uY29tcG9uZW50JztcblxuLy8gdHNjLWxpYnJhcnlcbmltcG9ydCB7IFJlc3BvbnNlTSwgTWF0ZXJpYWxGb3JtRmllbGRBcHBlYXJhbmNlLCBJbnZhbGlkRm9ybSwgQnV0dG9uTGFiZWxFbnVtLCBGb3JtQWN0aW9uLCBGb3JtRXJyb3JFbnVtLCBUU0NDb21tb25TZXJ2aWNlLCBDT01NT05fQ09OU1RBTlQsIE1BVEVSSUFMX0NPTlNUQU5ULCBCdXR0b25Ub29sdGlwRW51bSB9IGZyb20gJ0BsaWJyYXJ5L3RzYy1jb21tb24nO1xuaW1wb3J0IHsgVG9hc3RyQ29sb3IsIFRvYXN0clNlcnZpY2UgfSBmcm9tICdAbGlicmFyeS90b2FzdHItc2VydmljZSc7XG5pbXBvcnQgeyBTdG9yYWdlU2VydmljZSB9IGZyb20gJ0BsaWJyYXJ5L3N0b3JhZ2Utc2VydmljZSc7XG5pbXBvcnQgeyBBcHBsaWNhdGlvbktleUlEIH0gZnJvbSAnQGxpYnJhcnkvYXBwbGljYXRpb24tc2VydmljZSc7XG4vLyAvdHNjLWxpYnJhcnkvXG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbGliLXNvdXJjaW5nJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vc291cmNpbmcuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlczogW1xuICAgIF1cbn0pXG5leHBvcnQgY2xhc3MgU2NoZWR1bGVSZXBvcnRTb3VyY2luZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBDT01NT05fQ09OU1RBTlQgPSBDT01NT05fQ09OU1RBTlQ7XG4gICAgTUFURVJJQUxfQ09OU1RBTlQgPSBNQVRFUklBTF9DT05TVEFOVDtcblxuICAgIEZvcm1BY3Rpb24gPSBGb3JtQWN0aW9uO1xuICAgIEZvcm1FcnJvckVudW0gPSBGb3JtRXJyb3JFbnVtO1xuICAgIEJ1dHRvbkxhYmVsRW51bSA9IEJ1dHRvbkxhYmVsRW51bTtcbiAgICBCdXR0b25Ub29sdGlwRW51bSA9IEJ1dHRvblRvb2x0aXBFbnVtO1xuICAgIE1hdGVyaWFsRm9ybUZpZWxkQXBwZWFyYW5jZSA9IE1hdGVyaWFsRm9ybUZpZWxkQXBwZWFyYW5jZTtcblxuICAgIG9yZ0lEOiBhbnk7XG4gICAgYXBwbGljYXRpb25LZXlJRDogYW55O1xuICAgIGNvbnN1bXB0aW9uUGFyYW1NOiBhbnk7XG5cbiAgICBzY2hlZHVsZVNvdXJjaW5nUmVwb3J0Rkc6IEZvcm1Hcm91cDtcbiAgICBtb2RpZmllZEZHOiBhbnk7XG4gICAgc2NoZWR1bGVSZXBvcnRJRDogYW55O1xuXG4gICAgYWxsUGFyYW1ldGVySUQ6IGFueVtdID0gW107XG4gICAgdG90YWxQYXJhbWV0ZXJDb3VudDogbnVtYmVyID0gMDtcblxuICAgIGFjdGlvbjogc3RyaW5nO1xuICAgIHBhZ2VUaXRsZTogc3RyaW5nO1xuICAgIGlzRXF1YWw6IGJvb2xlYW4gPSB0cnVlO1xuICAgIGluaXRpYWxPYmplY3Q6IGFueTtcblxuICAgIHNjaGVkdWxlUmVwb3J0SSA9IG5ldyBTY2hlZHVsZVJlcG9ydCgpO1xuXG4gICAgQFZpZXdDaGlsZCgnc2NoZWR1bGVyQ29uZmlnSW5wdXQnKSBzY2hlZHVsZXJDb25maWdJbnB1dDogU2NoZWR1bGVSZXBvcnRDb25maWd1cmF0aW9uQ29tcG9uZW50O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgICAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgICAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcixcbiAgICAgICAgcHJpdmF0ZSBzY2hlZHVsZVJlcG9ydENvbnRyb2xsZXI6IFNjaGVkdWxlUmVwb3J0Q29udHJvbGxlcixcbiAgICAgICAgcHJpdmF0ZSBwYXJhbWV0ZXJTZXJ2aWNlOiBQYXJhbWV0ZXJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHNjaGVkdWxlUmVwb3J0U2VydmljZTogU2NoZWR1bGVSZXBvcnRTZXJ2aWNlLFxuXG4gICAgICAgIC8vIHRzYy1saWJyYXJ5XG4gICAgICAgIHByaXZhdGUgc3RvcmFnZVNlcnZpY2U6IFN0b3JhZ2VTZXJ2aWNlLFxuICAgICAgICBwdWJsaWMgdHNjQ29tbW9uU2VydmljZTogVFNDQ29tbW9uU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB0b2FzdHJTZXJ2aWNlOiBUb2FzdHJTZXJ2aWNlLFxuICAgICAgICAvLyAvdHNjLWxpYnJhcnkvXG4gICAgKSB7IH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLm9yZ0lEID0gdGhpcy5zdG9yYWdlU2VydmljZS5nZXRTdG9yYWdlKCdjdXJyZW50T3JnSUQnKTtcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbktleUlEID0gdGhpcy5zdG9yYWdlU2VydmljZS5nZXRTdG9yYWdlKCdhcHBsaWNhdGlvbktleUlEJyk7XG5cbiAgICAgICAgdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkdJbml0KCk7XG4gICAgICAgIHRoaXMuZ2V0Q29uc3VtcHRpb25QYXJhbWV0ZXIoKTtcblxuICAgICAgICB0aGlzLmFjdGl2YXRlZFJvdXRlLmRhdGEuc3Vic2NyaWJlKGRhdGEgPT4ge1xuICAgICAgICAgICAgdGhpcy5hY3Rpb24gPSBkYXRhLmFjdGlvbjtcbiAgICAgICAgICAgIHRoaXMuc2V0UGFnZVRpdGxlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWN0aXZhdGVkUm91dGUucGFyYW1zLnN1YnNjcmliZShwYXJhbXMgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uID09IEZvcm1BY3Rpb24uVVBEQVRFKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZVJlcG9ydElEID0gcGFyYW1zLnNjaGVkdWxlUmVwb3J0SUQ7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmdldFNjaGVkdWxlUmVwb3J0QnlJRCh0aGlzLnNjaGVkdWxlUmVwb3J0SUQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXRQYWdlVGl0bGUoKSB7XG4gICAgICAgIGNvbnN0IGFwcGxpY2F0aW9uTmFtZSA9IHRoaXMuYXBwbGljYXRpb25LZXlJRCA9PSBBcHBsaWNhdGlvbktleUlELldBVEVSX0tFWV9JRCA/ICdXYXRlcicgOiAnRW5lcmd5JztcblxuICAgICAgICBpZiAodGhpcy5hY3Rpb24gPT0gRm9ybUFjdGlvbi5DUkVBVEUpIHtcbiAgICAgICAgICAgIHRoaXMucGFnZVRpdGxlID0gYFNjaGVkdWxlICR7YXBwbGljYXRpb25OYW1lfSBTb3VyY2luZyBSZXBvcnRgO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWN0aW9uID09IEZvcm1BY3Rpb24uVVBEQVRFKSB7XG4gICAgICAgICAgICB0aGlzLnBhZ2VUaXRsZSA9IGBVcGRhdGUgU2NoZWR1bGVkICR7YXBwbGljYXRpb25OYW1lfSBTb3VyY2luZyAgUmVwb3J0YDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNjaGVkdWxlU291cmNpbmdSZXBvcnRGR0luaXQoKSB7XG4gICAgICAgIHRoaXMuc2NoZWR1bGVTb3VyY2luZ1JlcG9ydEZHID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cCh7XG4gICAgICAgICAgICByZXBvcnRDb25maWc6IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgICAgICAgICAgIHJlcG9ydFR5cGU6IFtTY2hlZHVsZVJlcG9ydFR5cGVFbnVtLlNPVVJDSU5HX1JFUE9SVCwgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICAgICAgICAgICAgZGV2aWNlSUQ6IFtbXV0sXG4gICAgICAgICAgICAgICAgZW50aXR5VHlwZTogW10sXG4gICAgICAgICAgICAgICAgZW50aXR5SUQ6IFtbXV0sXG4gICAgICAgICAgICAgICAgc291cmNlQ29uc3VtZXI6IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBbJ1NPVVJDRSddLFxuICAgICAgICAgICAgICAgICAgICBrZXlJRDogW11cbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBwYXJhbU1ldHJpYzogW1tdLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgc2NoZWR1bGVyQ29uZmlnOiB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICAgICAgICAgICAgICBuYW1lOiBbLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcbiAgICAgICAgICAgICAgICBkYXRhSW50ZXJ2YWw6IFssIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogWywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICAgICAgICAgICAgdXNlckNob2ljZTogWywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICAgICAgICAgICAgdXNlcklEOiBbW10sIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgICAgICAgICAgIG90aGVyVXNlckVtYWlsOiBbW11dLFxuICAgICAgICAgICAgICAgIHN0YXR1czogWywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICAgICAgICAgICAgcmVwb3J0Rm9ybWF0OiBbLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIGdldENvbnN1bXB0aW9uUGFyYW1ldGVyKCkge1xuICAgICAgICBjb25zdCBjb25zdW1wdGlvblBhcmFtTSA9IDxDb25zdW1wdGlvblBhcmFtZXRlck0+YXdhaXQgdGhpcy5wYXJhbWV0ZXJTZXJ2aWNlLmdldENvbnN1bXB0aW9uUGFyYW1ldGVyKHRoaXMub3JnSUQpO1xuICAgICAgICB0aGlzLmNvbnN1bXB0aW9uUGFyYW1NID0gY29uc3VtcHRpb25QYXJhbU0uY29uc3VtcHRpb25QYXJhbWV0ZXI7XG5cbiAgICAgICAgdGhpcy50b3RhbFBhcmFtZXRlckNvdW50ID0gdGhpcy5jb25zdW1wdGlvblBhcmFtTS5sZW5ndGg7XG4gICAgICAgIHRoaXMuY29uc3VtcHRpb25QYXJhbU0uZm9yRWFjaChwYXJhbWV0ZXIgPT4gdGhpcy5hbGxQYXJhbWV0ZXJJRC5wdXNoKHBhcmFtZXRlclsncGFyYW1NZXRyaWMnXSkpO1xuICAgIH1cblxuICAgIHNlbGVjdEFsbFBhcmFtZXRlcnMoKSB7XG4gICAgICAgIGlmICghdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcuZ2V0KCdyZXBvcnRDb25maWcnKS5nZXQoJ3BhcmFtTWV0cmljJykudmFsdWUuaW5jbHVkZXMoLTEpKSB7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlU291cmNpbmdSZXBvcnRGRy5nZXQoJ3JlcG9ydENvbmZpZycpLmdldCgncGFyYW1NZXRyaWMnKS5yZXNldChbXSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcuZ2V0KCdyZXBvcnRDb25maWcnKS5nZXQoJ3BhcmFtTWV0cmljJykuc2V0VmFsdWUoWy0xLCAuLi50aGlzLmFsbFBhcmFtZXRlcklEXSk7XG4gICAgfVxuXG4gICAgc2VsZWN0ZWRQYXJhbWV0ZXJzKCkge1xuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuc2NoZWR1bGVTb3VyY2luZ1JlcG9ydEZHLmdldCgncmVwb3J0Q29uZmlnJykuZ2V0KCdwYXJhbU1ldHJpYycpLnZhbHVlO1xuXG4gICAgICAgIGlmIChzZWxlY3RlZC5pbmNsdWRlcygtMSkpIHtcbiAgICAgICAgICAgIHNlbGVjdGVkLnNoaWZ0KCk7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlU291cmNpbmdSZXBvcnRGRy5nZXQoJ3JlcG9ydENvbmZpZycpLmdldCgncGFyYW1NZXRyaWMnKS5wYXRjaFZhbHVlKHNlbGVjdGVkKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNjaGVkdWxlU291cmNpbmdSZXBvcnRGRy5nZXQoJ3JlcG9ydENvbmZpZycpLmdldCgncGFyYW1NZXRyaWMnKS52YWx1ZS5sZW5ndGggPT0gdGhpcy50b3RhbFBhcmFtZXRlckNvdW50KSB7XG4gICAgICAgICAgICB0aGlzLmFsbFBhcmFtZXRlcklELnNwbGljZSgwLCAwLCAtMSk7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlU291cmNpbmdSZXBvcnRGRy5nZXQoJ3JlcG9ydENvbmZpZycpLmdldCgncGFyYW1NZXRyaWMnKS5wYXRjaFZhbHVlKHRoaXMuYWxsUGFyYW1ldGVySUQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRTZWxlY3RlZCA9IHNlbGVjdGVkLmZpbHRlcihzID0+IHMgIT0gLTEpO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcuZ2V0KCdwYXJhbU1ldHJpYycpLnBhdGNoVmFsdWUoZmlsdGVyZWRTZWxlY3RlZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwYXRjaFNjaGVkdWxlckNvbmZpZ0lucHV0KCkge1xuICAgICAgICB0aGlzLnNjaGVkdWxlU291cmNpbmdSZXBvcnRGRy5nZXQoJ3NjaGVkdWxlckNvbmZpZycpLnBhdGNoVmFsdWUodGhpcy5zY2hlZHVsZXJDb25maWdJbnB1dC5zY2hlZHVsZVJlcG9ydEZHLnZhbHVlKVxuICAgIH1cblxuICAgIGdldFZhbGlkRm9ybURhdGEoKSB7XG4gICAgICAgIHRoaXMucGF0Y2hTY2hlZHVsZXJDb25maWdJbnB1dCgpO1xuXG4gICAgICAgIGxldCB1c2VySUQgPSB0aGlzLnRzY0NvbW1vblNlcnZpY2UucmVtb3ZlU2VsZWN0QWxsSUQodGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcuZ2V0KCdzY2hlZHVsZXJDb25maWcnKS5nZXQoJ3VzZXJJRCcpLnZhbHVlKTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcuZ2V0KCdzY2hlZHVsZXJDb25maWcnKS5nZXQoJ3VzZXJJRCcpLnBhdGNoVmFsdWUodXNlcklEKTtcblxuICAgICAgICBsZXQgcGFyYW1NZXRyaWNzID0gdGhpcy50c2NDb21tb25TZXJ2aWNlLnJlbW92ZVNlbGVjdEFsbElEKHRoaXMuc2NoZWR1bGVTb3VyY2luZ1JlcG9ydEZHLmdldCgncmVwb3J0Q29uZmlnJykuZ2V0KCdwYXJhbU1ldHJpYycpLnZhbHVlKTtcbiAgICAgICAgbGV0IHBhcmFtc0FycmF5ID0gcGFyYW1NZXRyaWNzLm1hcChwYXJhbU5hbWUgPT4gKHtcbiAgICAgICAgICAgIG5hbWU6IHBhcmFtTmFtZSxcbiAgICAgICAgICAgIGRzQWdnOiAnc3VtJyxcbiAgICAgICAgICAgIGFnZzogJ3N1bSdcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIGNvbnN0IHJlcG9ydENvbmZpZ0ZHID0gdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcuZ2V0KCdyZXBvcnRDb25maWcnKS52YWx1ZTtcbiAgICAgICAgY29uc3Qgc2NoZWR1bGVyQ29uZmlnRkcgPSB0aGlzLnNjaGVkdWxlU291cmNpbmdSZXBvcnRGRy5nZXQoJ3NjaGVkdWxlckNvbmZpZycpLnZhbHVlO1xuICAgICAgICBjb25zdCB7IHBhcmFtTWV0cmljLCAuLi5yZXBvcnRDb25maWdXaXRob3V0UGFyYW1NZXRyaWMgfSA9IHJlcG9ydENvbmZpZ0ZHO1xuXG4gICAgICAgIHRoaXMubW9kaWZpZWRGRyA9IHtcbiAgICAgICAgICAgIHJlcG9ydENvbmZpZzoge1xuICAgICAgICAgICAgICAgIC4uLnJlcG9ydENvbmZpZ1dpdGhvdXRQYXJhbU1ldHJpYyxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc0FycmF5XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2NoZWR1bGVyQ29uZmlnOiB7XG4gICAgICAgICAgICAgICAgLi4uc2NoZWR1bGVyQ29uZmlnRkdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBzY2hlZHVsZVJlcG9ydFN1Ym1pdCgpIHtcbiAgICAgICAgdGhpcy5wYXRjaFNjaGVkdWxlckNvbmZpZ0lucHV0KCk7XG5cbiAgICAgICAgaWYgKHRoaXMuc2NoZWR1bGVyQ29uZmlnSW5wdXQuc2NoZWR1bGVSZXBvcnRGRy5pbnZhbGlkKSB7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlckNvbmZpZ0lucHV0LnNjaGVkdWxlUmVwb3J0RkcubWFya0FsbEFzVG91Y2hlZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc2NoZWR1bGVTb3VyY2luZ1JlcG9ydEZHLmludmFsaWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbnZhbGlkIGZvcm06JywgdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcudmFsdWUpO1xuICAgICAgICAgICAgdGhpcy50b2FzdHJTZXJ2aWNlLm9wZW5Ub2FzdChJbnZhbGlkRm9ybS5JTlZBTElEX0ZPUk1fVElUTEUsIEludmFsaWRGb3JtLklOVkFMSURfRk9STV9NRVNTQUdFLCBUb2FzdHJDb2xvci5FUlJPUik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdldFZhbGlkRm9ybURhdGEoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uID09IEZvcm1BY3Rpb24uQ1JFQVRFKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVTY2hlZHVsZVJlcG9ydCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFjdGlvbiA9PSBGb3JtQWN0aW9uLlVQREFURSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2NoZWR1bGVSZXBvcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNyZWF0ZVNjaGVkdWxlUmVwb3J0KCkge1xuICAgICAgICB0aGlzLnNjaGVkdWxlUmVwb3J0Q29udHJvbGxlci5jcmVhdGVTY2hlZHVsZVJlcG9ydCh0aGlzLm9yZ0lELCB0aGlzLm1vZGlmaWVkRkcpLnN1YnNjcmliZSgocmVzOiBSZXNwb25zZU0pID0+IHtcblxuICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW2BzY2hlZHVsZS1yZXBvcnQvcGFnZWBdKTtcblxuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgaW4gY3JlYXRlU2NoZWR1bGVSZXBvcnQgLScsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0U2NoZWR1bGVSZXBvcnRCeUlEKHNjaGVkdWxlUmVwb3J0SUQpIHtcbiAgICAgICAgdGhpcy5zY2hlZHVsZVJlcG9ydEkgPSA8U2NoZWR1bGVSZXBvcnRJPmF3YWl0IHRoaXMuc2NoZWR1bGVSZXBvcnRTZXJ2aWNlLmdldFNjaGVkdWxlUmVwb3J0QnlJRCh0aGlzLm9yZ0lELCBzY2hlZHVsZVJlcG9ydElEKTtcblxuICAgICAgICB0aGlzLnBhdGNoU2NoZWR1bGVSZXBvcnQodGhpcy5zY2hlZHVsZVJlcG9ydEkpO1xuICAgIH1cblxuICAgIHBhdGNoU2NoZWR1bGVSZXBvcnQoc2NoZWR1bGVSZXBvcnRJOiBTY2hlZHVsZVJlcG9ydEkpIHtcbiAgICAgICAgdGhpcy5zY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkcucGF0Y2hWYWx1ZSh7XG4gICAgICAgICAgICByZXBvcnRDb25maWc6IHNjaGVkdWxlUmVwb3J0SS5yZXBvcnRDb25maWcsXG4gICAgICAgICAgICBzY2hlZHVsZXJDb25maWc6IHNjaGVkdWxlUmVwb3J0SS5zY2hlZHVsZXJDb25maWdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zY2hlZHVsZXJDb25maWdJbnB1dC5zY2hlZHVsZVJlcG9ydEZHLnBhdGNoVmFsdWUoc2NoZWR1bGVSZXBvcnRJLnNjaGVkdWxlckNvbmZpZyk7XG5cbiAgICAgICAgdGhpcy5pbml0aWFsT2JqZWN0ID0ge1xuICAgICAgICAgICAgc291cmNpbmdSZXBvcnRDb25maWc6IHRoaXMuc2NoZWR1bGVTb3VyY2luZ1JlcG9ydEZHLnZhbHVlLFxuICAgICAgICAgICAgc2NoZWR1bGVyQ29uZmlnOiB0aGlzLnNjaGVkdWxlckNvbmZpZ0lucHV0LnNjaGVkdWxlUmVwb3J0RkcudmFsdWVcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmlzVmFsaWRVcGRhdGVGb3JtKCk7XG4gICAgfVxuXG4gICAgaXNWYWxpZFVwZGF0ZUZvcm0oKSB7XG4gICAgICAgIHRoaXMuc2NoZWR1bGVyQ29uZmlnSW5wdXQuc2NoZWR1bGVSZXBvcnRGRy52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tFcXVhbGl0eSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnNjaGVkdWxlU291cmNpbmdSZXBvcnRGRy52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tFcXVhbGl0eSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjaGVja0VxdWFsaXR5KCkge1xuICAgICAgICBjb25zdCBjdXJyZW50VmFsdWVzID0ge1xuICAgICAgICAgICAgc291cmNpbmdSZXBvcnRDb25maWc6IHRoaXMuc2NoZWR1bGVTb3VyY2luZ1JlcG9ydEZHLnZhbHVlLFxuICAgICAgICAgICAgc2NoZWR1bGVyQ29uZmlnOiB0aGlzLnNjaGVkdWxlckNvbmZpZ0lucHV0LnNjaGVkdWxlUmVwb3J0RkcudmFsdWVcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pc0VxdWFsID0gaXNFcXVhbCh0aGlzLmluaXRpYWxPYmplY3QsIGN1cnJlbnRWYWx1ZXMpO1xuICAgIH1cblxuICAgIHVwZGF0ZVNjaGVkdWxlUmVwb3J0KCkge1xuICAgICAgICB0aGlzLnNjaGVkdWxlUmVwb3J0Q29udHJvbGxlci51cGRhdGVTY2hlZHVsZVJlcG9ydCh0aGlzLm9yZ0lELCB0aGlzLnNjaGVkdWxlUmVwb3J0SUQsIHRoaXMubW9kaWZpZWRGRykuc3Vic2NyaWJlKChyZXM6IFJlc3BvbnNlTSkgPT4ge1xuXG4gICAgICAgICAgICB0aGlzLnRzY0NvbW1vblNlcnZpY2UuYmFjaygpO1xuXG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvciBpbiB1cGRhdGVTY2hlZHVsZVJlcG9ydCAtJywgZXJyb3IpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIGVycm9ySGFuZGxpbmcgPSAoZm9ybUdyb3VwOiBGb3JtR3JvdXAsIGNvbnRyb2xQYXRoOiBzdHJpbmcsIGVycm9yOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICAgICAgcmV0dXJuIGZvcm1Hcm91cC5nZXQoY29udHJvbFBhdGgpLmhhc0Vycm9yKGVycm9yKTtcbiAgICB9XG5cbn0iLCI8ZGl2IGNsYXNzPVwiY2FyZCBtYWluLWNhcmQgY2FyZE92ZXJ3cml0ZSBoMTAwXCI+XG4gICAgPGRpdiBjbGFzcz1cImhlYWRlckNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyTGVmdENvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBhZ2VUaXRsZVwiPnt7IHBhZ2VUaXRsZSB9fTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBhZ2VTdWJ0aXRsZVwiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJvZHlcIj5cbiAgICAgICAgPGZvcm0gW2Zvcm1Hcm91cF09XCJzY2hlZHVsZVNvdXJjaW5nUmVwb3J0RkdcIiAobmdTdWJtaXQpPVwic2NoZWR1bGVSZXBvcnRTdWJtaXQoKVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tMTJcIj5cbiAgICAgICAgICAgICAgICAgICAgPG1hdC1jYXJkIGNsYXNzPVwiYm9yZGVyIGNhcmRPdmVyd3JpdGVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkVGl0bGVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXBvcnQgY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93IG10LTJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBmb3JtR3JvdXBOYW1lPVwicmVwb3J0Q29uZmlnXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9XCJtYXRGaWVsZFdpZHRoMTAwXCIgW2FwcGVhcmFuY2VdPVwiTWF0ZXJpYWxGb3JtRmllbGRBcHBlYXJhbmNlLkZPUk1fRklFTERfQVBQRUFSQU5DRVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxtYXQtbGFiZWw+U2VsZWN0IGNvbnN1bXB0aW9uIHBhcmFtZXRlcjwvbWF0LWxhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxtYXQtc2VsZWN0IGZvcm1Db250cm9sTmFtZT1cInBhcmFtTWV0cmljXCIgbXVsdGlwbGUgcmVxdWlyZWQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpuZ0lmPVwiY29uc3VtcHRpb25QYXJhbU0gJiYgY29uc3VtcHRpb25QYXJhbU0ubGVuZ3RoID4gMCAmJiBjb25zdW1wdGlvblBhcmFtTVswXVsnaWQnXTsgZWxzZSBub0NvbnN1bXB0aW9uUGFyYW1NXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bWF0LW9wdGlvbiBbdmFsdWVdPVwiLTFcIiAoY2xpY2spPVwic2VsZWN0QWxsUGFyYW1ldGVycygpXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0IGFsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG1hdC1vcHRpb24gKm5nRm9yPVwibGV0IHBhcmFtIG9mIGNvbnN1bXB0aW9uUGFyYW1NXCIgW3ZhbHVlXT1cInBhcmFtLnBhcmFtTWV0cmljXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwic2VsZWN0ZWRQYXJhbWV0ZXJzKClcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBwYXJhbS5sYWJlbCB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlICNub0NvbnN1bXB0aW9uUGFyYW1NPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG1hdC1vcHRpb24gZGlzYWJsZWQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3sgQ09NTU9OX0NPTlNUQU5ULk5PX0RBVEFfRk9VTkQgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbWF0LW9wdGlvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L21hdC1zZWxlY3Q+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG1hdC1lcnJvciAqbmdJZj1cImVycm9ySGFuZGxpbmcoc2NoZWR1bGVTb3VyY2luZ1JlcG9ydEZHLCAncmVwb3J0Q29uZmlnLnBhcmFtTWV0cmljJywgJ3JlcXVpcmVkJylcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3sgRm9ybUVycm9yRW51bS5SRVFVSVJFRCB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbWF0LWVycm9yPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9tYXQtZm9ybS1maWVsZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9tYXQtY2FyZD5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93IG10LTNcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTEyXCI+XG4gICAgICAgICAgICAgICAgICAgIDxsaWItY29uZmlndXJhdGlvbiAjc2NoZWR1bGVyQ29uZmlnSW5wdXQ+PC9saWItY29uZmlndXJhdGlvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgXG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiZC1ub25lXCIgdHlwZT1cInN1Ym1pdFwiICNmb3JtU3VibWl0QnRuPjwvYnV0dG9uPlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93IG10LTNcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTEyXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbG9hdC1lbmRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi1zZWNvbmRhcnkgbWUtMlwiIHR5cGU9XCJidXR0b25cIiAoY2xpY2spPVwidHNjQ29tbW9uU2VydmljZS5iYWNrKClcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBCdXR0b25MYWJlbEVudW0uQ0FOQ0VMX0JUTl9MQUJFTCB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi1zdWNjZXNzXCIgW25nQ2xhc3NdPVwie1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYnRuLXN1Y2Nlc3MnIDogYWN0aW9uID09IEZvcm1BY3Rpb24uQ1JFQVRFLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYnRuLXByaW1hcnknIDogYWN0aW9uID09IEZvcm1BY3Rpb24uVVBEQVRFLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzYWJsZWQnIDogYWN0aW9uID09IEZvcm1BY3Rpb24uVVBEQVRFICYmIGlzRXF1YWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XCIgdHlwZT1cInN1Ym1pdFwiPnt7IGFjdGlvbiA9PVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcm1BY3Rpb24uQ1JFQVRFID8gJ1NjaGVkdWxlJyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQnV0dG9uTGFiZWxFbnVtLlVQREFURV9CVE5fTEFCRUwgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Zvcm0+XG4gICAgPC9kaXY+XG48L2Rpdj4iXX0=