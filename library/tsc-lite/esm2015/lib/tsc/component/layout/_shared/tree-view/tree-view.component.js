import { Component, EventEmitter, Input, Output } from '@angular/core';
import { EntityTree } from '../../../../model/entity.model';
import { CreateUpdateEntityComponent } from '../../_dialog/create-update/entity/entity.component';
import { DeviceMappingComponent } from '../../_dialog/device-mapping/device-mapping.component';
import { ButtonLabelEnum, DialogEnum, DialogOneComponent, DialogOneEnum, FormAction } from '@library/tsc-common';
import * as i0 from "@angular/core";
import * as i1 from "@library/storage-service";
import * as i2 from "../../../../controller/entity.controller";
import * as i3 from "@library/toastr-service";
import * as i4 from "@angular/material/dialog";
import * as i5 from "@angular/material/expansion";
import * as i6 from "@angular/common";
import * as i7 from "@angular/material/tooltip";
// /tsc-library/
export class CreateUpdateTreeViewComponent {
    constructor(storageService, entityController, toastrService, dialog) {
        this.storageService = storageService;
        this.entityController = entityController;
        this.toastrService = toastrService;
        this.dialog = dialog;
        this.formActionEnum = FormAction;
        this.emitFilter = new EventEmitter();
        this.entities = [new EntityTree()];
    }
    ngOnInit() {
        this.orgID = this.storageService.getStorage('currentOrgID');
        this.getEntitiesForTreeView();
    }
    ngOnChanges(changes) {
        this.getEntitiesForTreeView();
    }
    getEntitiesForTreeView() {
        this.entityController.getEntitiesForTreeView(this.orgID, this.layoutID)
            .subscribe((entityTreeRes) => {
            this.entities = entityTreeRes;
        }, error => {
            console.log('error in getEntitiesForTreeView() -', error);
        });
    }
    hasContent(entity) {
        return entity && entity.children && entity.children.length > 0;
    }
    openChildDialog(entityID, action) {
        const dialog = this.dialog.open(CreateUpdateEntityComponent, {
            data: {
                action: action,
                entityID: entityID,
                layoutID: this.layoutID,
            },
            minWidth: '500px',
            maxWidth: '500px',
        });
        dialog.afterClosed()
            .subscribe((result) => {
            if (result == DialogEnum.SUCCESS_DR) {
                this.getEntitiesForTreeView();
            }
        });
    }
    mapDevices(entityID) {
        const dialog = this.dialog.open(DeviceMappingComponent, {
            data: {
                entityID: entityID,
                layoutID: this.layoutID,
            },
            minWidth: '80vw',
            maxWidth: '80vw',
            height: '100%',
            position: { right: '-2px', top: '0px' },
        });
        dialog.afterClosed()
            .subscribe((result) => {
            if (result == DialogEnum.SUCCESS_DR) {
                this.getEntitiesForTreeView();
            }
        });
    }
    openDeleteEntityDialog(entityID, entityName) {
        const dialog = this.dialog.open(DialogOneComponent, {
            minWidth: '450px',
            maxWidth: '450px',
            data: {
                type: DialogOneEnum.DELETE,
                icon: 'dangerous',
                header: 'Delete entity?',
                body: 'This will delete all children entities of <b>' + entityName + '</b>.</br></br>Are you sure you want to continue?',
                buttonOne: ButtonLabelEnum.CANCEL_BTN_LABEL,
                buttonTwo: ButtonLabelEnum.DELETE_BTN_LABEL
            }
        });
        dialog.afterClosed().subscribe(res => {
            if (res) {
                this.deleteEntity(entityID);
            }
        });
    }
    deleteEntity(entityID) {
        this.entityController.deleteEntity(this.orgID, this.layoutID, entityID).subscribe((deleteRes) => {
            this.getEntitiesForTreeView();
        });
    }
}
CreateUpdateTreeViewComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: CreateUpdateTreeViewComponent, deps: [{ token: i1.StorageService }, { token: i2.EntityController }, { token: i3.ToastrService }, { token: i4.MatDialog }], target: i0.ɵɵFactoryTarget.Component });
CreateUpdateTreeViewComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: CreateUpdateTreeViewComponent, selector: "lib-tree-view", inputs: { permissionType: "permissionType", allowUpdateOnClick: "allowUpdateOnClick", layoutID: "layoutID" }, outputs: { emitFilter: "emitFilter" }, usesOnChanges: true, ngImport: i0, template: "<!-- template call for entityTemplate -->\n<mat-accordion>\n    <ng-container *ngFor=\"let entity of entities\">\n        <ng-container *ngTemplateOutlet=\"entityTemplate; \n            context: {\n                entity: entity,\n                panelTitleClass: 'fw-bold',\n                expansionPanelClass : 'cardBackgroundColor',\n                expanded: hasContent(entity),\n                allowUpdateDelete: false\n            }\">\n        </ng-container>\n    </ng-container>\n</mat-accordion>\n<!-- /template call for entityTemplate/ -->\n\n\n<!-- template for recursive entity -->\n<ng-template #entityTemplate let-entity=\"entity\" let-panelTitleClass=\"panelTitleClass\"\n    let-expansionPanelClass=\"expansionPanelClass\" let-expanded=\"expanded\" let-allowUpdateDelete=\"allowUpdateDelete\">\n    <mat-expansion-panel class=\"mt-2 cardOverwrite\" [class]=\"expansionPanelClass\" [expanded]=\"expanded\"\n        [disabled]=\"!hasContent(entity)\" [hideToggle]=\"!hasContent(entity)\">\n\n        <mat-expansion-panel-header class=\"matAccRightAlignedHeader\">\n            <mat-panel-title>\n                <div class=\"d-flex align-items-center\">\n                    <span [class]=\"panelTitleClass\">\n                        {{ entity.name }}\n                    </span> <span class=\"badge rounded-pill bg-info ms-2\">\n                        {{ entity.type }}\n                    </span>\n                </div>\n            </mat-panel-title>\n            <mat-panel-description class=\"float-end\" *ngIf=\"allowUpdateOnClick\">\n                <span class=\"material-symbols-outlined text-primary me-3\" #tooltip=\"matTooltip\"\n                    matTooltipPosition=\"above\" matTooltipClass=\"nameTooltip\" matTooltip=\"Add child\"\n                    (click)=\"openChildDialog(entity.id, 'create'); $event.stopPropagation()\">\n                    add_circle\n                </span>\n                <span class=\"material-symbols-outlined text-primary me-3\" #tooltip=\"matTooltip\"\n                    matTooltipPosition=\"above\" matTooltipClass=\"nameTooltip\" matTooltip=\"Device mapping\"\n                    (click)=\"mapDevices(entity.id); $event.stopPropagation()\">\n                    devices\n                </span>\n                <span class=\"material-symbols-outlined text-secondary me-3\" *ngIf=\"allowUpdateDelete\" #tooltip=\"matTooltip\"\n                    matTooltipPosition=\"above\" matTooltipClass=\"nameTooltip\" matTooltip=\"Edit child\"\n                    (click)=\"openChildDialog(entity.id, 'update'); $event.stopPropagation()\">\n                    edit_square\n                </span>\n                <span class=\"material-symbols-outlined text-danger me-3\" *ngIf=\"allowUpdateDelete\" #tooltip=\"matTooltip\"\n                    matTooltipPosition=\"above\" matTooltipClass=\"nameTooltip\" matTooltip=\"Delete\"\n                    (click)=\"openDeleteEntityDialog(entity.id, entity.name); $event.stopPropagation()\">\n                    delete\n                </span>\n            </mat-panel-description>\n        </mat-expansion-panel-header>\n\n        <ng-container *ngIf=\"entity.children && entity.children.length > 0\">\n            <ng-container *ngFor=\"let child of entity.children\">\n                <ng-container *ngTemplateOutlet=\"entityTemplate; \n                    context:{ \n                        entity: child,\n                        panelTitleClass: 'text-dark',\n                        expansionPanelClass : 'border',\n                        expanded: 'false',\n                        allowUpdateDelete: true\n                    }\">\n                </ng-container>\n            </ng-container>\n        </ng-container>\n\n    </mat-expansion-panel>\n</ng-template>\n<!-- /template for recursive entity/ -->", components: [{ type: i5.MatExpansionPanel, selector: "mat-expansion-panel", inputs: ["disabled", "expanded", "hideToggle", "togglePosition"], outputs: ["opened", "closed", "expandedChange", "afterExpand", "afterCollapse"], exportAs: ["matExpansionPanel"] }, { type: i5.MatExpansionPanelHeader, selector: "mat-expansion-panel-header", inputs: ["tabIndex", "expandedHeight", "collapsedHeight"] }], directives: [{ type: i5.MatAccordion, selector: "mat-accordion", inputs: ["multi", "displayMode", "togglePosition", "hideToggle"], exportAs: ["matAccordion"] }, { type: i6.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i6.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i5.MatExpansionPanelTitle, selector: "mat-panel-title" }, { type: i6.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.MatExpansionPanelDescription, selector: "mat-panel-description" }, { type: i7.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: CreateUpdateTreeViewComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-tree-view',
                    templateUrl: './tree-view.component.html',
                    styles: []
                }]
        }], ctorParameters: function () { return [{ type: i1.StorageService }, { type: i2.EntityController }, { type: i3.ToastrService }, { type: i4.MatDialog }]; }, propDecorators: { permissionType: [{
                type: Input
            }], allowUpdateOnClick: [{
                type: Input
            }], layoutID: [{
                type: Input
            }], emitFilter: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS12aWV3LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xpYnJhcnkvdHNjLWxpdGUvc3JjL2xpYi90c2MvY29tcG9uZW50L2xheW91dC9fc2hhcmVkL3RyZWUtdmlldy90cmVlLXZpZXcuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbGlicmFyeS90c2MtbGl0ZS9zcmMvbGliL3RzYy9jb21wb25lbnQvbGF5b3V0L19zaGFyZWQvdHJlZS12aWV3L3RyZWUtdmlldy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUk5RixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFNUQsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0scURBQXFELENBQUM7QUFDbEcsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdURBQXVELENBQUM7QUFNL0YsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsa0JBQWtCLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBYSxNQUFNLHFCQUFxQixDQUFDOzs7Ozs7Ozs7QUFFNUgsZ0JBQWdCO0FBUWhCLE1BQU0sT0FBTyw2QkFBNkI7SUFvQnRDLFlBQ1ksY0FBOEIsRUFDOUIsZ0JBQWtDLEVBQ2xDLGFBQTRCLEVBQzVCLE1BQWlCO1FBSGpCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLFdBQU0sR0FBTixNQUFNLENBQVc7UUF0QjdCLG1CQUFjLEdBQUcsVUFBVSxDQUFDO1FBWTVCLGVBQVUsR0FBRyxJQUFJLFlB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RyxtREFBbUQ7Z0JBQ3hILFNBQVMsRUFBRSxlQUFlLENBQUMsZ0JBQWdCO2dCQUMzQyxTQUFTLEVBQUUsZUFBZSxDQUFDLGdCQUFnQjthQUM5QztTQUNKLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDakMsSUFBSSxHQUFHLEVBQUU7Z0JBQ0wsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUMvQjtRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUVELFlBQVksQ0FBQyxRQUFRO1FBQ2pCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFNBQW9CLEVBQUUsRUFBRTtZQUN2RyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7OzJIQWpIUSw2QkFBNkI7K0dBQTdCLDZCQUE2QiwrTkN2QjFDLHl2SEF5RXdDOzRGRGxEM0IsNkJBQTZCO2tCQU56QyxTQUFTO21CQUFDO29CQUNQLFFBQVEsRUFBRSxlQUFlO29CQUN6QixXQUFXLEVBQUUsNEJBQTRCO29CQUN6QyxNQUFNLEVBQUUsRUFDUDtpQkFDSjt3TEFNRyxjQUFjO3NCQURiLEtBQUs7Z0JBSU4sa0JBQWtCO3NCQURqQixLQUFLO2dCQUlOLFFBQVE7c0JBRFAsS0FBSztnQkFJTixVQUFVO3NCQURULE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IE1hdERpYWxvZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5cbmltcG9ydCB7IEVudGl0eVRyZWUgfSBmcm9tICcuLi8uLi8uLi8uLi9tb2RlbC9lbnRpdHkubW9kZWwnO1xuXG5pbXBvcnQgeyBDcmVhdGVVcGRhdGVFbnRpdHlDb21wb25lbnQgfSBmcm9tICcuLi8uLi9fZGlhbG9nL2NyZWF0ZS11cGRhdGUvZW50aXR5L2VudGl0eS5jb21wb25lbnQnO1xuaW1wb3J0IHsgRGV2aWNlTWFwcGluZ0NvbXBvbmVudCB9IGZyb20gJy4uLy4uL19kaWFsb2cvZGV2aWNlLW1hcHBpbmcvZGV2aWNlLW1hcHBpbmcuY29tcG9uZW50JztcblxuaW1wb3J0IHsgRW50aXR5Q29udHJvbGxlciB9IGZyb20gJy4uLy4uLy4uLy4uL2NvbnRyb2xsZXIvZW50aXR5LmNvbnRyb2xsZXInO1xuXG4vLyB0c2MtbGlicmFyeVxuaW1wb3J0IHsgU3RvcmFnZVNlcnZpY2UgfSBmcm9tICdAbGlicmFyeS9zdG9yYWdlLXNlcnZpY2UnO1xuaW1wb3J0IHsgQnV0dG9uTGFiZWxFbnVtLCBEaWFsb2dFbnVtLCBEaWFsb2dPbmVDb21wb25lbnQsIERpYWxvZ09uZUVudW0sIEZvcm1BY3Rpb24sIFJlc3BvbnNlTSB9IGZyb20gJ0BsaWJyYXJ5L3RzYy1jb21tb24nO1xuaW1wb3J0IHsgVG9hc3RyU2VydmljZSB9IGZyb20gJ0BsaWJyYXJ5L3RvYXN0ci1zZXJ2aWNlJztcbi8vIC90c2MtbGlicmFyeS9cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsaWItdHJlZS12aWV3JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdHJlZS12aWV3LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZXM6IFtcbiAgICBdXG59KVxuZXhwb3J0IGNsYXNzIENyZWF0ZVVwZGF0ZVRyZWVWaWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGZvcm1BY3Rpb25FbnVtID0gRm9ybUFjdGlvbjtcblxuICAgIEBJbnB1dCgpXG4gICAgcGVybWlzc2lvblR5cGU6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgYWxsb3dVcGRhdGVPbkNsaWNrOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKVxuICAgIGxheW91dElEOiBudW1iZXI7XG5cbiAgICBAT3V0cHV0KClcbiAgICBlbWl0RmlsdGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgb3JnSUQ6IGFueTtcblxuICAgIGVudGl0aWVzID0gW25ldyBFbnRpdHlUcmVlKCldO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgc3RvcmFnZVNlcnZpY2U6IFN0b3JhZ2VTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGVudGl0eUNvbnRyb2xsZXI6IEVudGl0eUNvbnRyb2xsZXIsXG4gICAgICAgIHByaXZhdGUgdG9hc3RyU2VydmljZTogVG9hc3RyU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBkaWFsb2c6IE1hdERpYWxvZyxcbiAgICApIHsgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMub3JnSUQgPSB0aGlzLnN0b3JhZ2VTZXJ2aWNlLmdldFN0b3JhZ2UoJ2N1cnJlbnRPcmdJRCcpO1xuICAgICAgICB0aGlzLmdldEVudGl0aWVzRm9yVHJlZVZpZXcoKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZ2V0RW50aXRpZXNGb3JUcmVlVmlldygpO1xuICAgIH1cblxuICAgIGdldEVudGl0aWVzRm9yVHJlZVZpZXcoKSB7XG4gICAgICAgIHRoaXMuZW50aXR5Q29udHJvbGxlci5nZXRFbnRpdGllc0ZvclRyZWVWaWV3KHRoaXMub3JnSUQsIHRoaXMubGF5b3V0SUQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChlbnRpdHlUcmVlUmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVudGl0aWVzID0gZW50aXR5VHJlZVJlcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgaW4gZ2V0RW50aXRpZXNGb3JUcmVlVmlldygpIC0nLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaGFzQ29udGVudChlbnRpdHk6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gZW50aXR5ICYmIGVudGl0eS5jaGlsZHJlbiAmJiBlbnRpdHkuY2hpbGRyZW4ubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBvcGVuQ2hpbGREaWFsb2coZW50aXR5SUQsIGFjdGlvbikge1xuICAgICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLmRpYWxvZy5vcGVuKENyZWF0ZVVwZGF0ZUVudGl0eUNvbXBvbmVudCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBlbnRpdHlJRDogZW50aXR5SUQsXG4gICAgICAgICAgICAgICAgICAgIGxheW91dElEOiB0aGlzLmxheW91dElELFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbWluV2lkdGg6ICc1MDBweCcsXG4gICAgICAgICAgICAgICAgbWF4V2lkdGg6ICc1MDBweCcsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgZGlhbG9nLmFmdGVyQ2xvc2VkKClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gRGlhbG9nRW51bS5TVUNDRVNTX0RSKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0RW50aXRpZXNGb3JUcmVlVmlldygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgfVxuXG4gICAgbWFwRGV2aWNlcyhlbnRpdHlJRCkge1xuICAgICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLmRpYWxvZy5vcGVuKERldmljZU1hcHBpbmdDb21wb25lbnQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBlbnRpdHlJRDogZW50aXR5SUQsXG4gICAgICAgICAgICAgICAgICAgIGxheW91dElEOiB0aGlzLmxheW91dElELFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbWluV2lkdGg6ICc4MHZ3JyxcbiAgICAgICAgICAgICAgICBtYXhXaWR0aDogJzgwdncnLFxuICAgICAgICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHJpZ2h0OiAnLTJweCcsIHRvcDogJzBweCcgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBkaWFsb2cuYWZ0ZXJDbG9zZWQoKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBEaWFsb2dFbnVtLlNVQ0NFU1NfRFIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRFbnRpdGllc0ZvclRyZWVWaWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICB9XG5cbiAgICBvcGVuRGVsZXRlRW50aXR5RGlhbG9nKGVudGl0eUlELCBlbnRpdHlOYW1lKSB7XG4gICAgICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMuZGlhbG9nLm9wZW4oRGlhbG9nT25lQ29tcG9uZW50LCB7XG4gICAgICAgICAgICBtaW5XaWR0aDogJzQ1MHB4JyxcbiAgICAgICAgICAgIG1heFdpZHRoOiAnNDUwcHgnLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHR5cGU6IERpYWxvZ09uZUVudW0uREVMRVRFLFxuICAgICAgICAgICAgICAgIGljb246ICdkYW5nZXJvdXMnLFxuICAgICAgICAgICAgICAgIGhlYWRlcjogJ0RlbGV0ZSBlbnRpdHk/JyxcbiAgICAgICAgICAgICAgICBib2R5OiAnVGhpcyB3aWxsIGRlbGV0ZSBhbGwgY2hpbGRyZW4gZW50aXRpZXMgb2YgPGI+JyArIGVudGl0eU5hbWUgKyAnPC9iPi48L2JyPjwvYnI+QXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNvbnRpbnVlPycsXG4gICAgICAgICAgICAgICAgYnV0dG9uT25lOiBCdXR0b25MYWJlbEVudW0uQ0FOQ0VMX0JUTl9MQUJFTCxcbiAgICAgICAgICAgICAgICBidXR0b25Ud286IEJ1dHRvbkxhYmVsRW51bS5ERUxFVEVfQlROX0xBQkVMXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBkaWFsb2cuYWZ0ZXJDbG9zZWQoKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgICAgIGlmIChyZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZUVudGl0eShlbnRpdHlJRCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgZGVsZXRlRW50aXR5KGVudGl0eUlEKSB7XG4gICAgICAgIHRoaXMuZW50aXR5Q29udHJvbGxlci5kZWxldGVFbnRpdHkodGhpcy5vcmdJRCwgdGhpcy5sYXlvdXRJRCwgZW50aXR5SUQpLnN1YnNjcmliZSgoZGVsZXRlUmVzOiBSZXNwb25zZU0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RW50aXRpZXNGb3JUcmVlVmlldygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn1cbiIsIjwhLS0gdGVtcGxhdGUgY2FsbCBmb3IgZW50aXR5VGVtcGxhdGUgLS0+XG48bWF0LWFjY29yZGlvbj5cbiAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBlbnRpdHkgb2YgZW50aXRpZXNcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImVudGl0eVRlbXBsYXRlOyBcbiAgICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICBlbnRpdHk6IGVudGl0eSxcbiAgICAgICAgICAgICAgICBwYW5lbFRpdGxlQ2xhc3M6ICdmdy1ib2xkJyxcbiAgICAgICAgICAgICAgICBleHBhbnNpb25QYW5lbENsYXNzIDogJ2NhcmRCYWNrZ3JvdW5kQ29sb3InLFxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiBoYXNDb250ZW50KGVudGl0eSksXG4gICAgICAgICAgICAgICAgYWxsb3dVcGRhdGVEZWxldGU6IGZhbHNlXG4gICAgICAgICAgICB9XCI+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuPC9tYXQtYWNjb3JkaW9uPlxuPCEtLSAvdGVtcGxhdGUgY2FsbCBmb3IgZW50aXR5VGVtcGxhdGUvIC0tPlxuXG5cbjwhLS0gdGVtcGxhdGUgZm9yIHJlY3Vyc2l2ZSBlbnRpdHkgLS0+XG48bmctdGVtcGxhdGUgI2VudGl0eVRlbXBsYXRlIGxldC1lbnRpdHk9XCJlbnRpdHlcIiBsZXQtcGFuZWxUaXRsZUNsYXNzPVwicGFuZWxUaXRsZUNsYXNzXCJcbiAgICBsZXQtZXhwYW5zaW9uUGFuZWxDbGFzcz1cImV4cGFuc2lvblBhbmVsQ2xhc3NcIiBsZXQtZXhwYW5kZWQ9XCJleHBhbmRlZFwiIGxldC1hbGxvd1VwZGF0ZURlbGV0ZT1cImFsbG93VXBkYXRlRGVsZXRlXCI+XG4gICAgPG1hdC1leHBhbnNpb24tcGFuZWwgY2xhc3M9XCJtdC0yIGNhcmRPdmVyd3JpdGVcIiBbY2xhc3NdPVwiZXhwYW5zaW9uUGFuZWxDbGFzc1wiIFtleHBhbmRlZF09XCJleHBhbmRlZFwiXG4gICAgICAgIFtkaXNhYmxlZF09XCIhaGFzQ29udGVudChlbnRpdHkpXCIgW2hpZGVUb2dnbGVdPVwiIWhhc0NvbnRlbnQoZW50aXR5KVwiPlxuXG4gICAgICAgIDxtYXQtZXhwYW5zaW9uLXBhbmVsLWhlYWRlciBjbGFzcz1cIm1hdEFjY1JpZ2h0QWxpZ25lZEhlYWRlclwiPlxuICAgICAgICAgICAgPG1hdC1wYW5lbC10aXRsZT5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlclwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBbY2xhc3NdPVwicGFuZWxUaXRsZUNsYXNzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7eyBlbnRpdHkubmFtZSB9fVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+IDxzcGFuIGNsYXNzPVwiYmFkZ2Ugcm91bmRlZC1waWxsIGJnLWluZm8gbXMtMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAge3sgZW50aXR5LnR5cGUgfX1cbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9tYXQtcGFuZWwtdGl0bGU+XG4gICAgICAgICAgICA8bWF0LXBhbmVsLWRlc2NyaXB0aW9uIGNsYXNzPVwiZmxvYXQtZW5kXCIgKm5nSWY9XCJhbGxvd1VwZGF0ZU9uQ2xpY2tcIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLXN5bWJvbHMtb3V0bGluZWQgdGV4dC1wcmltYXJ5IG1lLTNcIiAjdG9vbHRpcD1cIm1hdFRvb2x0aXBcIlxuICAgICAgICAgICAgICAgICAgICBtYXRUb29sdGlwUG9zaXRpb249XCJhYm92ZVwiIG1hdFRvb2x0aXBDbGFzcz1cIm5hbWVUb29sdGlwXCIgbWF0VG9vbHRpcD1cIkFkZCBjaGlsZFwiXG4gICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJvcGVuQ2hpbGREaWFsb2coZW50aXR5LmlkLCAnY3JlYXRlJyk7ICRldmVudC5zdG9wUHJvcGFnYXRpb24oKVwiPlxuICAgICAgICAgICAgICAgICAgICBhZGRfY2lyY2xlXG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCB0ZXh0LXByaW1hcnkgbWUtM1wiICN0b29sdGlwPVwibWF0VG9vbHRpcFwiXG4gICAgICAgICAgICAgICAgICAgIG1hdFRvb2x0aXBQb3NpdGlvbj1cImFib3ZlXCIgbWF0VG9vbHRpcENsYXNzPVwibmFtZVRvb2x0aXBcIiBtYXRUb29sdGlwPVwiRGV2aWNlIG1hcHBpbmdcIlxuICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwibWFwRGV2aWNlcyhlbnRpdHkuaWQpOyAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcIj5cbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlc1xuICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLXN5bWJvbHMtb3V0bGluZWQgdGV4dC1zZWNvbmRhcnkgbWUtM1wiICpuZ0lmPVwiYWxsb3dVcGRhdGVEZWxldGVcIiAjdG9vbHRpcD1cIm1hdFRvb2x0aXBcIlxuICAgICAgICAgICAgICAgICAgICBtYXRUb29sdGlwUG9zaXRpb249XCJhYm92ZVwiIG1hdFRvb2x0aXBDbGFzcz1cIm5hbWVUb29sdGlwXCIgbWF0VG9vbHRpcD1cIkVkaXQgY2hpbGRcIlxuICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwib3BlbkNoaWxkRGlhbG9nKGVudGl0eS5pZCwgJ3VwZGF0ZScpOyAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcIj5cbiAgICAgICAgICAgICAgICAgICAgZWRpdF9zcXVhcmVcbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1zeW1ib2xzLW91dGxpbmVkIHRleHQtZGFuZ2VyIG1lLTNcIiAqbmdJZj1cImFsbG93VXBkYXRlRGVsZXRlXCIgI3Rvb2x0aXA9XCJtYXRUb29sdGlwXCJcbiAgICAgICAgICAgICAgICAgICAgbWF0VG9vbHRpcFBvc2l0aW9uPVwiYWJvdmVcIiBtYXRUb29sdGlwQ2xhc3M9XCJuYW1lVG9vbHRpcFwiIG1hdFRvb2x0aXA9XCJEZWxldGVcIlxuICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwib3BlbkRlbGV0ZUVudGl0eURpYWxvZyhlbnRpdHkuaWQsIGVudGl0eS5uYW1lKTsgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXCI+XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZVxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIDwvbWF0LXBhbmVsLWRlc2NyaXB0aW9uPlxuICAgICAgICA8L21hdC1leHBhbnNpb24tcGFuZWwtaGVhZGVyPlxuXG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJlbnRpdHkuY2hpbGRyZW4gJiYgZW50aXR5LmNoaWxkcmVuLmxlbmd0aCA+IDBcIj5cbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGNoaWxkIG9mIGVudGl0eS5jaGlsZHJlblwiPlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJlbnRpdHlUZW1wbGF0ZTsgXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6eyBcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eTogY2hpbGQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYW5lbFRpdGxlQ2xhc3M6ICd0ZXh0LWRhcmsnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5zaW9uUGFuZWxDbGFzcyA6ICdib3JkZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5kZWQ6ICdmYWxzZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd1VwZGF0ZURlbGV0ZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XCI+XG4gICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICA8L21hdC1leHBhbnNpb24tcGFuZWw+XG48L25nLXRlbXBsYXRlPlxuPCEtLSAvdGVtcGxhdGUgZm9yIHJlY3Vyc2l2ZSBlbnRpdHkvIC0tPiJdfQ==