import { __awaiter } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { FormControl, Validators } from '@angular/forms';
import { merge, fromEvent, of as observableOf } from 'rxjs';
import { map, startWith, switchMap, catchError } from "rxjs/operators";
import { faPlus, faEllipsisV } from '@fortawesome/free-solid-svg-icons';
import { SourceConsumerPage } from '../../../../model/source-consumer.model';
import { SourceCreateUpdateComponent } from '../../_dialog/source/create-update/create-update.component';
// tsc-library
import { MATERIAL_CONSTANT, TABLE_CONSTANT, ButtonTooltipEnum, ButtonLabelEnum, FormAction, COMMON_CONSTANT, DialogOneComponent, DialogOneEnum, DialogResponseEnum } from '@library/tsc-common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "@library/storage-service";
import * as i3 from "../../../../controller/source.controller";
import * as i4 from "../../../../service/source.service";
import * as i5 from "@library/tsc-common";
import * as i6 from "@fortawesome/angular-fontawesome";
import * as i7 from "@angular/material/table";
import * as i8 from "@angular/material/sort";
import * as i9 from "@angular/material/paginator";
import * as i10 from "@angular/material/core";
import * as i11 from "@angular/material/tooltip";
// /tsc-library/
export class SourcePageComponent {
    constructor(dialog, storageService, sourceController, sourceService) {
        this.dialog = dialog;
        this.storageService = storageService;
        this.sourceController = sourceController;
        this.sourceService = sourceService;
        this.faPlus = faPlus;
        this.faEllipsisV = faEllipsisV;
        this.MATERIAL_CONSTANT = MATERIAL_CONSTANT;
        this.TABLE_CONSTANT = TABLE_CONSTANT;
        this.COMMON_CONSTANT = COMMON_CONSTANT;
        this.ButtonTooltipEnum = ButtonTooltipEnum;
        this.DialogResponseEnum = DialogResponseEnum;
        this.FormAction = FormAction;
        this.searchByPlaceHolder = 'source name';
        this.dataSource = [new SourceConsumerPage()];
        this.dataSourceLength = 0;
        this.displayedColumn = ['id', 'name', 'utilitySourceName', 'type', 'option'];
        this.searchFlag = false;
        this.searchFC = new FormControl('', Validators.required);
        this.utilitySource = false;
        this.utilitySourceFC = new FormControl();
        this.filterArr = [];
        this.updateSource = (action, row) => {
            const dialogRef = this.dialog.open(SourceCreateUpdateComponent, {
                height: '100vh',
                width: '600px',
                position: { right: '-2px', top: '0px' },
                disableClose: true,
                panelClass: 'matDialogContainerOverride',
                data: {
                    action: action,
                    sourceID: row.id
                }
            });
            dialogRef.afterClosed()
                .subscribe((result) => {
                if (result.status == DialogResponseEnum.SUCCESS) {
                    this.refreshBtn.nativeElement.click();
                }
            });
        };
    }
    ngOnInit() {
        this.orgID = this.storageService.getStorage('currentOrgID');
        this.getUtilitySourceAndType();
    }
    getUtilitySourceAndType() {
        return __awaiter(this, void 0, void 0, function* () {
            const result = yield this.sourceService.getUtilitySourceAndType(this.orgID);
            const allKey = {
                "id": 0,
                "name": "All",
                "keyID": "ALL",
                "type": []
            };
            result.utilitySource.unshift(allKey);
            this.utilitySourceI = result.utilitySource;
        });
    }
    ngAfterViewInit() {
        merge(this.sort.sortChange, this.typeSelect.mono, fromEvent(this.refreshBtn.nativeElement, 'click')).pipe(startWith({}), switchMap(() => {
            this.filterArr = [];
            if (this.searchFlag) {
                var searchValue = 'name:' + this.searchValue;
            }
            if (this.utilitySource) {
                if (this.utilitySourceFC.value == 'ALL') {
                    this.utilitySource = false;
                }
                else {
                    this.filterArr.push('utilitySource:' + this.utilitySourceFC.value);
                }
            }
            return this.sourceController.getSourceTypeByPage(this.paginator.pageIndex, this.paginator.pageSize, this.sort.active, this.sort.direction, searchValue, this.filterArr, this.orgID).pipe(catchError(() => observableOf(null)));
        }), map((response) => {
            if (response == null) {
                this.dataSourceLength = 0;
                return [];
            }
            this.dataSourceLength = response.totalCount;
            return response.records;
        })).subscribe((dataSource) => {
            this.dataSource = dataSource;
        });
    }
    searchFn(value) {
        this.searchFlag = true;
        this.searchValue = value;
        if (value.length == 0) {
            this.resetSearch();
        }
        this.refreshBtn.nativeElement.click();
    }
    resetSearch() {
        this.searchFlag = false;
        this.searchBar.searchClear();
    }
    createSource(action) {
        const dialogRef = this.dialog.open(SourceCreateUpdateComponent, {
            height: '100vh',
            width: '600px',
            position: { right: '-2px', top: '0px' },
            disableClose: true,
            panelClass: 'matDialogContainerOverride',
            data: {
                action: action
            }
        });
        dialogRef.afterClosed()
            .subscribe((result) => {
            if (result.status == DialogResponseEnum.SUCCESS) {
                this.refreshBtn.nativeElement.click();
            }
        });
    }
    openDeleteDialog(source) {
        const dialog = this.dialog.open(DialogOneComponent, {
            minWidth: '450px',
            maxWidth: '450px',
            data: {
                type: DialogOneEnum.DELETE,
                icon: 'dangerous',
                header: 'Delete source type?',
                body: '<b>' + source.name + '</b>' + ' will be deleted permanently.</br></br>Are you sure you want to continue?',
                buttonOne: ButtonLabelEnum.CANCEL_BTN_LABEL,
                buttonTwo: ButtonLabelEnum.DELETE_BTN_LABEL
            }
        });
        dialog.afterClosed().subscribe(res => {
            if (res) {
                this.deleteSourceType(source.id);
            }
        });
    }
    deleteSourceType(sourceID) {
        this.sourceController.deleteSourceType(this.orgID, sourceID).subscribe((deleteRes) => {
            if (deleteRes) {
                this.refreshBtn.nativeElement.click();
            }
        });
    }
}
SourcePageComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: SourcePageComponent, deps: [{ token: i1.MatDialog }, { token: i2.StorageService }, { token: i3.SourceController }, { token: i4.SourceService }], target: i0.ɵɵFactoryTarget.Component });
SourcePageComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: SourcePageComponent, selector: "lib-page", viewQueries: [{ propertyName: "sort", first: true, predicate: ["sort"], descendants: true }, { propertyName: "paginator", first: true, predicate: ["paginator"], descendants: true }, { propertyName: "refreshBtn", first: true, predicate: ["refreshBtn"], descendants: true }, { propertyName: "searchBar", first: true, predicate: ["searchBar"], descendants: true }, { propertyName: "typeSelect", first: true, predicate: ["typeSelect"], descendants: true }], ngImport: i0, template: "<div class=\"card cardOverwrite h100\">\n    <div class=\"headerContainer\">\n        <div class=\"headerLeftContainer\">\n            <div class=\"pageTitle\">Source type</div>\n            <div class=\"pageSubtitle\"></div>\n        </div>\n\n        <div class=\"headerRightContainer\">\n            <div class=\"headerRightContainerInner\">\n                <lib-search-bar-one class=\"me-3\" #searchBar [searchBy]=\"searchByPlaceHolder\"\n                    (emitSearch)=\"searchFn($event)\"></lib-search-bar-one>\n\n                <button class=\"btn btn-sm btn-light refreshBtn centerAlign me-3 py-1\" #refreshBtn matRipple\n                    [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\" matTooltipPosition=\"below\"\n                    [matTooltip]=\"ButtonTooltipEnum.REFRESH\">\n                    <span class=\"material-symbols-outlined text-secondary\">\n                        refresh\n                    </span>\n                </button>\n\n                <button type=\"button\" class=\"btn btn-sm btn-success\" (click)=\"createSource(FormAction.CREATE)\" matRipple\n                    [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\" matTooltipPosition=\"below\"\n                    [matTooltip]=\"ButtonTooltipEnum.CREATE\">\n                    <fa-icon [icon]=\"faPlus\" class=\"me-1\"></fa-icon>Source type\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <table class=\"w-100\" mat-table matSort #sort=\"matSort\" matSortActive=\"name\" matSortDirection=\"asc\"\n        matSortDisableClear [dataSource]=\"dataSource\">\n\n        <ng-container matColumnDef=\"id\">\n            <th mat-header-cell *matHeaderCellDef>ID</th>\n            <td mat-cell *matCellDef=\"let row\">{{ row.id }}</td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"name\">\n            <th class=\"px-4\" mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Name</th>\n            <td class=\"px-4\" mat-cell *matCellDef=\"let row\">\n                {{ row.name ? row.name : COMMON_CONSTANT.HYPHEN }}\n            </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"utilitySourceName\">\n            <th mat-header-cell *matHeaderCellDef>\n                <funnel-filter #typeSelect header=\"Utility source\" type=\"mono\" value=\"keyID\"\n                    [entityList]=\"utilitySourceI\" view=\"name\" [selectFC]=\"utilitySourceFC\" [active]=\"utilitySource\"\n                    (mono)=\"utilitySource = true;\">\n                </funnel-filter>\n            </th>\n            <td mat-cell *matCellDef=\"let row\">\n                {{ row.utilitySourceName ? row.utilitySourceName : COMMON_CONSTANT.HYPHEN }}\n            </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"type\">\n            <th class=\"px-4\" mat-header-cell *matHeaderCellDef>Utility source type</th>\n            <td class=\"px-4\" mat-cell *matCellDef=\"let row\">\n                {{ row.type ? row.type : COMMON_CONSTANT.HYPHEN }}\n            </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"option\">\n            <th mat-header-cell *matHeaderCellDef></th>\n            <td mat-cell *matCellDef=\"let row\">\n                <div class=\"centerAlignVertical\">\n\n                    <button type=\"button\" class=\"iconBtn centerAlign text-primary updateIconHover\"\n                        (click)=\"updateSource(FormAction.UPDATE, row)\" matRipple\n                        [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\" matTooltipPosition=\"below\"\n                        [matTooltip]=\"ButtonTooltipEnum.UPDATE\">\n                        <span class=\"material-symbols-outlined icon\">\n                            edit\n                        </span>\n                    </button>\n\n                    <a class=\"iconBtn centerAlign text-danger deleteIconHover cursorPointer\" matTooltipPosition=\"below\"\n                        [matTooltip]=\"ButtonTooltipEnum.DELETE\" matRipple\n                        [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\" (click)=\"openDeleteDialog(row)\">\n                        <span class=\"material-symbols-outlined icon\">\n                            delete\n                        </span>\n                    </a>\n                </div>\n            </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"displayedColumn\"></tr>\n        <tr mat-row *matRowDef=\"let row; columns: displayedColumn;\" class=\"dataRow\"></tr>\n\n        <tr class=\"mat-row\" *matNoDataRow>\n            <td class=\"mat-cell text-center\" [attr.colspan]=\"displayedColumn.length\">\n                {{ TABLE_CONSTANT.TABLE_NO_DATA }}\n            </td>\n        </tr>\n    </table>\n\n    <mat-paginator class=\"roundedBorder\" showFirstLastButtons #paginator [length]=\"dataSourceLength\"\n        [pageSize]=\"TABLE_CONSTANT.DEFAULT_PAGE_SIZE\" [pageSizeOptions]=\"TABLE_CONSTANT.PAGE_SIZE_OPTION\">\n    </mat-paginator>\n</div>", components: [{ type: i5.SearchBarOneComponent, selector: "lib-search-bar-one", inputs: ["type", "searchBy", "clear", "emitValueOnChange"], outputs: ["emitSearch"] }, { type: i6.FaIconComponent, selector: "fa-icon", inputs: ["classes", "icon", "title", "spin", "pulse", "mask", "styles", "flip", "size", "pull", "border", "inverse", "symbol", "rotate", "fixedWidth", "transform", "a11yRole"] }, { type: i7.MatTable, selector: "mat-table, table[mat-table]", exportAs: ["matTable"] }, { type: i8.MatSortHeader, selector: "[mat-sort-header]", inputs: ["disabled", "arrowPosition", "sortActionDescription", "disableClear", "mat-sort-header", "start"], exportAs: ["matSortHeader"] }, { type: i5.FunnelFilterComponent, selector: "funnel-filter", inputs: ["header", "active", "showSearchBar", "searchByPlaceholder", "searchBy", "selectAllLabel", "entityList", "view", "value", "type", "selectFC", "resetFlag"], outputs: ["mono", "multi", "selected"] }, { type: i7.MatHeaderRow, selector: "mat-header-row, tr[mat-header-row]", exportAs: ["matHeaderRow"] }, { type: i7.MatRow, selector: "mat-row, tr[mat-row]", exportAs: ["matRow"] }, { type: i9.MatPaginator, selector: "mat-paginator", inputs: ["disabled"], exportAs: ["matPaginator"] }], directives: [{ type: i10.MatRipple, selector: "[mat-ripple], [matRipple]", inputs: ["matRippleRadius", "matRippleDisabled", "matRippleTrigger", "matRippleColor", "matRippleUnbounded", "matRippleCentered", "matRippleAnimation"], exportAs: ["matRipple"] }, { type: i11.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { type: i8.MatSort, selector: "[matSort]", inputs: ["matSortDisabled", "matSortStart", "matSortDirection", "matSortDisableClear", "matSortActive"], outputs: ["matSortChange"], exportAs: ["matSort"] }, { type: i7.MatColumnDef, selector: "[matColumnDef]", inputs: ["sticky", "matColumnDef"] }, { type: i7.MatHeaderCellDef, selector: "[matHeaderCellDef]" }, { type: i7.MatHeaderCell, selector: "mat-header-cell, th[mat-header-cell]" }, { type: i7.MatCellDef, selector: "[matCellDef]" }, { type: i7.MatCell, selector: "mat-cell, td[mat-cell]" }, { type: i7.MatHeaderRowDef, selector: "[matHeaderRowDef]", inputs: ["matHeaderRowDef", "matHeaderRowDefSticky"] }, { type: i7.MatRowDef, selector: "[matRowDef]", inputs: ["matRowDefColumns", "matRowDefWhen"] }, { type: i7.MatNoDataRow, selector: "ng-template[matNoDataRow]" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: SourcePageComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-page',
                    templateUrl: './page.component.html',
                    styles: []
                }]
        }], ctorParameters: function () { return [{ type: i1.MatDialog }, { type: i2.StorageService }, { type: i3.SourceController }, { type: i4.SourceService }]; }, propDecorators: { sort: [{
                type: ViewChild,
                args: ['sort']
            }], paginator: [{
                type: ViewChild,
                args: ['paginator']
            }], refreshBtn: [{
                type: ViewChild,
                args: ['refreshBtn']
            }], searchBar: [{
                type: ViewChild,
                args: ['searchBar']
            }], typeSelect: [{
                type: ViewChild,
                args: ['typeSelect']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9saWJyYXJ5L3RzYy1saXRlL3NyYy9saWIvdHNjL2NvbXBvbmVudC9wcmVmZXJlbmNlcy9zb3VyY2UvcGFnZS9wYWdlLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2xpYnJhcnkvdHNjLWxpdGUvc3JjL2xpYi90c2MvY29tcG9uZW50L3ByZWZlcmVuY2VzL3NvdXJjZS9wYWdlL3BhZ2UuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQXNCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RSxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTXpELE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEVBQUUsSUFBSSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXZFLE9BQU8sRUFDSCxNQUFNLEVBQ04sV0FBVyxFQUNkLE1BQU0sbUNBQW1DLENBQUM7QUFFM0MsT0FBTyxFQUFFLGtCQUFrQixFQUEyQyxNQUFNLHlDQUF5QyxDQUFDO0FBTXRILE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLDREQUE0RCxDQUFDO0FBRXpHLGNBQWM7QUFDZCxPQUFPLEVBQ0gsaUJBQWlCLEVBQ2pCLGNBQWMsRUFDZCxpQkFBaUIsRUFDakIsZUFBZSxFQUVmLFVBQVUsRUFDVixlQUFlLEVBQ2Ysa0JBQWtCLEVBQ2xCLGFBQWEsRUFHYixrQkFBa0IsRUFDckIsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7Ozs7Ozs7OztBQUU3QixnQkFBZ0I7QUFRaEIs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QkFDWCxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUN6QztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7aUhBaE1RLG1CQUFtQjtxR0FBbkIsbUJBQW1CLHNmQy9DaEMseThKQXFHTTs0RkR0RE8sbUJBQW1CO2tCQU4vQixTQUFTO21CQUFDO29CQUNQLFFBQVEsRUFBRSxVQUFVO29CQUNwQixXQUFXLEVBQUUsdUJBQXVCO29CQUNwQyxNQUFNLEVBQUUsRUFDUDtpQkFDSjt3TEE2QnNCLElBQUk7c0JBQXRCLFNBQVM7dUJBQUMsTUFBTTtnQkFDTyxTQUFTO3NCQUFoQyxTQUFTO3VCQUFDLFdBQVc7Z0JBQ0csVUFBVTtzQkFBbEMsU0FBUzt1QkFBQyxZQUFZO2dCQUNDLFNBQVM7c0JBQWhDLFNBQVM7dUJBQUMsV0FBVztnQkFDRyxVQUFVO3NCQUFsQyxTQUFTO3VCQUFDLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgTWF0U29ydCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NvcnQnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCB7IE1hdFBhZ2luYXRvciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3BhZ2luYXRvcic7XG5cbmltcG9ydCB7IG1lcmdlLCBmcm9tRXZlbnQsIG9mIGFzIG9ic2VydmFibGVPZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzdGFydFdpdGgsIHN3aXRjaE1hcCwgY2F0Y2hFcnJvciB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xuXG5pbXBvcnQge1xuICAgIGZhUGx1cyxcbiAgICBmYUVsbGlwc2lzVlxufSBmcm9tICdAZm9ydGF3ZXNvbWUvZnJlZS1zb2xpZC1zdmctaWNvbnMnO1xuXG5pbXBvcnQgeyBTb3VyY2VDb25zdW1lclBhZ2UsIFNvdXJjZUNvbnN1bWVyUGFnZU0sIFV0aWxpdHlTb3VyY2VUeXBlTSB9IGZyb20gJy4uLy4uLy4uLy4uL21vZGVsL3NvdXJjZS1jb25zdW1lci5tb2RlbCc7XG5cbmltcG9ydCB7IFNvdXJjZUNvbnRyb2xsZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9jb250cm9sbGVyL3NvdXJjZS5jb250cm9sbGVyJztcblxuaW1wb3J0IHsgU291cmNlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NlcnZpY2Uvc291cmNlLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBTb3VyY2VDcmVhdGVVcGRhdGVDb21wb25lbnQgfSBmcm9tICcuLi8uLi9fZGlhbG9nL3NvdXJjZS9jcmVhdGUtdXBkYXRlL2NyZWF0ZS11cGRhdGUuY29tcG9uZW50JztcblxuLy8gdHNjLWxpYnJhcnlcbmltcG9ydCB7XG4gICAgTUFURVJJQUxfQ09OU1RBTlQsXG4gICAgVEFCTEVfQ09OU1RBTlQsXG4gICAgQnV0dG9uVG9vbHRpcEVudW0sXG4gICAgQnV0dG9uTGFiZWxFbnVtLFxuICAgIFNlYXJjaEJhck9uZUNvbXBvbmVudCxcbiAgICBGb3JtQWN0aW9uLFxuICAgIENPTU1PTl9DT05TVEFOVCxcbiAgICBEaWFsb2dPbmVDb21wb25lbnQsXG4gICAgRGlhbG9nT25lRW51bSxcbiAgICBGdW5uZWxGaWx0ZXJDb21wb25lbnQsXG4gICAgUGFnZU0sXG4gICAgRGlhbG9nUmVzcG9uc2VFbnVtXG59IGZyb20gJ0BsaWJyYXJ5L3RzYy1jb21tb24nO1xuaW1wb3J0IHsgU3RvcmFnZVNlcnZpY2UgfSBmcm9tICdAbGlicmFyeS9zdG9yYWdlLXNlcnZpY2UnO1xuLy8gL3RzYy1saWJyYXJ5L1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2xpYi1wYWdlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcGFnZS5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVzOiBbXG4gICAgXVxufSlcbmV4cG9ydCBjbGFzcyBTb3VyY2VQYWdlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGZhUGx1cyA9IGZhUGx1cztcbiAgICBmYUVsbGlwc2lzViA9IGZhRWxsaXBzaXNWO1xuXG4gICAgTUFURVJJQUxfQ09OU1RBTlQgPSBNQVRFUklBTF9DT05TVEFOVDtcbiAgICBUQUJMRV9DT05TVEFOVCA9IFRBQkxFX0NPTlNUQU5UO1xuICAgIENPTU1PTl9DT05TVEFOVCA9IENPTU1PTl9DT05TVEFOVDtcblxuICAgIEJ1dHRvblRvb2x0aXBFbnVtID0gQnV0dG9uVG9vbHRpcEVudW07XG4gICAgRGlhbG9nUmVzcG9uc2VFbnVtID0gRGlhbG9nUmVzcG9uc2VFbnVtO1xuICAgIEZvcm1BY3Rpb24gPSBGb3JtQWN0aW9uO1xuXG4gICAgc2VhcmNoQnlQbGFjZUhvbGRlcjogc3RyaW5nID0gJ3NvdXJjZSBuYW1lJztcblxuICAgIG9yZ0lEOiBhbnk7XG4gICAgdXRpbGl0eVNvdXJjZUk6IGFueTtcbiAgICBkYXRhU291cmNlID0gW25ldyBTb3VyY2VDb25zdW1lclBhZ2UoKV07XG4gICAgZGF0YVNvdXJjZUxlbmd0aDogbnVtYmVyID0gMDtcbiAgICBkaXNwbGF5ZWRDb2x1bW46IHN0cmluZ1tdID0gWydpZCcsICduYW1lJywgJ3V0aWxpdHlTb3VyY2VOYW1lJywgJ3R5cGUnLCAnb3B0aW9uJ107XG4gICAgc2VhcmNoRmxhZzogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHNlYXJjaFZhbHVlOiBzdHJpbmc7XG4gICAgc2VhcmNoRkMgPSBuZXcgRm9ybUNvbnRyb2woJycsIFZhbGlkYXRvcnMucmVxdWlyZWQpO1xuXG4gICAgdXRpbGl0eVNvdXJjZTogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHV0aWxpdHlTb3VyY2VGQzogRm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcbiAgICBmaWx0ZXJBcnI6IEFycmF5PHN0cmluZz4gPSBbXTtcblxuICAgIEBWaWV3Q2hpbGQoJ3NvcnQnKSBzb3J0OiBNYXRTb3J0O1xuICAgIEBWaWV3Q2hpbGQoJ3BhZ2luYXRvcicpIHBhZ2luYXRvcjogTWF0UGFnaW5hdG9yO1xuICAgIEBWaWV3Q2hpbGQoJ3JlZnJlc2hCdG4nKSByZWZyZXNoQnRuOiBFbGVtZW50UmVmO1xuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaEJhcicpIHNlYXJjaEJhcjogU2VhcmNoQmFyT25lQ29tcG9uZW50O1xuICAgIEBWaWV3Q2hpbGQoJ3R5cGVTZWxlY3QnKSB0eXBlU2VsZWN0OiBGdW5uZWxGaWx0ZXJDb21wb25lbnQ7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBkaWFsb2c6IE1hdERpYWxvZyxcbiAgICAgICAgcHJpdmF0ZSBzdG9yYWdlU2VydmljZTogU3RvcmFnZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc291cmNlQ29udHJvbGxlcjogU291cmNlQ29udHJvbGxlcixcbiAgICAgICAgcHJpdmF0ZSBzb3VyY2VTZXJ2aWNlOiBTb3VyY2VTZXJ2aWNlXG4gICAgKSB7IH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLm9yZ0lEID0gdGhpcy5zdG9yYWdlU2VydmljZS5nZXRTdG9yYWdlKCdjdXJyZW50T3JnSUQnKTtcblxuICAgICAgICB0aGlzLmdldFV0aWxpdHlTb3VyY2VBbmRUeXBlKCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VXRpbGl0eVNvdXJjZUFuZFR5cGUoKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IDxVdGlsaXR5U291cmNlVHlwZU0+YXdhaXQgdGhpcy5zb3VyY2VTZXJ2aWNlLmdldFV0aWxpdHlTb3VyY2VBbmRUeXBlKHRoaXMub3JnSUQpO1xuICAgICAgICBjb25zdCBhbGxLZXkgPSB7XG4gICAgICAgICAgICBcImlkXCI6IDAsXG4gICAgICAgICAgICBcIm5hbWVcIjogXCJBbGxcIixcbiAgICAgICAgICAgIFwia2V5SURcIjogXCJBTExcIixcbiAgICAgICAgICAgIFwidHlwZVwiOiBbXVxuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC51dGlsaXR5U291cmNlLnVuc2hpZnQoYWxsS2V5KTtcbiAgICAgICAgdGhpcy51dGlsaXR5U291cmNlSSA9IHJlc3VsdC51dGlsaXR5U291cmNlO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgbWVyZ2UoXG4gICAgICAgICAgICB0aGlzLnNvcnQuc29ydENoYW5nZSxcbiAgICAgICAgICAgIHRoaXMudHlwZVNlbGVjdC5tb25vLFxuICAgICAgICAgICAgZnJvbUV2ZW50KHRoaXMucmVmcmVzaEJ0bi5uYXRpdmVFbGVtZW50LCAnY2xpY2snKVxuICAgICAgICApLnBpcGUoXG4gICAgICAgICAgICBzdGFydFdpdGgoe30pLFxuICAgICAgICAgICAgc3dpdGNoTWFwKCgpOiBhbnkgPT4ge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJBcnIgPSBbXTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaEZsYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaFZhbHVlID0gJ25hbWU6JyArIHRoaXMuc2VhcmNoVmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudXRpbGl0eVNvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy51dGlsaXR5U291cmNlRkMudmFsdWUgPT0gJ0FMTCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXRpbGl0eVNvdXJjZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJBcnIucHVzaCgndXRpbGl0eVNvdXJjZTonICsgdGhpcy51dGlsaXR5U291cmNlRkMudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlQ29udHJvbGxlci5nZXRTb3VyY2VUeXBlQnlQYWdlKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2luYXRvci5wYWdlSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvcnQuYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvcnQuZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJBcnIsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3JnSUQsXG4gICAgICAgICAgICAgICAgKS5waXBlKGNhdGNoRXJyb3IoKCkgPT4gb2JzZXJ2YWJsZU9mKG51bGwpKSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG1hcCgocmVzcG9uc2U6IFBhZ2VNPFNvdXJjZUNvbnN1bWVyUGFnZU0+KTogYW55ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2VMZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhU291cmNlTGVuZ3RoID0gcmVzcG9uc2UudG90YWxDb3VudDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVjb3JkcztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICkuc3Vic2NyaWJlKChkYXRhU291cmNlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2UgPSBkYXRhU291cmNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZWFyY2hGbih2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoRmxhZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VhcmNoVmFsdWUgPSB2YWx1ZTtcblxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHRoaXMucmVzZXRTZWFyY2goKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVmcmVzaEJ0bi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XG4gICAgfVxuXG4gICAgcmVzZXRTZWFyY2goKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoRmxhZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlYXJjaEJhci5zZWFyY2hDbGVhcigpO1xuICAgIH1cblxuICAgIGNyZWF0ZVNvdXJjZShhY3Rpb246IHN0cmluZykge1xuICAgICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKFNvdXJjZUNyZWF0ZVVwZGF0ZUNvbXBvbmVudCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDB2aCcsXG4gICAgICAgICAgICAgICAgd2lkdGg6ICc2MDBweCcsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHsgcmlnaHQ6ICctMnB4JywgdG9wOiAnMHB4JyB9LFxuICAgICAgICAgICAgICAgIGRpc2FibGVDbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYW5lbENsYXNzOiAnbWF0RGlhbG9nQ29udGFpbmVyT3ZlcnJpZGUnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBkaWFsb2dSZWYuYWZ0ZXJDbG9zZWQoKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT0gRGlhbG9nUmVzcG9uc2VFbnVtLlNVQ0NFU1MpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoQnRuLm5hdGl2ZUVsZW1lbnQuY2xpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB1cGRhdGVTb3VyY2UgPSAoYWN0aW9uLCByb3cpID0+IHtcbiAgICAgICAgY29uc3QgZGlhbG9nUmVmID0gdGhpcy5kaWFsb2cub3BlbihTb3VyY2VDcmVhdGVVcGRhdGVDb21wb25lbnQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTAwdmgnLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnNjAwcHgnLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHJpZ2h0OiAnLTJweCcsIHRvcDogJzBweCcgfSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICAgICAgcGFuZWxDbGFzczogJ21hdERpYWxvZ0NvbnRhaW5lck92ZXJyaWRlJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VJRDogcm93LmlkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09IERpYWxvZ1Jlc3BvbnNlRW51bS5TVUNDRVNTKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaEJ0bi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb3BlbkRlbGV0ZURpYWxvZyhzb3VyY2UpIHtcblxuICAgICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLmRpYWxvZy5vcGVuKERpYWxvZ09uZUNvbXBvbmVudCwge1xuICAgICAgICAgICAgbWluV2lkdGg6ICc0NTBweCcsXG4gICAgICAgICAgICBtYXhXaWR0aDogJzQ1MHB4JyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBEaWFsb2dPbmVFbnVtLkRFTEVURSxcbiAgICAgICAgICAgICAgICBpY29uOiAnZGFuZ2Vyb3VzJyxcbiAgICAgICAgICAgICAgICBoZWFkZXI6ICdEZWxldGUgc291cmNlIHR5cGU/JyxcbiAgICAgICAgICAgICAgICBib2R5OiAnPGI+JyArIHNvdXJjZS5uYW1lICsgJzwvYj4nICsgJyB3aWxsIGJlIGRlbGV0ZWQgcGVybWFuZW50bHkuPC9icj48L2JyPkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjb250aW51ZT8nLFxuICAgICAgICAgICAgICAgIGJ1dHRvbk9uZTogQnV0dG9uTGFiZWxFbnVtLkNBTkNFTF9CVE5fTEFCRUwsXG4gICAgICAgICAgICAgICAgYnV0dG9uVHdvOiBCdXR0b25MYWJlbEVudW0uREVMRVRFX0JUTl9MQUJFTFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZGlhbG9nLmFmdGVyQ2xvc2VkKCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgICAgICBpZiAocmVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWxldGVTb3VyY2VUeXBlKHNvdXJjZS5pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgZGVsZXRlU291cmNlVHlwZShzb3VyY2VJRCkge1xuICAgICAgICB0aGlzLnNvdXJjZUNvbnRyb2xsZXIuZGVsZXRlU291cmNlVHlwZSh0aGlzLm9yZ0lELCBzb3VyY2VJRCkuc3Vic2NyaWJlKChkZWxldGVSZXMpID0+IHtcbiAgICAgICAgICAgIGlmIChkZWxldGVSZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hCdG4ubmF0aXZlRWxlbWVudC5jbGljaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJjYXJkIGNhcmRPdmVyd3JpdGUgaDEwMFwiPlxuICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJDb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRlckxlZnRDb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYWdlVGl0bGVcIj5Tb3VyY2UgdHlwZTwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBhZ2VTdWJ0aXRsZVwiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyUmlnaHRDb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJSaWdodENvbnRhaW5lcklubmVyXCI+XG4gICAgICAgICAgICAgICAgPGxpYi1zZWFyY2gtYmFyLW9uZSBjbGFzcz1cIm1lLTNcIiAjc2VhcmNoQmFyIFtzZWFyY2hCeV09XCJzZWFyY2hCeVBsYWNlSG9sZGVyXCJcbiAgICAgICAgICAgICAgICAgICAgKGVtaXRTZWFyY2gpPVwic2VhcmNoRm4oJGV2ZW50KVwiPjwvbGliLXNlYXJjaC1iYXItb25lPlxuXG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc20gYnRuLWxpZ2h0IHJlZnJlc2hCdG4gY2VudGVyQWxpZ24gbWUtMyBweS0xXCIgI3JlZnJlc2hCdG4gbWF0UmlwcGxlXG4gICAgICAgICAgICAgICAgICAgIFttYXRSaXBwbGVDZW50ZXJlZF09XCJNQVRFUklBTF9DT05TVEFOVC5NQVRfUklQUExFX0NFTlRFUlwiIG1hdFRvb2x0aXBQb3NpdGlvbj1cImJlbG93XCJcbiAgICAgICAgICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwiQnV0dG9uVG9vbHRpcEVudW0uUkVGUkVTSFwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1hdGVyaWFsLXN5bWJvbHMtb3V0bGluZWQgdGV4dC1zZWNvbmRhcnlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hcbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuXG4gICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi1zdWNjZXNzXCIgKGNsaWNrKT1cImNyZWF0ZVNvdXJjZShGb3JtQWN0aW9uLkNSRUFURSlcIiBtYXRSaXBwbGVcbiAgICAgICAgICAgICAgICAgICAgW21hdFJpcHBsZUNlbnRlcmVkXT1cIk1BVEVSSUFMX0NPTlNUQU5ULk1BVF9SSVBQTEVfQ0VOVEVSXCIgbWF0VG9vbHRpcFBvc2l0aW9uPVwiYmVsb3dcIlxuICAgICAgICAgICAgICAgICAgICBbbWF0VG9vbHRpcF09XCJCdXR0b25Ub29sdGlwRW51bS5DUkVBVEVcIj5cbiAgICAgICAgICAgICAgICAgICAgPGZhLWljb24gW2ljb25dPVwiZmFQbHVzXCIgY2xhc3M9XCJtZS0xXCI+PC9mYS1pY29uPlNvdXJjZSB0eXBlXG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8dGFibGUgY2xhc3M9XCJ3LTEwMFwiIG1hdC10YWJsZSBtYXRTb3J0ICNzb3J0PVwibWF0U29ydFwiIG1hdFNvcnRBY3RpdmU9XCJuYW1lXCIgbWF0U29ydERpcmVjdGlvbj1cImFzY1wiXG4gICAgICAgIG1hdFNvcnREaXNhYmxlQ2xlYXIgW2RhdGFTb3VyY2VdPVwiZGF0YVNvdXJjZVwiPlxuXG4gICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwiaWRcIj5cbiAgICAgICAgICAgIDx0aCBtYXQtaGVhZGVyLWNlbGwgKm1hdEhlYWRlckNlbGxEZWY+SUQ8L3RoPlxuICAgICAgICAgICAgPHRkIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHJvd1wiPnt7IHJvdy5pZCB9fTwvdGQ+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwibmFtZVwiPlxuICAgICAgICAgICAgPHRoIGNsYXNzPVwicHgtNFwiIG1hdC1oZWFkZXItY2VsbCAqbWF0SGVhZGVyQ2VsbERlZiBtYXQtc29ydC1oZWFkZXIgZGlzYWJsZUNsZWFyPk5hbWU8L3RoPlxuICAgICAgICAgICAgPHRkIGNsYXNzPVwicHgtNFwiIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHJvd1wiPlxuICAgICAgICAgICAgICAgIHt7IHJvdy5uYW1lID8gcm93Lm5hbWUgOiBDT01NT05fQ09OU1RBTlQuSFlQSEVOIH19XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgICAgICA8bmctY29udGFpbmVyIG1hdENvbHVtbkRlZj1cInV0aWxpdHlTb3VyY2VOYW1lXCI+XG4gICAgICAgICAgICA8dGggbWF0LWhlYWRlci1jZWxsICptYXRIZWFkZXJDZWxsRGVmPlxuICAgICAgICAgICAgICAgIDxmdW5uZWwtZmlsdGVyICN0eXBlU2VsZWN0IGhlYWRlcj1cIlV0aWxpdHkgc291cmNlXCIgdHlwZT1cIm1vbm9cIiB2YWx1ZT1cImtleUlEXCJcbiAgICAgICAgICAgICAgICAgICAgW2VudGl0eUxpc3RdPVwidXRpbGl0eVNvdXJjZUlcIiB2aWV3PVwibmFtZVwiIFtzZWxlY3RGQ109XCJ1dGlsaXR5U291cmNlRkNcIiBbYWN0aXZlXT1cInV0aWxpdHlTb3VyY2VcIlxuICAgICAgICAgICAgICAgICAgICAobW9ubyk9XCJ1dGlsaXR5U291cmNlID0gdHJ1ZTtcIj5cbiAgICAgICAgICAgICAgICA8L2Z1bm5lbC1maWx0ZXI+XG4gICAgICAgICAgICA8L3RoPlxuICAgICAgICAgICAgPHRkIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHJvd1wiPlxuICAgICAgICAgICAgICAgIHt7IHJvdy51dGlsaXR5U291cmNlTmFtZSA/IHJvdy51dGlsaXR5U291cmNlTmFtZSA6IENPTU1PTl9DT05TVEFOVC5IWVBIRU4gfX1cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwidHlwZVwiPlxuICAgICAgICAgICAgPHRoIGNsYXNzPVwicHgtNFwiIG1hdC1oZWFkZXItY2VsbCAqbWF0SGVhZGVyQ2VsbERlZj5VdGlsaXR5IHNvdXJjZSB0eXBlPC90aD5cbiAgICAgICAgICAgIDx0ZCBjbGFzcz1cInB4LTRcIiBtYXQtY2VsbCAqbWF0Q2VsbERlZj1cImxldCByb3dcIj5cbiAgICAgICAgICAgICAgICB7eyByb3cudHlwZSA/IHJvdy50eXBlIDogQ09NTU9OX0NPTlNUQU5ULkhZUEhFTiB9fVxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgICAgPG5nLWNvbnRhaW5lciBtYXRDb2x1bW5EZWY9XCJvcHRpb25cIj5cbiAgICAgICAgICAgIDx0aCBtYXQtaGVhZGVyLWNlbGwgKm1hdEhlYWRlckNlbGxEZWY+PC90aD5cbiAgICAgICAgICAgIDx0ZCBtYXQtY2VsbCAqbWF0Q2VsbERlZj1cImxldCByb3dcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2VudGVyQWxpZ25WZXJ0aWNhbFwiPlxuXG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiaWNvbkJ0biBjZW50ZXJBbGlnbiB0ZXh0LXByaW1hcnkgdXBkYXRlSWNvbkhvdmVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJ1cGRhdGVTb3VyY2UoRm9ybUFjdGlvbi5VUERBVEUsIHJvdylcIiBtYXRSaXBwbGVcbiAgICAgICAgICAgICAgICAgICAgICAgIFttYXRSaXBwbGVDZW50ZXJlZF09XCJNQVRFUklBTF9DT05TVEFOVC5NQVRfUklQUExFX0NFTlRFUlwiIG1hdFRvb2x0aXBQb3NpdGlvbj1cImJlbG93XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIFttYXRUb29sdGlwXT1cIkJ1dHRvblRvb2x0aXBFbnVtLlVQREFURVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1zeW1ib2xzLW91dGxpbmVkIGljb25cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuXG4gICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPVwiaWNvbkJ0biBjZW50ZXJBbGlnbiB0ZXh0LWRhbmdlciBkZWxldGVJY29uSG92ZXIgY3Vyc29yUG9pbnRlclwiIG1hdFRvb2x0aXBQb3NpdGlvbj1cImJlbG93XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIFttYXRUb29sdGlwXT1cIkJ1dHRvblRvb2x0aXBFbnVtLkRFTEVURVwiIG1hdFJpcHBsZVxuICAgICAgICAgICAgICAgICAgICAgICAgW21hdFJpcHBsZUNlbnRlcmVkXT1cIk1BVEVSSUFMX0NPTlNUQU5ULk1BVF9SSVBQTEVfQ0VOVEVSXCIgKGNsaWNrKT1cIm9wZW5EZWxldGVEaWFsb2cocm93KVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtYXRlcmlhbC1zeW1ib2xzLW91dGxpbmVkIGljb25cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgICAgPHRyIG1hdC1oZWFkZXItcm93ICptYXRIZWFkZXJSb3dEZWY9XCJkaXNwbGF5ZWRDb2x1bW5cIj48L3RyPlxuICAgICAgICA8dHIgbWF0LXJvdyAqbWF0Um93RGVmPVwibGV0IHJvdzsgY29sdW1uczogZGlzcGxheWVkQ29sdW1uO1wiIGNsYXNzPVwiZGF0YVJvd1wiPjwvdHI+XG5cbiAgICAgICAgPHRyIGNsYXNzPVwibWF0LXJvd1wiICptYXROb0RhdGFSb3c+XG4gICAgICAgICAgICA8dGQgY2xhc3M9XCJtYXQtY2VsbCB0ZXh0LWNlbnRlclwiIFthdHRyLmNvbHNwYW5dPVwiZGlzcGxheWVkQ29sdW1uLmxlbmd0aFwiPlxuICAgICAgICAgICAgICAgIHt7IFRBQkxFX0NPTlNUQU5ULlRBQkxFX05PX0RBVEEgfX1cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvdHI+XG4gICAgPC90YWJsZT5cblxuICAgIDxtYXQtcGFnaW5hdG9yIGNsYXNzPVwicm91bmRlZEJvcmRlclwiIHNob3dGaXJzdExhc3RCdXR0b25zICNwYWdpbmF0b3IgW2xlbmd0aF09XCJkYXRhU291cmNlTGVuZ3RoXCJcbiAgICAgICAgW3BhZ2VTaXplXT1cIlRBQkxFX0NPTlNUQU5ULkRFRkFVTFRfUEFHRV9TSVpFXCIgW3BhZ2VTaXplT3B0aW9uc109XCJUQUJMRV9DT05TVEFOVC5QQUdFX1NJWkVfT1BUSU9OXCI+XG4gICAgPC9tYXQtcGFnaW5hdG9yPlxuPC9kaXY+Il19