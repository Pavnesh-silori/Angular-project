import { __awaiter } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { FormControl, Validators } from '@angular/forms';
import { merge, fromEvent, of as observableOf } from 'rxjs';
import { map, startWith, switchMap, catchError } from "rxjs/operators";
import { faPlus, faEllipsisV } from '@fortawesome/free-solid-svg-icons';
import { SourceConsumerPage } from '../../../../model/source-consumer.model';
import { ConsumerCreateUpdateComponent } from '../../_dialog/consumer/create-update/create-update.component';
// tsc-library
import { MATERIAL_CONSTANT, TABLE_CONSTANT, ButtonTooltipEnum, ButtonLabelEnum, FormAction, COMMON_CONSTANT, DialogOneComponent, DialogOneEnum, DialogResponseEnum, } from '@library/tsc-common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "@library/storage-service";
import * as i3 from "../../../../service/source.service";
import * as i4 from "../../../../controller/consumer.controller";
import * as i5 from "@library/tsc-common";
import * as i6 from "@fortawesome/angular-fontawesome";
import * as i7 from "@angular/material/table";
import * as i8 from "@angular/material/sort";
import * as i9 from "@angular/material/paginator";
import * as i10 from "@angular/material/core";
import * as i11 from "@angular/material/tooltip";
// /tsc-library/
export class ConsumerPageComponent {
    constructor(dialog, storageService, sourceService, consumerController) {
        this.dialog = dialog;
        this.storageService = storageService;
        this.sourceService = sourceService;
        this.consumerController = consumerController;
        this.faPlus = faPlus;
        this.faEllipsisV = faEllipsisV;
        this.MATERIAL_CONSTANT = MATERIAL_CONSTANT;
        this.TABLE_CONSTANT = TABLE_CONSTANT;
        this.COMMON_CONSTANT = COMMON_CONSTANT;
        this.ButtonTooltipEnum = ButtonTooltipEnum;
        this.FormAction = FormAction;
        this.searchByPlaceHolder = 'consumer name';
        this.dataSource = [new SourceConsumerPage()];
        this.dataSourceLength = 0;
        this.displayedColumn = ['id', 'name', 'utilitySourceName', 'type', 'option'];
        this.searchFlag = false;
        this.searchFC = new FormControl('', Validators.required);
        this.utilitySource = false;
        this.utilitySourceFC = new FormControl();
        this.filterArr = [];
        this.updateConsumer = (action, row) => {
            const dialogRef = this.dialog.open(ConsumerCreateUpdateComponent, {
                height: '100vh',
                width: '600px',
                position: { right: '-2px', top: '0px' },
                disableClose: true,
                panelClass: 'matDialogContainerOverride',
                data: {
                    action: action,
                    consumerID: row.id
                }
            });
            dialogRef.afterClosed()
                .subscribe((result) => {
                if (result.status == DialogResponseEnum.SUCCESS) {
                    this.refreshBtn.nativeElement.click();
                }
            });
        };
    }
    ngOnInit() {
        this.orgID = this.storageService.getStorage('currentOrgID');
        this.getUtilitySourceAndType();
    }
    getUtilitySourceAndType() {
        return __awaiter(this, void 0, void 0, function* () {
            const result = yield this.sourceService.getUtilitySourceAndType(this.orgID);
            const allKey = {
                "id": 0,
                "name": "All",
                "keyID": "ALL",
                "type": []
            };
            result.utilitySource.unshift(allKey);
            this.utilitySourceI = result.utilitySource;
        });
    }
    ngAfterViewInit() {
        merge(this.sort.sortChange, this.typeSelect.mono, fromEvent(this.refreshBtn.nativeElement, 'click')).pipe(startWith({}), switchMap(() => {
            this.filterArr = [];
            if (this.searchFlag) {
                var searchValue = 'name:' + this.searchValue;
            }
            if (this.utilitySource) {
                if (this.utilitySourceFC.value == 'ALL') {
                    this.utilitySource = false;
                }
                else {
                    this.filterArr.push('utilitySource:' + this.utilitySourceFC.value);
                }
            }
            return this.consumerController.getConsumerTypeByPage(this.paginator.pageIndex, this.paginator.pageSize, this.sort.active, this.sort.direction, searchValue, this.filterArr, this.orgID).pipe(catchError(() => observableOf(null)));
        }), map((response) => {
            if (response == null) {
                this.dataSourceLength = 0;
                return [];
            }
            this.dataSourceLength = response.totalCount;
            return response.records;
        })).subscribe((dataSource) => {
            this.dataSource = dataSource;
        });
    }
    searchFn(value) {
        this.searchFlag = true;
        this.searchValue = value;
        if (value.length == 0) {
            this.resetSearch();
        }
        this.refreshBtn.nativeElement.click();
    }
    resetSearch() {
        this.searchFlag = false;
        this.searchBar.searchClear();
    }
    createConsumer(action) {
        const dialogRef = this.dialog.open(ConsumerCreateUpdateComponent, {
            height: '100vh',
            width: '600px',
            position: { right: '-2px', top: '0px' },
            disableClose: true,
            panelClass: 'matDialogContainerOverride',
            data: {
                action: action
            }
        });
        dialogRef.afterClosed()
            .subscribe((result) => {
            if (result.status == DialogResponseEnum.SUCCESS) {
                this.refreshBtn.nativeElement.click();
            }
        });
    }
    openDeleteDialog(consumer) {
        const dialog = this.dialog.open(DialogOneComponent, {
            minWidth: '450px',
            maxWidth: '450px',
            data: {
                type: DialogOneEnum.DELETE,
                icon: 'dangerous',
                header: 'Delete consumer type?',
                body: '<b>' + consumer.name + '</b>' + ' will be deleted permanently.</br></br>Are you sure you want to continue?',
                buttonOne: ButtonLabelEnum.CANCEL_BTN_LABEL,
                buttonTwo: ButtonLabelEnum.DELETE_BTN_LABEL
            }
        });
        dialog.afterClosed().subscribe(res => {
            if (res) {
                this.deleteConsumerType(consumer.id);
            }
        });
    }
    deleteConsumerType(consumerID) {
        this.consumerController.deleteConsumerType(this.orgID, consumerID).subscribe((deleteRes) => {
            if (deleteRes) {
                this.refreshBtn.nativeElement.click();
            }
        });
    }
}
ConsumerPageComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: ConsumerPageComponent, deps: [{ token: i1.MatDialog }, { token: i2.StorageService }, { token: i3.SourceService }, { token: i4.ConsumerController }], target: i0.ɵɵFactoryTarget.Component });
ConsumerPageComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: ConsumerPageComponent, selector: "lib-page", viewQueries: [{ propertyName: "sort", first: true, predicate: ["sort"], descendants: true }, { propertyName: "paginator", first: true, predicate: ["paginator"], descendants: true }, { propertyName: "refreshBtn", first: true, predicate: ["refreshBtn"], descendants: true }, { propertyName: "searchBar", first: true, predicate: ["searchBar"], descendants: true }, { propertyName: "typeSelect", first: true, predicate: ["typeSelect"], descendants: true }], ngImport: i0, template: "<div class=\"card cardOverwrite h100\">\n    <div class=\"headerContainer\">\n        <div class=\"headerLeftContainer\">\n            <div class=\"pageTitle\">Consumer type</div>\n            <div class=\"pageSubtitle\"></div>\n        </div>\n\n        <div class=\"headerRightContainer\">\n            <div class=\"headerRightContainerInner\">\n                <lib-search-bar-one class=\"me-3\" #searchBar [searchBy]=\"searchByPlaceHolder\"\n                    (emitSearch)=\"searchFn($event)\"></lib-search-bar-one>\n\n                <button class=\"btn btn-sm btn-light refreshBtn centerAlign me-3 py-1\" #refreshBtn matRipple\n                    [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\" matTooltipPosition=\"below\"\n                    [matTooltip]=\"ButtonTooltipEnum.REFRESH\">\n                    <span class=\"material-symbols-outlined text-secondary\">\n                        refresh\n                    </span>\n                </button>\n\n                <button type=\"button\" class=\"btn btn-sm btn-success\" (click)=\"createConsumer(FormAction.CREATE)\" matRipple\n                    [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\" matTooltipPosition=\"below\"\n                    [matTooltip]=\"ButtonTooltipEnum.CREATE\">\n                    <fa-icon [icon]=\"faPlus\" class=\"me-1\"></fa-icon>Consumer type\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <table class=\"w-100\" mat-table matSort #sort=\"matSort\" matSortActive=\"name\" matSortDirection=\"asc\"\n        matSortDisableClear [dataSource]=\"dataSource\">\n\n        <ng-container matColumnDef=\"id\">\n            <th mat-header-cell *matHeaderCellDef>ID</th>\n            <td mat-cell *matCellDef=\"let row\">{{ row.id }}</td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"name\">\n            <th class=\"px-4\" mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Name</th>\n            <td class=\"px-4\" mat-cell *matCellDef=\"let row\">\n                {{ row.name ? row.name : COMMON_CONSTANT.HYPHEN }}\n            </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"utilitySourceName\">\n            <th mat-header-cell *matHeaderCellDef>\n                <funnel-filter #typeSelect header=\"Utility source\" type=\"mono\" value=\"keyID\" [entityList]=\"utilitySourceI\"\n                    view=\"name\" [selectFC]=\"utilitySourceFC\" [active]=\"utilitySource\" (mono)=\"utilitySource = true;\">\n                </funnel-filter>\n            </th>\n            <td mat-cell *matCellDef=\"let row\">\n                {{ row.utilitySourceName ? row.utilitySourceName : COMMON_CONSTANT.HYPHEN }}\n            </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"type\">\n            <th mat-header-cell *matHeaderCellDef>Type</th>\n            <td mat-cell *matCellDef=\"let row\">\n                {{ row.type ? row.type : COMMON_CONSTANT.HYPHEN }}\n            </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"option\">\n            <th mat-header-cell *matHeaderCellDef></th>\n            <td mat-cell *matCellDef=\"let row\">\n                <div class=\"centerAlignVertical\">\n\n                    <button type=\"button\" class=\"iconBtn centerAlign text-primary updateIconHover\"\n                        (click)=\"updateConsumer(FormAction.UPDATE, row)\" matRipple [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\"\n                        matTooltipPosition=\"below\" [matTooltip]=\"ButtonTooltipEnum.UPDATE\">\n                        <span class=\"material-symbols-outlined icon\">\n                            edit\n                        </span>\n                    </button>\n\n                    <a class=\"iconBtn centerAlign text-danger deleteIconHover cursorPointer\" matTooltipPosition=\"below\"\n                        [matTooltip]=\"ButtonTooltipEnum.DELETE\" matRipple\n                        [matRippleCentered]=\"MATERIAL_CONSTANT.MAT_RIPPLE_CENTER\" (click)=\"openDeleteDialog(row)\">\n                        <span class=\"material-symbols-outlined icon\">\n                            delete\n                        </span>\n                    </a>\n                </div>\n            </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"displayedColumn\"></tr>\n        <tr mat-row *matRowDef=\"let row; columns: displayedColumn;\" class=\"dataRow\"></tr>\n\n        <tr class=\"mat-row\" *matNoDataRow>\n            <td class=\"mat-cell text-center\" [attr.colspan]=\"displayedColumn.length\">\n                {{ TABLE_CONSTANT.TABLE_NO_DATA }}\n            </td>\n        </tr>\n    </table>\n\n    <mat-paginator class=\"roundedBorder\" showFirstLastButtons #paginator [length]=\"dataSourceLength\"\n        [pageSize]=\"TABLE_CONSTANT.DEFAULT_PAGE_SIZE\" [pageSizeOptions]=\"TABLE_CONSTANT.PAGE_SIZE_OPTION\">\n    </mat-paginator>\n</div>", components: [{ type: i5.SearchBarOneComponent, selector: "lib-search-bar-one", inputs: ["type", "searchBy", "clear", "emitValueOnChange"], outputs: ["emitSearch"] }, { type: i6.FaIconComponent, selector: "fa-icon", inputs: ["classes", "icon", "title", "spin", "pulse", "mask", "styles", "flip", "size", "pull", "border", "inverse", "symbol", "rotate", "fixedWidth", "transform", "a11yRole"] }, { type: i7.MatTable, selector: "mat-table, table[mat-table]", exportAs: ["matTable"] }, { type: i8.MatSortHeader, selector: "[mat-sort-header]", inputs: ["disabled", "arrowPosition", "sortActionDescription", "disableClear", "mat-sort-header", "start"], exportAs: ["matSortHeader"] }, { type: i5.FunnelFilterComponent, selector: "funnel-filter", inputs: ["header", "active", "showSearchBar", "searchByPlaceholder", "searchBy", "selectAllLabel", "entityList", "view", "value", "type", "selectFC", "resetFlag"], outputs: ["mono", "multi", "selected"] }, { type: i7.MatHeaderRow, selector: "mat-header-row, tr[mat-header-row]", exportAs: ["matHeaderRow"] }, { type: i7.MatRow, selector: "mat-row, tr[mat-row]", exportAs: ["matRow"] }, { type: i9.MatPaginator, selector: "mat-paginator", inputs: ["disabled"], exportAs: ["matPaginator"] }], directives: [{ type: i10.MatRipple, selector: "[mat-ripple], [matRipple]", inputs: ["matRippleRadius", "matRippleDisabled", "matRippleTrigger", "matRippleColor", "matRippleUnbounded", "matRippleCentered", "matRippleAnimation"], exportAs: ["matRipple"] }, { type: i11.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { type: i8.MatSort, selector: "[matSort]", inputs: ["matSortDisabled", "matSortStart", "matSortDirection", "matSortDisableClear", "matSortActive"], outputs: ["matSortChange"], exportAs: ["matSort"] }, { type: i7.MatColumnDef, selector: "[matColumnDef]", inputs: ["sticky", "matColumnDef"] }, { type: i7.MatHeaderCellDef, selector: "[matHeaderCellDef]" }, { type: i7.MatHeaderCell, selector: "mat-header-cell, th[mat-header-cell]" }, { type: i7.MatCellDef, selector: "[matCellDef]" }, { type: i7.MatCell, selector: "mat-cell, td[mat-cell]" }, { type: i7.MatHeaderRowDef, selector: "[matHeaderRowDef]", inputs: ["matHeaderRowDef", "matHeaderRowDefSticky"] }, { type: i7.MatRowDef, selector: "[matRowDef]", inputs: ["matRowDefColumns", "matRowDefWhen"] }, { type: i7.MatNoDataRow, selector: "ng-template[matNoDataRow]" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: ConsumerPageComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-page',
                    templateUrl: './page.component.html',
                    styles: []
                }]
        }], ctorParameters: function () { return [{ type: i1.MatDialog }, { type: i2.StorageService }, { type: i3.SourceService }, { type: i4.ConsumerController }]; }, propDecorators: { sort: [{
                type: ViewChild,
                args: ['sort']
            }], paginator: [{
                type: ViewChild,
                args: ['paginator']
            }], refreshBtn: [{
                type: ViewChild,
                args: ['refreshBtn']
            }], searchBar: [{
                type: ViewChild,
                args: ['searchBar']
            }], typeSelect: [{
                type: ViewChild,
                args: ['typeSelect']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9saWJyYXJ5L3RzYy1saXRlL3NyYy9saWIvdHNjL2NvbXBvbmVudC9wcmVmZXJlbmNlcy9jb25zdW1lci9wYWdlL3BhZ2UuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbGlicmFyeS90c2MtbGl0ZS9zcmMvbGliL3RzYy9jb21wb25lbnQvcHJlZmVyZW5jZXMvY29uc3VtZXIvcGFnZS9wYWdlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFzQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekUsT0FBTyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQU16RCxPQUFPLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxFQUFFLElBQUksWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2RSxPQUFPLEVBQ0gsTUFBTSxFQUNOLFdBQVcsRUFDZCxNQUFNLG1DQUFtQyxDQUFDO0FBRTNDLE9BQU8sRUFBRSxrQkFBa0IsRUFBMkMsTUFBTSx5Q0FBeUMsQ0FBQztBQU10SCxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSw4REFBOEQsQ0FBQztBQUU3RyxjQUFjO0FBQ2QsT0FBTyxFQUNILGlCQUFpQixFQUNqQixjQUFjLEVBQ2QsaUJBQWlCLEVBQ2pCLGVBQWUsRUFFZixVQUFVLEVBQ1YsZUFBZSxFQUNmLGtCQUFrQixFQUNsQixhQUFhLEVBRWIsa0JBQWtCLEdBRXJCLE1BQU0scUJBQXFCLENBQUM7Ozs7Ozs7Ozs7Ozs7QUFFN0IsZ0JBQWdCO0FB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QUFhLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDekM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7O21IQS9MUSxxQkFBcUI7dUdBQXJCLHFCQUFxQixzZkMvQ2xDLHMzSkFtR007NEZEcERPLHFCQUFxQjtrQkFOakMsU0FBUzttQkFBQztvQkFDUCxRQUFRLEVBQUUsVUFBVTtvQkFDcEIsV0FBVyxFQUFFLHVCQUF1QjtvQkFDcEMsTUFBTSxFQUFFLEVBQ1A7aUJBQ0o7MExBNEJzQixJQUFJO3NCQUF0QixTQUFTO3VCQUFDLE1BQU07Z0JBQ08sU0FBUztzQkFBaEMsU0FBUzt1QkFBQyxXQUFXO2dCQUNHLFVBQVU7c0JBQWxDLFNBQVM7dUJBQUMsWUFBWTtnQkFDQyxTQUFTO3NCQUFoQyxTQUFTO3VCQUFDLFdBQVc7Z0JBQ0csVUFBVTtzQkFBbEMsU0FBUzt1QkFBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wsIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IE1hdFNvcnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9zb3J0JztcbmltcG9ydCB7IE1hdERpYWxvZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5pbXBvcnQgeyBNYXRQYWdpbmF0b3IgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9wYWdpbmF0b3InO1xuXG5pbXBvcnQgeyBtZXJnZSwgZnJvbUV2ZW50LCBvZiBhcyBvYnNlcnZhYmxlT2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAsIGNhdGNoRXJyb3IgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcblxuaW1wb3J0IHtcbiAgICBmYVBsdXMsXG4gICAgZmFFbGxpcHNpc1Zcbn0gZnJvbSAnQGZvcnRhd2Vzb21lL2ZyZWUtc29saWQtc3ZnLWljb25zJztcblxuaW1wb3J0IHsgU291cmNlQ29uc3VtZXJQYWdlLCBTb3VyY2VDb25zdW1lclBhZ2VNLCBVdGlsaXR5U291cmNlVHlwZU0gfSBmcm9tICcuLi8uLi8uLi8uLi9tb2RlbC9zb3VyY2UtY29uc3VtZXIubW9kZWwnO1xuXG5pbXBvcnQgeyBDb25zdW1lckNvbnRyb2xsZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9jb250cm9sbGVyL2NvbnN1bWVyLmNvbnRyb2xsZXInO1xuXG5pbXBvcnQgeyBTb3VyY2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2VydmljZS9zb3VyY2Uuc2VydmljZSc7XG5cbmltcG9ydCB7IENvbnN1bWVyQ3JlYXRlVXBkYXRlQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vX2RpYWxvZy9jb25zdW1lci9jcmVhdGUtdXBkYXRlL2NyZWF0ZS11cGRhdGUuY29tcG9uZW50JztcblxuLy8gdHNjLWxpYnJhcnlcbmltcG9ydCB7XG4gICAgTUFURVJJQUxfQ09OU1RBTlQsXG4gICAgVEFCTEVfQ09OU1RBTlQsXG4gICAgQnV0dG9uVG9vbHRpcEVudW0sXG4gICAgQnV0dG9uTGFiZWxFbnVtLFxuICAgIFNlYXJjaEJhck9uZUNvbXBvbmVudCxcbiAgICBGb3JtQWN0aW9uLFxuICAgIENPTU1PTl9DT05TVEFOVCxcbiAgICBEaWFsb2dPbmVDb21wb25lbnQsXG4gICAgRGlhbG9nT25lRW51bSxcbiAgICBQYWdlTSxcbiAgICBEaWFsb2dSZXNwb25zZUVudW0sXG4gICAgRnVubmVsRmlsdGVyQ29tcG9uZW50LFxufSBmcm9tICdAbGlicmFyeS90c2MtY29tbW9uJztcbmltcG9ydCB7IFN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSAnQGxpYnJhcnkvc3RvcmFnZS1zZXJ2aWNlJztcbi8vIC90c2MtbGlicmFyeS9cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsaWItcGFnZScsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3BhZ2UuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlczogW1xuICAgIF1cbn0pXG5leHBvcnQgY2xhc3MgQ29uc3VtZXJQYWdlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGZhUGx1cyA9IGZhUGx1cztcbiAgICBmYUVsbGlwc2lzViA9IGZhRWxsaXBzaXNWO1xuXG4gICAgTUFURVJJQUxfQ09OU1RBTlQgPSBNQVRFUklBTF9DT05TVEFOVDtcbiAgICBUQUJMRV9DT05TVEFOVCA9IFRBQkxFX0NPTlNUQU5UO1xuICAgIENPTU1PTl9DT05TVEFOVCA9IENPTU1PTl9DT05TVEFOVDtcblxuICAgIEJ1dHRvblRvb2x0aXBFbnVtID0gQnV0dG9uVG9vbHRpcEVudW07XG4gICAgRm9ybUFjdGlvbiA9IEZvcm1BY3Rpb247XG5cbiAgICBzZWFyY2hCeVBsYWNlSG9sZGVyOiBzdHJpbmcgPSAnY29uc3VtZXIgbmFtZSc7XG5cbiAgICBvcmdJRDogYW55O1xuICAgIHV0aWxpdHlTb3VyY2VJOiBhbnk7XG4gICAgZGF0YVNvdXJjZSA9IFtuZXcgU291cmNlQ29uc3VtZXJQYWdlKCldO1xuICAgIGRhdGFTb3VyY2VMZW5ndGg6IG51bWJlciA9IDA7XG4gICAgZGlzcGxheWVkQ29sdW1uOiBzdHJpbmdbXSA9IFsnaWQnLCAnbmFtZScsICd1dGlsaXR5U291cmNlTmFtZScsICd0eXBlJywgJ29wdGlvbiddO1xuICAgIHNlYXJjaEZsYWc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBzZWFyY2hWYWx1ZTogc3RyaW5nO1xuICAgIHNlYXJjaEZDID0gbmV3IEZvcm1Db250cm9sKCcnLCBWYWxpZGF0b3JzLnJlcXVpcmVkKTtcblxuICAgIHV0aWxpdHlTb3VyY2U6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICB1dGlsaXR5U291cmNlRkM6IEZvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKCk7XG4gICAgZmlsdGVyQXJyOiBBcnJheTxzdHJpbmc+ID0gW107XG5cbiAgICBAVmlld0NoaWxkKCdzb3J0Jykgc29ydDogTWF0U29ydDtcbiAgICBAVmlld0NoaWxkKCdwYWdpbmF0b3InKSBwYWdpbmF0b3I6IE1hdFBhZ2luYXRvcjtcbiAgICBAVmlld0NoaWxkKCdyZWZyZXNoQnRuJykgcmVmcmVzaEJ0bjogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdzZWFyY2hCYXInKSBzZWFyY2hCYXI6IFNlYXJjaEJhck9uZUNvbXBvbmVudDtcbiAgICBAVmlld0NoaWxkKCd0eXBlU2VsZWN0JykgdHlwZVNlbGVjdDogRnVubmVsRmlsdGVyQ29tcG9uZW50O1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZGlhbG9nOiBNYXREaWFsb2csXG4gICAgICAgIHByaXZhdGUgc3RvcmFnZVNlcnZpY2U6IFN0b3JhZ2VTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHNvdXJjZVNlcnZpY2U6IFNvdXJjZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgY29uc3VtZXJDb250cm9sbGVyOiBDb25zdW1lckNvbnRyb2xsZXJcbiAgICApIHsgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMub3JnSUQgPSB0aGlzLnN0b3JhZ2VTZXJ2aWNlLmdldFN0b3JhZ2UoJ2N1cnJlbnRPcmdJRCcpO1xuXG4gICAgICAgIHRoaXMuZ2V0VXRpbGl0eVNvdXJjZUFuZFR5cGUoKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRVdGlsaXR5U291cmNlQW5kVHlwZSgpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gPFV0aWxpdHlTb3VyY2VUeXBlTT5hd2FpdCB0aGlzLnNvdXJjZVNlcnZpY2UuZ2V0VXRpbGl0eVNvdXJjZUFuZFR5cGUodGhpcy5vcmdJRCk7XG4gICAgICAgIGNvbnN0IGFsbEtleSA9IHtcbiAgICAgICAgICAgIFwiaWRcIjogMCxcbiAgICAgICAgICAgIFwibmFtZVwiOiBcIkFsbFwiLFxuICAgICAgICAgICAgXCJrZXlJRFwiOiBcIkFMTFwiLFxuICAgICAgICAgICAgXCJ0eXBlXCI6IFtdXG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnV0aWxpdHlTb3VyY2UudW5zaGlmdChhbGxLZXkpO1xuICAgICAgICB0aGlzLnV0aWxpdHlTb3VyY2VJID0gcmVzdWx0LnV0aWxpdHlTb3VyY2U7XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICBtZXJnZShcbiAgICAgICAgICAgIHRoaXMuc29ydC5zb3J0Q2hhbmdlLFxuICAgICAgICAgICAgdGhpcy50eXBlU2VsZWN0Lm1vbm8sXG4gICAgICAgICAgICBmcm9tRXZlbnQodGhpcy5yZWZyZXNoQnRuLm5hdGl2ZUVsZW1lbnQsICdjbGljaycpXG4gICAgICAgICkucGlwZShcbiAgICAgICAgICAgIHN0YXJ0V2l0aCh7fSksXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKCk6IGFueSA9PiB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckFyciA9IFtdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoRmxhZykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VhcmNoVmFsdWUgPSAnbmFtZTonICsgdGhpcy5zZWFyY2hWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy51dGlsaXR5U291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnV0aWxpdHlTb3VyY2VGQy52YWx1ZSA9PSAnQUxMJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51dGlsaXR5U291cmNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckFyci5wdXNoKCd1dGlsaXR5U291cmNlOicgKyB0aGlzLnV0aWxpdHlTb3VyY2VGQy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdW1lckNvbnRyb2xsZXIuZ2V0Q29uc3VtZXJUeXBlQnlQYWdlKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2luYXRvci5wYWdlSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvcnQuYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvcnQuZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBzZWFyY2hWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJBcnIsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3JnSUQsXG4gICAgICAgICAgICAgICAgKS5waXBlKGNhdGNoRXJyb3IoKCkgPT4gb2JzZXJ2YWJsZU9mKG51bGwpKSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG1hcCgocmVzcG9uc2U6IFBhZ2VNPFNvdXJjZUNvbnN1bWVyUGFnZU0+KTogYW55ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2VMZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhU291cmNlTGVuZ3RoID0gcmVzcG9uc2UudG90YWxDb3VudDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVjb3JkcztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICkuc3Vic2NyaWJlKChkYXRhU291cmNlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2UgPSBkYXRhU291cmNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZWFyY2hGbih2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoRmxhZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VhcmNoVmFsdWUgPSB2YWx1ZTtcblxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHRoaXMucmVzZXRTZWFyY2goKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVmcmVzaEJ0bi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XG4gICAgfVxuXG4gICAgcmVzZXRTZWFyY2goKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoRmxhZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlYXJjaEJhci5zZWFyY2hDbGVhcigpO1xuICAgIH1cblxuICAgIGNyZWF0ZUNvbnN1bWVyKGFjdGlvbjogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oQ29uc3VtZXJDcmVhdGVVcGRhdGVDb21wb25lbnQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTAwdmgnLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnNjAwcHgnLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHJpZ2h0OiAnLTJweCcsIHRvcDogJzBweCcgfSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICAgICAgcGFuZWxDbGFzczogJ21hdERpYWxvZ0NvbnRhaW5lck92ZXJyaWRlJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09IERpYWxvZ1Jlc3BvbnNlRW51bS5TVUNDRVNTKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaEJ0bi5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdXBkYXRlQ29uc3VtZXIgPSAoYWN0aW9uLCByb3cpID0+IHtcbiAgICAgICAgY29uc3QgZGlhbG9nUmVmID0gdGhpcy5kaWFsb2cub3BlbihDb25zdW1lckNyZWF0ZVVwZGF0ZUNvbXBvbmVudCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDB2aCcsXG4gICAgICAgICAgICAgICAgd2lkdGg6ICc2MDBweCcsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHsgcmlnaHQ6ICctMnB4JywgdG9wOiAnMHB4JyB9LFxuICAgICAgICAgICAgICAgIGRpc2FibGVDbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYW5lbENsYXNzOiAnbWF0RGlhbG9nQ29udGFpbmVyT3ZlcnJpZGUnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGNvbnN1bWVySUQ6IHJvdy5pZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGRpYWxvZ1JlZi5hZnRlckNsb3NlZCgpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PSBEaWFsb2dSZXNwb25zZUVudW0uU1VDQ0VTUykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hCdG4ubmF0aXZlRWxlbWVudC5jbGljaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9wZW5EZWxldGVEaWFsb2coY29uc3VtZXIpIHtcblxuICAgICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLmRpYWxvZy5vcGVuKERpYWxvZ09uZUNvbXBvbmVudCwge1xuICAgICAgICAgICAgbWluV2lkdGg6ICc0NTBweCcsXG4gICAgICAgICAgICBtYXhXaWR0aDogJzQ1MHB4JyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBEaWFsb2dPbmVFbnVtLkRFTEVURSxcbiAgICAgICAgICAgICAgICBpY29uOiAnZGFuZ2Vyb3VzJyxcbiAgICAgICAgICAgICAgICBoZWFkZXI6ICdEZWxldGUgY29uc3VtZXIgdHlwZT8nLFxuICAgICAgICAgICAgICAgIGJvZHk6ICc8Yj4nICsgY29uc3VtZXIubmFtZSArICc8L2I+JyArICcgd2lsbCBiZSBkZWxldGVkIHBlcm1hbmVudGx5LjwvYnI+PC9icj5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY29udGludWU/JyxcbiAgICAgICAgICAgICAgICBidXR0b25PbmU6IEJ1dHRvbkxhYmVsRW51bS5DQU5DRUxfQlROX0xBQkVMLFxuICAgICAgICAgICAgICAgIGJ1dHRvblR3bzogQnV0dG9uTGFiZWxFbnVtLkRFTEVURV9CVE5fTEFCRUxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGRpYWxvZy5hZnRlckNsb3NlZCgpLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgaWYgKHJlcykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlQ29uc3VtZXJUeXBlKGNvbnN1bWVyLmlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBkZWxldGVDb25zdW1lclR5cGUoY29uc3VtZXJJRCkge1xuICAgICAgICB0aGlzLmNvbnN1bWVyQ29udHJvbGxlci5kZWxldGVDb25zdW1lclR5cGUodGhpcy5vcmdJRCwgY29uc3VtZXJJRCkuc3Vic2NyaWJlKChkZWxldGVSZXMpID0+IHtcbiAgICAgICAgICAgIGlmIChkZWxldGVSZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hCdG4ubmF0aXZlRWxlbWVudC5jbGljaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJjYXJkIGNhcmRPdmVyd3JpdGUgaDEwMFwiPlxuICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJDb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRlckxlZnRDb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwYWdlVGl0bGVcIj5Db25zdW1lciB0eXBlPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicGFnZVN1YnRpdGxlXCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJSaWdodENvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRlclJpZ2h0Q29udGFpbmVySW5uZXJcIj5cbiAgICAgICAgICAgICAgICA8bGliLXNlYXJjaC1iYXItb25lIGNsYXNzPVwibWUtM1wiICNzZWFyY2hCYXIgW3NlYXJjaEJ5XT1cInNlYXJjaEJ5UGxhY2VIb2xkZXJcIlxuICAgICAgICAgICAgICAgICAgICAoZW1pdFNlYXJjaCk9XCJzZWFyY2hGbigkZXZlbnQpXCI+PC9saWItc2VhcmNoLWJhci1vbmU+XG5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zbSBidG4tbGlnaHQgcmVmcmVzaEJ0biBjZW50ZXJBbGlnbiBtZS0zIHB5LTFcIiAjcmVmcmVzaEJ0biBtYXRSaXBwbGVcbiAgICAgICAgICAgICAgICAgICAgW21hdFJpcHBsZUNlbnRlcmVkXT1cIk1BVEVSSUFMX0NPTlNUQU5ULk1BVF9SSVBQTEVfQ0VOVEVSXCIgbWF0VG9vbHRpcFBvc2l0aW9uPVwiYmVsb3dcIlxuICAgICAgICAgICAgICAgICAgICBbbWF0VG9vbHRpcF09XCJCdXR0b25Ub29sdGlwRW51bS5SRUZSRVNIXCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCB0ZXh0LXNlY29uZGFyeVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tc20gYnRuLXN1Y2Nlc3NcIiAoY2xpY2spPVwiY3JlYXRlQ29uc3VtZXIoRm9ybUFjdGlvbi5DUkVBVEUpXCIgbWF0UmlwcGxlXG4gICAgICAgICAgICAgICAgICAgIFttYXRSaXBwbGVDZW50ZXJlZF09XCJNQVRFUklBTF9DT05TVEFOVC5NQVRfUklQUExFX0NFTlRFUlwiIG1hdFRvb2x0aXBQb3NpdGlvbj1cImJlbG93XCJcbiAgICAgICAgICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwiQnV0dG9uVG9vbHRpcEVudW0uQ1JFQVRFXCI+XG4gICAgICAgICAgICAgICAgICAgIDxmYS1pY29uIFtpY29uXT1cImZhUGx1c1wiIGNsYXNzPVwibWUtMVwiPjwvZmEtaWNvbj5Db25zdW1lciB0eXBlXG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8dGFibGUgY2xhc3M9XCJ3LTEwMFwiIG1hdC10YWJsZSBtYXRTb3J0ICNzb3J0PVwibWF0U29ydFwiIG1hdFNvcnRBY3RpdmU9XCJuYW1lXCIgbWF0U29ydERpcmVjdGlvbj1cImFzY1wiXG4gICAgICAgIG1hdFNvcnREaXNhYmxlQ2xlYXIgW2RhdGFTb3VyY2VdPVwiZGF0YVNvdXJjZVwiPlxuXG4gICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwiaWRcIj5cbiAgICAgICAgICAgIDx0aCBtYXQtaGVhZGVyLWNlbGwgKm1hdEhlYWRlckNlbGxEZWY+SUQ8L3RoPlxuICAgICAgICAgICAgPHRkIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHJvd1wiPnt7IHJvdy5pZCB9fTwvdGQ+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwibmFtZVwiPlxuICAgICAgICAgICAgPHRoIGNsYXNzPVwicHgtNFwiIG1hdC1oZWFkZXItY2VsbCAqbWF0SGVhZGVyQ2VsbERlZiBtYXQtc29ydC1oZWFkZXIgZGlzYWJsZUNsZWFyPk5hbWU8L3RoPlxuICAgICAgICAgICAgPHRkIGNsYXNzPVwicHgtNFwiIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHJvd1wiPlxuICAgICAgICAgICAgICAgIHt7IHJvdy5uYW1lID8gcm93Lm5hbWUgOiBDT01NT05fQ09OU1RBTlQuSFlQSEVOIH19XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgICAgICA8bmctY29udGFpbmVyIG1hdENvbHVtbkRlZj1cInV0aWxpdHlTb3VyY2VOYW1lXCI+XG4gICAgICAgICAgICA8dGggbWF0LWhlYWRlci1jZWxsICptYXRIZWFkZXJDZWxsRGVmPlxuICAgICAgICAgICAgICAgIDxmdW5uZWwtZmlsdGVyICN0eXBlU2VsZWN0IGhlYWRlcj1cIlV0aWxpdHkgc291cmNlXCIgdHlwZT1cIm1vbm9cIiB2YWx1ZT1cImtleUlEXCIgW2VudGl0eUxpc3RdPVwidXRpbGl0eVNvdXJjZUlcIlxuICAgICAgICAgICAgICAgICAgICB2aWV3PVwibmFtZVwiIFtzZWxlY3RGQ109XCJ1dGlsaXR5U291cmNlRkNcIiBbYWN0aXZlXT1cInV0aWxpdHlTb3VyY2VcIiAobW9ubyk9XCJ1dGlsaXR5U291cmNlID0gdHJ1ZTtcIj5cbiAgICAgICAgICAgICAgICA8L2Z1bm5lbC1maWx0ZXI+XG4gICAgICAgICAgICA8L3RoPlxuICAgICAgICAgICAgPHRkIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHJvd1wiPlxuICAgICAgICAgICAgICAgIHt7IHJvdy51dGlsaXR5U291cmNlTmFtZSA/IHJvdy51dGlsaXR5U291cmNlTmFtZSA6IENPTU1PTl9DT05TVEFOVC5IWVBIRU4gfX1cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwidHlwZVwiPlxuICAgICAgICAgICAgPHRoIG1hdC1oZWFkZXItY2VsbCAqbWF0SGVhZGVyQ2VsbERlZj5UeXBlPC90aD5cbiAgICAgICAgICAgIDx0ZCBtYXQtY2VsbCAqbWF0Q2VsbERlZj1cImxldCByb3dcIj5cbiAgICAgICAgICAgICAgICB7eyByb3cudHlwZSA/IHJvdy50eXBlIDogQ09NTU9OX0NPTlNUQU5ULkhZUEhFTiB9fVxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgICAgPG5nLWNvbnRhaW5lciBtYXRDb2x1bW5EZWY9XCJvcHRpb25cIj5cbiAgICAgICAgICAgIDx0aCBtYXQtaGVhZGVyLWNlbGwgKm1hdEhlYWRlckNlbGxEZWY+PC90aD5cbiAgICAgICAgICAgIDx0ZCBtYXQtY2VsbCAqbWF0Q2VsbERlZj1cImxldCByb3dcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2VudGVyQWxpZ25WZXJ0aWNhbFwiPlxuXG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiaWNvbkJ0biBjZW50ZXJBbGlnbiB0ZXh0LXByaW1hcnkgdXBkYXRlSWNvbkhvdmVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJ1cGRhdGVDb25zdW1lcihGb3JtQWN0aW9uLlVQREFURSwgcm93KVwiIG1hdFJpcHBsZSBbbWF0UmlwcGxlQ2VudGVyZWRdPVwiTUFURVJJQUxfQ09OU1RBTlQuTUFUX1JJUFBMRV9DRU5URVJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0VG9vbHRpcFBvc2l0aW9uPVwiYmVsb3dcIiBbbWF0VG9vbHRpcF09XCJCdXR0b25Ub29sdGlwRW51bS5VUERBVEVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCBpY29uXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cblxuICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz1cImljb25CdG4gY2VudGVyQWxpZ24gdGV4dC1kYW5nZXIgZGVsZXRlSWNvbkhvdmVyIGN1cnNvclBvaW50ZXJcIiBtYXRUb29sdGlwUG9zaXRpb249XCJiZWxvd1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBbbWF0VG9vbHRpcF09XCJCdXR0b25Ub29sdGlwRW51bS5ERUxFVEVcIiBtYXRSaXBwbGVcbiAgICAgICAgICAgICAgICAgICAgICAgIFttYXRSaXBwbGVDZW50ZXJlZF09XCJNQVRFUklBTF9DT05TVEFOVC5NQVRfUklQUExFX0NFTlRFUlwiIChjbGljayk9XCJvcGVuRGVsZXRlRGlhbG9nKHJvdylcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCBpY29uXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlXG4gICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgICAgIDx0ciBtYXQtaGVhZGVyLXJvdyAqbWF0SGVhZGVyUm93RGVmPVwiZGlzcGxheWVkQ29sdW1uXCI+PC90cj5cbiAgICAgICAgPHRyIG1hdC1yb3cgKm1hdFJvd0RlZj1cImxldCByb3c7IGNvbHVtbnM6IGRpc3BsYXllZENvbHVtbjtcIiBjbGFzcz1cImRhdGFSb3dcIj48L3RyPlxuXG4gICAgICAgIDx0ciBjbGFzcz1cIm1hdC1yb3dcIiAqbWF0Tm9EYXRhUm93PlxuICAgICAgICAgICAgPHRkIGNsYXNzPVwibWF0LWNlbGwgdGV4dC1jZW50ZXJcIiBbYXR0ci5jb2xzcGFuXT1cImRpc3BsYXllZENvbHVtbi5sZW5ndGhcIj5cbiAgICAgICAgICAgICAgICB7eyBUQUJMRV9DT05TVEFOVC5UQUJMRV9OT19EQVRBIH19XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICA8L3RyPlxuICAgIDwvdGFibGU+XG5cbiAgICA8bWF0LXBhZ2luYXRvciBjbGFzcz1cInJvdW5kZWRCb3JkZXJcIiBzaG93Rmlyc3RMYXN0QnV0dG9ucyAjcGFnaW5hdG9yIFtsZW5ndGhdPVwiZGF0YVNvdXJjZUxlbmd0aFwiXG4gICAgICAgIFtwYWdlU2l6ZV09XCJUQUJMRV9DT05TVEFOVC5ERUZBVUxUX1BBR0VfU0laRVwiIFtwYWdlU2l6ZU9wdGlvbnNdPVwiVEFCTEVfQ09OU1RBTlQuUEFHRV9TSVpFX09QVElPTlwiPlxuICAgIDwvbWF0LXBhZ2luYXRvcj5cbjwvZGl2PiJdfQ==