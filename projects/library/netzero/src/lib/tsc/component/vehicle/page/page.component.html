<div class="card cardOverwrite h100">
    <div class="headerContainer">
        <div class="headerLeftContainer">
            <div class="pageTitle">Vehicles</div>
            <div class="pageSubtitle">Create company owned vehicles to track their emissions.</div>
        </div>
        <div class="headerRightContainer">
            <div class="headerRightContainerInner">
                <lib-search-bar-one class="me-3" #searchBar [searchBy]="'vehicle name'"
                    (emitSearch)="SearchFn($event)"></lib-search-bar-one>

                <button class="btn btn-sm btn-light centerAlign me-3 py-1 refreshBtn" #refreshBtn matRipple
                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                    [matTooltip]="ButtonTooltipEnum.REFRESH">
                    <span class="material-symbols-outlined">
                        refresh
                    </span>
                </button>



                <button type="button" class="btn btn-sm btn-success btnRightRadiusZero"
                    (click)="createUpdateVehicle(FormAction.CREATE, '')" matRipple
                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                    [matTooltip]="ButtonTooltipEnum.CREATE">
                    <fa-icon [icon]="faPlus"></fa-icon>&nbsp;&nbsp;Vehicle
                </button>

                <div class="btn-group" ngbDropdown placement="bottom-right" matTooltipPosition="below"
                    [matTooltip]="ButtonTooltipEnum.MORE">
                    <button type="button" ngbDropdownToggle class="btn btn-sm btn-success btnLeftRadiusZero">
                    </button>
                    <div ngbDropdownMenu>
                        <button class="dropdown-item" (click)="bulkUpload()" matRipple
                            [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER">
                            Import
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <table mat-table [dataSource]="dataSource" #sort matSort matSortActive="employeeID" matSortDirection="desc"
        matSortDisableClear>

        <ng-container matColumnDef="vehicleNumber">
            <th mat-header-cell class="col-sm-2 " *matHeaderCellDef disableClear> Vehicle Number </th>
            <td mat-cell *matCellDef="let row"> {{ row.vehicleNumber ? row.vehicleNumber : COMMON_CONSTANT.HYPHEN}}
            </td>
        </ng-container>

        <ng-container matColumnDef="vehicleName">
            <th mat-header-cell class="col-sm-2" *matHeaderCellDef> Vehicle Name </th>
            <td mat-cell *matCellDef="let row"> {{row.vehicleName ? row.vehicleName : COMMON_CONSTANT.HYPHEN}}</td>
        </ng-container>

        <ng-container matColumnDef="vehicleType">
            <th mat-header-cell class="vehicleType" *matHeaderCellDef disableClear>
                <funnel-filter #vehicleType header="Vehicle Type" type="mono" value="id" [entityList]="vehicleTypeList"
                    [selectFC]="vehicleTypeFc" [active]="vehicleTypeFlag" (mono)="vehicleTypeFlag = true;">
                </funnel-filter>
            </th>
            <td mat-cell *matCellDef="let row"> {{row.vehicleType.name ? row.vehicleType.name : COMMON_CONSTANT.HYPHEN}}
            </td>
        </ng-container>

        <ng-container matColumnDef="vehicleCategory">
            <th mat-header-cell class="vehicleCategory" *matHeaderCellDef disableClear [ngClass]="{'d-none': isIpcc}">
                <funnel-filter #vehicleCategory header="Vehicle Category" value="id" type="mono"
                    [entityList]="vehicleCategoryList" [selectFC]="vehicleCategoryFc" [active]="vehicleCategoryFlag"
                    (mono)="vehicleCategoryFlag = true;"></funnel-filter>
            </th>

            <td mat-cell *matCellDef="let row" [ngClass]="{'d-none': isIpcc}"> {{row.vehicleCategory ?
                row.vehicleCategory.name :
                COMMON_CONSTANT.HYPHEN}}
            </td>
        </ng-container>

        <ng-container matColumnDef="engineStroke">
            <th mat-header-cell class="col-sm-1" *matHeaderCellDef [ngClass]="{'d-none': isIpcc}"> Engine Stroke </th>
            <td mat-cell *matCellDef="let row" [ngClass]="{'d-none': isIpcc}">
                {{ row.engineStroke ? row.engineStroke.name : COMMON_CONSTANT.HYPHEN }}
            </td>
        </ng-container>

        <ng-container matColumnDef="year">
            <th mat-header-cell class="col-sm-1" *matHeaderCellDef [ngClass]="{'d-none': isIpcc}"> Year </th>
            <td mat-cell *matCellDef="let row;" [ngClass]="{'d-none': isIpcc}">
                {{row.year ? row.year : COMMON_CONSTANT.HYPHEN}}
            </td>
        </ng-container>

        <ng-container matColumnDef="odometer">
            <th mat-header-cell class="col-sm-1" *matHeaderCellDef> <funnel-filter #odometer header="Odometer"
                    type="mono" value="id" view="name" [entityList]="odometerList" [selectFC]="odometerFc"
                    [active]="odometerFlag" (mono)="odometerFlag = true;"></funnel-filter></th>
            <td mat-cell *matCellDef="let row;">
                {{row.odoMeterUnit.uomCode ? row.odoMeterUnit.uomCode : COMMON_CONSTANT.HYPHEN}}
            </td>
            <td mat-cell *matCellDef="let row;">
                {{ row.odoMeterUnit.uomCode ? row.odoMeterUnit.uomName + " (" + row.odoMeterUnit.uomCode + ")" :
                COMMON_CONSTANT.HYPHEN }}
            </td>
        </ng-container>

        <ng-container matColumnDef="option">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row">
                <div class="centerAlignVertical">
                    <ng-container *ngTemplateOutlet="icon; 
                    context: {
                        icon: 'edit',
                        tooltip: ButtonTooltipEnum.UPDATE,
                        class: 'text-primary',
                        function: createUpdateVehicle,
                        functionParameter: [FormAction.UPDATE, row]
                    }">
                    </ng-container>
                </div>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="dataRow"></tr>
        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">
                {{ TABLE_CONSTANT.TABLE_NO_DATA }}
            </td>
        </tr>
    </table>

    <mat-paginator class="roundedBorder" #paginator [length]="resultLength"
        [pageSizeOptions]="TABLE_CONSTANT.PAGE_SIZE_OPTION" [pageSize]="TABLE_CONSTANT.DEFAULT_PAGE_SIZE"
        showFirstLastButtons>
    </mat-paginator>
</div>

<ng-template #icon let-icon="icon" let-tooltip="tooltip" let-class="class" let-function="function"
    let-functionParameter="functionParameter">
    <button class="iconBtn centerAlign" [class]="class" matTooltipPosition="below" [matTooltip]="tooltip" matRipple
        [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" (click)="handleClick(function, functionParameter)">
        <span class="material-symbols-outlined icon">
            {{ icon }}
        </span>
    </button>
</ng-template>
