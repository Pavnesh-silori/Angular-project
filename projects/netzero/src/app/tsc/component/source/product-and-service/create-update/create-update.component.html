<div class="headerContainer p-0" #header>
    <div class="headerLeftContainer">
        <div class="pageTitle">{{ source }}</div>
    </div>

    <div class="headerRightContainer">
        <div class="headerRightContainerInner">
            <button class="btn btn-sm centerAlign py-1 iconBtn" matRipple
                [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                [matTooltip]="ButtonTooltipEnum.CLOSE" mat-dialog-close>
                <span class="material-symbols-outlined">
                    close
                </span>
            </button>
        </div>
    </div>
</div>

<mat-dialog-content class="mat-typography customScrollBar pt-2" #body>
    <form [formGroup]="formDataFG" (ngSubmit)="submit()">
        <mat-form-field class="matFieldWidth100" [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
            <mat-label class="formLabel">{{ productCodeLabel }}</mat-label>
            <input class="formPlaceholder" matInput type="text" [placeholder]="productCodeLabel" formControlName="code"
                required />
            <mat-error *ngIf="errorHandling('code', 'required')">
                {{ FormErrorEnum.REQUIRED }}
            </mat-error>
        </mat-form-field>
        <mat-form-field class="matFieldWidth100" [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
            <mat-label class="formLabel">Name</mat-label>
            <input class="formPlaceholder" matInput type="text" placeholder="Name" formControlName="name" required />
            <mat-error *ngIf="errorHandling('name', 'required')">
                {{ FormErrorEnum.REQUIRED }}
            </mat-error>
        </mat-form-field>

        <mat-form-field class="matFieldWidth100" [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
            <mat-label class="formLabel"> Description </mat-label>
            <textarea matInput matTextareaAutosize matAutosizeMinRows="2" matAutosizeMaxRows="10"
                [maxlength]="maxLength" formControlName="description"></textarea>
            <mat-hint>Total number of character remaining: <span
                    [class]="(charactersRemainingFn(formDataFG) < 20)? 'text-danger': '' ">{{
                    charactersRemainingFn(formDataFG) }}</span>
                /{{maxLength}}
            </mat-hint>
        </mat-form-field>

        <mat-form-field *ngIf="source == ProductServiceTabTypeEnum.PRODUCT" class="matFieldWidth100"
            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
            <mat-label class="formLabel">Select Type</mat-label>
            <mat-select formControlName="productTypeID" (selectionChange)="validateCBAMProduct()" required>
                <mat-option>
                    <ngx-mat-select-search [formControl]="productTypeSearchUtil.filterFC"
                        placeholderLabel="Search by product type name" noEntriesFoundLabel="No matching found.">
                    </ngx-mat-select-search>
                </mat-option>

                <mat-option *ngFor="let item of productTypeSearchUtil.filteredEntities | async" [value]="item.id">
                    <span class="d-flex justify-content-between">
                        {{ item.name }}
                    </span>
                </mat-option>

            </mat-select>
            <mat-error *ngIf="errorHandling('productTypeID', 'required')">
                {{ FormErrorEnum.REQUIRED }}
            </mat-error>
        </mat-form-field>

        <mat-form-field *ngIf="source == ProductServiceTabTypeEnum.PRODUCT" class="matFieldWidth100"
            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
            <mat-label class="formLabel">Select Category</mat-label>
            <mat-select formControlName="category" multiple (selectionChange)="validateCBAMProduct()" required>
                <mat-option>
                    <ngx-mat-select-search [formControl]="categorySearchUtil.filterFC"
                        placeholderLabel="Search by category name"
                        [noEntriesFoundLabel]="COMMON_CONSTANT.NO_MATCH_FOUND">
                    </ngx-mat-select-search>
                </mat-option>
                <mat-option *ngFor="let category of categorySearchUtil.filteredEntities | async" [value]="category.id">
                    <span class="d-flex justify-content-between">
                        {{ category.name }}
                    </span>
                </mat-option>
            </mat-select>
            <mat-error *ngIf="errorHandling('category', 'required')">
                {{ FormErrorEnum.REQUIRED }}
            </mat-error>
        </mat-form-field>

        <ng-container *ngIf="isCBAMProduct">
            <div class="col-sm-12" *ngIf="source == ProductServiceTabTypeEnum.PRODUCT">
                <div class="radioBtnGroupLabel">
                    Is this an EU CBAM compliant product that you export?
                </div>
                <mat-radio-group formControlName="isCbamCompliant">
                    <div class="row my-2">
                        <div class="col-sm-3">
                            <mat-radio-button class="radioBtnLabel" [value]="true" (change)="checkValue($event)">
                                Yes
                            </mat-radio-button>
                        </div>
                        <div class="col-sm-3">
                            <mat-radio-button class="radioBtnLabel" [value]="false" (change)="checkValue($event)">
                                No
                            </mat-radio-button>
                        </div>
                    </div>
                    <mat-error class="radioBtnGroupError ms-1 mt-1"
                        *ngIf="radioGroupHasError('isCbamCompliant', 'required')">
                        {{ FormErrorEnum.REQUIRED }}
                    </mat-error>
                </mat-radio-group>
            </div>
        </ng-container>

        <div class="col-sm-12 mt-4">
            <div class="radioBtnGroupLabel"> Unique ID Code </div>
            <div class="row my-2" *ngIf="source == ProductServiceTabTypeEnum.PRODUCT">
                <div class="col-sm-12">
                    <mat-form-field class="col-sm-5" [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">CN</mat-label>
                        <input class="formPlaceholder" matInput type="text" placeholder="CN" (blur)="onCnInput($event)"
                            formControlName="cn" />
                        <mat-error *ngIf="errorHandling('cn', 'required')">
                            {{ FormErrorEnum.REQUIRED }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field *ngIf="formDataFG.controls['aggregatedCode'].value != null" class="col-sm-5 ms-3"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">Aggregated goods category</mat-label>
                        <input class="formPlaceholder" matInput type="text" placeholder="CN aggerated code"
                            formControlName="aggregatedCode" />
                    </mat-form-field>
                </div>
            </div>

            <div class="row my-2">
                <div class="col-sm-12">
                    <mat-form-field *ngIf="source == ProductServiceTabTypeEnum.PRODUCT" class="col-sm-5"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">HSN</mat-label>
                        <input class="formPlaceholder" matInput type="text" placeholder="HSN" formControlName="hsn" />
                    </mat-form-field>

                    <mat-form-field *ngIf="source == ProductServiceTabTypeEnum.SERVICE" class="col-sm-5"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">SAC</mat-label>
                        <input class="formPlaceholder" matInput type="text" placeholder="SAC" formControlName="sac" />
                    </mat-form-field>
                    <mat-form-field class="col-sm-5 ms-3"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">EAN</mat-label>
                        <input class="formPlaceholder" matInput type="text" placeholder="EAN" formControlName="ean" />
                    </mat-form-field>
                </div>
            </div>

            <div class="row my-2">
                <div class="col-sm-12">
                    <mat-form-field class="col-sm-5" [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">UPC</mat-label>
                        <input class="formPlaceholder" matInput type="text" placeholder="UPC" formControlName="upc" />
                    </mat-form-field>

                    <mat-form-field class="col-sm-5 ms-3"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">ISBN</mat-label>
                        <input class="formPlaceholder" matInput type="text" placeholder="ISBN" formControlName="isbn" />
                    </mat-form-field>
                </div>
            </div>
        </div>
        <!-- </mat-card> -->

        <!-- <mat-card class="cardOverwrite mat-card mat-focus-indicator border mt-3"> -->
        <div class="col-sm-12">
            <div class="row my-2">
                <div class="cardTitle"> Emission Factor Databases </div>
                <div class="cardSubtitle pb-3" *ngIf="isProduct()">
                    {{ messagesConstant.EMISSION_SOURCE_PAGE_INFO }}
                </div>
                <div class="cardSubtitle pb-3" *ngIf="isService()">
                    {{ messagesConstant.EMISSION_SOURCE_SERVICE_PAGE_INFO }}
                </div>

                <app-emission-source-form [sourceID]="id" [source]="source"
                    (emissionSourceFormUpdate)="updateFormData($event)"></app-emission-source-form>
            </div>
        </div>
        <!-- </mat-card> -->

        <button class="d-none" type="submit" #formSubmitBtn></button>
    </form>
</mat-dialog-content>

<div class="tscDialogFooter" #footer>
    <button class="btn btn-sm btn-success" [ngClass]="{'disabled': isEqual && action == FormAction.UPDATE}"
        (click)="formSubmitBtn.click()" matRipple>
        {{ tSCCommonService.getButtonLabel(action) }}
    </button>

    <button class="btn btn-sm btn-secondary me-2" mat-dialog-close matRipple
        [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER">
        Cancel
    </button>
</div>