<div class="card cardOverwrite h100">
    <div class="headerContainer">
        <div class="headerLeftContainer">
            <div class="pageTitle">Vehicles</div>
            <div class="pageSubtitle">Create company owned vehicles to track their emissions.</div>
        </div>
        <div class="headerRightContainer">
            <div class="headerRightContainerInner">
                <lib-search-bar-one class="me-3" #searchBar [searchBy]="'vehicle name'"
                    (emitSearch)="searchFn($event)"></lib-search-bar-one>

                <button class="btn btn-sm btn-light centerAlign me-3 py-1 refreshBtn" #refreshBtn matRipple
                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                    [matTooltip]="ButtonTooltipEnum.REFRESH">
                    <span class="material-symbols-outlined">
                        refresh
                    </span>
                </button>

                <button type="button" class="btn btn-sm btn-success btnRightRadiusZero"
                    (click)="createUpdateVehicle(FormAction.CREATE, '')" matRipple
                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                    [matTooltip]="ButtonTooltipEnum.CREATE">
                    <fa-icon [icon]="faPlus"></fa-icon>&nbsp;&nbsp;Vehicle
                </button>

                <div class="btn-group" ngbDropdown placement="bottom-right" matTooltipPosition="below"
                    [matTooltip]="ButtonTooltipEnum.MORE">
                    <button type="button" ngbDropdownToggle class="btn btn-sm btn-success btnLeftRadiusZero">
                    </button>
                    <div ngbDropdownMenu>
                        <button class="dropdown-item" (click)="bulkUpload()" matRipple
                            [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER">
                            Import
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div [ngStyle]="{'display': isFirstTemplate ? '' : 'none'}">
        <!-- <div class="pe-3 me-1 btn-group float-end" ngbDropdown placement="bottom-right"
            [class]="bulkBtnFlag ? 'custom-cursor' : 'disableCursor'">
            <button type="button" ngbDropdownToggle class="btn btn-sm btn-secondary" [disabled]="!bulkBtnFlag">
                Bulk actions
            </button>

            <div ngbDropdownMenu *ngIf="bulkBtnFlag">
                <button class="dropdown-item" (click)="bulkUpdate('active')">
                    <span class="ms-2">Mark all as active</span>
                </button>
                <button class="dropdown-item" (click)="bulkUpdate('inactive')">
                    <span class="ms-2">Mark all as inactive</span>
                </button>
                <button class="dropdown-item" (click)="bulkUpdate('delete')">
                    <span class="ms-2 text-danger">
                        {{ ButtonLabelEnum.DELETE_BTN_LABEL }} all
                    </span>
                </button>
            </div>
        </div> -->

        <div class="me-2 mb-2">
            <button matRipple [matRippleCentered]="true" class="btn btn-link float-end" (click)="resetFilter()"
                [disabled]="!isAnyFlagTrue()">
                <span class="material-symbols-outlined fs-6">
                    filter_list_off
                </span>
                Reset Filters
            </button>
        </div>
    </div>

    <table mat-table [dataSource]="dataSource" #sort matSort matSortActive="employeeID" matSortDirection="desc"
        matSortDisableClear [ngStyle]="{'display': isFirstTemplate ? '' : 'none'}">

        <ng-container matColumnDef="vehicleNumber">
            <th mat-header-cell class="col-sm-2 " *matHeaderCellDef disableClear>
                <!-- <mat-checkbox [(ngModel)]="allComplete" (change)="selectAll($event.checked)">
                </mat-checkbox> -->
                <span class="ms-2"> Vehicle Number </span>
            </th>
            <td mat-cell *matCellDef="let row">
                <!-- <mat-checkbox [(ngModel)]="row['completed']" (change)="rowSelected()"></mat-checkbox> -->
                <span class="ms-2"> {{ row.vehicleNumber ? row.vehicleNumber : COMMON_CONSTANT.HYPHEN}} </span>
            </td>
        </ng-container>

        <ng-container matColumnDef="vehicleName">
            <th mat-header-cell class="col-sm-2" *matHeaderCellDef> Vehicle Name </th>
            <td mat-cell *matCellDef="let row">
                <!-- <span (click)="navigateToViewPage(row.id)" class="text-primary cursorPointer lineClamp1"> -->
                    {{row.vehicleName ? row.vehicleName : COMMON_CONSTANT.HYPHEN}}
                <!-- </span> -->
            </td>
        </ng-container>

        <ng-container matColumnDef="vehicleType">
            <th mat-header-cell class="vehicleType" *matHeaderCellDef disableClear>
                <funnel-filter #vehicleType header="Vehicle Type" type="mono" value="id" [entityList]="vehicleTypeList"
                    [selectFC]="vehicleTypeFc" [active]="vehicleTypeFlag" (mono)="vehicleTypeFlag = true;" [resetFlag]="resetFlag">
                </funnel-filter>
            </th>
            <td mat-cell *matCellDef="let row"> {{row.vehicleType.name ? row.vehicleType.name : COMMON_CONSTANT.HYPHEN}}
            </td>
        </ng-container>

        <ng-container matColumnDef="vehicleCategory">
            <th mat-header-cell class="vehicleCategory" *matHeaderCellDef disableClear>
                <funnel-filter #vehicleCategory header="Vehicle Category" value="id" type="mono"
                    [entityList]="vehicleCategoryList" [selectFC]="vehicleCategoryFc" [active]="vehicleCategoryFlag"
                    (mono)="vehicleCategoryFlag = true;" [resetFlag]="resetFlag"></funnel-filter>
            </th>
            <td mat-cell *matCellDef="let row"> {{row.vehicleCategory.name ? row.vehicleCategory.name :
                COMMON_CONSTANT.HYPHEN}}
            </td>
        </ng-container>

        <ng-container matColumnDef="engineStroke">
            <th mat-header-cell class="col-sm-1" *matHeaderCellDef> Engine Stroke </th>
            <td mat-cell *matCellDef="let row">
                {{ row.engineStroke ? row.engineStroke.name : COMMON_CONSTANT.HYPHEN }}
            </td>
        </ng-container>

        <ng-container matColumnDef="year">
            <th mat-header-cell class="col-sm-1" *matHeaderCellDef> Year </th>
            <td mat-cell *matCellDef="let row;">
                {{row.year ? row.year : COMMON_CONSTANT.HYPHEN}}
            </td>
        </ng-container>

        <ng-container matColumnDef="odometer">
            <th mat-header-cell class="col-sm-1" *matHeaderCellDef> <funnel-filter #odometer header="Odometer"
                    type="mono" value="id" view="name" [entityList]="odometerList" [selectFC]="odometerFc"
                    [active]="odometerFlag" (mono)="odometerFlag = true;" [resetFlag]="resetFlag"></funnel-filter></th>
            <td mat-cell *matCellDef="let row;">
                {{row.odoMeterUnit.uomCode ? row.odoMeterUnit.uomCode : COMMON_CONSTANT.HYPHEN}}
            </td>
            <td mat-cell *matCellDef="let row;">
                {{ row.odoMeterUnit.uomCode ? row.odoMeterUnit.uomName + " (" + row.odoMeterUnit.uomCode + ")" :
                COMMON_CONSTANT.HYPHEN }}
            </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status
                <!-- <funnel-filter #statusFilter header="Status" type="mono" [entityList]="statusList" [selectFC]="statusFC"
                    [active]="statusFlag" (mono)="statusFlag = true;" [resetFlag]="resetFlag">
                </funnel-filter> -->
            </th>
            <td mat-cell *matCellDef="let row" [ngClass]="row.status ? 'text-success' : 'text-danger'">
                {{ row.status ? statusService.getStatusValue(row.status) : COMMON_CONSTANT.HYPHEN }}
            </td>
        </ng-container>

        <ng-container matColumnDef="option">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row">
                <div class="btn-group" ngbDropdown placement="left-top">
                    <button type="button" ngbDropdownToggle class="dropdown-after dropdownAfter btn">
                        <fa-icon [icon]="faEllipsisV"></fa-icon>
                    </button>
                    <div ngbDropdownMenu>
                        <button class="dropdown-item" (click)="createUpdateVehicle(FormAction.UPDATE, row)">
                            {{ ButtonLabelEnum.UPDATE_BTN_LABEL }}
                        </button>

                        <!-- <button class="dropdown-item" (click)="changeItemStatus(row)">
                            <ng-container *ngIf="row.status == 'INACTIVE'; else activeContainer">
                                Mark as active
                            </ng-container>
                            <ng-template #activeContainer>
                                Mark as inactive
                            </ng-template>
                        </button> -->
                    </div>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="dataRow"></tr>
        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">
                {{ TABLE_CONSTANT.TABLE_NO_DATA }}
            </td>
        </tr>
    </table>

    <mat-paginator class="roundedBorder" #paginator [length]="resultLength"
        [pageSizeOptions]="TABLE_CONSTANT.PAGE_SIZE_OPTION" [pageSize]="TABLE_CONSTANT.DEFAULT_PAGE_SIZE"
        showFirstLastButtons [ngStyle]="{'display': isFirstTemplate ? '' : 'none'}">
    </mat-paginator>

    <div class="card-body" [ngStyle]="{'display': isFirstTemplate ? 'none' : ''}">
        <div class="row d-flex">
            <ng-container *ngIf="dataSource?.length !== 0">
                <div class="col-sm-4 pe-4">
                    <div class="row customScrollBar hMax100 OverflowY">
                        <div class="col-sm-12 mb-3" *ngFor="let row of dataSource; let i=index"
                            [ngClass]="{'cursorPointer': selectedVehicleID != row.id}">
                            <mat-card class="card cardOverwrite p-3"
                                [ngClass]="{'current-org': selectedVehicleID == row.id, 'border': selectedVehicleID != row.id}">
                                <div class="row">
                                    <div class="col-sm-12 d-flex flex-column justify-content-center"
                                        (click)="navigateToViewPage(row.id)">

                                        <div class="fw-bold pb-1">
                                            {{ row.vehicleName ? row.vehicleName : COMMON_CONSTANT.HYPHEN }}
                                        </div>

                                        <div class="row text-secondary">
                                            <div class="col-sm-6">Vehicle number:
                                            </div>
                                            <div class="col-sm-6 fw-bold">{{ row.vehicleNumber }}</div>
                                        </div>
                                    </div>
                                </div>
                            </mat-card>
                        </div>
                    </div>
                </div>

                <div class="col-sm-8 card cardOverwrite border mb-2 customScrollBar hMax100 OverflowY">
                    <router-outlet></router-outlet>
                </div>
            </ng-container>

            <ng-container *ngIf="dataSource?.length == 0">
                <div class="col-sm-6">
                    <lib-message-alert [messageAlertTypeInp]="messageAlertTypeEnum.INFO"
                        [messageAlertIconInp]="messageAlertIconEnum.INFO_ICON"
                        contentInp="No data has been found. Please make a different search/filter selection.">
                    </lib-message-alert>
                </div>
            </ng-container>
        </div>
    </div>
</div>

<ng-template #icon let-icon="icon" let-tooltip="tooltip" let-class="class" let-function="function"
    let-functionParameter="functionParameter">
    <button class="iconBtn centerAlign" [class]="class" matTooltipPosition="below" [matTooltip]="tooltip" matRipple
        [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" (click)="handleClick(function, functionParameter)">
        <span class="material-symbols-outlined icon">
            {{ icon }}
        </span>
    </button>
</ng-template>