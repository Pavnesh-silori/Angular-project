<div class="headerContainer p-0" #header>
    <div class="headerLeftContainer">
        <div class="pageTitle">{{Title}} Supplier</div>
        <!-- <div class="pageSubtitle">{{ pageSubtitle }}</div> -->
    </div>

    <!-- <div class="headerRightContainer">
        <div class="headerRightContainerInner">
            <button class="btn btn-sm centerAlign py-1 iconBtn" matRipple
                [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                [matTooltip]="ButtonTooltipEnum.CLOSE" mat-dialog-close>
                <span class="material-symbols-outlined">
                    close
                </span>
            </button>
        </div>
    </div> -->
</div>

<mat-dialog-content class="mat-typography customScrollBar pt-2" #body>
    <form [formGroup]="supplierFG">
        <mat-card class="cardOverwrite mat-card mat-focus-indicator border">
            <div class="cardTitle pb-3"> Details </div>
            <div class="row">
                <div class="col-sm-12">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel"> Name </mat-label>
                        <input class="formPlaceholder" matInput type="text" formControlName="name" placeholder="Name"
                            required />
                        <mat-error *ngIf="errorHandling('name', 'required')">
                           {{ FormErrorEnum.REQUIRED }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel"> Supplier code </mat-label>
                        <input class="formPlaceholder" matInput type="text" formControlName="supplierCode"
                            placeholder="Supplier code" />
                        <mat-error *ngIf="errorHandling('supplierCode', 'duplicate_supplier_code')">
                            Supplier Code already exists
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel"> Select supplier type </mat-label>
                        <mat-select formControlName="supplierTypeIDs" multiple required
                            (selectionChange)="checkSupplierType($event.value)"
                            [matTooltip]="showTooltip ? 'Here you can add new supplier type but not remove created supplier type.' : ''"
                            matTooltipPosition="below">
                            <mat-option class="hideCheckbox" disabled> Select supplier type</mat-option>
                            <mat-option class="multiSelect" *ngFor="let supplierTypes of supplierType"
                                [value]="supplierTypes['typeID']"
                                [disabled]="supplierTypeId == null? false: contains(supplierTypes['typeID'])"
                                [matTooltip]="showTooltip ? 'Here you can add new supplier type but not remove created supplier type.' : ''"
                                matTooltipPosition="below">
                                {{supplierTypes.name}}
                            </mat-option>
                        </mat-select>

                        <mat-error *ngIf="errorHandling('supplierTypeIDs', 'required')">
                            {{ FormErrorEnum.REQUIRED }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">

                        <mat-label class="formLabel"> Select supplier tier </mat-label>

                        <mat-select formControlName="supplierTierID" required>
                            <mat-option disabled> Select supplier tier</mat-option>
                            <mat-option *ngFor="let supplierTier of supplierTiers" [value]="supplierTier['tierID']">
                                {{supplierTier.name}}
                            </mat-option>
                        </mat-select>

                        <mat-error *ngIf="errorHandling('supplierTierID', 'required')">
                            {{ FormErrorEnum.REQUIRED }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field *ngIf="isAWasteDisposalSupplier" class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel"> Email </mat-label>
                        <input class="formPlaceholder" matInput type="email" formControlName="email" placeholder="Email"
                            required />
                        <mat-error *ngIf="errorHandling('email', 'required')">
                            {{ FormErrorEnum.REQUIRED }}
                        </mat-error>
                        <mat-error *ngIf="errorHandling('email', 'email')">
                            Please enter valid email id
                        </mat-error>
                    </mat-form-field>

                    <!-- <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">Address</mat-label>
                        <textarea matInput placeholder="Address" matTextareaAutosize matAutosizeMinRows="1"
                            matAutosizeMaxRows="5" formControlName="address"></textarea>
                    </mat-form-field> -->

                    <mat-form-field class="matFieldWidth100 pb-3"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE"
                        [hintLabel]="'Max ' + addressCharMaxLength +' characters'">
                        <mat-label class="formLabel">Address</mat-label>
                        <textarea #address class="formPlaceholder" placeholder="Address" matInput
                            [maxlength]="addressCharMaxLength" formControlName="address" required>
                        </textarea>
                        <mat-hint align="end">{{address.value?.length || 0}}/{{ addressCharMaxLength }}
                        </mat-hint>
                        <!-- <mat-error *ngIf="errorHandling('address')">
                            {{ FormErrorEnum.REQUIRED }}
                        </mat-error> -->
                    </mat-form-field>

                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">Select Country</mat-label>
                        <mat-select (selectionChange)="countryChange($event.value)" formControlName="countryCode"
                            required>
                            <!-- <mat-option>
                                    <ngx-mat-select-search [formControl]="countryFilterFC"
                                        placeholderLabel="Search by country name"
                                        noEntriesFoundLabel="No matching country found.">
                                    </ngx-mat-select-search>
                                </mat-option> -->

                            <mat-option>
                                <ngx-mat-select-search [formControl]="countrySelectSearch.filterFC"
                                    placeholderLabel="Search by country name"
                                    [noEntriesFoundLabel]="COMMON_CONSTANT.NO_MATCH_FOUND">
                                </ngx-mat-select-search>
                            </mat-option>


                            <!-- <mat-option *ngFor="let countriesM of countryFiltered | async" [value]="countriesM.countryCode">
                                    <span class="d-flex justify-content-between">
                                        {{countriesM.countryName}} -
                                        <span>{{countriesM.countryCode}}</span>
                                    </span>
                                </mat-option> -->

                            <mat-option *ngFor="let country of countrySelectSearch.filteredEntities | async"
                                [value]="country.countryCode">
                                <span class="d-flex justify-content-between">
                                    {{country.countryName}} -
                                    <span>{{country.countryCode}}</span>
                                </span>
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="errorHandling('countryCode', 'required')">
                            {{ FormErrorEnum.REQUIRED }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field *ngIf="isGridAvailable && isEnergySupplier" class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">Select Grid</mat-label>
                        <mat-select formControlName="gridID" required>
                            <mat-option>
                                <!-- <ngx-mat-select-search [formControl]="gridFilterFC" placeholderLabel="Search by grid name"
                                        noEntriesFoundLabel="No matching grid found.">
                                    </ngx-mat-select-search> -->

                                <ngx-mat-select-search [formControl]="gridSelectSearch.filterFC"
                                    placeholderLabel="Search by grid name"
                                    [noEntriesFoundLabel]="COMMON_CONSTANT.NO_MATCH_FOUND">
                                </ngx-mat-select-search>
                            </mat-option>

                            <!-- <mat-option *ngFor="let grids of gridFiltered | async" [value]="grids.gridID">
                                    {{grids.gridName}}
                                </mat-option> -->

                            <mat-option *ngFor="let grid of gridSelectSearch.filteredEntities | async"
                                [value]="grid.gridID">
                                {{grid.gridName}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="errorHandling('gridID', 'required')">
                            {{ FormErrorEnum.REQUIRED }}
                        </mat-error>
                    </mat-form-field>

                    <!-- <mat-form-field class="matFieldWidth100"
                    [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE"> -->
                    <mat-slide-toggle class="float-start" formControlName="isPortalEnabled"
                        (change)="handlePortalAccess($event)">
                        <div class="cardTitle">
                            Enable Supplier Portal Access
                        </div>
                    </mat-slide-toggle>

                    <!-- </mat-form-field> -->
                </div>
            </div>
        </mat-card>

        <mat-card class="cardOverwrite mat-card mat-focus-indicator border mt-4" *ngIf="hasSupplierPortal()">
            <div class="cardTitle pb-3"> Contact Person </div>
            <div formArrayName="contactUsers" *ngFor="let group of contactPersonControls; let i = index">
                <div [formGroupName]="i">
                    <div class="row pb-4 mb-1">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-6">
                                    <mat-form-field class="matFieldWidth100"
                                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                        <mat-label class="formLabel"> First Name </mat-label>
                                        <input class="formPlaceholder" matInput type="text" formControlName="firstName"
                                            placeholder="Name" required />
                                        <mat-error *ngIf="errorHandlingContactPerson( i, 'firstName', 'required')">
                                            {{ FormErrorEnum.REQUIRED }}
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <div class="col-sm-6">
                                    <mat-form-field class="matFieldWidth100"
                                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                        <mat-label class="formLabel"> Last Name </mat-label>
                                        <input class="formPlaceholder" matInput type="text" formControlName="lastName"
                                            placeholder="Name" />
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <mat-form-field class="matFieldWidth100"
                                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                        <mat-label class="formLabel"> Email </mat-label>
                                        <input class="formPlaceholder" matInput type="email" formControlName="emailID"
                                            placeholder="Email" required />
                                        <mat-error *ngIf="errorHandlingContactPerson( i, 'emailID', 'required')">
                                            {{ FormErrorEnum.REQUIRED }}
                                        </mat-error>

                                        <mat-error *ngIf="errorHandlingContactPerson( i, 'emailID', 'email')">
                                            Please enter valid email id
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <div class="col-sm-6" style="margin: .25em 0;">
                                    <ngx-intl-tel-input [preferredCountries]="preferredCountries"
                                        [enableAutoCountrySelect]="true" [enablePlaceholder]="true"
                                        [searchCountryFlag]="true"
                                        [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                                        [selectFirstCountry]="false" [maxLength]="maxLength" [phoneValidation]="true"
                                        [separateDialCode]="separateDialCode"
                                        [numberFormat]="PhoneNumberFormat.National" formControlName="phoneNumber"
                                        [selectedCountryISO]="currentCountryCode"
                                        customPlaceholder="Enter Phone Number">
                                    </ngx-intl-tel-input>

                                    <mat-error *ngIf="errorHandlingContactPerson( i, 'phoneNumber', 'required')">
                                         {{ FormErrorEnum.REQUIRED }}
                                    </mat-error>
                                </div>
                            </div>

                            <div class="row pt-2">
                                <mat-checkbox formControlName="isPrimary" (change)="updatePrimaryContact(i)"
                                    [disabled]="!canUpdatePrimaryContact(i)" matRipple
                                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER">
                                    <div class="cardTitle">
                                        Mark as Primary Contact
                                    </div>
                                </mat-checkbox>

                                <!-- <mat-hint align="start">Primary contact can't be disabled, mark other as primary
                                    contact if you wanna disabled.
                                </mat-hint> -->
                            </div>

                        </div>

                        <div class="col-sm-12 button-row">
                            <span>
                                <button class="btn btn-sm btn-primary m-1" *ngIf="contactPersonControls.length-1 == i"
                                    (click)="addContactPerson()" matRipple
                                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                                    [matTooltip]="'Add Contact Person'">
                                    + Contact Person
                                </button>
                            </span>
                            <span [ngClass]="!canRemoveContactPerson(i) ? 'disableCursor' : ''">
                                <button class="btn btn-sm btn-danger m-1" (click)="deletePerson(i)"
                                    [disabled]="!canRemoveContactPerson(i)" matRipple
                                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER">
                                    Remove
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </mat-card>
    </form>
</mat-dialog-content>

<div class="tscDialogFooter" #footer>
    <button class="btn btn-sm btn-success" [ngClass]="{'disabled': isEqual && action == FormAction.UPDATE}"
        (click)="createUpdateSupplierForm(action)" matRipple [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER"
        matTooltipPosition="below">
        {{ tSCCommonService.getButtonLabel(action) }}
    </button>

    <button class="btn btn-sm btn-secondary me-2" mat-dialog-close matRipple
        [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER">Cancel
    </button>
</div>