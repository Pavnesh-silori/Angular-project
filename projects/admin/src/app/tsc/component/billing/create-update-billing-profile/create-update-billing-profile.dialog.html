<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
    <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
        <path
            d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
    </symbol>
</svg>
<div mat-dialog-title>
    <strong class="dialogHeader">
        {{Title}} Billing Profile
    </strong>
</div>

<div class="matDialogContent" mat-dialog-content>
    <form [formGroup]="billingProfileFG">
        <mat-card class="border cardOverwrite">
            <div class="cardTitle fw-bold pb-3">
                Billing details
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel"> Company name </mat-label>
                        <input matInput type="text" placeholder="Example:Logicladder Technologies Private Limited"
                            formControlName="companyName">
                        <mat-error>
                            Enter a company name.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel"> Company address </mat-label>
                        <input matInput type="text" placeholder="Company address" formControlName="billingAddress">
                        <mat-error>
                            Enter an organization or facility address.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel"> Select Country </mat-label>
                        <mat-select (selectionChange)="countryChange($event.value)" formControlName="countryCode">
                            <mat-option>
                                <ngx-mat-select-search [formControl]="countryFilterFC"
                                    placeholderLabel="Search by country name"
                                    noEntriesFoundLabel="No matching country found.">
                                </ngx-mat-select-search>
                            </mat-option>
                            <mat-option *ngFor="let countriesM of countryFiltered | async"
                                [value]="countriesM.countryCode">
                                <span class="d-flex justify-content-between">
                                    {{countriesM.countryName}} -
                                    <span>{{countriesM.countryCode}}</span>
                                </span>
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="errorHandling('countryCode', 'required')">
                            Country is required
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-sm-6">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel"> Select State </mat-label>
                        <mat-select formControlName="stateCode">
                            <mat-option>
                                <ngx-mat-select-search [formControl]="stateFilterFC"
                                    placeholderLabel="Search by state name"
                                    noEntriesFoundLabel="No matching state found.">
                                </ngx-mat-select-search>
                            </mat-option>
                            <mat-option *ngFor="let statesM of stateFiltered | async" [value]="statesM.stateCode">
                                {{statesM.name}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="billingProfileFG.get('countryCode').invalid">
                            Please select country first
                        </mat-error>
                        <mat-error
                            *ngIf="errorHandling('stateCode', 'required') && billingProfileFG.get('countryCode').valid">
                            State is required
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel">City</mat-label>
                        <input matInput type="text" placeholder="City" formControlName="city" pattern="[a-zA-Z\s'-]*" />
                        <mat-error *ngIf="billingProfileFG.controls['city'].invalid">
                            Enter a valid city name.
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-sm-6">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel"> Zip code </mat-label>
                        <input matInput type="text" placeholder="Zip Code" formControlName="zipCode" />
                        <mat-error *ngIf="billingProfileFG.get('zipCode').hasError('required')">
                            Zipcode is required.
                        </mat-error>
                        <mat-error *ngIf="billingProfileFG.get('zipCode').hasError('pattern')">
                            Only text and numbers are allowed in Zip Code.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
        </mat-card>

        <mat-card class="mt-3 border cardOverwrite">
            <div class="cardTitle fw-bold pb-3">
                Billing contact
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel">Billing contact</mat-label>
                        <input matInput type="text" formControlName="userName" pattern="[a-zA-Z\s'-]*">
                        <mat-error *ngIf="billingProfileFG.controls['userName'].invalid">
                            Enter a valid name.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel">Email ID</mat-label>
                        <input matInput type="email" placeholder="email@domain.com" formControlName="userEmail">
                        <mat-error *ngIf="billingProfileFG.get('userEmail').hasError('required')">
                            Enter email ID.
                        </mat-error>
                        <mat-error *ngIf="billingProfileFG.get('userEmail').hasError('pattern')">
                            Enter a valid email ID.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <ngx-intl-tel-input [preferredCountries]="preferredCountries" [enableAutoCountrySelect]="true"
                    [enablePlaceholder]="true" [searchCountryFlag]="true"
                    [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                    [selectFirstCountry]="false" [maxLength]="maxLength" [phoneValidation]="true"
                    [separateDialCode]="separateDialCode" [numberFormat]="PhoneNumberFormat.National"
                    [formControl]="phoneFormControl">
                </ngx-intl-tel-input>
                <mat-error *ngIf="phoneFormControl.touched && phoneFormControl.hasError('required')">
                    Enter phone number.
                </mat-error>
                <mat-error *ngIf="phoneFormControl.invalid && !phoneFormControl.hasError('required')">Please
                    input a valid mobile number.</mat-error>
            </div>
        </mat-card>

        <mat-card class="mt-3 border cardOverwrite">
            <div class="cardTitle fw-bold pb-3">
                Other details
            </div>

            <div class="row" *ngIf="showGSTNumber == 'YES'">
                <div class="col-sm-12">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel">GST Number</mat-label>
                        <input class="formPlaceholder" matInput formControlName="tinNo" [maxlength]="maxLength"
                            #input />
                        <mat-hint>Total number of character remaining: {{input.value.length}} /{{maxLength}}</mat-hint>
                        <mat-error *ngIf="billingProfileFG.get('tinNo').hasError('pattern')">
                            Only text and numbers are allowed in the GST Number.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="alert alert-primary centerAlignVertical roundedBorder" *ngIf="showGSTNumber == 'NO'">
                <svg class="bi flex-shrink-0 me-3 cardIcon">
                    <use xlink:href="#info-fill" />
                </svg>
                <div class="extraInfoCardText">
                    We don't add VAT or other tax charges to your account. You'll be responsible for self-assessing and
                    paying taxes on these prices if your local rules require you to pay these taxes.
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <mat-form-field class="matFieldWidth100"
                        [appearance]="MaterialFormFieldAppearance['FORM_FIELD_APPEARANCE']">
                        <mat-label class="formLabel">Share invoice</mat-label>
                        <mat-chip-list #chipList>
                            <mat-chip *ngFor="let email of extraInvoiceEmails.value" [removable]="removable"
                                (removed)="removeEmail(email)">
                                {{ email }}
                                <button matChipRemove *ngIf="removable" class="mat-chip-cancel">
                                    <mat-icon><span class="material-symbols-outlined">cancel</span></mat-icon>
                                </button>
                            </mat-chip>
                            <input [placeholder]="inputPlaceholder" [matChipInputFor]="chipList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                                (matChipInputTokenEnd)="add($event)" (input)="onInput()">
                        </mat-chip-list>
                    </mat-form-field>
                </div>
            </div>
        </mat-card>
    </form>
</div>

<div class="float-end my-2">
    <button type="button" class="btn btn-sm btn-secondary me-2" mat-dialog-close>
        {{ ButtonLabelEnum.CANCEL_BTN_LABEL }}
    </button>
    <div [ngSwitch]="action" class="d-inline">
        <button *ngSwitchCase="'create'" type="submit" class="btn btn-sm btn-success" (click)="createBillingProfile()">
            {{ ButtonLabelEnum.CREATE_BTN_LABEL }}
        </button>
        <button *ngSwitchCase="'update'" type="submit" class="btn btn-sm btn-success" [ngClass]="{'disabled': isEqual}"
            (click)="updateBillingProfile()">
            {{ ButtonLabelEnum.UPDATE_BTN_LABEL }}
        </button>
        <button *ngSwitchDefault class="d-none"></button>
    </div>
</div>