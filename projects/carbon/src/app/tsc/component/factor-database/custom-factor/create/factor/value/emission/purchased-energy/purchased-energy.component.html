<mat-card class="border cardOverwrite" [class]="{'border-danger': showError()}">
    <div class="cardTitle pb-2"> Emission Factor values </div>

    <form [formGroup]="valueFG">
        <div class="row">
            <div class="col-sm-6">
                <mat-form-field class="matFieldWidth100"
                    [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                    <mat-label class="formLabel"> Select gas </mat-label>
                    <mat-select [formControl]="gasSelectFC" (selectionChange)="addGas()">
                        <mat-option>
                            <ngx-mat-select-search [formControl]="gasSearchUtil.filterFC"
                                placeholderLabel="Search by gas name"
                                noEntriesFoundLabel="No gas found with such name.">
                            </ngx-mat-select-search>
                        </mat-option>
                        <mat-option *ngFor="let gas of gasSearchUtil.filteredEntities | async" [value]="gas"
                            [disabled]="selectedGases.isSelected(gas.id)" matTooltipPosition="left"
                            matTooltipClass="infoTooltip"
                            [matTooltip]="selectedGases.isSelected(gas.id) ? 'Gas already added to list' : null">
                            {{ gas['name'] }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <!-- <div class="col-sm-2 centerAlignVertical pb-4">
                <button type="button" class="btn btn-light" (click)="addGas()">Add</button>
            </div> -->
        </div>

        <ng-container formArrayName="gases">
            <ng-container *ngFor="let formGroup of gasFormArray['controls']; let i = index;">
                <ng-container [formGroupName]="i">
                    <!-- <div class="row"> -->
                        <div class="col-sm-6 row">
                            <div class="col-sm-3 centerAlignVertical pb-4" matTooltipPosition="above"
                                [matTooltip]="formGroup.get('gasStdName').value.length > 20 ? formGroup.get('gasStdName').value : null">
                                {{ formGroup.get('gasStdName').value | dotdotdot: 20 }}
                            </div>
                            <div class="col-sm-8">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <mat-form-field class="matFieldWidth100"
                                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                            <mat-label class="formLabel"> Quantity of gas released</mat-label>
                                            <input class="formPlaceholder" type="number"
                                                placeholder="Quantity of gas released" matInput formControlName="factor"
                                                required />
                                            <mat-error *ngIf="errorHandlingFA(formGroup, 'factor', 'required')">
                                                {{ FormErrorEnum.REQUIRED }}
                                            </mat-error>
                                            <mat-error *ngIf="errorHandlingFA(formGroup, 'factor', 'min')">
                                                Negative value is not allowed
                                            </mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-sm-4">
                                        <mat-form-field class="matFieldWidth100"
                                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                            <mat-label class="formLabel"> Select numerator </mat-label>
                                            <mat-select formControlName="numeratorUnitID">
                                                <mat-option>
                                                    <ngx-mat-select-search
                                                        [formControl]="getNumeratorSearchUtil(i).filterFC"
                                                        placeholderLabel="Search by unit name"
                                                        noEntriesFoundLabel="No unit found with such name.">
                                                    </ngx-mat-select-search>
                                                </mat-option>
                                                <mat-option
                                                    *ngFor="let unit of getNumeratorSearchUtil(i).filteredEntities | async"
                                                    [value]="unit.id">
                                                    <span class="d-flex justify-content-between">
                                                        {{ unit.name }}
                                                        <span>{{ unit.uomCode }}</span>
                                                    </span>
                                                </mat-option>
                                            </mat-select>
                                            <mat-error
                                                *ngIf="errorHandlingFA(formGroup, 'numeratorUnitID', 'required')">
                                                {{ FormErrorEnum.REQUIRED }}
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-sm-4">
                                        <mat-form-field class="matFieldWidth100"
                                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                            <mat-label class="formLabel"> Select denominator unit </mat-label>
                                            <mat-select formControlName="denominatorUnitID">
                                                <mat-option>
                                                    <ngx-mat-select-search
                                                        [formControl]="getDenominatorSearchUtil(i).filterFC"
                                                        placeholderLabel="Search by unit name"
                                                        noEntriesFoundLabel="No unit found with such name.">
                                                    </ngx-mat-select-search>
                                                </mat-option>
                                                <mat-option
                                                    *ngFor="let unit of getDenominatorSearchUtil(i).filteredEntities | async"
                                                    [value]="unit.id">
                                                    <span class="d-flex justify-content-between">
                                                        {{ unit.name }}
                                                        <span>{{ unit.uomCode }}</span>
                                                    </span>
                                                </mat-option>
                                            </mat-select>
                                            <mat-error
                                                *ngIf="errorHandlingFA(formGroup, 'denominatorUnitID', 'required')">
                                                {{ FormErrorEnum.REQUIRED }}
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                </div>    
                            </div>
                            <div class="col-sm-1 centerAlignVertical p-0 pb-3">
                                <button mat-icon-button class="iconBtn centerAlign" class="text-danger deleteIconHover"
                                    matTooltipPosition="below" matTooltip="Remove gas" matRipple
                                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER"
                                    (click)="removeGasFromArray(i);">
                                    <span class="material-symbols-outlined icon">
                                        delete
                                    </span>
                                </button>
                            </div>
                        </div>
                    <!-- </div> -->
                </ng-container>
            </ng-container>
        </ng-container>
    </form>

    <mat-error class="customError" *ngIf="showError()">
        Please add atleast one gas
    </mat-error>
</mat-card>