<div mat-dialog-title>
    <strong class="dialogTitle">
        {{ baseYearType }} base year emission confirmation- {{ confirmationYear }}
    </strong>
    <button mat-icon-button mat-dialog-close cdkFocusInitial class="float-end matDialogClose" matTooltip="Close"
        matTooltipPosition="before">
        <span class="material-symbols-outlined">
            close
        </span>
    </button>
</div>
<div class="matDialogContent" mat-dialog-content>
    <form [formGroup]="emissionConfirmationFG">
        <div class="row mt-4">
            <div class="col-sm-2">
                {{ emissionData['scope']['name'] }}
            </div>
            <div class="col-sm-9">
                <div class="progress cardOverwrite">
                    <div class="progress-bar cardOverwrite" role="progressbar"
                        [style.width.%]="calculateProgressWidth(emissionData)"></div>
                </div>
                <div class="mt-3 text-secondary">
                    {{ emissionData.confirmedActivities }} / {{ emissionData.totalActivities }}
                    activity types marked as confirmed
                </div>
            </div>
        </div>
        <div class="row mt-2 tablePadding" formArrayName="emissions">
            <div class="col-sm-7"></div>
            <div class="col-sm-5">
                {{ consolidationApproach }}
            </div>
            <table mat-table [dataSource]="activityData">
                <ng-container matColumnDef="activityType">
                    <th class="columnWidth1" mat-header-cell *matHeaderCellDef> Activity Type
                    </th>
                    <td class="columnWidth1 ps-4" mat-cell *matCellDef="let row">
                        {{ row['name'] }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="MTCO2e">
                    <th class="columnWidth2 text-end pe-2" mat-header-cell *matHeaderCellDef> Emission ({{ unit['keyID']
                        }})
                        <ng-container *ngIf="!useTSC">
                            <a mat-icon-button matTooltip="Edit" matTooltipPosition="above"
                                (click)="isMTCO2eEditClicked()">
                                <span class="material-symbols-outlined updateIconHover fs-5">
                                    edit
                                </span>
                            </a>
                        </ng-container>
                    </th>
                    <td class="columnWidth2 text-end pe-3" mat-cell *matCellDef="let row; let i = index"
                        [formGroupName]="i">
                        <ng-container *ngIf="!isMTCO2eEditable; else editField">
                            <span [matTooltip]="row['emission']?.emission" matTooltipPosition="above"
                                matTooltipClass="nameTooltip">
                                {{ getEmissionValue(row,'emission') != null ? getEmissionValue(row,'emission') :
                                COMMON_CONSTANT.HYPHEN }}
                            </span>
                        </ng-container>
                        <ng-template #editField>
                            <mat-form-field class="matFieldWidth100"
                                [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                <input matInput placeholder="Enter emission value" type="number" [min]="0"
                                    formControlName="emission" />
                            </mat-form-field>
                            <mat-error *ngIf="errorHandling(i, 'emission', 'min')">
                                Emission value cannot be negative
                            </mat-error>
                        </ng-template>
                    </td>
                </ng-container>

                <ng-container matColumnDef="biogenicMTCO2e">
                    <th class="columnWidth2 text-end pe-2" mat-header-cell *matHeaderCellDef>Biogenic emission ({{
                        unit['keyID'] }})
                        <ng-container *ngIf="!useTSC">
                            <a mat-icon-button matTooltip="Edit" matTooltipPosition="above"
                                (click)="isMTCO2eEditClicked()">
                                <span class="material-symbols-outlined updateIconHover fs-5">
                                    edit
                                </span>
                            </a>
                        </ng-container>
                    </th>
                    <td class="columnWidth2 text-end pe-3" mat-cell *matCellDef="let row; let i = index"
                        [formGroupName]="i">
                        <ng-container *ngIf="!isMTCO2eEditable; else editBioMTCO2e">
                            <span [matTooltip]="row['biogenicEmission']?.emission" matTooltipPosition="above"
                                matTooltipClass="nameTooltip">
                                {{ getEmissionValue(row,'biogenicEmission') != null ?
                                getEmissionValue(row,'biogenicEmission') :
                                COMMON_CONSTANT.HYPHEN }}
                            </span>
                        </ng-container>
                        <ng-template #editBioMTCO2e>
                            <mat-form-field class="matFieldWidth100"
                                [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                <input matInput placeholder="Enter emission value" type="number" [min]="0"
                                    [value]="row['biogenicEmission']?.emission" formControlName="biogenicEmission" />
                            </mat-form-field>
                            <mat-error *ngIf="errorHandling(i, 'biogenicEmission', 'min')">
                                Emission value cannot be negative
                            </mat-error>
                        </ng-template>
                    </td>
                </ng-container>

                <ng-container matColumnDef="confirmation">
                    <th class="columnWidth3 text-center" mat-header-cell *matHeaderCellDef> Mark as confirmed </th>
                    <td class="columnWidth3 text-center" mat-cell *matCellDef="let row; let i = index"
                        [formGroupName]="i">
                        <mat-checkbox formControlName="isConfirmed"
                            [disabled]="(row['emission']?.emission == null || row['biogenicEmission']?.emission == null) && !useTSC "></mat-checkbox>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let task; columns: displayedColumns;"></tr>
            </table>
        </div>
    </form>
</div>

<ng-container *ngIf="!(this.isUpdate && this.useTSC)">
    <div mat-dialog-footer align="end">
        <button type="button" class="btn btn-success" (click)="confirmedEmissions()" [disabled]="!isConfirmedValid">
            {{ DialogEnum.CONFIRM_BTN_LABEL }}
        </button>
    </div>
</ng-container>