<div class="col-sm-12 mt-1 thinnerFF">
    <div class="row">
        <div class="targetSearch pt-2">
                <lib-search-bar-one #searchBar searchBy="Target name" (emitSearch)="searchFn($event)"></lib-search-bar-one>
        </div>
    </div>
</div>
<div class="card main-card cardOverwrite overflowX customScrollBar">
    <button type="button" class="d-none" #refreshBtn>refresh</button>
    <table mat-table [dataSource]="dataSource" matSort matSortActive="name" matSortDirection="desc" matSortDisableClear>

        <ng-container matColumnDef="name">
            <th mat-header-cell mat-sort-header *matHeaderCellDef class="targetNameHeader">
                <div class="d-flex align-items-center">
                    <span class="targetName">Target Name</span>
                </div>
            </th>
            <td mat-cell *matCellDef="let row" routerLink="../../dashboard" [queryParams]="{targetID: row['id']}">
                <div class="content">
                    <div class="row pb-3">
                        <span class="col-sm-6 name">{{row['name']?row['name']:COMMON_CONSTANT.HYPHEN}}</span>
                        <span *ngIf="row['sbtiStatus'] == 'VERIFIED'" class="badge rounded-pill bg-success col-sm-6"
                            align="start">SBTi verified</span>
                        <span *ngIf="row['sbtiStatus'] == 'PENDING'"
                            class="badge rounded-pill bg-warning text-white col-sm-6">Pending SBTi
                            verification</span>
                    </div>
                    <div class="subContent">
                        <div class="row fw-bold" *ngIf="statusValue == CARBON_CONSTANT.INACTIVE_STATUS">
                            {{row['orgSize']?row['orgSize']:COMMON_CONSTANT.HYPHEN}}
                        </div>
                        <div class="row">
                            {{row['termName']?row['termName']:COMMON_CONSTANT.HYPHEN}}
                        </div>
                        <div class="row">
                            {{row['targetMethod']?row['targetMethod']:''}}
                        </div>
                        <div class="row">
                            {{row['scopes']?row['scopes']:COMMON_CONSTANT.HYPHEN}}
                        </div>
                        <div class="row" *ngIf="statusValue == CARBON_CONSTANT.ACTIVE_STATUS">
                            Target year emission : 
                            {{row['targetYearEmission'] != null ?(row['targetYearEmission'] | number: '1.2-2'
                            ):COMMON_CONSTANT.HYPHEN}}
                            {{row['targetYearEmission'] != null ? (row['uomName']?row['uomName']:''):''}}
                        </div>
                        <div class="row" *ngIf="statusValue == CARBON_CONSTANT.ACTIVE_STATUS">
                            Current year emission :
                            {{row['currentYearEmission'] != null ?(row['currentYearEmission'] | number: '1.2-2'
                            ):COMMON_CONSTANT.HYPHEN}}
                            {{row['currentYearEmission'] != null ? (row['uomName']?row['uomName']:''):''}}
                        </div>
                    </div>
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="domain">
            <th mat-header-cell *matHeaderCellDef class="targetDomainHeader">
                <div class="d-flex align-items-center">
                    <span class="targetName">Target Domain</span>
                </div>
            </th>
            <td mat-cell *matCellDef="let row" routerLink="../../dashboard" [queryParams]="{targetID: row['id']}">
                <div class="content">
                    {{row['domain']?row['domain']:COMMON_CONSTANT.HYPHEN}}
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef class="targetTypeHeader">
                <div class="d-flex align-items-center">
                    <span class="targetName">Target Type</span>
                </div>
            </th>
            <td mat-cell *matCellDef="let row" routerLink="../../dashboard" [queryParams]="{targetID: row['id']}">
                <div class="content">
                    {{row['type']?row['type']:COMMON_CONSTANT.HYPHEN}}
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="targetYear">
            <th mat-header-cell mat-sort-header *matHeaderCellDef class="targetYearHeader">
                <div class="d-flex align-items-center">
                    <span class="targetName">Target Year</span>
                </div>
            </th>
            <td mat-cell *matCellDef="let row" routerLink="../../dashboard" [queryParams]="{targetID: row['id']}">
                <div class="content">
                    {{row['targetYear']?row['targetYear']:COMMON_CONSTANT.HYPHEN}}
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="progress" *ngIf="statusValue == CARBON_CONSTANT.ACTIVE_STATUS">
            <th mat-header-cell *matHeaderCellDef class="targetProgressHeader">
                <div class="d-flex align-items-center">
                    <span class="targetName">Target Progress</span>
                </div>
            </th>
            <td mat-cell *matCellDef="let row" class="progressData" routerLink="../../dashboard"
                [queryParams]="{targetID: row['id']}">
                <div class="content row pt-1">
                    <div class="col-sm-6">
                        <span class="text">Current year target reduction</span>
                        <div *ngIf="row['progress']['currentYearTargetReductionPct']" class="subText grey">
                            {{(row['progress']['currentYearTargetReductionPct'] | number: '1.2-2' )}}%
                        </div>
                        <div *ngIf="!row['progress']['currentYearTargetReductionPct']" class="subText grey">
                            {{COMMON_CONSTANT.HYPHEN}}
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <span class="text">Current year achieved reduction</span>
                        <div *ngIf="(row['progress']['currentYearAchievedReductionPct']<row['progress']['currentYearTargetReductionPct']) && row['progress']['currentYearAchievedReductionPct']"
                            class="subText text-danger">
                            {{(convertToAbs(row['progress']['currentYearAchievedReductionPct']) | number: '1.2-2' )}}%
                        </div>
                        <div *ngIf="(row['progress']['currentYearAchievedReductionPct']>=row['progress']['currentYearTargetReductionPct']) && row['progress']['currentYearAchievedReductionPct']"
                            class="subText text-success">
                            {{(convertToAbs(row['progress']['currentYearAchievedReductionPct']) | number: '1.2-2' )}}%
                        </div>
                        <div *ngIf="!row['progress']['currentYearAchievedReductionPct']" class="subText grey">
                            {{COMMON_CONSTANT.HYPHEN}}
                        </div>
                    </div>
                    <div class="col-sm-12 align-items-center" class="charts">
                        <div class="echart" echarts [options]="drawChart(row)"></div>
                    </div>
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="targetActionsHeader">
            </th>
            <td mat-cell *matCellDef="let row">
                <div class="btn-group content align-items-center float-end" ngbDropdown placement="left-top">
                    <button type="button" ngbDropdownToggle class="dropdown-after dropdownAfter btn">
                        <fa-icon [icon]="faEllipsisV"></fa-icon>
                    </button>
                    <div ngbDropdownMenu>
                        <button *ngIf="statusValue == CARBON_CONSTANT.ACTIVE_STATUS" class="dropdown-item" (click)="updateTarget(row)">Edit</button>
                        <button *ngIf="statusValue == CARBON_CONSTANT.ACTIVE_STATUS" class="btn btn-outline-danger rounded-0 dropdown-item" (click)="inactiveConfirmation(row['id'])">Mark as inactive</button>
                        <button class="btn btn-outline-danger rounded-0 dropdown-item"
                            (click)="deleteConfirmation(row['id'])">
                            {{ ButtonLabelEnum.DELETE_BTN_LABEL }}
                        </button>
                    </div>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumn"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumn;" class="data-row"></tr>

        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell text-center" [attr.colspan]="displayedColumn.length">
                {{ TABLE_CONSTANT.TABLE_NO_DATA }}
            </td>
        </tr>
    </table>
</div>

<mat-paginator class="roundedBorder" #paginator [length]="resultLength"
    [pageSizeOptions]="TABLE_CONSTANT.PAGE_SIZE_OPTION" [pageSize]="TABLE_CONSTANT.DEFAULT_PAGE_SIZE"
    showFirstLastButtons>
</mat-paginator>