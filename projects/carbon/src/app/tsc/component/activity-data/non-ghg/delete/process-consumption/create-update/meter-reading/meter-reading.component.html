<div class="card main-card cardOverwrite h100 pt-3 ms-2">
    <div class="overflowX h100">
        <form [formGroup]="activityDataFG">
            <table>
                <thead class="theadStickyOverwrite">
                    <tr>
                        <th class="fw-normal ps-4" *ngIf="isSource">Supplier </th>
                        <th class="fw-normal ps-4">Accounting period </th>
                        <th class="fw-normal ps-4">Opening Meter Reading </th>
                        <th class="fw-normal ps-4">Closing Meter Reading </th>
                        <th class="fw-normal ps-4">Select Unit </th>
                        <th class="fw-normal ps-4">Bill  </th>
                    </tr>
                </thead>
                <tbody formArrayName="activityDataDetails">
                    <tr *ngFor="let activityData of activityDataFA.controls; let i = index">
                        <ng-container [formGroupName]="i">
                            <td class="ps-4 pt-2" *ngIf="isSource">
                                {{dataSource.length > 0 ? getProductName(dataSource[i].id) : sourceName}}
                            </td>

                            <td class="ps-4 pt-2">
                                <lib-date-input class="cursorPointer" #customDateInput (emitFilter)="dateInpChange(i)"
                                    [materialFieldWidthInp]="true"
                                    [materialFormFieldAppearanceInp]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE"
                                    [isMandatoryFieldInp]="true" [dateInputTypeInp]="dateInputTypeEnum.CUSTOM_INPUT"
                                    [labelInp]="'Accounting Period'"></lib-date-input>
                            </td>

                            <td class="ps-4 pt-2">
                                <mat-form-field class="matFieldWidth100 col-sm-4"
                                    [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                    <mat-label class="formLabel">Opening meter reading</mat-label>
                                    <input matInput type="number" formControlName="openingMeterReading"
                                        placeholder="0.00" min="0">

                                    <mat-error *ngIf="activityData.get('openingMeterReading').hasError('min')">
                                        Amount of opening meter reading can't be negative.
                                    </mat-error>

                                    <mat-error *ngIf="activityData.get('openingMeterReading').hasError('required')">
                                        {{ formErrorEnum.REQUIRED }}
                                    </mat-error>
                                </mat-form-field>
                            </td>

                            <td class="ps-4 pt-2">
                                <mat-form-field class="matFieldWidth100 col-sm-4"
                                    [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                    <mat-label class="formLabel">Closing meter reading</mat-label>
                                    <input matInput type="number" formControlName="closingMeterReading"
                                        placeholder="0.00" min="0">

                                    <mat-error *ngIf="activityData.get('closingMeterReading').hasError('min')">
                                        Amount of closing meter reading can't be negative.
                                    </mat-error>

                                    <mat-error *ngIf="activityData.get('closingMeterReading').hasError('required')">
                                        {{ formErrorEnum.REQUIRED }}
                                    </mat-error>
                                </mat-form-field>
                            </td>

                            <td class="ps-4 pt-2">
                                <mat-form-field class="matFieldWidth100 col-sm-4"
                                    [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                                    <mat-label class="formLabel">Select unit</mat-label>
                                    <mat-select formControlName="meterReadingUnitID" [disabled]="isReadOnly">
                                        <mat-option *ngFor="let unit of allUnit" [value]="unit.id">
                                            <span class="d-flex justify-content-between">
                                                {{ unit.name }} - {{unit.uomCode}}
                                            </span>
                                        </mat-option>
                                    </mat-select>
                                    <mat-error>
                                        {{ formErrorEnum.REQUIRED }}
                                    </mat-error>
                                </mat-form-field>
                            </td>

                            <td class="ps-4 pt-2 pe-4">
                                <div class="col-sm-4" *ngIf="activityDataFG.get('activityDataID').value == null">
                                    <div class="row" [ngClass]="{'d-none': !noBillFileAvailable}">
                                        <div class="d-flex justify-content-between">
                                            <button class="button btn btn-light uploadBtn" type="button" (click)="uploadDoc()">
                                                Attach bill
                                            </button>
                                            <input #fileInput type="file" accept="application/pdf" class="d-none"
                                                (change)="fileUpload($event)">
                                        </div>
                                    </div>
                                    <div class="row border rounded m-1 p-2" [ngClass]="{'d-none': noBillFileAvailable}">
                                        <div class="col-sm-3 docIcon" matSuffix mat-icon-button mat-raised-button
                                            [matTooltip]="billFileName" matTooltipPosition="below">
                                            <img height="40px" src="assets/images/default-doc.ico" alt="noc document preview">
                                        </div>
                                        <div class="col-sm-4 centerAlignVertical uploadDocumentFont">
                                            {{ billFileName }}
                                        </div>
                                        <div class="col-sm-2 ms-2">
                                            <button type="button" class="btn" mat-icon-button (click)="removeFile()">
                                                <span class="material-symbols-outlined text-danger">
                                                    delete
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4 ms-4" *ngIf="activityDataFG.get('docID').value != null">
                                    <a href="{{activityDataFG.get('docPath').value}}" target="_blank">View bill</a>
                                </div>
                            </td>
                        </ng-container>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>
</div>