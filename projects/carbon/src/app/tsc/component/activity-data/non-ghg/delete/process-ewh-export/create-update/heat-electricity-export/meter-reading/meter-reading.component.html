<mat-card class="cardOverwrite">
    <form [formGroup]="activityDataFG">
        <ng-container formArrayName="activityData">
            <ng-container *ngFor="let formGroup of activityDataFA.controls; let index = index;">
                <ng-container [formGroupName]="index">
                    <lib-date-input class="cursorPointer" #customDateInput
                        (emitFilter)="dateInpChange(formGroup, index)" [materialFieldWidthInp]="true"
                        [materialFormFieldAppearanceInp]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE"
                        [isMandatoryFieldInp]="true" [dateInputTypeInp]="DateInputTypeEnum.CUSTOM_INPUT"
                        [labelInp]="'Accounting Period'">
                    </lib-date-input>
                    <div>
                        <mat-form-field class="col-sm-2 pe-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Opening meter reading</mat-label>
                            <input matInput type="number" formControlName="openingMeterReading" placeholder="0.00"
                                min="0">
                            <mat-error *ngIf="errorHandling(formGroup, 'openingMeterReading', 'min')">
                                Odometer reading can't be negative.
                            </mat-error>
                            <mat-error *ngIf="errorHandling(formGroup, 'openingMeterReading', 'required')">
                                This field is equired
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="col-sm-2 pe-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Closing meter reading</mat-label>
                            <input matInput type="number" formControlName="closingMeterReading" placeholder="0.00"
                                min="0">
                            <mat-error *ngIf="errorHandling(formGroup, 'closingMeterReading', 'min')">
                                Odometer reading can't be negative.
                            </mat-error>
                            <mat-error *ngIf="errorHandling(formGroup, 'closingMeterReading', 'required')">
                                This field is equired
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="col-sm-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Select unit</mat-label>
                            <mat-select formControlName="meterUnitID">
                                <mat-option>
                                    <ngx-mat-select-search [formControl]="fuelUnitTypeSearchUtil.filterFC"
                                        placeholderLabel="Search by unit name" noEntriesFoundLabel="No matching found.">
                                    </ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let unit of fuelUnitTypeSearchUtil.filteredEntities| async"
                                    [value]="unit.id">
                                    {{ unit.name }} -
                                    {{unit.uomCode}}
                                </mat-option>
                            </mat-select>
                            <mat-error>
                                Meter unit is required.
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div>
                        <mat-form-field class="col-sm-2 pe-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Net calorific value(NCV)</mat-label>
                            <input class="formPlaceholder" matInput min="0" type="number" matInput placeholder=""
                                type="number" formControlName="netCalorificValue" />
                            <mat-error *ngIf="errorHandling(formGroup, 'netCalorificValue', 'required')">
                                Net calorific value required and greater than 0
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class=" col-sm-2 pe-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Select Numerator</mat-label>
                            <mat-select formControlName="ncvNumeratorUnitID">
                                <mat-option>
                                    <ngx-mat-select-search [formControl]="energyUnitListSearch.filterFC"
                                        placeholderLabel="Search by unit name" noEntriesFoundLabel="No matching found.">
                                    </ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let unit of energyUnitListSearch.filteredEntities| async"
                                    [value]="unit.id">
                                    {{ unit.name }} -
                                    {{unit.uomCode}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="errorHandling(formGroup, 'ncvNumeratorUnitID', 'required')">
                                Numerator is a required feild
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class=" col-sm-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Select Denomenator</mat-label>
                            <mat-select formControlName="ncvDenominatorUnitID">
                                <mat-option>
                                    <ngx-mat-select-search [formControl]="fuelUnitTypeSearchUtil.filterFC"
                                        placeholderLabel="Search by unit name" noEntriesFoundLabel="No matching found.">
                                    </ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let unit of fuelUnitTypeSearchUtil.filteredEntities| async"
                                    [value]="unit.id">
                                    {{ unit.name }} -
                                    {{unit.uomCode}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="errorHandling(formGroup, 'ncvDenominatorUnitID', 'required')">
                                Denomenator is a required feild
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <mat-form-field class="col-sm-2 pe-2"
                        [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                        <mat-label class="formLabel">Biomass Used</mat-label>
                        <input class="formPlaceholder" matInput min="0" max="100" type="number" placeholder=""
                            formControlName="biomassPct" />
                        <span matSuffix class="matSuffix ms-2 pb-5">%</span>
                        <mat-error *ngIf="errorHandling(formGroup, 'biomassPct', 'required')">
                            biomass is required
                        </mat-error>
                    </mat-form-field>

                    <div>
                        <mat-form-field class="col-sm-2 pe-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Amount of {{source}} exported</mat-label>
                            <input matInput type="number" formControlName="energyExported"
                                placeholder="0.00" min="0">
                            <mat-error *ngIf="errorHandling(formGroup, 'energyExported', 'min')">
                                Odometer reading can't be negative.
                            </mat-error>
                            <mat-error *ngIf="errorHandling(formGroup, 'energyExported', 'required')">
                                This field is equired
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="col-sm-2"
                            [appearance]="MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE">
                            <mat-label class="formLabel">Select unit</mat-label>
                            <mat-select formControlName="energyExportedUnitID">
                                <mat-option>
                                    <ngx-mat-select-search [formControl]="energyUnitListSearch.filterFC"
                                        placeholderLabel="Search by unit name" noEntriesFoundLabel="No matching found.">
                                    </ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let unit of energyUnitListSearch.filteredEntities| async"
                                    [value]="unit.id">
                                    {{ unit.name }} -
                                    {{unit.uomCode}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="errorHandling(formGroup, 'energyExportedUnitID', 'required')">
                                This field is equired
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="col-sm-4" *ngIf="formGroup.get('activityDataID').value == null">
                        <div class="row" [ngClass]="{'d-none': !noBillFileAvailable}">
                            <div class="d-flex justify-content-between">
                                <button class="button btn btn-light uploadBtn" type="button" (click)="uploadDoc()">
                                    Attach proof
                                </button>
                                <input #fileInput type="file" accept="application/pdf" class="d-none"
                                    (change)="fileUpload($event)">
                            </div>
                        </div>
                        <div class="border border-2 rounded" [ngClass]="{'d-none': noBillFileAvailable}">
                            <div class="col-sm-3 docIcon" matSuffix mat-icon-button mat-raised-button
                                [matTooltip]="billFileName" matTooltipPosition="below">
                                <img height="40px" src="assets/images/default-doc.ico" alt="noc document preview">
                            </div>
                            <div class="col-sm-4 centerAlignVertical uploadDocumentFont">
                                {{ billFileName }}
                            </div>
                            <div class="col-sm-2 ms-2">
                                <button type="button" class="btn" mat-icon-button (click)="removeFile()">
                                    <span class="material-symbols-outlined text-danger">
                                        delete
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2" *ngIf="formGroup.get('docID').value != null">
                        <a href="{{formGroup.get('docPath').value}}" target="_blank">View bill</a>
                    </div>

                </ng-container>
            </ng-container>
        </ng-container>
    </form>
</mat-card>