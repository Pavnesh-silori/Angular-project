<div class="card main-card cardOverwrite overflowX h100">
    <div class="headerContainer">
        <div class="headerLeftContainer">
            <div class="pageTitle">
                Scope 3 by spend based method
                <button type="button" class="btn" #tooltip="matTooltip" matTooltipPosition="right"
                    matTooltip="This method includes 5 activity types (Purchased Goods and Services, Capital goods, Upstream Transportation and Distribution, Downstream Transportation and Distribution and Business travel).">
                    <span class="material-symbols-outlined">
                        info
                    </span>
                </button>
            </div>
            <div class="pageSubtitle">
                Records of financial transactions used to calculate scope 3 emissions using the spend based method.
            </div>
        </div>
        <div class="headerRightContainerInner">
            <button type="button" class="button ms-4 btn btn-primary"
                routerLink="/activity-data/spend-based-method/import-history" [queryParams]="{methodID: this.methodID}">
                View all imports
            </button>
            <button type="button" class="button ms-1 btn btn-success"
                [routerLink]="['/activity-data/spend-based-method/import-data']"
                [queryParams]="{methodID: this.methodID}">
                New import
            </button>
            <div class="ms-1 btn-group" ngbDropdown placement="bottom-right">
                <button type="button" ngbDropdownToggle class="btn btn-success">
                </button>
                <div ngbDropdownMenu>
                    <button class="dropdown-item" (click)="createImportRequestDialog(this.methodID)">
                        Create import request
                    </button>
                </div>
            </div>
        </div>
    </div>

    <button type="button" class="d-none" #refreshBtn>refresh</button>
    <div>
        <div class="float-end px-4">
            <lib-search-bar-one class="me-3" #searchBar [searchBy]="'supplier'"
                (emitSearch)="searchFn($event)"></lib-search-bar-one>
        </div>
    </div>

    <div class="ms-3 me-3">
        <lib-date-filter #filterChild></lib-date-filter>
    </div>

    <table mat-table [dataSource]="dataSource" #sort="matSort" matSort matSortActive="recordID" matSortDirection="desc"
        matSortDisableClear>

        <ng-container matColumnDef="recordID">
            <th class="ps-3 recordID justify-content-start" mat-header-cell *matHeaderCellDef mat-sort-header> Record ID
            </th>
            <td class="ps-3 justify-content-start" mat-cell *matCellDef="let row">
                <ng-container
                    *ngIf="row.calculationErrorReason && row.calculationErrorReason.length !== 0; else noError">
                    <img matTooltipPosition="above" matTooltip="{{ row.calculationErrorReason }}" class="ps-2 img"
                        src="/assets/images/icons8-calculation-error-100.png" />
                    {{row.recordID}}
                </ng-container>
                <ng-template #noError>
                    <span class="noError">
                        {{row.recordID}}
                    </span>
                </ng-template>
            </td>
        </ng-container>

        <ng-container matColumnDef="transactionDate">
            <th mat-header-cell class="ps-1 transactionDate" *matHeaderCellDef>Accounting period</th>
            <td class="p-3" mat-cell *matCellDef="let row">
                {{ row.transactionDate ? (row.transactionDate | date:'dd-MMM-yyyy') : COMMON_CONSTANT.HYPHEN }}
            </td>
        </ng-container>

        <ng-container matColumnDef="account">
            <th class="ps-3 account text-center" mat-header-cell *matHeaderCellDef>
                <div class="row">
                    <funnel-filter #accountSelect header="Account" type="multi" [entityList]="accountList" value="name"
                        view="name" [selectFC]="accountFC" [active]="accountFlag" selectAllLabel="All account"
                        [resetFlag]="accountFlag" (multi)="accountFlag = true">
                    </funnel-filter>
                </div>
            </th>
            <td class="px-3" mat-cell *matCellDef="let row" [matTooltip]="row.account?.length>17? row.account: ''"
                matTooltipPosition="above" matTooltipClass="nameTooltip">
                {{ (row.account ? row.account : COMMON_CONSTANT.HYPHEN) | dotdotdot:17}}
            </td>
        </ng-container>

        <ng-container matColumnDef="supplier">
            <th class="ps-2 supplier" mat-header-cell *matHeaderCellDef> Supplier </th>
            <td class="px-2" mat-cell *matCellDef="let row"
                [matTooltip]="row['supplier']?.length>25? row['supplier']: ''" matTooltipPosition="above"
                matTooltipClass="nameTooltip">
                {{ (row.supplier ? row.supplier : COMMON_CONSTANT.HYPHEN) | dotdotdot:25}}
            </td>
        </ng-container>

        <ng-container matColumnDef="amount">
            <th class="ps-3 amount" mat-header-cell *matHeaderCellDef> Amount </th>
            <td class="px-3 " mat-cell *matCellDef="let row">
                {{ (row['currencySymbol'] ? row['currencySymbol'] : COMMON_CONSTANT.HYPHEN) + ' '+(row['amount'] ?
                (row.amount | number: '1.2-2') : COMMON_CONSTANT.HYPHEN) }}
            </td>
        </ng-container>


        <ng-container matColumnDef="emissions">
            <th class="emissions pe-4" mat-header-cell *matHeaderCellDef> Emissions <span
                    class="ps-1">(tCO<sub>2</sub>e)</span> </th>
            <td class="emissions pe-4" mat-cell [matTooltip]="row.emission" matTooltipPosition="above"
                *matCellDef="let row">
                {{ (row.emission ? (row.emission| number: '1.2-2') : COMMON_CONSTANT.HYPHEN) }}
            </td>
        </ng-container>

        <ng-container matColumnDef="category">
            <th class="ps-3 category" mat-header-cell *matHeaderCellDef> USEEIO Category </th>
            <td class="px-3 " mat-cell *matCellDef="let row"
                [matTooltip]="row['categoryName']?.length>20? row['categoryName']: ''" matTooltipPosition="above"
                matTooltipClass="nameTooltip">
                {{ (row.categoryName ? row.categoryName : COMMON_CONSTANT.HYPHEN) | dotdotdot:20}}
            </td>
        </ng-container>

        <ng-container matColumnDef="activityType">
            <th class="ps-2 activity " mat-header-cell *matHeaderCellDef>
                <funnel-filter #activityType header="Activity type" type="mono" [entityList]="activityTypeList"
                    value="value" view="value" [selectFC]="activityTypeFC" [active]="activityTypeFlag"
                    [showSearchBar]="false" [resetFlag]="activityTypeFlag" (mono)="activityTypeFlag = true;">
                </funnel-filter>
            </th>
            <td class="px-2 " mat-cell *matCellDef="let row"
                [matTooltip]="row['activityType']?.length>20? row['activityType']: ''" matTooltipPosition="above"
                matTooltipClass="nameTooltip">
                {{ (row.activityType ? row.activityType : COMMON_CONSTANT.HYPHEN) | dotdotdot:20}}
            </td>
        </ng-container>

        <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row">
                <div class="btn-group" ngbDropdown placement="left-top">
                    <button type="button" ngbDropdownToggle class="dropdown-after dropdownAfter btn">
                        <fa-icon [icon]="faEllipsisV" class="">
                        </fa-icon>
                    </button>
                    <div ngbDropdownMenu>
                        <button class="dropdown-item" *ngIf="row.categorizePermission == CARBON_CONSTANT.YES"
                            (click)="updateCategorizedRecordsDialog(row.activityDataID)">
                            Edit
                        </button>
                        <button class="btn btn-outline-danger rounded-0 dropdown-item"
                            (click)="deleteImportRecord(row.activityDataID)">
                            Delete
                        </button>
                    </div>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let task; columns: displayedColumns;">
        </tr>

        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">
                {{ TABLE_CONSTANT.TABLE_NO_DATA }}
            </td>
        </tr>
    </table>

    <mat-paginator class="roundedBorder" showFirstLastButtons [length]="resultLength"
        [pageSize]="TABLE_CONSTANT.DEFAULT_PAGE_SIZE" [pageSizeOptions]="TABLE_CONSTANT.PAGE_SIZE_OPTION">
    </mat-paginator>
</div>