<div class="card main-card cardOverwrite h100">
	<div class="headerContainer">
		<div class="headerLeftContainer">
			<div class="pageTitle">{{activity.name}}</div>
			<div class="pageSubtitle">Records of third-party disposal and treatment of waste generated in your
				organizationâ€™s owned or controlled operations.</div>
		</div>
		<div class="headerRightContainer">
			<div class="headerRightContainerInner">
				<lib-search-bar-one class="me-3" #searchBar [searchBy]="'name'"
					(emitSearch)="searchFn($event)"></lib-search-bar-one>

				<button class="btn btn-sm btn-light refreshBtn centerAlign me-3 py-1" #refreshBtn matRipple
					[matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
					[matTooltip]="'Refresh'">
					<span class="material-symbols-outlined">
						refresh
					</span>
				</button>

                <div class="btn-group" ngbDropdown placement="bottom-right" matTooltipPosition="below"
                [matTooltip]="ButtonTooltipEnum.MORE">
                <button type="button" ngbDropdownToggle class="hideDropdownIcon btn btn-sm btn-success"><fa-icon
                        [icon]="faPlus"></fa-icon>&nbsp;&nbsp;Record
                        <fa-icon [icon]="faCaretDown" class="ms-2"></fa-icon>
                </button>
                <div ngbDropdownMenu>
                    <button class="dropdown-item" matRipple [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER"
                    (click)="routeToAdHoc()">
                        Add New Record
                    </button>
                    <button class="dropdown-item" matRipple [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" (click)="showActivityConfigSelection()">
                        Use Activity Form
                    </button>
                </div>
            </div>
			</div>
		</div>
	</div>

	<div class="ms-3 me-3">
        <lib-date-filter [ngClass]="{'d-none': !dateFlag}" #filterChild></lib-date-filter>
	</div>

	<div class="ms-3 mb-4">
		<button matRipple [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" class="btn btn-link float-end me-2"
			(click)="refreshFilter()" [disabled]="wasteFlag == false && wasteTreatmentFlag == false">
			<span class="material-symbols-outlined fs-6">
				filter_list_off
			</span> Reset
			Filters </button>
	</div>

	<div class="overflowX customScrollBar">
		<table mat-table [dataSource]="dataSource" matSort matSortActive="recordID" matSortDirection="desc"
			matSortDisableClear>

			<ng-container matColumnDef="recordID">
				<th mat-header-cell class="recordID" *matHeaderCellDef mat-sort-header disableClear> Record ID </th>
				<td mat-cell *matCellDef="let row">
					<ng-container
						*ngIf="row.calculationErrorReason && row.calculationErrorReason.length !== 0; else noError">
						<img matTooltipPosition="above" matTooltip="{{ row.calculationErrorReason }}" class="ps-2 img"
							src="/assets/images/icons8-calculation-error-100.png" />
						{{row.recordID}}
					</ng-container>
					<ng-template #noError>
						<span class="noError">
							{{row.recordID}}
						</span>
					</ng-template>
				</td>
			</ng-container>

			<ng-container matColumnDef="startDate">
				<th mat-header-cell class="accountingPeriod text-align" *matHeaderCellDef mat-sort-header disableClear>
					Accounting period
				</th>
				<td mat-cell *matCellDef="let row">
					{{ row.startDate | date:'dd-MMM-yyyy'}} - {{ row.endDate | date:'dd-MMM-yyyy'}}
				</td>
			</ng-container>

			<ng-container matColumnDef="supplier">
				<th class="supplier ps-5" mat-header-cell *matHeaderCellDef> Supplier </th>
				<td class="ps-5" mat-cell *matCellDef="let element"> {{element?.supplier? element?.supplier:
					COMMON_CONSTANT.HYPHEN}} </td>
			</ng-container>

			<ng-container matColumnDef="wasteType">
				<th mat-header-cell class="" *matHeaderCellDef>
					<div class="element">
						<funnel-filter #wasteType header="Waste type" type="mono" [entityList]="wasteTypeList"
							value="keyID" view="name" [selectFC]="wasteFC" [searchBy]="name" [active]="wasteFlag"
							selectAllLabel="Select all" (mono)="wasteFlag = true;">
						</funnel-filter>
					</div>
				</th>
				<td class="ps-1 wasteType" mat-cell *matCellDef="let element">
					{{ element?.wasteTypeName? element?.wasteTypeName: COMMON_CONSTANT.HYPHEN}}
				</td>
			</ng-container>

			<ng-container matColumnDef="wasteTreatmentMethod">
				<th mat-header-cell class="ps-1 wasteTreatmentMethod" *matHeaderCellDef>
					<div class="element">
						<funnel-filter #wasteTreatment header="Waste treatment method" type="mono" [entityList]="wasteTreatemntTypeList"
							value="keyID" view="name" [selectFC]="wasteTreatmentFC" [searchBy]="name" [active]="wasteTreatmentFlag"
							selectAllLabel="Select all" (mono)="wasteTreatmentFlag = true;">
						</funnel-filter>
					</div>
				</th>
				<td class="ps-1 wasteTreatmentMethod" mat-cell *matCellDef="let row" #tooltip="matTooltip"
					matTooltipPosition="above" matTooltipHideDelay="0"
					[matTooltip]="row.wasteTreatmentName?.length > 12 ? row.wasteTreatmentName : ''" matTooltip
					Class="nameTooltip">
					{{ row.wasteTreatmentName?.length > 12 ? row.wasteTreatmentName.slice(0, 18) + '...' :
					row.wasteTreatmentName }}
				</td>
			</ng-container>

			<ng-container matColumnDef="wasteGenerated">
				<th class="ps-3 wasteGenerated" mat-header-cell *matHeaderCellDef> Quantity of waste treated </th>
				<td class="ps-3 wasteGenerated" mat-cell *matCellDef="let element"> <span matTooltipPosition="above"
						[matTooltip]="element?.wasteTreated+ element?.wasteTreatedUnit">{{element?.wasteTreated |
						number:'1.0-2'}}
						{{element?.wasteTreatedUnit}}</span>
				</td>
			</ng-container>

			<ng-container matColumnDef="emission">
				<th class="ps-5 emission" mat-header-cell *matHeaderCellDef mat-sort-header disableClear>
					Emissions<span class="ps-1">(tCO<sub>2</sub>e)</span>
				</th>
				<td class="emission pe-5" mat-cell *matCellDef="let element"><span matTooltipPosition="above"
						[matTooltip]="element?.emission">
						{{element?.emission ? (element?.emission| number:'1.0-2'):
						COMMON_CONSTANT.HYPHEN }}
					</span>
				</td>
			</ng-container>

            <ng-container matColumnDef="doc">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let row">
                    <a href="{{row.docPath}}" target="_blank" [ngClass]="{'d-none': !row.docPath}"
                        [matTooltip]="row.docName" matTooltipPosition="above" matTooltipClass="infoTooltip">
                        <span class="material-symbols-outlined cursorPointer centerAlign"> description </span>
                    </a>
                </td>
            </ng-container>

            <ng-container matColumnDef="option">
                <th mat-header-cell class="option" *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let row">
                    <div class="centerAlignVertical">
                        <ng-container *ngTemplateOutlet="icon; 
                        context: {
                            icon: 'edit',
                            tooltip: ButtonTooltipEnum.UPDATE,
                            iconClass: 'text-primary updateIconHover',
                            function: routeToADUpdate,
                            functionParameter: [row]
                        }">
                        </ng-container>
                    </div>
                </td>
            </ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
			<tr class="mat-row" *matNoDataRow>
				<td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">
					{{ TABLE_CONSTANT.TABLE_NO_DATA}}
				</td>
			</tr>
		</table>
	</div>
	<mat-paginator class="roundedBorder" #paginator [length]="resultLength"
		[pageSizeOptions]="TABLE_CONSTANT['pageSizeOption']" [pageSize]="TABLE_CONSTANT['pageSize']"
		showFirstLastButtons>
	</mat-paginator>
</div>

<ng-template #icon let-icon="icon" let-tooltip="tooltip" let-iconClass="iconClass" let-function="function"
    let-functionParameter="functionParameter">
    <button class="iconBtn centerAlign" [class]="iconClass" matTooltipPosition="below" [matTooltip]="tooltip" matRipple
        [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" (click)="handleClick(function, functionParameter)">
        <span class="material-symbols-outlined icon">
            {{ icon }}
        </span>
    </button>
</ng-template>