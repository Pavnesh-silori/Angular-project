<div class="card cardOverwrite overFlowX">
    <div class="headerContainer">
        <div class="headerRightContainer">
            <div class="headerRightContainerInner">
                <lib-search-bar-one class="me-3" #searchBar [searchBy]="'Product name'"
                    (emitSearch)="searchFn($event)"></lib-search-bar-one>

                <button class="btn btn-sm btn-light refreshBtn centerAlign me-3 py-1" #refreshBtn matRipple
                    [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER" matTooltipPosition="below"
                    [matTooltip]="refreshBtnTooltip">
                    <span class="material-symbols-outlined">
                        refresh
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- <div class="bulkActionContainer centerAlignVertical"
        [ngClass]="{'invisible' : bulkActionArr.length == 0 || bulkActionArr.length == 1 }">
        <ng-container *ngTemplateOutlet="icon; context: {
            icon: 'delete',
            tooltip: 'Delete',
            class: 'text-danger cursorPointer',
            function: bulkDelete,
            functionParameter: bulkActionArr
        }"></ng-container>

        <ng-container *ngIf="source == CbamConstant.ONGOING_RUN">
            <ng-container *ngTemplateOutlet="icon; context: {
                icon: 'lock',
                tooltip: 'Lock products',
                class: 'cursorPointer',
                function: lockFunc,
                functionParameter: bulkActionArr
            }"></ng-container>
        </ng-container>

        <ng-container *ngIf="source == CbamConstant.LEDGER">
            <ng-container *ngTemplateOutlet="icon; context: {
                icon: 'lock_open',
                tooltip: 'Unlock products',
                class: 'cursorPointer',
                function: unlockDialog,
                functionParameter: bulkActionArr
            }"></ng-container>
        </ng-container>
    </div> -->

    <table mat-table [dataSource]="dataSource" matSort matSortActive="id" matSortDisableClear matSortDirection="desc">
        <!-- <ng-container matColumnDef="isChecked">

            <th mat-header-cell *matHeaderCellDef class="isChecked">
                <mat-checkbox [formControl]="checkAll" (change)="$event ? selectAll() : null"
                    [checked]="checkAll.value">
                </mat-checkbox>
            </th>
            <td class="cursorPointer" class="px-3" mat-cell *matCellDef="let row;" class="text-start">
                <mat-checkbox (change)="$event ? manualSelect(row.runID, row.runStatus,  $event.checked,dataSource):null"
                    [checked]="selection.isSelected(row['id'])"></mat-checkbox>
            </td>
        </ng-container> -->

        <ng-container matColumnDef="id">
            <th class="columnWidth" mat-header-cell *matHeaderCellDef mat-sort-header disableClear> Run ID </th>
            <td [ngClass]="{'cursorPointer' : source == CbamConstant.ONGOING_RUN}" (click)="editRun(row)" mat-cell *matCellDef="let row">{{row.runID?
                row.runID:COMMON_CONSTANT.HYPHEN}}</td>
        </ng-container>

        <ng-container matColumnDef="productCnCode">
            <th class="columnWidth" mat-header-cell *matHeaderCellDef mat-sort-header disableClear> CN code</th>
            <td [ngClass]="{'cursorPointer' : source == CbamConstant.ONGOING_RUN}" (click)="editRun(row)" mat-cell *matCellDef="let row"> {{row.productCnCode?
                row.productCnCode:COMMON_CONSTANT.HYPHEN}}</td>
        </ng-container>

        <ng-container matColumnDef="productName">
            <th class="columnWidth" mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Product Name </th>
            <td [ngClass]="{'cursorPointer' : source == CbamConstant.ONGOING_RUN}" (click)="editRun(row)" mat-cell *matCellDef="let row"> <span
                    matTooltipPosition="above" matTooltip={{row.productName}}>{{row.productName? (row.productName|
                    dotdotdot:13):COMMON_CONSTANT.HYPHEN}}</span></td>
        </ng-container>

        <ng-container matColumnDef="periodStartDate">
            <th mat-header-cell class="reportingPeriod" *matHeaderCellDef mat-sort-header disableClear> Reporting Period
            </th>
            <td [ngClass]="{'cursorPointer' : source == CbamConstant.ONGOING_RUN}" (click)="editRun(row)" mat-cell *matCellDef="let row">{{row.periodStartDate |
                date: 'dd-MMM-yyyy'}} - {{row.periodEndDate| date: 'dd-MMM-yyyy'}}
            </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell class="col-sm-1" *matHeaderCellDef disableClear>
                <span class="filter">
                    <funnel-filter #statusSelect header="Run Status" type="mono" [entityList]="statusList" value="keyID"
                        view="name" [selectFC]="statusFC" [searchBy]="name" [active]="statusFlag"
                        selectAllLabel="Select all activity" (mono)="statusFlag = true;">
                    </funnel-filter>
                </span>
            </th>

            <td [ngClass]="{'cursorPointer' : source == CbamConstant.ONGOING_RUN}" (click)="editRun(row)" mat-cell *matCellDef="let row">
                <span class="badge rounded-pill" [ngClass]="statusColour(row.runStatus)">
                    {{row.runStatus?showStatus(row.runStatus):COMMON_CONSTANT.HYPHEN}}
                </span>
            </td>
        </ng-container>

        <ng-container matColumnDef="totalSEE">
            <th mat-header-cell class="ps-3 totalSEE" *matHeaderCellDef mat-sort-header disableClear> Specific embedded
                emissions <span class="ps-1">(tCO<sub>2</sub>e / t)</span></th>
            <td [ngClass]="{'cursorPointer' : source == CbamConstant.ONGOING_RUN}" (click)="editRun(row)" mat-cell class="text-start ps-5" *matCellDef="let row">
                <span matTooltipPosition="above" matTooltip={{row.totalSEE}}{{row.seeUnitName}}>
                    {{row.totalSEE?(row.totalSEE| number:'1.0-2'):COMMON_CONSTANT.HYPHEN +
                    ''}}{{row.seeUnitName}}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="defaultSEE">
            <th class="fixed-header-cell" mat-header-cell *matHeaderCellDef>
                Default specific embedded emissions<span class="ps-1">(tCO<sub>2</sub>e / t)</span>
            </th>
            <td mat-cell *matCellDef="let row" class="ps-5">
                {{ row.defaultEmbeddedEmission ? (row.defaultEmbeddedEmission | number:'1.0-2') : COMMON_CONSTANT.HYPHEN }}
            </td>
        </ng-container>

        <ng-container matColumnDef="lockStatus">
            <th class="options" mat-header-cell *matHeaderCellDef disableClear></th>
            <td mat-cell class="cursorPointer" *matCellDef="let row">
                <div *ngIf="row.runStatus == RunStatusKeyIDEnum.DONE && row.lockStatus == CbamEnum.UNLOCKED" (click)="runLockStatusUpdateByRunId(row)"
                    [matTooltip]="getTooltipMessage(row)" matTooltipPosition="above">
                    <span class="material-symbols-outlined pt-1">lock</span>
                </div>

                <div *ngIf="row.runStatus == RunStatusKeyIDEnum.DONE && row.lockStatus == CbamEnum.LOCKED" (click)="runLockStatusUpdateByRunId(row)"
                    [matTooltip]="getTooltipMessage(row)" matTooltipPosition="above">
                    <span class="material-symbols-outlined pt-1">lock_open</span>
                </div>
                <!-- <div *ngIf="source == CbamConstant.ONGOING_RUN;else elsebolck">
                    <span *ngIf="row.lockStatus == CbamEnum.UNLOCKED  && row.runStatus == RunStatusKeyIDEnum.DONE"
                        (click)="lockProduct(row)" class="material-symbols-outlined">
                        lock_open
                    </span>
                </div>
                <div *ngIf="source == CbamConstant.LEDGER; else elseBlock">
                    <span *ngIf="row.lockStatus == CbamEnum.LOCKED" (click)="unlockProduct(row)"
                        class="text-success material-symbols-outlined">
                        lock
                    </span>
                </div> -->
                <!-- <ng-template #elseBlock>
                </ng-template> -->
            </td>
        </ng-container>

        <!-- <ng-container matColumnDef="delete">
            <th class="options" mat-header-cell *matHeaderCellDef disableClear> </th>
            <td mat-cell class="cursorPointer text-danger" *matCellDef="let row" (click)="deleteProduct(row)"
                matTooltipPosition="above" matTooltip="click to delete product"> <span
                    class="material-symbols-outlined">
                    delete
                </span></td>
        </ng-container> -->

        <ng-container matColumnDef="option">
            <th mat-header-cell class="options" *matHeaderCellDef>
            </th>
            <td mat-cell class="options" *matCellDef="let row">
                <div class="btn-group" ngbDropdown placement="left-top">
                    <button type="button" ngbDropdownToggle class="dropdown-after dropdownAfter btn">
                        <fa-icon [icon]="faEllipsisV"></fa-icon>
                    </button>
                    <div ngbDropdownMenu>
                        <!-- <button class="dropdown-item">
                            View MMD
                        </button> -->
                        <button class="dropdown-item" (click)="openReportDialog(row)">
                            Generate Report
                        </button>
                    </div>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="{'dataRow' : source == CbamConstant.ONGOING_RUN}"  ></tr>
        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">
                {{ TABLE_CONSTANT.TABLE_NO_DATA }}
            </td>
        </tr>
    </table>

    <mat-paginator class="roundedBorder" #paginator [length]="resultLength"
        [pageSizeOptions]="TABLE_CONSTANT.PAGE_SIZE_OPTION" [pageSize]="TABLE_CONSTANT.DEFAULT_PAGE_SIZE"
        showFirstLastButtons>
    </mat-paginator>
</div>

<ng-template #icon let-icon="icon" let-tooltip="tooltip" let-class="class" let-function="function"
    let-functionParameter="functionParameter">
    <span class="iconBtn centerAlign material-symbols-outlined icon" [class]="class" matTooltipPosition="below"
        [matTooltip]="tooltip" matRipple [matRippleCentered]="MATERIAL_CONSTANT.MAT_RIPPLE_CENTER"
        (click)="handleClick(function, functionParameter)">
        {{ icon }}
    </span>
</ng-template>