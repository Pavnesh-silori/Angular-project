<mat-card class="border cardOverwrite">
    <ng-container *ngIf="runRequest">
        <ng-container *ngIf="!runRequest.calculationStatus">
            <div class="fs-4 text-primary fw-bold cbamRunResultTitle"> {{ cardTitle }}</div>

            <div class="mt-3">
                <div class="cbamRunProgressBar">
                    <mat-progress-bar [color]="color" [mode]="mode" [value]="value" [bufferValue]="bufferValue">
                    </mat-progress-bar>
                </div>
            </div>

            <div *ngIf="runRequest">
                <div class="row mt-3">
                    <div class="col-sm-3">
                        Records processed
                    </div>
                    <div class="col-sm-4 fw-bold">
                        {{ runRequest.calculatedRecords }} / {{ runRequest.totalRecords }}
                    </div>
                </div>

                <div class="row mt-2">
                    <div class="col-sm-3">
                        Errors found
                    </div>
                    <div class="col-sm-4 fw-bold">
                        {{ runRequest.errorCount }}
                    </div>
                </div>
            </div>

            <div class="text-end">
                <button class="btn btn-sm btn-danger"
                    (click)="updateCbamRunStatus(currentOrgID, runID, RunStatusKeyIDEnum.ALLOCATE_REVIEW); clearInterval();">Abort
                    calculation and edit</button>
            </div>
        </ng-container>

        <ng-container
            *ngIf="runRequest.calculationStatus == CBAM_RUN_CALCULATION_STATUS_KEYID_ENUM.CALCULATION_SUCCESS">
            <ng-container *ngIf="run">
                <div class="fs-4 text-success fw-bold">CBAM run was successful ðŸŽ‰</div>
                <p class="mt-3 text-secondary">
                    Specific Embedded Emission (SEE) for this run is <span class="fw-bold"
                        *ngIf="run.embeddedEmission">{{
                        (run.embeddedEmission.totalSee
                        |
                        number:'1.2-2') }} {{
                        run.embeddedEmission.numeratorUnit.uomCode }} / {{ run.embeddedEmission.denominatorUnit.uomCode
                        }}</span>
                    <span *ngIf="!run.embeddedEmission">0.</span>
                </p>
            </ng-container>

            <ng-container *ngTemplateOutlet="editAndReRunBtn"></ng-container>
        </ng-container>

        <ng-container *ngIf="runRequest.calculationStatus == CBAM_RUN_CALCULATION_STATUS_KEYID_ENUM.CALCULATION_FAILED">
            <div class="fs-4 fw-bold text-danger">CBAM run was unsuccessful! ðŸ˜”</div>
            <p class="mt-3 text-secondary">
                An error has occurred during this CBAM run calculation.
            </p>

            <ng-container *ngTemplateOutlet="editAndReRunBtn"></ng-container>
        </ng-container>

    </ng-container>
</mat-card>

<ng-template #editAndReRunBtn>
    <div class="text-end">
        <button class="btn btn-sm btn-primary"
            (click)="updateCbamRunStatus(currentOrgID, runID, RunStatusKeyIDEnum.ALLOCATE_REVIEW); clearInterval();">Edit
            and re-run CBAM tool</button>
    </div>
</ng-template>