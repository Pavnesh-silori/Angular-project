{"version":3,"file":"ngx-progressbar-http.js","sources":["@ngx-progressbar/http/lib/ng-progress-http.interface.ts","@ngx-progressbar/http/lib/ng-progress.interceptor.ts","@ngx-progressbar/http/lib/ng-progress-http.module.ts"],"names":[],"mappings":"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","sourcesContent":["import { InjectionToken } from '@angular/core';\r\n\r\nexport interface NgProgressHttpConfig {\r\n  id?: string;\r\n  silentApis?: string[];\r\n}\r\n\r\nexport const NG_PROGRESS_HTTP_CONFIG = new InjectionToken<NgProgressHttpConfig>('ngProgressHttpConfig');\r\n","import { Injectable, Optional, Inject } from '@angular/core';\r\nimport { HttpInterceptor, HttpEvent, HttpHandler, HttpRequest } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { finalize } from 'rxjs/operators';\r\nimport { NgProgress, NgProgressRef } from '@ngx-progressbar/core';\r\nimport { NgProgressHttpConfig, NG_PROGRESS_HTTP_CONFIG } from './ng-progress-http.interface';\r\n\r\n@Injectable()\r\nexport class NgProgressInterceptor implements HttpInterceptor {\r\n\r\n  private _inProgressCount = 0;\r\n  private _progressRef: NgProgressRef;\r\n  private readonly _config: NgProgressHttpConfig = {\r\n    id: 'root',\r\n    silentApis: []\r\n  };\r\n\r\n  constructor(ngProgress: NgProgress, @Optional() @Inject(NG_PROGRESS_HTTP_CONFIG) config?: NgProgressHttpConfig) {\r\n    this._config = config ? {...this._config, ...config} : this._config;\r\n    this._progressRef = ngProgress.ref(this._config.id);\r\n  }\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n\r\n    // Ignore by request headers\r\n    if (req.headers.has('ignoreProgressBar')) {\r\n      return next.handle(req.clone({headers: req.headers.delete('ignoreProgressBar')}));\r\n    }\r\n\r\n    // Ignore silent api requests\r\n    if (this.checkUrl(req)) {\r\n      return next.handle(req);\r\n    }\r\n\r\n    this._inProgressCount++;\r\n\r\n    if (!this._progressRef.isStarted) {\r\n      this._progressRef.start();\r\n    }\r\n\r\n    return next.handle(req).pipe(\r\n      finalize(() => {\r\n        this._inProgressCount--;\r\n        if (this._inProgressCount === 0) {\r\n          this._progressRef.complete();\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check if request is silent.\r\n   * @param req request\r\n   */\r\n  private checkUrl(req: HttpRequest<any>) {\r\n    const url = req.url.toLowerCase();\r\n    const found = this._config.silentApis.find((u) => url.startsWith(u));\r\n    return !!found;\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\r\nimport { NgProgressInterceptor } from './ng-progress.interceptor';\r\nimport { NgProgressHttpConfig, NG_PROGRESS_HTTP_CONFIG } from './ng-progress-http.interface';\r\n\r\n@NgModule({\r\n  providers: [\r\n    { provide: HTTP_INTERCEPTORS, useClass: NgProgressInterceptor, multi: true }\r\n  ]\r\n})\r\nexport class NgProgressHttpModule {\r\n  static withConfig(config: NgProgressHttpConfig): ModuleWithProviders {\r\n    return {\r\n      ngModule: NgProgressHttpModule,\r\n      providers: [\r\n        { provide: NG_PROGRESS_HTTP_CONFIG, useValue: config }\r\n      ]\r\n    };\r\n  }\r\n}\r\n"]}