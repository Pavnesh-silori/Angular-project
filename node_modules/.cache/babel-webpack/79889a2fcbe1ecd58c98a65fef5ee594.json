{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Validators } from '@angular/forms';\nimport * as moment from 'moment';\nimport { isEqual } from \"lodash\";\nimport { InOutsourcingBaseYearEmissionDialogComponent } from '../../in-outsourcing-base-year-emission-dialog/in-outsourcing-base-year-emission-dialog.component';\nimport { StructuralChangeTabTypeEnum, StructuralChangeTypeEnum } from '@carbon/enum/ghg.enum';\nimport { date_format_providers } from '@carbon/constant/carbon.constant';\nimport { StructuralChangeData } from '@carbon/model/ghg-base-year.model';\nimport { BaseYearEnum } from '@carbon/enum/base-year.enum';\n// tsc-library\nimport { ButtonLabelEnum, InvalidForm, MaterialFormFieldAppearance } from '@library/tsc-common';\nimport { UnitTypeKeyID, UomCode } from '@library/unit-service';\nimport { ToastrColor } from '@library/toastr-service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@library/storage-service\";\nimport * as i2 from \"@library/date\";\nimport * as i3 from \"@carbon/service/scope.service\";\nimport * as i4 from \"@carbon/controller/ghg-base-year.controller\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/material/dialog\";\nimport * as i8 from \"@carbon/controller/base-year.controller\";\nimport * as i9 from \"@carbon/service/ghg.service\";\nimport * as i10 from \"@library/unit-service\";\nimport * as i11 from \"@library/toastr-service\";\nimport * as i12 from \"@angular/common\";\nimport * as i13 from \"@angular/material/form-field\";\nimport * as i14 from \"@angular/material/input\";\nimport * as i15 from \"@angular/material/select\";\nimport * as i16 from \"@angular/material/core\";\nimport * as i17 from \"@angular/material/datepicker\";\nfunction UpdateComponent_mat_error_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Business entity name is required \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_mat_option_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 32);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const years_r10 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", years_r10);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", years_r10, \" \");\n  }\n}\nfunction UpdateComponent_mat_error_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Business entity start year is required \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_mat_error_47_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r5.tabType, \" date is required \");\n  }\n}\nfunction UpdateComponent_mat_option_54_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 32);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const activity_r11 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", activity_r11[\"id\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", activity_r11.name, \" \");\n  }\n}\nfunction UpdateComponent_mat_error_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Activity is required \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_ng_container_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 33);\n    i0.ɵɵelementStart(2, \"div\", 34);\n    i0.ɵɵelementStart(3, \"div\", 35);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(4, \"svg\", 36);\n    i0.ɵɵelement(5, \"use\", 37);\n    i0.ɵɵelementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(6, \"div\", 38);\n    i0.ɵɵtext(7, \"For submitting the record you have to confirm emissions for atleast one year.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction UpdateComponent_div_57_ng_container_6_span_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" Not applicable \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_div_57_ng_container_6_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" Business entity did not exist in this year \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_div_57_ng_container_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 8);\n    i0.ɵɵelementStart(2, \"div\", 42);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 11);\n    i0.ɵɵelementStart(5, \"div\", 35);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(6, \"svg\", 43);\n    i0.ɵɵelement(7, \"path\", 2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, UpdateComponent_div_57_ng_container_6_span_8_Template, 2, 0, \"span\", 15);\n    i0.ɵɵtemplate(9, UpdateComponent_div_57_ng_container_6_span_9_Template, 2, 0, \"span\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r12 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r12.noEntityYearRange, \" \");\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r12.updateInOutsourcingFG.controls[\"entityStartYear\"].value < ctx_r12.baseYear);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r12.updateInOutsourcingFG.controls[\"entityStartYear\"].value > ctx_r12.baseYear);\n  }\n}\nfunction UpdateComponent_div_57_ng_container_7_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" (optional) \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_div_57_ng_container_7_div_6_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r25 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 49);\n    i0.ɵɵlistener(\"click\", function UpdateComponent_div_57_ng_container_7_div_6_button_1_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const years_r16 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r23 = i0.ɵɵnextContext(2);\n      return ctx_r23.openGhgEmissionDialog(years_r16, \"update\");\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", \"Update Emission\", \" \");\n  }\n}\nfunction UpdateComponent_div_57_ng_container_7_div_6_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 49);\n    i0.ɵɵlistener(\"click\", function UpdateComponent_div_57_ng_container_7_div_6_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r28);\n      const years_r16 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r26 = i0.ɵɵnextContext(2);\n      return ctx_r26.openGhgEmissionDialog(years_r16, \"create\");\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", \"Enter Emission\", \" \");\n  }\n}\nfunction UpdateComponent_div_57_ng_container_7_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 47);\n    i0.ɵɵtemplate(1, UpdateComponent_div_57_ng_container_7_div_6_button_1_Template, 2, 1, \"button\", 48);\n    i0.ɵɵtemplate(2, UpdateComponent_div_57_ng_container_7_div_6_button_2_Template, 2, 1, \"button\", 48);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const years_r16 = i0.ɵɵnextContext().$implicit;\n    const ctx_r18 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r18.fillEmissionYear.includes(years_r16));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r18.fillEmissionYear.includes(years_r16));\n  }\n}\nfunction UpdateComponent_div_57_ng_container_7_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 50);\n    i0.ɵɵtext(1, \" Please enter emissions for the base year. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_div_57_ng_container_7_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 50);\n    i0.ɵɵtext(1, \" Please update emissions for selected activity. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UpdateComponent_div_57_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 44);\n    i0.ɵɵelementContainerStart(2);\n    i0.ɵɵelementStart(3, \"div\", 42);\n    i0.ɵɵtext(4);\n    i0.ɵɵtemplate(5, UpdateComponent_div_57_ng_container_7_span_5_Template, 2, 0, \"span\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, UpdateComponent_div_57_ng_container_7_div_6_Template, 3, 2, \"div\", 45);\n    i0.ɵɵtemplate(7, UpdateComponent_div_57_ng_container_7_div_7_Template, 2, 0, \"div\", 46);\n    i0.ɵɵtemplate(8, UpdateComponent_div_57_ng_container_7_div_8_Template, 2, 0, \"div\", 46);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const years_r16 = ctx.$implicit;\n    const ctx_r13 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", years_r16, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", years_r16 != ctx_r13.baseYear && years_r16 >= ctx_r13.baseYear);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", years_r16 >= ctx_r13.baseYear);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", years_r16 == ctx_r13.baseYear && ctx_r13.emissionsForBaseYearRequired);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r13.resetEmissionList.includes(years_r16) && ctx_r13.resetEmissionDataRequired);\n  }\n}\nfunction UpdateComponent_div_57_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵelementStart(1, \"div\", 9);\n    i0.ɵɵelementStart(2, \"div\", 8);\n    i0.ɵɵelementStart(3, \"div\", 39);\n    i0.ɵɵelementStart(4, \"div\", 40);\n    i0.ɵɵtext(5, \" Enter emissions \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, UpdateComponent_div_57_ng_container_6_Template, 10, 3, \"ng-container\", 15);\n    i0.ɵɵtemplate(7, UpdateComponent_div_57_ng_container_7_Template, 9, 5, \"ng-container\", 41);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.noEntityYearRange && ctx_r9.baseYear != null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r9.emissionYear);\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"disabled\": a0\n  };\n};\n// /tsc-library\nexport let UpdateComponent = /*#__PURE__*/(() => {\n  class UpdateComponent {\n    constructor(storageService, dateService, scopeService, ghgBaseYearController, router, activatedRoute, updateInOutsourcingFB, dialog, baseYearController, ghgBaseYearService, unitService, toastrService, location) {\n      this.storageService = storageService;\n      this.dateService = dateService;\n      this.scopeService = scopeService;\n      this.ghgBaseYearController = ghgBaseYearController;\n      this.router = router;\n      this.activatedRoute = activatedRoute;\n      this.updateInOutsourcingFB = updateInOutsourcingFB;\n      this.dialog = dialog;\n      this.baseYearController = baseYearController;\n      this.ghgBaseYearService = ghgBaseYearService;\n      this.unitService = unitService;\n      this.toastrService = toastrService;\n      this.location = location;\n      this.MaterialFormFieldAppearance = MaterialFormFieldAppearance;\n      this.ButtonLabelEnum = ButtonLabelEnum;\n      this.StructuralChangeTabType = StructuralChangeTabTypeEnum;\n      this.maxLength = 100;\n      this.currentYear = this.dateService.getCurrentYear();\n      this.minYear = 1900;\n      this.maxYear = this.currentYear - 1;\n      this.currentValueYear = this.currentYear - 1;\n      this.year = [];\n      this.emissionYear = [];\n      this.showEmissionYear = false;\n      this.ghgBaseYear = null;\n      this.sbtiBaseYear = null;\n      this.scopesWithActivity = [];\n      this.selectedScopeActivity = [];\n      this.dialogDataArray = [];\n      this.yearlyEmissionDialogData = {};\n      this.noActivitiesSelected = true;\n      this.emissionsForBaseYearRequired = false;\n      this.structuralChangeRes = new StructuralChangeData();\n      this.isEqual = true;\n      this.afterClosed = false;\n      this.fillEmissionYear = [];\n      this.resetEmissionDataRequired = false;\n      this.resetEmissionList = [];\n      this.noEntityYearRange = null;\n      this.dataFillInit = true;\n      this.prevData = [];\n      this.preSelectedActivityList = [];\n      this.today = new Date();\n      this.errorHandling = (control, error) => {\n        return this.updateInOutsourcingFG.controls[control].hasError(error);\n      };\n    }\n    ngOnInit() {\n      this.rootOrgID = this.storageService.getStorage('rootOrgID');\n      this.activatedRoute.data.subscribe(data => {\n        this.tabType = data['tabType'];\n        if (this.tabType == StructuralChangeTabTypeEnum.INSOURCING) {\n          this.type = StructuralChangeTypeEnum.INSOURCING;\n          this.routerLink = `carbon-setting/structural-change/insourcing/page`;\n        } else if (this.tabType == StructuralChangeTabTypeEnum.OUTSOURCING) {\n          this.type = StructuralChangeTypeEnum.OUTSOURCING;\n          this.routerLink = `carbon-setting/structural-change/outsourcing/page`;\n        }\n      });\n      this.activatedRoute.params.subscribe(param => {\n        this.recordID = param['recordID'];\n      });\n      this.getAllScopeWithActivity();\n      this.updateInOutsourcingInit();\n      this.getStructuralChangeOrgByID();\n      this.populateYear();\n      this.getSbtiBaseYear();\n      this.ghgBaseYearEmission();\n    }\n    ngAfterViewInit() {\n      this.updateInOutsourcingFG.get('entityStartYear').valueChanges.subscribe(value => {\n        this.populateYearForEmissions(value);\n      });\n      this.updateInOutsourcingFG.get('activityID').valueChanges.subscribe(selectedActivityIDs => {\n        var _a;\n        this.selectedScopeActivity = (_a = this.activityList) === null || _a === void 0 ? void 0 : _a.filter(activity => selectedActivityIDs.includes(activity.id));\n        if (this.selectedScopeActivity.every(element => this.preSelectedActivityList.includes(element))) {\n          this.resetEmissionDataRequired = false;\n        } else {\n          if (this.fillEmissionYear.length != 0) {\n            this.resetEmissionDataRequired = true;\n          } else {\n            this.resetEmissionDataRequired = false;\n          }\n        }\n        if (!this.dataFillInit) {\n          const isExit = this.selectedScopeActivity.every(item => this.prevData.includes(item));\n          if (!isExit) {\n            this.resetEmissionDataRequired = true;\n          } else {\n            this.resetEmissionDataRequired = false;\n          }\n        }\n        this.noActivitiesSelected = selectedActivityIDs.length == 0;\n        if (this.resetEmissionDataRequired) {\n          this.resetEmissionList = [];\n          this.fillEmissionYear.forEach(year => {\n            this.resetEmissionList.push(year);\n          });\n        }\n      });\n    }\n    getUnit() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.unitList = yield this.unitService.getUnit([`type:` + UnitTypeKeyID.EQUIVALENT_EMISSION]);\n        this.unit = this.unitList.find(unit => unit.uomCode == UomCode.TCO2E);\n      });\n    }\n    ghgBaseYearEmission() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.ghgEmissionRes = yield this.ghgBaseYearService.getAllGHGEmissionsForView(this.rootOrgID);\n        this.ghgBaseYear = this.ghgEmissionRes['baseYear'];\n        this.setBaseYear();\n        this.populateYearForEmissions(this.updateInOutsourcingFG.get('entityStartYear').value);\n      });\n    }\n    setBaseYear() {\n      if (this.ghgBaseYear && this.sbtiBaseYear) {\n        if (this.ghgBaseYear == this.sbtiBaseYear || this.ghgBaseYear > this.sbtiBaseYear) {\n          this.baseYear = this.ghgBaseYear;\n        } else {\n          this.baseYear = this.sbtiBaseYear;\n        }\n      } else if (this.ghgBaseYear) {\n        this.baseYear = this.ghgBaseYear;\n      } else {\n        this.baseYear = this.sbtiBaseYear;\n      }\n    }\n    getSbtiBaseYear() {\n      this.baseYearController.getBaseYearByType(this.rootOrgID, BaseYearEnum.SBTI_BASE_YEAR).subscribe(res => {\n        this.sbtiBaseYear = res.baseYear;\n      });\n    }\n    getAllScopeWithActivity() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.scopesWithActivity = yield this.scopeService.getAllScopeWithActivity();\n        if (this.tabType == StructuralChangeTabTypeEnum.INSOURCING) {\n          this.scopeKeyID = 'SCOPE3';\n          this.scopeName = 'Scope 3';\n          this.scopeID = 3;\n        } else if (this.tabType == StructuralChangeTabTypeEnum.OUTSOURCING) {\n          this.scopeKeyID = 'SCOPE1';\n          this.scopeName = 'Scope 1';\n          this.scopeID = 1;\n        }\n        this.scope = this.scopesWithActivity.find(scope => scope.keyID == this.scopeKeyID);\n        this.activityList = this.scope.activity;\n      });\n    }\n    updateInOutsourcingInit() {\n      this.updateInOutsourcingFG = this.updateInOutsourcingFB.group({\n        type: [this.type],\n        entityName: [, [Validators.required]],\n        entityStartYear: [, [Validators.required]],\n        description: [],\n        eventDate: [, [Validators.required]],\n        activityID: [, [Validators.required]],\n        structuralChangeData: [, [Validators.required]]\n      });\n    }\n    getStructuralChangeOrgByID() {\n      this.ghgBaseYearController.getStructuralChangeOrgByID(this.rootOrgID, this.recordID, this.type).subscribe(res => {\n        if (res) {\n          this.structuralChangeRes = res;\n          this.patchStructuralChangeData();\n          this.updateInOutsourcingFG.valueChanges.subscribe(() => {\n            this.isEqual = isEqual(this.initialObject, this.updateInOutsourcingFG.getRawValue());\n          });\n        } else {\n          this.structuralChangeRes = new StructuralChangeData();\n        }\n      }, error => {\n        console.log('error in getStructuralChangeOrgByID -', error);\n        this.structuralChangeRes = new StructuralChangeData();\n      });\n    }\n    patchStructuralChangeData() {\n      var _a;\n      this.updateInOutsourcingFG.patchValue({\n        entityName: this.structuralChangeRes['entityName'],\n        entityStartYear: this.structuralChangeRes['entityStartYear'],\n        description: this.structuralChangeRes['description'],\n        eventDate: this.structuralChangeRes['eventDate'],\n        activityID: this.structuralChangeRes['activityID'],\n        structuralChangeData: this.structuralChangeRes['structuralChangeData']\n      });\n      this.preSelectedActivityList = (_a = this.activityList) === null || _a === void 0 ? void 0 : _a.filter(activity => this.updateInOutsourcingFG.get('activityID').value.includes(activity.id));\n      this.updateInOutsourcingFG.get('activityID').valueChanges.subscribe(selectedActivityIDs => {\n        this.selectedScopeActivity = this.activityList.filter(activity => selectedActivityIDs.includes(activity.id));\n        this.noActivitiesSelected = selectedActivityIDs.length == 0;\n      });\n      this.initialObject = this.updateInOutsourcingFG.value;\n      this.isEqual = true;\n      this.structuralChangeRes['structuralChangeData'].forEach(data => {\n        this.fillEmissionYear.push(data.year);\n      });\n    }\n    formatDate(control) {\n      let date = moment(this.updateInOutsourcingFG.controls[control].value).format(\"YYYY-MM-DD\");\n      this.updateInOutsourcingFG.controls[control].patchValue(date);\n    }\n    populateYear() {\n      for (let year = this.minYear; year <= this.maxYear; year++) {\n        this.year.push(year);\n      }\n    }\n    populateYearForEmissions(entityStartYear) {\n      this.noEntityYearRange = null;\n      this.showEmissionYear = true;\n      this.emissionYear = [];\n      for (let year = entityStartYear; year <= this.maxYear; year++) {\n        if (year >= this.baseYear) {\n          this.emissionYear.push(year);\n        }\n        if (entityStartYear == this.baseYear - 1) {\n          this.noEntityYearRange = `${entityStartYear}`;\n        } else {\n          if (year < this.baseYear) {\n            this.noEntityYearRange = `${entityStartYear}   -  ${this.baseYear - 1}`;\n          }\n        }\n        if (entityStartYear == this.baseYear + 1) {\n          this.noEntityYearRange = `${this.baseYear}`;\n        }\n        if (entityStartYear > this.baseYear + 1) {\n          this.noEntityYearRange = `${this.baseYear}   -  ${entityStartYear - 1}`;\n        }\n      }\n    }\n    openGhgEmissionDialog(year, action) {\n      let dialogData;\n      if (action == 'update') {\n        const structuralChangeData = this.updateInOutsourcingFG.get('structuralChangeData').value;\n        dialogData = structuralChangeData.find(data => data.year == year);\n      } else {\n        dialogData = this.yearlyEmissionDialogData[year];\n      }\n      this.afterClosed = false;\n      const dialog = this.dialog.open(InOutsourcingBaseYearEmissionDialogComponent, {\n        data: {\n          year: year,\n          emissionUnit: this.unit,\n          scopeID: this.scopeKeyID,\n          scopeName: this.scopeName,\n          selectedScopeActivity: this.selectedScopeActivity,\n          yearlyEmissionData: dialogData\n        },\n        minWidth: '80vw',\n        maxWidth: '80vw',\n        height: '100%',\n        position: {\n          right: '-2px',\n          top: '0px'\n        }\n      });\n      dialog.afterClosed().subscribe(emissionRes => {\n        if (emissionRes) {\n          this.afterClosed = true;\n          this.structuralChangeRes = emissionRes;\n          this.fillEmissionYear.push(year);\n          const modifiedList = this.resetEmissionList.filter(element => element !== year);\n          this.resetEmissionList = modifiedList;\n          const updatedStructuralChangeData = [...this.updateInOutsourcingFG.get('structuralChangeData').value];\n          const index = updatedStructuralChangeData.findIndex(data => data.year == year);\n          if (index != -1) {\n            updatedStructuralChangeData[index] = emissionRes;\n          } else {\n            updatedStructuralChangeData.push(emissionRes);\n          }\n          if (year == this.ghgBaseYear) {\n            this.emissionsForBaseYearRequired = false;\n          }\n          this.updateInOutsourcingFG.get('structuralChangeData').patchValue(updatedStructuralChangeData);\n          this.dialogDataArray = updatedStructuralChangeData;\n          if (this.dataFillInit) this.dataFillInit = false;\n          this.prevData = this.selectedScopeActivity;\n        }\n      });\n    }\n    updateInOutSource() {\n      var _a, _b;\n      console.log('ads', this.updateInOutsourcingFG);\n      let currentDataArr;\n      let prevDataArr;\n      if (this.updateInOutsourcingFG.get('structuralChangeData').value) {\n        prevDataArr = this.updateInOutsourcingFG.get('structuralChangeData').value;\n        currentDataArr = prevDataArr.filter(data => data['year'] >= this.updateInOutsourcingFG.get('entityStartYear').value);\n        if (currentDataArr.length == 0) {\n          this.toastrService.openToast(InvalidForm.INVALID_FORM_TITLE, InvalidForm.INVALID_FORM_MESSAGE, ToastrColor.ERROR);\n          return;\n        }\n      }\n      const emissionFormControl = this.updateInOutsourcingFG.get('structuralChangeData');\n      if (this.updateInOutsourcingFG.get('entityStartYear').value <= this.ghgBaseYear) {\n        if (emissionFormControl.value) {\n          const emissionData = emissionFormControl.value;\n          this.emissionsForBaseYearRequired = true;\n          for (let i = 0; i < emissionData.length; i++) {\n            if (emissionData[i]['year'] == this.ghgBaseYear) {\n              this.emissionsForBaseYearRequired = false;\n              break;\n            }\n          }\n        }\n        if (this.emissionsForBaseYearRequired && this.updateInOutsourcingFG.controls['entityStartYear'].value <= this.ghgBaseYear) {\n          this.toastrService.openToast(InvalidForm.INVALID_FORM_TITLE, InvalidForm.INVALID_FORM_MESSAGE, ToastrColor.ERROR);\n          return;\n        }\n      }\n      if (this.updateInOutsourcingFG.invalid) {\n        this.updateInOutsourcingFG.markAllAsTouched();\n        this.toastrService.openToast(InvalidForm.INVALID_FORM_TITLE, InvalidForm.INVALID_FORM_MESSAGE, ToastrColor.ERROR);\n        if (emissionFormControl) {\n          const emissionsData = emissionFormControl.value;\n          const emissionsForBaseYear = emissionsData.find(structuralChangeData => {\n            var _a, _b;\n            return structuralChangeData.year == this.ghgBaseYear && structuralChangeData.emissionRecords && ((_b = (_a = structuralChangeData.emissionRecords[0]) === null || _a === void 0 ? void 0 : _a['equityShareApproach']) === null || _b === void 0 ? void 0 : _b['emission']) == ('' || null);\n          });\n          if (emissionsForBaseYear) {\n            this.emissionsForBaseYearRequired = true;\n          }\n        }\n        return;\n      }\n      if (this.resetEmissionList.length != 0) {\n        this.toastrService.openToast(InvalidForm.INVALID_FORM_TITLE, InvalidForm.INVALID_FORM_MESSAGE, ToastrColor.ERROR);\n        return;\n      }\n      this.updateInOutsourcingFG.get('structuralChangeData').patchValue(currentDataArr);\n      let fillData = [];\n      let activityList = [];\n      fillData = this.updateInOutsourcingFG.get('structuralChangeData').value;\n      activityList = this.updateInOutsourcingFG.get('activityID').value;\n      let dataJson = [];\n      for (let i = 0; i < fillData.length; i++) {\n        let updatedJson = this.updateInOutsourcingFG.get('structuralChangeData').value[i];\n        let isExistData = (_b = (_a = this.updateInOutsourcingFG.get('structuralChangeData').value[i]) === null || _a === void 0 ? void 0 : _a['emissionRecords']) === null || _b === void 0 ? void 0 : _b.filter(id => activityList.includes(id['activityID']));\n        updatedJson['emissionRecords'] = isExistData;\n        dataJson.push(updatedJson);\n      }\n      this.updateInOutsourcingFG.get('structuralChangeData').patchValue(dataJson);\n      this.ghgBaseYearController.updateStructuralChangeOrg(this.rootOrgID, this.recordID, this.updateInOutsourcingFG.value).subscribe(subsidiaryRes => {\n        this.router.navigate([this.routerLink]);\n      }, error => {\n        console.log('error in updateInOutSource - ', error);\n      });\n    }\n    // Datepicker calender open/close\n    openDatepicker(datepicker) {\n      if (!datepicker.opened) {\n        datepicker.open();\n      }\n    }\n  }\n  UpdateComponent.ɵfac = function UpdateComponent_Factory(t) {\n    return new (t || UpdateComponent)(i0.ɵɵdirectiveInject(i1.StorageService), i0.ɵɵdirectiveInject(i2.DateService), i0.ɵɵdirectiveInject(i3.ScopeService), i0.ɵɵdirectiveInject(i4.GhgBaseYearController), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i5.ActivatedRoute), i0.ɵɵdirectiveInject(i6.FormBuilder), i0.ɵɵdirectiveInject(i7.MatDialog), i0.ɵɵdirectiveInject(i8.BaseYearController), i0.ɵɵdirectiveInject(i9.GhgBaseYearService), i0.ɵɵdirectiveInject(i10.UnitService), i0.ɵɵdirectiveInject(i11.ToastrService), i0.ɵɵdirectiveInject(i12.Location));\n  };\n  UpdateComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UpdateComponent,\n    selectors: [[\"app-update\"]],\n    features: [i0.ɵɵProvidersFeature(date_format_providers)],\n    decls: 65,\n    vars: 28,\n    consts: [[\"xmlns\", \"http://www.w3.org/2000/svg\", 1, \"d-none\"], [\"id\", \"exclamation-triangle-fill\", \"fill\", \"#fd7e14\", \"viewBox\", \"0 0 16 16\"], [\"d\", \"M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z\"], [1, \"card\", \"main-card\", \"cardOverwrite\", \"h100\"], [1, \"headerContainer\"], [1, \"headerLeftContainer\"], [1, \"pageTitle\"], [1, \"card-body\"], [1, \"row\"], [1, \"col-sm-12\"], [3, \"formGroup\"], [1, \"col-sm-6\"], [1, \"matFieldWidth100\", 3, \"appearance\"], [1, \"formLabel\"], [\"matInput\", \"\", \"placeholder\", \"Business entity name\", \"type\", \"text\", \"formControlName\", \"entityName\"], [4, \"ngIf\"], [\"formControlName\", \"entityStartYear\"], [\"disabled\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"matInput\", \"\", \"formControlName\", \"description\", 1, \"formPlaceholder\", 3, \"maxlength\"], [\"input\", \"\"], [1, \"matFieldWidth100\", 3, \"appearance\", \"click\", \"keydown.enter\", \"keydown.arrowdown\"], [\"matInput\", \"\", \"formControlName\", \"eventDate\", 1, \"noFocus\", 3, \"matDatepicker\", \"max\", \"dateInput\"], [\"matSuffix\", \"\", 3, \"for\"], [\"disabled\", \"false\"], [\"date\", \"\"], [\"formControlName\", \"activityID\", \"multiple\", \"\"], [\"class\", \"row\", 4, \"ngIf\"], [1, \"row\", \"pt-4\"], [1, \"float-end\"], [\"type\", \"button\", 1, \"btn\", \"btn-secondary\", \"me-2\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-success\", 3, \"ngClass\", \"click\"], [3, \"value\"], [1, \"extraInfoCard\", \"mb-4\"], [1, \"alert\", \"alert-warning\", \"m-0\", \"roundedBorder\", \"warningCardWidth\"], [1, \"d-flex\", \"align-items-center\"], [1, \"bi\", \"flex-shrink-0\", \"me-3\", \"extraInfoCardHeaderIcon\"], [0, \"xlink\", \"href\", \"#exclamation-triangle-fill\"], [1, \"mt-2\"], [1, \"card-title\"], [1, \"cardTitle\"], [4, \"ngFor\", \"ngForOf\"], [1, \"col-sm-2\"], [\"fill\", \"#fd7e14\", \"viewBox\", \"0 0 16 16\", 1, \"exclamation-triangle-fill\", \"flex-shrink-0\", \"fs-5\", \"dialogHeaderIcon\", \"verifiedIcon\", \"me-2\"], [1, \"row\", \"mt-4\"], [\"class\", \"col-sm-4\", 4, \"ngIf\"], [\"class\", \"col-sm-6 text-danger\", 4, \"ngIf\"], [1, \"col-sm-4\"], [\"class\", \"btn btn-link btn-sm\", \"type\", \"button\", 3, \"click\", 4, \"ngIf\"], [\"type\", \"button\", 1, \"btn\", \"btn-link\", \"btn-sm\", 3, \"click\"], [1, \"col-sm-6\", \"text-danger\"]],\n    template: function UpdateComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r30 = i0.ɵɵgetCurrentView();\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(0, \"svg\", 0);\n        i0.ɵɵelementStart(1, \"symbol\", 1);\n        i0.ɵɵelement(2, \"path\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelementStart(3, \"div\", 3);\n        i0.ɵɵelementStart(4, \"div\", 4);\n        i0.ɵɵelementStart(5, \"div\", 5);\n        i0.ɵɵelementStart(6, \"div\", 6);\n        i0.ɵɵtext(7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"div\", 7);\n        i0.ɵɵelementStart(9, \"div\", 8);\n        i0.ɵɵelementStart(10, \"div\", 9);\n        i0.ɵɵelementStart(11, \"form\", 10);\n        i0.ɵɵelementStart(12, \"div\", 8);\n        i0.ɵɵelementStart(13, \"div\", 11);\n        i0.ɵɵelementStart(14, \"mat-form-field\", 12);\n        i0.ɵɵelementStart(15, \"mat-label\", 13);\n        i0.ɵɵtext(16, \"Business entity name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(17, \"input\", 14);\n        i0.ɵɵtemplate(18, UpdateComponent_mat_error_18_Template, 2, 0, \"mat-error\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"div\", 8);\n        i0.ɵɵelementStart(20, \"div\", 11);\n        i0.ɵɵelementStart(21, \"mat-form-field\", 12);\n        i0.ɵɵelementStart(22, \"mat-label\");\n        i0.ɵɵtext(23, \"Business entity start year\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"mat-select\", 16);\n        i0.ɵɵelementStart(25, \"mat-option\", 17);\n        i0.ɵɵtext(26, \"Select Business entity base year\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(27, UpdateComponent_mat_option_27_Template, 2, 2, \"mat-option\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(28, UpdateComponent_mat_error_28_Template, 2, 0, \"mat-error\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"div\", 8);\n        i0.ɵɵelementStart(30, \"div\", 11);\n        i0.ɵɵelementStart(31, \"mat-form-field\", 12);\n        i0.ɵɵelementStart(32, \"mat-label\", 13);\n        i0.ɵɵtext(33);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(34, \"input\", 19, 20);\n        i0.ɵɵelementStart(36, \"mat-hint\");\n        i0.ɵɵtext(37);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(38, \"div\", 8);\n        i0.ɵɵelementStart(39, \"div\", 11);\n        i0.ɵɵelementStart(40, \"mat-form-field\", 21);\n        i0.ɵɵlistener(\"click\", function UpdateComponent_Template_mat_form_field_click_40_listener() {\n          i0.ɵɵrestoreView(_r30);\n          const _r4 = i0.ɵɵreference(46);\n          return ctx.openDatepicker(_r4);\n        })(\"keydown.enter\", function UpdateComponent_Template_mat_form_field_keydown_enter_40_listener() {\n          i0.ɵɵrestoreView(_r30);\n          const _r4 = i0.ɵɵreference(46);\n          return ctx.openDatepicker(_r4);\n        })(\"keydown.arrowdown\", function UpdateComponent_Template_mat_form_field_keydown_arrowdown_40_listener() {\n          i0.ɵɵrestoreView(_r30);\n          const _r4 = i0.ɵɵreference(46);\n          return ctx.openDatepicker(_r4);\n        });\n        i0.ɵɵelementStart(41, \"mat-label\", 13);\n        i0.ɵɵtext(42);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(43, \"input\", 22);\n        i0.ɵɵlistener(\"dateInput\", function UpdateComponent_Template_input_dateInput_43_listener() {\n          return ctx.formatDate(\"eventDate\");\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(44, \"mat-datepicker-toggle\", 23);\n        i0.ɵɵelement(45, \"mat-datepicker\", 24, 25);\n        i0.ɵɵtemplate(47, UpdateComponent_mat_error_47_Template, 2, 1, \"mat-error\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(48, \"div\", 8);\n        i0.ɵɵelementStart(49, \"div\", 11);\n        i0.ɵɵelementStart(50, \"mat-form-field\", 12);\n        i0.ɵɵelementStart(51, \"mat-label\", 13);\n        i0.ɵɵtext(52, \"Select activity type\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(53, \"mat-select\", 26);\n        i0.ɵɵtemplate(54, UpdateComponent_mat_option_54_Template, 2, 2, \"mat-option\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(55, UpdateComponent_mat_error_55_Template, 2, 0, \"mat-error\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(56, UpdateComponent_ng_container_56_Template, 8, 0, \"ng-container\", 15);\n        i0.ɵɵtemplate(57, UpdateComponent_div_57_Template, 8, 2, \"div\", 27);\n        i0.ɵɵelementStart(58, \"div\", 28);\n        i0.ɵɵelementStart(59, \"div\", 9);\n        i0.ɵɵelementStart(60, \"div\", 29);\n        i0.ɵɵelementStart(61, \"button\", 30);\n        i0.ɵɵlistener(\"click\", function UpdateComponent_Template_button_click_61_listener() {\n          return ctx.location.back();\n        });\n        i0.ɵɵtext(62);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(63, \"button\", 31);\n        i0.ɵɵlistener(\"click\", function UpdateComponent_Template_button_click_63_listener() {\n          return ctx.updateInOutSource();\n        });\n        i0.ɵɵtext(64);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        const _r3 = i0.ɵɵreference(35);\n        const _r4 = i0.ɵɵreference(46);\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate1(\"Update \", ctx.tabType, \" Record\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"formGroup\", ctx.updateInOutsourcingFG);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"appearance\", ctx.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorHandling(\"entityName\", \"required\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"appearance\", ctx.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.year);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorHandling(\"entityStartYear\", \"required\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"appearance\", ctx.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\"\", ctx.tabType, \" description\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"maxlength\", ctx.maxLength);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate2(\"Total number of character remaining: \", _r3.value.length, \" /\", ctx.maxLength, \"\");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"appearance\", ctx.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\"\", ctx.tabType, \" date \");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"matDatepicker\", _r4)(\"max\", ctx.today);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"for\", _r4);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorHandling(\"eventDate\", \"required\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"appearance\", ctx.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.activityList);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorHandling(\"activityID\", \"required\"));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.updateInOutsourcingFG.controls[\"entityStartYear\"].value > ctx.baseYear);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showEmissionYear);\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\" \", ctx.ButtonLabelEnum.CANCEL_BTN_LABEL, \" \");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(26, _c0, ctx.isEqual));\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", ctx.ButtonLabelEnum.SUBMIT_BTN_LABEL, \" \");\n      }\n    },\n    directives: [i6.ɵNgNoValidate, i6.NgControlStatusGroup, i6.FormGroupDirective, i13.MatFormField, i13.MatLabel, i14.MatInput, i6.DefaultValueAccessor, i6.NgControlStatus, i6.FormControlName, i12.NgIf, i15.MatSelect, i16.MatOption, i12.NgForOf, i6.MaxLengthValidator, i13.MatHint, i17.MatDatepickerInput, i17.MatDatepickerToggle, i13.MatSuffix, i17.MatDatepicker, i12.NgClass, i13.MatError],\n    styles: [\"\"]\n  });\n  return UpdateComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}