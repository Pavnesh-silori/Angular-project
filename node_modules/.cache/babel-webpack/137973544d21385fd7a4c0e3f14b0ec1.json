{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { SupplierTypeKeyIDEnum } from '@netzero/enum/supplier.enum';\n/* tsc-library */\nimport { COMMON_CONSTANT, MatSelectSearchService, MaterialFormFieldAppearance } from '@library/tsc-common';\nimport { OrgType } from '@library/organization-service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@library/storage-service\";\nimport * as i4 from \"@library/toastr-service\";\nimport * as i5 from \"@netzero/controller/supplier.controller\";\nimport * as i6 from \"@library/organization-service\";\nimport * as i7 from \"@angular/material/card\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@angular/material/form-field\";\nimport * as i10 from \"@angular/material/select\";\nimport * as i11 from \"@angular/material/core\";\nimport * as i12 from \"ngx-mat-select-search\";\nfunction PurchasedEnergyComponent_ng_container_4_mat_option_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const supplier_r8 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", supplier_r8[\"supplierID\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", supplier_r8[\"supplierName\"], \" \");\n  }\n}\nfunction PurchasedEnergyComponent_ng_container_4_mat_error_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \" Supplier is required \");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function () {\n  return [\"/source/supplier\"];\n};\nfunction PurchasedEnergyComponent_ng_container_4_ng_container_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 9);\n    i0.ɵɵelementStart(2, \"div\", 20);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(3, \"svg\", 21);\n    i0.ɵɵelement(4, \"use\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(5, \"div\", 23);\n    i0.ɵɵtext(6, \" You have not created any supplier. Please create one \");\n    i0.ɵɵelementStart(7, \"a\", 24);\n    i0.ɵɵtext(8, \"here\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(9, \". \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(1, _c0));\n  }\n}\nfunction PurchasedEnergyComponent_ng_container_4_mat_option_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const facility_r9 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", facility_r9[\"id\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", facility_r9[\"name\"], \" \");\n  }\n}\nfunction PurchasedEnergyComponent_ng_container_4_ng_container_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 9);\n    i0.ɵɵelementStart(2, \"div\", 20);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(3, \"svg\", 21);\n    i0.ɵɵelement(4, \"use\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(5, \"div\", 23);\n    i0.ɵɵtext(6, \" You have not created any facility. Please create one \");\n    i0.ɵɵelementStart(7, \"a\", 25);\n    i0.ɵɵtext(8, \"here\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(9, \". \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    \"d-none\": a0\n  };\n};\nfunction PurchasedEnergyComponent_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 8);\n    i0.ɵɵelementStart(2, \"div\", 9);\n    i0.ɵɵelementStart(3, \"mat-form-field\", 10);\n    i0.ɵɵelementStart(4, \"mat-label\", 11);\n    i0.ɵɵtext(5, \" Select supplier \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"mat-select\", 12);\n    i0.ɵɵelementStart(7, \"mat-option\");\n    i0.ɵɵelement(8, \"ngx-mat-select-search\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, PurchasedEnergyComponent_ng_container_4_mat_option_9_Template, 2, 2, \"mat-option\", 14);\n    i0.ɵɵpipe(10, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, PurchasedEnergyComponent_ng_container_4_mat_error_11_Template, 2, 0, \"mat-error\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(12, PurchasedEnergyComponent_ng_container_4_ng_container_12_Template, 10, 2, \"ng-container\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 8);\n    i0.ɵɵelementStart(14, \"div\", 16);\n    i0.ɵɵelementStart(15, \"mat-form-field\", 10);\n    i0.ɵɵelementStart(16, \"mat-label\", 11);\n    i0.ɵɵtext(17, \" Select facility\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"mat-select\", 17);\n    i0.ɵɵelementStart(19, \"mat-option\");\n    i0.ɵɵelement(20, \"ngx-mat-select-search\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(21, PurchasedEnergyComponent_ng_container_4_mat_option_21_Template, 2, 2, \"mat-option\", 14);\n    i0.ɵɵpipe(22, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(23, PurchasedEnergyComponent_ng_container_4_ng_container_23_Template, 10, 0, \"ng-container\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"appearance\", ctx_r0.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.getSearchUtil(\"supplierSearchUtil\")[\"filterFC\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(10, 10, ctx_r0.getSearchUtil(\"supplierSearchUtil\")[\"filteredEntities\"]));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.errorHandling(\"supplierID\", \"required\"));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.haveSuppliers);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(14, _c1, ctx_r0.currentOrgType == ctx_r0.OrgType.SITE));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"appearance\", ctx_r0.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.getSearchUtil(\"facilitySearchUtil\")[\"filterFC\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(22, 12, ctx_r0.getSearchUtil(\"facilitySearchUtil\")[\"filteredEntities\"]));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.haveFacilities);\n  }\n}\nfunction PurchasedEnergyComponent_ng_template_5_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 27);\n    i0.ɵɵelementStart(2, \"div\", 28);\n    i0.ɵɵelementStart(3, \"div\", 29);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 30);\n    i0.ɵɵelementStart(6, \"div\", 31);\n    i0.ɵɵelementStart(7, \"span\", 32);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const viewField_r11 = ctx.$implicit;\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", viewField_r11[\"title\"], \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"matTooltip\", (viewField_r11[\"value\"] == null ? null : viewField_r11[\"value\"].length) > 12 ? viewField_r11[\"value\"] : \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", (viewField_r11 == null ? null : viewField_r11[\"value\"]) && (viewField_r11[\"value\"] != null || (viewField_r11[\"value\"] == null ? null : viewField_r11[\"value\"].length)) ? viewField_r11[\"value\"] : ctx_r10.COMMON_CONSTANT.HYPHEN, \" \");\n  }\n}\nfunction PurchasedEnergyComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, PurchasedEnergyComponent_ng_template_5_ng_container_0_Template, 9, 3, \"ng-container\", 26);\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.viewFields);\n  }\n}\n/* tsc-library */\nexport let PurchasedEnergyComponent = /*#__PURE__*/(() => {\n  class PurchasedEnergyComponent {\n    constructor(activatedRoute, formBuilder, storageService, toastrService, supplierController, organizationController) {\n      this.activatedRoute = activatedRoute;\n      this.formBuilder = formBuilder;\n      this.toastrService = toastrService;\n      this.supplierController = supplierController;\n      this.organizationController = organizationController;\n      this.OrgType = OrgType;\n      this.MaterialFormFieldAppearance = MaterialFormFieldAppearance;\n      this.COMMON_CONSTANT = COMMON_CONSTANT;\n      this.fields = [{\n        width: 'col-sm-8',\n        key: 'supplier',\n        label: 'Supplier',\n        control: 'supplierID',\n        input: 'select',\n        type: 'select',\n        multiple: false,\n        search: true,\n        searchUtil: {\n          name: 'supplierSearchUtil',\n          placeholderLabel: 'Search by supplier name',\n          noEntriesFoundLabel: 'No matching supplier found',\n          searchBy: 'supplierName'\n        },\n        entityList: [],\n        validators: [{\n          validator: 'required',\n          error: 'Select a supplier'\n        }]\n      }, {\n        width: 'col-sm-8',\n        key: 'facility',\n        label: 'Facility',\n        control: 'orgID',\n        input: 'select',\n        type: 'select',\n        multiple: false,\n        search: true,\n        searchUtil: {\n          name: 'facilitySearchUtil',\n          placeholderLabel: 'Search by facility name',\n          noEntriesFoundLabel: 'No matching facility found',\n          searchBy: 'orgName'\n        },\n        entityList: [],\n        validators: []\n      }, {\n        view: true,\n        width: 'col-sm-12',\n        key: 'view',\n        control: 'supplierName',\n        title: 'Supplier',\n        value: 'supplier name'\n      }, {\n        view: true,\n        width: 'col-sm-12',\n        key: 'view',\n        control: 'orgName',\n        title: 'Facility',\n        value: 'Facility name'\n      }];\n      this.searchUtility = {};\n      this.isFactor = true;\n      this.haveSuppliers = true;\n      this.haveFacilities = true;\n      this.errorHandling = (control, error) => {\n        return this.referenceDataFG.get(control).hasError(error);\n      };\n      this.currentOrgID = parseInt(storageService.getStorage(['currentOrgID']));\n      this.currentOrgType = storageService.getStorage(['currentOrgType']);\n    }\n    setEntityList(key, list) {\n      this.fields.find(f => (f === null || f === void 0 ? void 0 : f.key) == key)['entityList'] = list;\n    }\n    createSearchUtilities() {\n      this.fields.forEach(ff => {\n        if (ff['input'] == 'select' && ff['search']) {\n          let searchUtil = ff['searchUtil'];\n          let name = searchUtil['name'];\n          this.searchUtility[name] = new MatSelectSearchService([searchUtil['searchBy']]);\n        }\n      });\n    }\n    getSearchUtil(util) {\n      return this.searchUtility[util];\n    }\n    ngOnInit() {\n      this.activatedRoute.parent.params.subscribe(params => {\n        if (params['factorID']) {\n          this.isFactor = false;\n        } else {\n          this.createSearchUtilities();\n        }\n        this.initFormGroup();\n      });\n    }\n    initFormGroup() {\n      this.referenceDataFG = this.formBuilder.group(this.createFormGroup());\n    }\n    createFormGroup() {\n      let formGroup = {};\n      if (this.isFactor) {\n        let formFields = this.fields.filter(ff => ff['key'] != 'view');\n        formFields.forEach(ff => {\n          formGroup[ff['control']] = this.formBuilder.control(null, Validators.compose(ff['validators'].map(v => Validators[v['validator']])));\n        });\n        if (this.currentOrgType == OrgType.ORGANIZATION) {\n          this.getOrganizationList();\n        } else if (this.currentOrgType == OrgType.SITE) {\n          formGroup['orgID'].patchValue(this.currentOrgID);\n        }\n        this.getSupplierByType();\n      } else {\n        this.viewFields = this.fields.filter(ff => ff['key'] == 'view');\n      }\n      return formGroup;\n    }\n    getSupplierByType() {\n      this.supplierController.getSupplierByType(this.currentOrgID, SupplierTypeKeyIDEnum.ENERGY_SUPPLIER).subscribe(supplierRes => {\n        this.haveSuppliers = (supplierRes === null || supplierRes === void 0 ? void 0 : supplierRes.length) > 0;\n        this.searchUtility['supplierSearchUtil'].entityArr = supplierRes;\n        this.searchUtility['supplierSearchUtil'].createSubscription();\n      }, error => {\n        console.log('error in getSupplier() -', error);\n        this.toastrService.openToast(error.error['title'], error.error['message'], error.error['result']);\n      });\n    }\n    getOrganizationList() {\n      this.organizationController.getOrganizationsByType(this.currentOrgID, OrgType.SITE).subscribe(facilityRes => {\n        this.haveFacilities = (facilityRes === null || facilityRes === void 0 ? void 0 : facilityRes.length) > 0;\n        this.searchUtility['facilitySearchUtil'].entityArr = facilityRes;\n        this.searchUtility['facilitySearchUtil'].createSubscription();\n      }, error => {\n        console.log('error in getOrganizationList() -', error);\n        this.toastrService.openToast(error.error['title'], error.error['message'], error.error['result']);\n      });\n    }\n    patchReference(reference) {\n      this.fields.forEach(ff => {\n        if (ff['key'] == 'view') {\n          ff['value'] = reference[ff['control']];\n        }\n      });\n    }\n    isValidForm() {\n      if (this.referenceDataFG.invalid) {\n        this.referenceDataFG.markAllAsTouched();\n        console.log('invalid form -', this.referenceDataFG);\n        return false;\n      }\n      return true;\n    }\n  }\n  PurchasedEnergyComponent.ɵfac = function PurchasedEnergyComponent_Factory(t) {\n    return new (t || PurchasedEnergyComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.StorageService), i0.ɵɵdirectiveInject(i4.ToastrService), i0.ɵɵdirectiveInject(i5.SupplierController), i0.ɵɵdirectiveInject(i6.OrganizationController));\n  };\n  PurchasedEnergyComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PurchasedEnergyComponent,\n    selectors: [[\"app-purchased-energy\"]],\n    decls: 10,\n    vars: 3,\n    consts: [[1, \"border\", \"cardOverwrite\"], [1, \"cardTitle\", \"pb-2\"], [3, \"formGroup\"], [4, \"ngIf\", \"ngIfElse\"], [\"elseBlock\", \"\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", 1, \"d-none\"], [\"id\", \"info-fill\", \"fill\", \"currentColor\", \"viewBox\", \"0 0 16 16\"], [\"d\", \"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z\"], [1, \"row\"], [1, \"col-sm-6\"], [1, \"matFieldWidth100\", 3, \"appearance\"], [1, \"formLabel\"], [\"formControlName\", \"supplierID\"], [\"placeholderLabel\", \"Search by supplier name\", \"noEntriesFoundLabel\", \"No matching supplier found.\", 3, \"formControl\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"col-sm-6\", 3, \"ngClass\"], [\"formControlName\", \"orgID\"], [\"placeholderLabel\", \"Search by facility name\", \"noEntriesFoundLabel\", \"No matching facility found.\", 3, \"formControl\"], [3, \"value\"], [1, \"alert\", \"alert-primary\", \"centerAlignVertical\", \"roundedBorder\"], [1, \"extraInfoCardIcon\"], [0, \"xlink\", \"href\", \"#info-fill\"], [1, \"extraInfoCardText\", \"ps-3\", \"fs-6\"], [\"target\", \"_blank\", 3, \"routerLink\"], [\"target\", \"_blank\"], [4, \"ngFor\", \"ngForOf\"], [1, \"row\", \"pb-3\", \"w-100\"], [1, \"col-sm-5\", \"centerAlignVertical\"], [1, \"col-form-label\", \"ms-1\"], [1, \"col-sm-7\", \"centerAlignVertical\"], [1, \"form-control-plaintext\", \"fw-bold\"], [\"matTooltipPosition\", \"above\", \"matTooltipClass\", \"nameTooltip\", 3, \"matTooltip\"]],\n    template: function PurchasedEnergyComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"mat-card\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵtext(2, \" Reference data \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"form\", 2);\n        i0.ɵɵtemplate(4, PurchasedEnergyComponent_ng_container_4_Template, 24, 16, \"ng-container\", 3);\n        i0.ɵɵtemplate(5, PurchasedEnergyComponent_ng_template_5_Template, 1, 1, \"ng-template\", null, 4, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(7, \"svg\", 5);\n        i0.ɵɵelementStart(8, \"symbol\", 6);\n        i0.ɵɵelement(9, \"path\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(6);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formGroup\", ctx.referenceDataFG);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isFactor)(\"ngIfElse\", _r1);\n      }\n    },\n    directives: [i7.MatCard, i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i8.NgIf, i9.MatFormField, i9.MatLabel, i10.MatSelect, i2.NgControlStatus, i2.FormControlName, i11.MatOption, i12.MatSelectSearchComponent, i2.FormControlDirective, i8.NgForOf, i8.NgClass, i9.MatError, i1.RouterLinkWithHref],\n    pipes: [i8.AsyncPipe],\n    encapsulation: 2\n  });\n  return PurchasedEnergyComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}