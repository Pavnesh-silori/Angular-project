{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { MaterialFormFieldAppearance, NocFileUploadEnum } from '@library/tsc-common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@library/toastr-service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/material/card\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/form-field\";\nimport * as i7 from \"@angular/material/input\";\nimport * as i8 from \"@angular/material/tooltip\";\nimport * as i9 from \"@angular/material/button\";\nimport * as i10 from \"@library/tsc-common\";\nconst _c0 = [\"fileInput\"];\nfunction SourceComponent_ng_container_6_ng_container_3_mat_error_5_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const validators_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", validators_r6[\"error\"], \" \");\n  }\n}\nfunction SourceComponent_ng_container_6_ng_container_3_mat_error_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtemplate(1, SourceComponent_ng_container_6_ng_container_3_mat_error_5_ng_container_1_Template, 2, 1, \"ng-container\", 11);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const validators_r6 = ctx.$implicit;\n    const field_r1 = i0.ɵɵnextContext(2).$implicit;\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.errorHandling(field_r1[\"control\"], validators_r6[\"validator\"]));\n  }\n}\nfunction SourceComponent_ng_container_6_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"mat-form-field\", 8);\n    i0.ɵɵelementStart(2, \"mat-label\", 9);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"input\", 10);\n    i0.ɵɵtemplate(5, SourceComponent_ng_container_6_ng_container_3_mat_error_5_Template, 2, 1, \"mat-error\", 4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const field_r1 = i0.ɵɵnextContext().$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"appearance\", ctx_r2.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(field_r1[\"label\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"type\", field_r1[\"type\"])(\"formControlName\", field_r1[\"control\"])(\"placeholder\", field_r1[\"placeholder\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", field_r1[\"validators\"]);\n  }\n}\nfunction SourceComponent_ng_container_6_ng_container_4_mat_error_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\", 22);\n    i0.ɵɵtext(1, \" Please upload a file \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction SourceComponent_ng_container_6_ng_container_4_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵelementStart(1, \"span\", 24);\n    i0.ɵɵtext(2, \" error \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction SourceComponent_ng_container_6_ng_container_4_div_13_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 30);\n    i0.ɵɵelementStart(2, \"a\", 31);\n    i0.ɵɵelementStart(3, \"span\", 32);\n    i0.ɵɵtext(4, \" open_in_new \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r15 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"href\", ctx_r15.fileUrl, i0.ɵɵsanitizeUrl);\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    \"col-sm-10\": a0\n  };\n};\nfunction SourceComponent_ng_container_6_ng_container_4_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵelementStart(1, \"div\", 26);\n    i0.ɵɵelementStart(2, \"div\", 27);\n    i0.ɵɵelement(3, \"img\", 28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 29);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"dotdotdot\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, SourceComponent_ng_container_6_ng_container_4_div_13_ng_container_7_Template, 5, 1, \"ng-container\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r14 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(6, _c1, !ctx_r14.fileUrl));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(6, 3, ctx_r14.fileName, 25), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r14.fileUrl);\n  }\n}\nfunction SourceComponent_ng_container_6_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵelementStart(2, \"div\", 12);\n    i0.ɵɵelementStart(3, \"span\", 13);\n    i0.ɵɵtext(4, \" Verification document \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, SourceComponent_ng_container_6_ng_container_4_mat_error_5_Template, 2, 0, \"mat-error\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 15);\n    i0.ɵɵelementStart(7, \"input\", 16, 17);\n    i0.ɵɵlistener(\"change\", function SourceComponent_ng_container_6_ng_container_4_Template_input_change_7_listener($event) {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext(2);\n      return ctx_r16.fileUpload($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerStart(9, 18);\n    i0.ɵɵtemplate(10, SourceComponent_ng_container_6_ng_container_4_button_10_Template, 3, 0, \"button\", 19);\n    i0.ɵɵelementStart(11, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function SourceComponent_ng_container_6_ng_container_4_Template_button_click_11_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const _r12 = i0.ɵɵreference(8);\n      return _r12.click();\n    });\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(13, SourceComponent_ng_container_6_ng_container_4_div_13_Template, 8, 8, \"div\", 21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.invalidFile);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.fileUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.fileUrl ? \"Upload new\" : \"Upload\", \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.fileName !== null);\n  }\n}\nfunction SourceComponent_ng_container_6_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵelementStart(2, \"div\", 33);\n    i0.ɵɵelementStart(3, \"div\", 34);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 35);\n    i0.ɵɵelementStart(6, \"div\", 36);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const field_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", field_r1[\"title\"], \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", field_r1[\"value\"], \" \");\n  }\n}\nfunction SourceComponent_ng_container_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\");\n    i0.ɵɵelementContainerStart(2, 5);\n    i0.ɵɵtemplate(3, SourceComponent_ng_container_6_ng_container_3_Template, 6, 6, \"ng-container\", 6);\n    i0.ɵɵtemplate(4, SourceComponent_ng_container_6_ng_container_4_Template, 14, 4, \"ng-container\", 6);\n    i0.ɵɵtemplate(5, SourceComponent_ng_container_6_ng_container_5_Template, 8, 2, \"ng-container\", 7);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const field_r1 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassMap(field_r1[\"width\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitch\", field_r1[\"input\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"input\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"file\");\n  }\n}\nexport let SourceComponent = /*#__PURE__*/(() => {\n  class SourceComponent {\n    constructor(activatedRoute, toastrService, formBuilder) {\n      this.activatedRoute = activatedRoute;\n      this.toastrService = toastrService;\n      this.formBuilder = formBuilder;\n      this.MaterialFormFieldAppearance = MaterialFormFieldAppearance;\n      this.formFields = [{\n        width: 'col-sm-12',\n        label: 'Source name',\n        control: 'name',\n        placeholder: 'Example heat supplier',\n        input: 'input',\n        type: 'text',\n        validators: [{\n          validator: 'required',\n          error: 'Name is mandatory'\n        }]\n      }, {\n        input: 'file',\n        control: '',\n        Validators: []\n      }];\n      this.isUpdate = false;\n      this.file = null;\n      this.fileName = null;\n      this.fileUrl = null;\n      this.invalidFile = false;\n      this.errorHandling = (control, error) => {\n        return this.sourceFG.get(control).hasError(error);\n      };\n    }\n    ngOnInit() {\n      this.initFormGroup();\n      this.activatedRoute.params.subscribe(params => {\n        if (params['versionID']) {\n          this.isUpdate = true;\n        }\n      });\n    }\n    initFormGroup() {\n      this.sourceFG = this.formBuilder.group(this.createFG());\n    }\n    createFG() {\n      let formGroup = {};\n      let formFields = this.formFields.filter(ff => ff['input'] == 'input');\n      formFields.forEach(ff => {\n        formGroup[ff['control']] = this.formBuilder.control(null, Validators.compose(ff['validators'].map(v => Validators[v['validator']])));\n      });\n      return formGroup;\n    }\n    fileUpload(event) {\n      if (event.target.files.length > 0) {\n        const file = event.target.files[0];\n        if (file.type !== 'application/pdf') {\n          this.resetFileInput();\n          this.toastrService.openToast(\"Error\", `${NocFileUploadEnum.INVALID_FILE_TYPE_ERROR}`, \"error\");\n          return;\n        } else if (file.size > NocFileUploadEnum.INVAID_FILE_SIZE_ERROR) {\n          this.resetFileInput();\n          this.toastrService.openToast(\"Error\", `${NocFileUploadEnum.MAX_FILE_SIZE}`, \"error\");\n          return;\n        }\n        const reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.addEventListener(\"load\", () => {\n          this.fileUrl = null;\n          this.file = file;\n          this.fileName = file.name;\n          this.invalidFile = false;\n        });\n        reader.addEventListener(\"abort\", () => {\n          this.resetFileInput();\n          this.toastrService.openToast(\"Error\", \"Something went wrong!\", \"error\");\n        });\n        reader.addEventListener(\"error\", () => {\n          this.resetFileInput();\n          this.toastrService.openToast(\"Error\", \"Error while uploading file!\", \"error\");\n        });\n      }\n    }\n    resetFileInput() {\n      this.file = null;\n      this.fileName = null;\n      this.fileInput.nativeElement.value = null;\n    }\n    patchSource(source) {\n      this.sourceFG.patchValue(source);\n      if (source['fileName'] && source['fileUrl']) {\n        this.fileName = source['fileName'];\n        this.fileUrl = source['fileUrl'];\n      }\n    }\n    isValidForm() {\n      if (this.sourceFG.invalid) {\n        if (!this.isUpdate && this.file == null) this.invalidFile = true;\n        this.sourceFG.markAllAsTouched();\n        return false;\n      }\n      if (!this.isUpdate && this.file == null) {\n        this.invalidFile = true;\n        return false;\n      }\n      return true;\n    }\n  }\n  SourceComponent.ɵfac = function SourceComponent_Factory(t) {\n    return new (t || SourceComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ToastrService), i0.ɵɵdirectiveInject(i3.FormBuilder));\n  };\n  SourceComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SourceComponent,\n    selectors: [[\"factor-source\"]],\n    viewQuery: function SourceComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.fileInput = _t.first);\n      }\n    },\n    decls: 7,\n    vars: 2,\n    consts: [[1, \"border\", \"cardOverwrite\"], [1, \"cardTitle\", \"pb-2\"], [3, \"formGroup\"], [1, \"row\"], [4, \"ngFor\", \"ngForOf\"], [3, \"ngSwitch\"], [4, \"ngSwitchCase\"], [4, \"ngSwitchDefault\"], [1, \"matFieldWidth100\", 3, \"appearance\"], [1, \"formLabel\"], [\"matInput\", \"\", 1, \"formPlaceholder\", 3, \"type\", \"formControlName\", \"placeholder\"], [4, \"ngIf\"], [1, \"col-sm-7\", 2, \"height\", \"41px\"], [1, \"ps-2\", \"fs-5\"], [\"class\", \"ms-2 ps-1 fw-normal\", \"style\", \"font-size: 10px;\", 4, \"ngIf\"], [1, \"col-sm-5\"], [\"type\", \"file\", \"accept\", \"application/pdf\", 1, \"d-none\", 3, \"change\"], [\"fileInput\", \"\"], [\"align\", \"end\"], [\"class\", \"btn float-end\", \"type\", \"button\", \"matTooltip\", \"Uploading a new document will result in deletion of previously uploaded document!\", \"matTooltipPosition\", \"above\", \"matTooltipClass\", \"nameTooltip\", 4, \"ngIf\"], [\"type\", \"button\", 1, \"btn\", \"btn-light\", \"float-end\", 3, \"click\"], [\"class\", \"col-sm-12 mt-1\", 4, \"ngIf\"], [1, \"ms-2\", \"ps-1\", \"fw-normal\", 2, \"font-size\", \"10px\"], [\"type\", \"button\", \"matTooltip\", \"Uploading a new document will result in deletion of previously uploaded document!\", \"matTooltipPosition\", \"above\", \"matTooltipClass\", \"nameTooltip\", 1, \"btn\", \"float-end\"], [\"mat-icon-button\", \"\", 1, \"material-symbols-outlined\", \"text-warning\"], [1, \"col-sm-12\", \"mt-1\"], [1, \"row\", \"border\", \"border-2\", \"rounded\", \"cardOverwrite\", \"m-1\", \"p-2\"], [1, \"col-sm-2\", \"docIcon\", \"centerAlign\"], [\"height\", \"50px\", \"src\", \"assets/images/default-doc.ico\", \"alt\", \"verification document preview\"], [1, \"col-sm-8\", \"centerAlign\", 2, \"font-family\", \"Roboto, Helvetica Neue, sans-serif\", 3, \"ngClass\"], [1, \"col-sm-2\", \"centerAlignVertical\"], [\"target\", \"_blank\", \"mat-icon-button\", \"\", \"matTooltip\", \"Open file in new window\", \"matTooltipPosition\", \"above\", 1, \"btn\", \"text-primary\", 3, \"href\"], [1, \"material-symbols-outlined\"], [1, \"col-sm-4\"], [1, \"col-form-label\", \"fs-5\", \"fw-bold\"], [1, \"col-sm-8\"], [1, \"form-control-plaintext\", \"fw-bold\"]],\n    template: function SourceComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"mat-card\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵtext(2, \" Factor source \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"form\", 2);\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵelementStart(5, \"div\", 3);\n        i0.ɵɵtemplate(6, SourceComponent_ng_container_6_Template, 6, 5, \"ng-container\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formGroup\", ctx.sourceFG);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.formFields);\n      }\n    },\n    directives: [i4.MatCard, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i5.NgForOf, i5.NgSwitch, i5.NgSwitchCase, i5.NgSwitchDefault, i6.MatFormField, i6.MatLabel, i7.MatInput, i3.DefaultValueAccessor, i3.NgControlStatus, i3.FormControlName, i6.MatError, i5.NgIf, i8.MatTooltip, i5.NgClass, i9.MatAnchor],\n    pipes: [i10.EllipsisPipeService],\n    encapsulation: 2\n  });\n  return SourceComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}