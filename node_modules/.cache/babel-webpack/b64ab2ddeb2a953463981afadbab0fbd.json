{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Validators } from '@angular/forms';\n// tsc-library\nimport { ButtonTooltipEnum, COMMON_CONSTANT, FormErrorEnum, InvalidForm, MATERIAL_CONSTANT, MatSelectSearchService, MaterialFormFieldAppearance } from '@library/tsc-common';\nimport { ToastrColor, ToastrTitle } from '@library/toastr-service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"@carbon/service/product.service \";\nimport * as i4 from \"@library/storage-service\";\nimport * as i5 from \"@library/toastr-service\";\nimport * as i6 from \"@library/date\";\nimport * as i7 from \"@carbon/controller/cbam-run.controller\";\nimport * as i8 from \"@angular/material/core\";\nimport * as i9 from \"@angular/material/tooltip\";\nimport * as i10 from \"@angular/material/form-field\";\nimport * as i11 from \"@angular/material/select\";\nimport * as i12 from \"ngx-mat-select-search\";\nimport * as i13 from \"@angular/common\";\nfunction CreateComponent_mat_option_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 21);\n    i0.ɵɵelementStart(1, \"span\", 22);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const product_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", product_r6.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", product_r6.name, \" \");\n  }\n}\nfunction CreateComponent_mat_error_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formErrorEnum.REQUIRED, \" \");\n  }\n}\nfunction CreateComponent_ng_container_21_ng_container_1_mat_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const route_r12 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", route_r12.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", route_r12.name, \" \");\n  }\n}\nfunction CreateComponent_ng_container_21_ng_container_1_mat_error_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r11 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r11.formErrorEnum.REQUIRED, \" \");\n  }\n}\nfunction CreateComponent_ng_container_21_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 9);\n    i0.ɵɵelementStart(2, \"mat-form-field\", 10);\n    i0.ɵɵelementStart(3, \"mat-label\", 11);\n    i0.ɵɵtext(4, \"Select Production Route\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mat-select\", 25);\n    i0.ɵɵelementStart(6, \"mat-option\");\n    i0.ɵɵelement(7, \"ngx-mat-select-search\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, CreateComponent_ng_container_21_ng_container_1_mat_option_8_Template, 2, 2, \"mat-option\", 14);\n    i0.ɵɵpipe(9, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, CreateComponent_ng_container_21_ng_container_1_mat_error_10_Template, 2, 1, \"mat-error\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"appearance\", ctx_r7.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"formControl\", ctx_r7.productionRouteSearchUtil.filterFC)(\"noEntriesFoundLabel\", ctx_r7.COMMON_CONSTANT.NO_MATCH_FOUND);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(9, 5, ctx_r7.productionRouteSearchUtil.filteredEntities));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r7.errorHandling(\"productionRouteID\", \"required\"));\n  }\n}\nfunction CreateComponent_ng_container_21_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1, \"No production route available for this product. \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"div\", 27);\n    i0.ɵɵelementStart(3, \"a\", 28);\n    i0.ɵɵtext(4, \"Click here to create a production route\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"value\", null);\n  }\n}\nfunction CreateComponent_ng_container_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CreateComponent_ng_container_21_ng_container_1_Template, 11, 7, \"ng-container\", 23);\n    i0.ɵɵtemplate(2, CreateComponent_ng_container_21_ng_template_2_Template, 5, 1, \"ng-template\", null, 24, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const _r8 = i0.ɵɵreference(3);\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.productionRoute.length > 0)(\"ngIfElse\", _r8);\n  }\n}\nconst _c0 = function (a0, a1) {\n  return {\n    startDate: a0,\n    endDate: a1\n  };\n};\nfunction CreateComponent_mat_option_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const period_r13 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", i0.ɵɵpureFunction2(2, _c0, period_r13.startDate, period_r13.endDate));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", period_r13.name, \" \");\n  }\n}\nfunction CreateComponent_mat_error_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r4.formErrorEnum.REQUIRED, \" \");\n  }\n}\n// /tsc-library/\nexport let CreateComponent = /*#__PURE__*/(() => {\n  class CreateComponent {\n    constructor(formBuilder, dialogRef, productService, storageService, toastrService, dateService, cbamRunController) {\n      this.formBuilder = formBuilder;\n      this.dialogRef = dialogRef;\n      this.productService = productService;\n      this.storageService = storageService;\n      this.toastrService = toastrService;\n      this.dateService = dateService;\n      this.cbamRunController = cbamRunController;\n      this.COMMON_CONSTANT = COMMON_CONSTANT;\n      this.MATERIAL_CONSTANT = MATERIAL_CONSTANT;\n      this.MaterialFormFieldAppearance = MaterialFormFieldAppearance;\n      this.ButtonTooltipEnum = ButtonTooltipEnum;\n      this.formErrorEnum = FormErrorEnum;\n      this.products = [];\n      this.productSearchUtil = new MatSelectSearchService(['name']);\n      this.productionRoute = [];\n      this.productionRouteSearchUtil = new MatSelectSearchService(['name']);\n      this.reportingPeriod = [];\n      this.errorHandling = (control, error) => {\n        return this.newRunFG.controls[control].hasError(error);\n      };\n      this.dialogRef.disableClose = true;\n    }\n    ngOnInit() {\n      this.currentOrgID = this.storageService.getStorage('currentOrgID');\n      this.formDetailsInit();\n      this.getProducts();\n      this.getReportingPeriod();\n    }\n    formDetailsInit() {\n      this.newRunFG = this.formBuilder.group({\n        productID: [, Validators.required],\n        productionRouteID: [, Validators.required],\n        reportingPeriod: [, Validators.required]\n      });\n      this.newRunFG.get('productID').valueChanges.subscribe(value => {\n        this.newRunFG.get('productionRouteID').reset();\n        this.getProductionRoutes(value);\n      });\n    }\n    getProducts() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.products = yield this.productService.getProductionRoute(this.currentOrgID);\n        let cbamProducts = this.products.filter(source => source.isCbam == true);\n        this.products = cbamProducts;\n        this.productSearchUtil.entityArr = this.products;\n        this.productSearchUtil.createSubscription();\n      });\n    }\n    getProductionRoutes(value) {\n      const selectedProduct = this.products.find(product => product.id == value);\n      this.productionRoute = selectedProduct.productionRoute ? selectedProduct.productionRoute : [];\n      this.productionRouteSearchUtil.entityArr = this.productionRoute;\n      this.productionRouteSearchUtil.createSubscription();\n    }\n    getReportingPeriod() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.reportingPeriod = yield this.dateService.getReportingPeriodList(this.currentOrgID, 2);\n      });\n    }\n    getValidation() {\n      if (this.newRunFG.invalid) {\n        this.newRunFG.markAllAsTouched();\n        this.toastrService.openToast(ToastrTitle.ERROR, InvalidForm.INVALID_FORM_MESSAGE, ToastrColor.ERROR);\n        return false;\n      }\n      this.cbamRunController.getValidation(this.currentOrgID, this.newRunFG.value.productID, this.newRunFG.value.productionRouteID, this.newRunFG.value.reportingPeriod.startDate, this.newRunFG.value.reportingPeriod.endDate).subscribe(res => {\n        this.configFound = res.response.configFound;\n        if (this.configFound) {\n          this.toastrService.openToast(ToastrTitle.ERROR, res.message, ToastrColor.ERROR);\n          return;\n        } else {\n          if (!this.newRunFG.invalid) this.dialogRef.close({\n            newRunFG: this.newRunFG.value,\n            status: true\n          });\n          return;\n        }\n      });\n    }\n  }\n  CreateComponent.ɵfac = function CreateComponent_Factory(t) {\n    return new (t || CreateComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MatDialogRef), i0.ɵɵdirectiveInject(i3.ProductService), i0.ɵɵdirectiveInject(i4.StorageService), i0.ɵɵdirectiveInject(i5.ToastrService), i0.ɵɵdirectiveInject(i6.DateService), i0.ɵɵdirectiveInject(i7.CbamRunController));\n  };\n  CreateComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CreateComponent,\n    selectors: [[\"app-create\"]],\n    decls: 35,\n    vars: 16,\n    consts: [[1, \"headerContainer\", \"p-0\"], [1, \"headerLeftContainer\"], [1, \"pageTitle\"], [1, \"headerRightContainer\"], [1, \"headerRightContainerInner\"], [\"matRipple\", \"\", \"matTooltipPosition\", \"below\", \"mat-dialog-close\", \"\", 1, \"btn\", \"btn-sm\", \"centerAlign\", \"py-1\", \"iconBtn\", 3, \"matRippleCentered\", \"matTooltip\"], [1, \"material-symbols-outlined\"], [1, \"mat-typography\", \"pt-2\"], [3, \"formGroup\"], [1, \"row\"], [1, \"matFieldWidth100\", 3, \"appearance\"], [1, \"formLabel\"], [\"formControlName\", \"productID\"], [\"placeholderLabel\", \"Search by product name\", 3, \"formControl\", \"noEntriesFoundLabel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [\"formControlName\", \"reportingPeriod\"], [1, \"tscDialogFooter\"], [\"footer\", \"\"], [\"type\", \"button\", \"matRipple\", \"\", 1, \"btn\", \"btn-sm\", \"btn-success\", 3, \"matRippleCentered\", \"click\"], [\"mat-dialog-close\", \"\", \"matRipple\", \"\", 1, \"btn\", \"btn-sm\", \"btn-secondary\", \"me-2\", 3, \"matRippleCentered\"], [3, \"value\"], [1, \"d-flex\", \"justify-content-between\"], [4, \"ngIf\", \"ngIfElse\"], [\"noRoutes\", \"\"], [\"formControlName\", \"productionRouteID\"], [\"placeholderLabel\", \"Search by production route name\", 3, \"formControl\", \"noEntriesFoundLabel\"], [1, \"mb-3\"], [\"href\", \"/source/production-route/create\"]],\n    template: function CreateComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵtext(3, \"New CBAM Run\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵelementStart(5, \"div\", 4);\n        i0.ɵɵelementStart(6, \"button\", 5);\n        i0.ɵɵelementStart(7, \"span\", 6);\n        i0.ɵɵtext(8, \" close \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"mat-dialog-content\", 7);\n        i0.ɵɵelementStart(10, \"form\", 8);\n        i0.ɵɵelementStart(11, \"div\", 9);\n        i0.ɵɵelementStart(12, \"mat-form-field\", 10);\n        i0.ɵɵelementStart(13, \"mat-label\", 11);\n        i0.ɵɵtext(14, \"Select CBAM Product\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"mat-select\", 12);\n        i0.ɵɵelementStart(16, \"mat-option\");\n        i0.ɵɵelement(17, \"ngx-mat-select-search\", 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(18, CreateComponent_mat_option_18_Template, 3, 2, \"mat-option\", 14);\n        i0.ɵɵpipe(19, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(20, CreateComponent_mat_error_20_Template, 2, 1, \"mat-error\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(21, CreateComponent_ng_container_21_Template, 4, 2, \"ng-container\", 15);\n        i0.ɵɵelementStart(22, \"div\", 9);\n        i0.ɵɵelementStart(23, \"mat-form-field\", 10);\n        i0.ɵɵelementStart(24, \"mat-label\", 11);\n        i0.ɵɵtext(25, \"Select Reporting Period\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"mat-select\", 16);\n        i0.ɵɵtemplate(27, CreateComponent_mat_option_27_Template, 2, 5, \"mat-option\", 14);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(28, CreateComponent_mat_error_28_Template, 2, 1, \"mat-error\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"div\", 17, 18);\n        i0.ɵɵelementStart(31, \"button\", 19);\n        i0.ɵɵlistener(\"click\", function CreateComponent_Template_button_click_31_listener() {\n          return ctx.getValidation();\n        });\n        i0.ɵɵtext(32, \"Start Configuring\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"button\", 20);\n        i0.ɵɵtext(34, \"Cancel\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"matRippleCentered\", ctx.MATERIAL_CONSTANT.MAT_RIPPLE_CENTER)(\"matTooltip\", ctx.ButtonTooltipEnum.CLOSE);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"formGroup\", ctx.newRunFG);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"appearance\", ctx.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"formControl\", ctx.productSearchUtil.filterFC)(\"noEntriesFoundLabel\", ctx.COMMON_CONSTANT.NO_MATCH_FOUND);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(19, 14, ctx.productSearchUtil.filteredEntities));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorHandling(\"productID\", \"required\"));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.newRunFG.get(\"productID\").value);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"appearance\", ctx.MaterialFormFieldAppearance.FORM_FIELD_APPEARANCE);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.reportingPeriod);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorHandling(\"reportingPeriod\", \"required\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"matRippleCentered\", ctx.MATERIAL_CONSTANT.MAT_RIPPLE_CENTER);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"matRippleCentered\", ctx.MATERIAL_CONSTANT.MAT_RIPPLE_CENTER);\n      }\n    },\n    directives: [i8.MatRipple, i2.MatDialogClose, i9.MatTooltip, i2.MatDialogContent, i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i10.MatFormField, i10.MatLabel, i11.MatSelect, i1.NgControlStatus, i1.FormControlName, i8.MatOption, i12.MatSelectSearchComponent, i1.FormControlDirective, i13.NgForOf, i13.NgIf, i10.MatError],\n    pipes: [i13.AsyncPipe],\n    encapsulation: 2\n  });\n  return CreateComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}