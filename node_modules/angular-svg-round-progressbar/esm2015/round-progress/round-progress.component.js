import { Component, Input, Output, NgZone, EventEmitter, ViewChild, Inject, ChangeDetectionStrategy, } from '@angular/core';
import { RoundProgressService } from './round-progress.service';
import { ROUND_PROGRESS_DEFAULTS } from './round-progress.config';
import { RoundProgressEase } from './round-progress.ease';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './round-progress.service';
import * as ɵngcc2 from './round-progress.ease';

const _c0 = ["path"];
export class RoundProgressComponent {
    constructor(service, easing, defaults, ngZone) {
        this.service = service;
        this.easing = easing;
        this.defaults = defaults;
        this.ngZone = ngZone;
        /** Radius of the circle. */
        this.radius = this.defaults.radius;
        /** Name of the easing function to use when animating. */
        this.animation = this.defaults.animation;
        /** Time in millisconds by which to delay the animation. */
        this.animationDelay = this.defaults.animationDelay;
        /** Duration of the animation. */
        this.duration = this.defaults.duration;
        /** Width of the circle's stroke. */
        this.stroke = this.defaults.stroke;
        /** Color of the circle. */
        this.color = this.defaults.color;
        /** Background color of the circle. */
        this.background = this.defaults.background;
        /** Whether the circle should take up the width of its parent. */
        this.responsive = this.defaults.responsive;
        /** Whether the circle is filling up clockwise. */
        this.clockwise = this.defaults.clockwise;
        /** Whether to render a semicircle. */
        this.semicircle = this.defaults.semicircle;
        /** Whether the tip of the progress should be rounded off. */
        this.rounded = this.defaults.rounded;
        /** Emits when a new value has been rendered. */
        this.onRender = new EventEmitter();
        this.lastAnimationId = 0;
    }
    /** Animates a change in the current value. */
    _animateChange(from, to) {
        if (typeof from !== 'number') {
            from = 0;
        }
        to = this._clamp(to);
        from = this._clamp(from);
        const self = this;
        const changeInValue = to - from;
        const duration = self.duration;
        // Avoid firing change detection for each of the animation frames.
        self.ngZone.runOutsideAngular(() => {
            const start = () => {
                const startTime = self.service.getTimestamp();
                const id = ++self.lastAnimationId;
                requestAnimationFrame(function animation() {
                    const currentTime = Math.min(self.service.getTimestamp() - startTime, duration);
                    const value = self.easing[self.animation](currentTime, from, changeInValue, duration);
                    self._setPath(value);
                    self.onRender.emit(value);
                    if (id === self.lastAnimationId && currentTime < duration) {
                        requestAnimationFrame(animation);
                    }
                });
            };
            if (this.animationDelay > 0) {
                setTimeout(start, this.animationDelay);
            }
            else {
                start();
            }
        });
    }
    /** Sets the path dimensions. */
    _setPath(value) {
        if (this.path) {
            const arc = this.service.getArc(value, this.max, this.radius - this.stroke / 2, this.radius, this.semicircle);
            this.path.nativeElement.setAttribute('d', arc);
        }
    }
    /** Clamps a value between the maximum and 0. */
    _clamp(value) {
        return Math.max(0, Math.min(value || 0, this.max));
    }
    /** Determines the SVG transforms for the <path> node. */
    getPathTransform() {
        const diameter = this._getDiameter();
        if (this.semicircle) {
            return this.clockwise
                ? `translate(0, ${diameter}) rotate(-90)`
                : `translate(${diameter + ',' + diameter}) rotate(90) scale(-1, 1)`;
        }
        else if (!this.clockwise) {
            return `scale(-1, 1) translate(-${diameter} 0)`;
        }
    }
    /** Resolves a color through the service. */
    resolveColor(color) {
        return this.service.resolveColor(color);
    }
    /** Change detection callback. */
    ngOnChanges(changes) {
        if (changes.current) {
            this._animateChange(changes.current.previousValue, changes.current.currentValue);
        }
        else {
            this._setPath(this.current);
        }
    }
    /** Diameter of the circle. */
    _getDiameter() {
        return this.radius * 2;
    }
    /** The CSS height of the wrapper element. */
    _getElementHeight() {
        if (!this.responsive) {
            return (this.semicircle ? this.radius : this._getDiameter()) + 'px';
        }
    }
    /** Viewbox for the SVG element. */
    _getViewBox() {
        const diameter = this._getDiameter();
        return `0 0 ${diameter} ${this.semicircle ? this.radius : diameter}`;
    }
    /** Bottom padding for the wrapper element. */
    _getPaddingBottom() {
        if (this.responsive) {
            return this.semicircle ? '50%' : '100%';
        }
    }
}
RoundProgressComponent.ɵfac = function RoundProgressComponent_Factory(t) { return new (t || RoundProgressComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.RoundProgressService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.RoundProgressEase), ɵngcc0.ɵɵdirectiveInject(ROUND_PROGRESS_DEFAULTS), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
RoundProgressComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: RoundProgressComponent, selectors: [["round-progress"]], viewQuery: function RoundProgressComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.path = _t.first);
    } }, hostAttrs: ["role", "progressbar"], hostVars: 10, hostBindings: function RoundProgressComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵattribute("aria-valuemin", ctx.current)("aria-valuemax", ctx.max);
        ɵngcc0.ɵɵstyleProp("width", ctx.responsive ? "" : ctx._getDiameter() + "px")("height", ctx._getElementHeight())("padding-bottom", ctx._getPaddingBottom());
        ɵngcc0.ɵɵclassProp("responsive", ctx.responsive);
    } }, inputs: { radius: "radius", animation: "animation", animationDelay: "animationDelay", duration: "duration", stroke: "stroke", color: "color", background: "background", responsive: "responsive", clockwise: "clockwise", semicircle: "semicircle", rounded: "rounded", current: "current", max: "max" }, outputs: { onRender: "onRender" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 4, vars: 15, consts: [["xmlns", "http://www.w3.org/2000/svg"], ["fill", "none"], ["path", ""]], template: function RoundProgressComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵnamespaceSVG();
        ɵngcc0.ɵɵelementStart(0, "svg", 0);
        ɵngcc0.ɵɵelement(1, "circle", 1);
        ɵngcc0.ɵɵelement(2, "path", 1, 2);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("viewBox", ctx._getViewBox());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵstyleProp("stroke", ctx.resolveColor(ctx.background))("stroke-width", ctx.stroke);
        ɵngcc0.ɵɵattribute("cx", ctx.radius)("cy", ctx.radius)("r", ctx.radius - ctx.stroke / 2);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵstyleProp("stroke-width", ctx.stroke)("stroke", ctx.resolveColor(ctx.color))("stroke-linecap", ctx.rounded ? "round" : "");
        ɵngcc0.ɵɵattribute("transform", ctx.getPathTransform());
    } }, styles: ["[_nghost-%COMP%]{display:block;overflow:hidden;position:relative}.responsive[_nghost-%COMP%]{padding-bottom:100%;width:100%}.responsive[_nghost-%COMP%] > svg[_ngcontent-%COMP%]{height:100%;left:0;position:absolute;top:0;width:100%}"], changeDetection: 0 });
RoundProgressComponent.ctorParameters = () => [
    { type: RoundProgressService },
    { type: RoundProgressEase },
    { type: undefined, decorators: [{ type: Inject, args: [ROUND_PROGRESS_DEFAULTS,] }] },
    { type: NgZone }
];
RoundProgressComponent.propDecorators = {
    path: [{ type: ViewChild, args: ['path',] }],
    current: [{ type: Input }],
    max: [{ type: Input }],
    radius: [{ type: Input }],
    animation: [{ type: Input }],
    animationDelay: [{ type: Input }],
    duration: [{ type: Input }],
    stroke: [{ type: Input }],
    color: [{ type: Input }],
    background: [{ type: Input }],
    responsive: [{ type: Input }],
    clockwise: [{ type: Input }],
    semicircle: [{ type: Input }],
    rounded: [{ type: Input }],
    onRender: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(RoundProgressComponent, [{
        type: Component,
        args: [{
                selector: 'round-progress',
                changeDetection: ChangeDetectionStrategy.OnPush,
                template: "<svg xmlns=\"http://www.w3.org/2000/svg\" [attr.viewBox]=\"_getViewBox()\">\n  <circle\n    fill=\"none\"\n    [attr.cx]=\"radius\"\n    [attr.cy]=\"radius\"\n    [attr.r]=\"radius - stroke / 2\"\n    [style.stroke]=\"resolveColor(background)\"\n    [style.stroke-width]=\"stroke\"/>\n\n  <path\n    #path\n    fill=\"none\"\n    [style.stroke-width]=\"stroke\"\n    [style.stroke]=\"resolveColor(color)\"\n    [style.stroke-linecap]=\"rounded ? 'round' : ''\"\n    [attr.transform]=\"getPathTransform()\"/>\n</svg>\n",
                host: {
                    role: 'progressbar',
                    '[attr.aria-valuemin]': 'current',
                    '[attr.aria-valuemax]': 'max',
                    '[style.width]': 'responsive ? "" : _getDiameter() + "px"',
                    '[style.height]': '_getElementHeight()',
                    '[style.padding-bottom]': '_getPaddingBottom()',
                    '[class.responsive]': 'responsive'
                },
                styles: [":host{display:block;overflow:hidden;position:relative}:host(.responsive){padding-bottom:100%;width:100%}:host(.responsive)>svg{height:100%;left:0;position:absolute;top:0;width:100%}"]
            }]
    }], function () { return [{ type: ɵngcc1.RoundProgressService }, { type: ɵngcc2.RoundProgressEase }, { type: undefined, decorators: [{
                type: Inject,
                args: [ROUND_PROGRESS_DEFAULTS]
            }] }, { type: ɵngcc0.NgZone }]; }, { radius: [{
            type: Input
        }], animation: [{
            type: Input
        }], animationDelay: [{
            type: Input
        }], duration: [{
            type: Input
        }], stroke: [{
            type: Input
        }], color: [{
            type: Input
        }], background: [{
            type: Input
        }], responsive: [{
            type: Input
        }], clockwise: [{
            type: Input
        }], semicircle: [{
            type: Input
        }], rounded: [{
            type: Input
        }], onRender: [{
            type: Output
        }], path: [{
            type: ViewChild,
            args: ['path']
        }], current: [{
            type: Input
        }], max: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91bmQtcHJvZ3Jlc3MuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL3JvdW5kLXByb2dyZXNzL3JvdW5kLXByb2dyZXNzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxNQUFNLEVBRU4sTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1QsTUFBTSxFQUdOLHVCQUF1QixHQUN4QixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUM5RCxPQUFPLEVBQUMsdUJBQXVCLEVBQXdCLE1BQU0seUJBQXlCLENBQUM7QUFDdkYsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sdUJBQXVCLENBQUM7Ozs7OztBQWlCeEQsTUFBTSxPQUFPLHNCQUFzQjtBQUFJLElBZ0RyQyxZQUNVLE9BQTZCLEVBQzdCLE1BQXlCLEVBQ1EsUUFBK0IsRUFDaEUsTUFBYztBQUN0QixRQUpRLFlBQU8sR0FBUCxPQUFPLENBQXNCO0FBQ3pDLFFBQVksV0FBTSxHQUFOLE1BQU0sQ0FBbUI7QUFDckMsUUFBNkMsYUFBUSxHQUFSLFFBQVEsQ0FBdUI7QUFDNUUsUUFBWSxXQUFNLEdBQU4sTUFBTSxDQUFRO0FBQ3pCLFFBM0NDLDRCQUE0QjtBQUM3QixRQUFVLFdBQU0sR0FBVyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztBQUVqRCxRQUFFLHlEQUF5RDtBQUMxRCxRQUFVLGNBQVMsR0FBVyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztBQUV2RCxRQUFFLDJEQUEyRDtBQUM1RCxRQUFVLG1CQUFjLEdBQVcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUM7QUFFakUsUUFBRSxpQ0FBaUM7QUFDbEMsUUFBVSxhQUFRLEdBQVcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUM7QUFFckQsUUFB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R1gsS0FBSztBQUFNLHdCQUdYLEtBQUs7QUFBTSx5QkFHWCxLQUFLO0FBQU0sc0JBR1gsS0FBSztBQUFNLHVCQUdYLE1BQU07QUFBSzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE3RUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFHQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFpQkEsQUFBQSxBQUFBLEFBQUEsQUFnREEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBSEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQTFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFPQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQTdLQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFsQkEsQUFBQSxBQUVBLEFBQUEsQUFvRUEsQUFBQSxBQUFBLEFBQUEsQUEvRUEsQUFBQSxBQThCQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBPbkNoYW5nZXMsXG4gIE5nWm9uZSxcbiAgRXZlbnRFbWl0dGVyLFxuICBWaWV3Q2hpbGQsXG4gIEluamVjdCxcbiAgRWxlbWVudFJlZixcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1JvdW5kUHJvZ3Jlc3NTZXJ2aWNlfSBmcm9tICcuL3JvdW5kLXByb2dyZXNzLnNlcnZpY2UnO1xuaW1wb3J0IHtST1VORF9QUk9HUkVTU19ERUZBVUxUUywgUm91bmRQcm9ncmVzc0RlZmF1bHRzfSBmcm9tICcuL3JvdW5kLXByb2dyZXNzLmNvbmZpZyc7XG5pbXBvcnQge1JvdW5kUHJvZ3Jlc3NFYXNlfSBmcm9tICcuL3JvdW5kLXByb2dyZXNzLmVhc2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdyb3VuZC1wcm9ncmVzcycsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICB0ZW1wbGF0ZVVybDogJy4vcm91bmQtcHJvZ3Jlc3MuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9yb3VuZC1wcm9ncmVzcy5jb21wb25lbnQuY3NzJ10sXG4gIGhvc3Q6IHtcbiAgICByb2xlOiAncHJvZ3Jlc3NiYXInLFxuICAgICdbYXR0ci5hcmlhLXZhbHVlbWluXSc6ICdjdXJyZW50JyxcbiAgICAnW2F0dHIuYXJpYS12YWx1ZW1heF0nOiAnbWF4JyxcbiAgICAnW3N0eWxlLndpZHRoXSc6ICdyZXNwb25zaXZlID8gXCJcIiA6IF9nZXREaWFtZXRlcigpICsgXCJweFwiJyxcbiAgICAnW3N0eWxlLmhlaWdodF0nOiAnX2dldEVsZW1lbnRIZWlnaHQoKScsXG4gICAgJ1tzdHlsZS5wYWRkaW5nLWJvdHRvbV0nOiAnX2dldFBhZGRpbmdCb3R0b20oKScsXG4gICAgJ1tjbGFzcy5yZXNwb25zaXZlXSc6ICdyZXNwb25zaXZlJyxcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBSb3VuZFByb2dyZXNzQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgLyoqIFJlZmVyZW5jZSB0byB0aGUgdW5kZXJseWluZyBgcGF0aGAgbm9kZS4gKi9cbiAgQFZpZXdDaGlsZCgncGF0aCcpIHBhdGg6IEVsZW1lbnRSZWY7XG5cbiAgLyoqIEN1cnJlbnQgdmFsdWUgb2YgdGhlIHByb2dyZXNzIGJhci4gKi9cbiAgQElucHV0KCkgY3VycmVudDogbnVtYmVyO1xuXG4gIC8qKiBNYXhpbXVtIHZhbHVlIG9mIHRoZSBwcm9ncmVzcyBiYXIuICovXG4gIEBJbnB1dCgpIG1heDogbnVtYmVyO1xuXG4gIC8qKiBSYWRpdXMgb2YgdGhlIGNpcmNsZS4gKi9cbiAgQElucHV0KCkgcmFkaXVzOiBudW1iZXIgPSB0aGlzLmRlZmF1bHRzLnJhZGl1cztcblxuICAvKiogTmFtZSBvZiB0aGUgZWFzaW5nIGZ1bmN0aW9uIHRvIHVzZSB3aGVuIGFuaW1hdGluZy4gKi9cbiAgQElucHV0KCkgYW5pbWF0aW9uOiBzdHJpbmcgPSB0aGlzLmRlZmF1bHRzLmFuaW1hdGlvbjtcblxuICAvKiogVGltZSBpbiBtaWxsaXNjb25kcyBieSB3aGljaCB0byBkZWxheSB0aGUgYW5pbWF0aW9uLiAqL1xuICBASW5wdXQoKSBhbmltYXRpb25EZWxheTogbnVtYmVyID0gdGhpcy5kZWZhdWx0cy5hbmltYXRpb25EZWxheTtcblxuICAvKiogRHVyYXRpb24gb2YgdGhlIGFuaW1hdGlvbi4gKi9cbiAgQElucHV0KCkgZHVyYXRpb246IG51bWJlciA9IHRoaXMuZGVmYXVsdHMuZHVyYXRpb247XG5cbiAgLyoqIFdpZHRoIG9mIHRoZSBjaXJjbGUncyBzdHJva2UuICovXG4gIEBJbnB1dCgpIHN0cm9rZTogbnVtYmVyID0gdGhpcy5kZWZhdWx0cy5zdHJva2U7XG5cbiAgLyoqIENvbG9yIG9mIHRoZSBjaXJjbGUuICovXG4gIEBJbnB1dCgpIGNvbG9yOiBzdHJpbmcgPSB0aGlzLmRlZmF1bHRzLmNvbG9yO1xuXG4gIC8qKiBCYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBjaXJjbGUuICovXG4gIEBJbnB1dCgpIGJhY2tncm91bmQ6IHN0cmluZyA9IHRoaXMuZGVmYXVsdHMuYmFja2dyb3VuZDtcblxuICAvKiogV2hldGhlciB0aGUgY2lyY2xlIHNob3VsZCB0YWtlIHVwIHRoZSB3aWR0aCBvZiBpdHMgcGFyZW50LiAqL1xuICBASW5wdXQoKSByZXNwb25zaXZlOiBib29sZWFuID0gdGhpcy5kZWZhdWx0cy5yZXNwb25zaXZlO1xuXG4gIC8qKiBXaGV0aGVyIHRoZSBjaXJjbGUgaXMgZmlsbGluZyB1cCBjbG9ja3dpc2UuICovXG4gIEBJbnB1dCgpIGNsb2Nrd2lzZTogYm9vbGVhbiA9IHRoaXMuZGVmYXVsdHMuY2xvY2t3aXNlO1xuXG4gIC8qKiBXaGV0aGVyIHRvIHJlbmRlciBhIHNlbWljaXJjbGUuICovXG4gIEBJbnB1dCgpIHNlbWljaXJjbGU6IGJvb2xlYW4gPSB0aGlzLmRlZmF1bHRzLnNlbWljaXJjbGU7XG5cbiAgLyoqIFdoZXRoZXIgdGhlIHRpcCBvZiB0aGUgcHJvZ3Jlc3Mgc2hvdWxkIGJlIHJvdW5kZWQgb2ZmLiAqL1xuICBASW5wdXQoKSByb3VuZGVkOiBib29sZWFuID0gdGhpcy5kZWZhdWx0cy5yb3VuZGVkO1xuXG4gIC8qKiBFbWl0cyB3aGVuIGEgbmV3IHZhbHVlIGhhcyBiZWVuIHJlbmRlcmVkLiAqL1xuICBAT3V0cHV0KCkgb25SZW5kZXI6IEV2ZW50RW1pdHRlcjxudW1iZXI+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHByaXZhdGUgbGFzdEFuaW1hdGlvbklkID0gMDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHNlcnZpY2U6IFJvdW5kUHJvZ3Jlc3NTZXJ2aWNlLFxuICAgIHByaXZhdGUgZWFzaW5nOiBSb3VuZFByb2dyZXNzRWFzZSxcbiAgICBASW5qZWN0KFJPVU5EX1BST0dSRVNTX0RFRkFVTFRTKSBwcml2YXRlIGRlZmF1bHRzOiBSb3VuZFByb2dyZXNzRGVmYXVsdHMsXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZVxuICApIHt9XG5cbiAgLyoqIEFuaW1hdGVzIGEgY2hhbmdlIGluIHRoZSBjdXJyZW50IHZhbHVlLiAqL1xuICBwcml2YXRlIF9hbmltYXRlQ2hhbmdlKGZyb206IG51bWJlciwgdG86IG51bWJlcik6IHZvaWQge1xuICAgIGlmICh0eXBlb2YgZnJvbSAhPT0gJ251bWJlcicpIHtcbiAgICAgIGZyb20gPSAwO1xuICAgIH1cblxuICAgIHRvID0gdGhpcy5fY2xhbXAodG8pO1xuICAgIGZyb20gPSB0aGlzLl9jbGFtcChmcm9tKTtcblxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIGNvbnN0IGNoYW5nZUluVmFsdWUgPSB0byAtIGZyb207XG4gICAgY29uc3QgZHVyYXRpb24gPSBzZWxmLmR1cmF0aW9uO1xuXG4gICAgLy8gQXZvaWQgZmlyaW5nIGNoYW5nZSBkZXRlY3Rpb24gZm9yIGVhY2ggb2YgdGhlIGFuaW1hdGlvbiBmcmFtZXMuXG4gICAgc2VsZi5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHNlbGYuc2VydmljZS5nZXRUaW1lc3RhbXAoKTtcbiAgICAgICAgY29uc3QgaWQgPSArK3NlbGYubGFzdEFuaW1hdGlvbklkO1xuXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiBhbmltYXRpb24oKSB7XG4gICAgICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBNYXRoLm1pbihzZWxmLnNlcnZpY2UuZ2V0VGltZXN0YW1wKCkgLSBzdGFydFRpbWUsIGR1cmF0aW9uKTtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNlbGYuZWFzaW5nW3NlbGYuYW5pbWF0aW9uXShjdXJyZW50VGltZSwgZnJvbSwgY2hhbmdlSW5WYWx1ZSwgZHVyYXRpb24pO1xuXG4gICAgICAgICAgc2VsZi5fc2V0UGF0aCh2YWx1ZSk7XG4gICAgICAgICAgc2VsZi5vblJlbmRlci5lbWl0KHZhbHVlKTtcblxuICAgICAgICAgIGlmIChpZCA9PT0gc2VsZi5sYXN0QW5pbWF0aW9uSWQgJiYgY3VycmVudFRpbWUgPCBkdXJhdGlvbikge1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGlmICh0aGlzLmFuaW1hdGlvbkRlbGF5ID4gMCkge1xuICAgICAgICBzZXRUaW1lb3V0KHN0YXJ0LCB0aGlzLmFuaW1hdGlvbkRlbGF5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0YXJ0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKiogU2V0cyB0aGUgcGF0aCBkaW1lbnNpb25zLiAqL1xuICBwcml2YXRlIF9zZXRQYXRoKHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wYXRoKSB7XG4gICAgICBjb25zdCBhcmMgPSB0aGlzLnNlcnZpY2UuZ2V0QXJjKHZhbHVlLCB0aGlzLm1heCwgdGhpcy5yYWRpdXMgLSB0aGlzLnN0cm9rZSAvIDIsIHRoaXMucmFkaXVzLCB0aGlzLnNlbWljaXJjbGUpO1xuICAgICAgdGhpcy5wYXRoLm5hdGl2ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkJywgYXJjKTtcbiAgICB9XG4gIH1cblxuICAvKiogQ2xhbXBzIGEgdmFsdWUgYmV0d2VlbiB0aGUgbWF4aW11bSBhbmQgMC4gKi9cbiAgcHJpdmF0ZSBfY2xhbXAodmFsdWU6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKHZhbHVlIHx8IDAsIHRoaXMubWF4KSk7XG4gIH1cblxuICAvKiogRGV0ZXJtaW5lcyB0aGUgU1ZHIHRyYW5zZm9ybXMgZm9yIHRoZSA8cGF0aD4gbm9kZS4gKi9cbiAgZ2V0UGF0aFRyYW5zZm9ybSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRpYW1ldGVyID0gdGhpcy5fZ2V0RGlhbWV0ZXIoKTtcblxuICAgIGlmICh0aGlzLnNlbWljaXJjbGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmNsb2Nrd2lzZVxuICAgICAgICA/IGB0cmFuc2xhdGUoMCwgJHtkaWFtZXRlcn0pIHJvdGF0ZSgtOTApYFxuICAgICAgICA6IGB0cmFuc2xhdGUoJHtkaWFtZXRlciArICcsJyArIGRpYW1ldGVyfSkgcm90YXRlKDkwKSBzY2FsZSgtMSwgMSlgO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuY2xvY2t3aXNlKSB7XG4gICAgICByZXR1cm4gYHNjYWxlKC0xLCAxKSB0cmFuc2xhdGUoLSR7ZGlhbWV0ZXJ9IDApYDtcbiAgICB9XG4gIH1cblxuICAvKiogUmVzb2x2ZXMgYSBjb2xvciB0aHJvdWdoIHRoZSBzZXJ2aWNlLiAqL1xuICByZXNvbHZlQ29sb3IoY29sb3I6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuc2VydmljZS5yZXNvbHZlQ29sb3IoY29sb3IpO1xuICB9XG5cbiAgLyoqIENoYW5nZSBkZXRlY3Rpb24gY2FsbGJhY2suICovXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcy5jdXJyZW50KSB7XG4gICAgICB0aGlzLl9hbmltYXRlQ2hhbmdlKGNoYW5nZXMuY3VycmVudC5wcmV2aW91c1ZhbHVlLCBjaGFuZ2VzLmN1cnJlbnQuY3VycmVudFZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2V0UGF0aCh0aGlzLmN1cnJlbnQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBEaWFtZXRlciBvZiB0aGUgY2lyY2xlLiAqL1xuICBfZ2V0RGlhbWV0ZXIoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5yYWRpdXMgKiAyO1xuICB9XG5cbiAgLyoqIFRoZSBDU1MgaGVpZ2h0IG9mIHRoZSB3cmFwcGVyIGVsZW1lbnQuICovXG4gIF9nZXRFbGVtZW50SGVpZ2h0KCk6IHN0cmluZyB7XG4gICAgaWYgKCF0aGlzLnJlc3BvbnNpdmUpIHtcbiAgICAgIHJldHVybiAodGhpcy5zZW1pY2lyY2xlID8gdGhpcy5yYWRpdXMgOiB0aGlzLl9nZXREaWFtZXRlcigpKSArICdweCc7XG4gICAgfVxuICB9XG5cbiAgLyoqIFZpZXdib3ggZm9yIHRoZSBTVkcgZWxlbWVudC4gKi9cbiAgX2dldFZpZXdCb3goKTogc3RyaW5nIHtcbiAgICBjb25zdCBkaWFtZXRlciA9IHRoaXMuX2dldERpYW1ldGVyKCk7XG4gICAgcmV0dXJuIGAwIDAgJHtkaWFtZXRlcn0gJHt0aGlzLnNlbWljaXJjbGUgPyB0aGlzLnJhZGl1cyA6IGRpYW1ldGVyfWA7XG4gIH1cblxuICAvKiogQm90dG9tIHBhZGRpbmcgZm9yIHRoZSB3cmFwcGVyIGVsZW1lbnQuICovXG4gIF9nZXRQYWRkaW5nQm90dG9tKCk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMucmVzcG9uc2l2ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2VtaWNpcmNsZSA/ICc1MCUnIDogJzEwMCUnO1xuICAgIH1cbiAgfVxufVxuIl19